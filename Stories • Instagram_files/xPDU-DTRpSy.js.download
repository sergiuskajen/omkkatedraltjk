;/*FB_PKG_DELIM*/

__d("ArmadilloReceiveWriteDbFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5720");b=d("FalcoLoggerInternal").create("armadillo_receive_write_db_failure",a);e=b;g["default"]=e}),98);
__d("ArmadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={add:(a=c("JSResourceForInteraction"))("AddTaskHandler").__setRef("ArmadilloTaskHandlers"),get_messenger_db_dump_attachments_for_bug_reporting:a("GetMessengerDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),maw_get_devices:a("MAWGetDevicesTaskHandler").__setRef("ArmadilloTaskHandlers"),preload_messenger_db_dump_attachments_for_bug_reporting:a("PreloadDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),test:a("TestNativeTaskHandler").__setRef("ArmadilloTaskHandlers"),zenon_send_chatd_mws_message:a("MAWZenonSendMultiwayMsgChatdTaskHandler").__setRef("ArmadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("MAWCommonWebWorkerErrorLogging",["Env","ErrorGuard","ErrorPubSub","ErrorSetup","ErrorTransport","JSErrorLoggingConfig","SiteData","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(){(h||(h=c("ErrorGuard"))).skipGuardGlobal((i||(i=c("Env"))).nocatch),c("ErrorSetup").setup({appId:c("JSErrorLoggingConfig").appId,client_revision:c("SiteData").client_revision,extra:c("JSErrorLoggingConfig").extra,loggingFramework:"worker",projectBlocklist:c("JSErrorLoggingConfig").projectBlocklist,report_source:c("JSErrorLoggingConfig").report_source,report_source_ref:c("JSErrorLoggingConfig").report_source_ref,sample_weight:c("JSErrorLoggingConfig").sampleWeight!=null?c("JSErrorLoggingConfig").sampleWeight:0,site_category:"armadillo-worker"},d("ErrorTransport").log),self.addEventListener("unhandledrejection",function(a){a=a.reason;(j||(j=c("ErrorPubSub"))).reportError(c("getErrorSafe")(a))})}c("ErrorSetup").preSetup();g.init=a}),98);
__d("MAWPREListeners",["MAWODSProxy","MAWQplProxy","SiteData","WALogger","WAMapWithDefault","WAOdsEnums","WAPREList","WAPREMetrics","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unreachable stage value for the event"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was processed already"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was processed already"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was processed already"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was completed or failed already"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot RESUME without instanceKey"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was completed or failed already"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unreachable stage value for the ODS event"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Event "," not implemented"]);p=function(){return a};return a}function a(){d("WAPREMetrics").subscribe(r)}var q=new(d("WAMapWithDefault").MapWithDefault)(function(){return new Map()});function b(a){return r(a)}function r(a){switch(a.name){case d("WAPREList").PRE_METRIC.EBDB_INIT:t(c("qpl")._(521473151,"2593"),a);break;case d("WAPREList").PRE_METRIC.DELETE_THREAD:t(c("qpl")._(1056845732,"691"),a);break;case d("WAPREList").PRE_METRIC.FRANKING_VALIDATION:t(c("qpl")._(25299246,"150"),a);break;case d("WAPREList").PRE_METRIC.QUERY_GROUPS:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.QUERY_GROUP:s(d("WAOdsEnums").Entity.WA_QUERY_GROUP,a);break;case d("WAPREList").PRE_METRIC.OFFLINE_RETRY:t(c("qpl")._(25309990,"124"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD:t(c("qpl")._(25312150,"83"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_UPLOAD:t(c("qpl")._(25313100,"131"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_VALIDATE:t(c("qpl")._(25304678,"2352"),a);break;case d("WAPREList").PRE_METRIC.GET_DEVICES:s(d("WAOdsEnums").Entity.GET_DEVICES,a);break;case d("WAPREList").PRE_METRIC.MESSAGE_DECRYPTION:t(c("qpl")._(25306682,"11176"),a);s(d("WAOdsEnums").Entity.DECRYPTION,a);break;case d("WAPREList").PRE_METRIC.DECRYPT_MESSAGE_FINAL:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION:t(c("qpl")._(25299294,"12933"),a);t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.OFFLINE_QUEUE:t(c("qpl")._(25306361,"5664"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_FATAL_ERROR:t(c("qpl")._(25310891,"540"),a);break;case d("WAPREList").PRE_METRIC.SEND_MESSAGE:t(c("qpl")._(25313175,"1551"),a);break;case d("WAPREList").PRE_METRIC.CREATE_GROUP:t(c("qpl")._(25307987,"970"),a);break;case d("WAPREList").PRE_METRIC.REMOVE_PARTICIPANTS:t(c("qpl")._(25312342,"971"),a);break;case d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE:t(c("qpl")._(1056840931,"814"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_EVENT:t(c("qpl")._(25311142,"804"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_BOOTSTRAP_STAGE:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_DECRYPT_MUTATIONS:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_DATA_APPLIED:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.APP_STATE_SYNC_DAILY:t(c("qpl")._(25306941,"813"),a);break;case d("WAPREList").PRE_METRIC.ICDC_ERROR:t(c("qpl")._(25313187,"948"),a);break;case d("WAPREList").PRE_METRIC.WA_DISCONNECT:s(d("WAOdsEnums").Entity.WA_DISCONNECT,a);break;case d("WAPREList").PRE_METRIC.WA_FAIL_STANZA_QUEUE_ITEM:s(d("WAOdsEnums").Entity.WA_FAIL_STANZA_QUEUE_ITEM,a);break;case d("WAPREList").PRE_METRIC.WA_JOBS_ORCHESTRATOR:t(c("qpl")._(25311870,"1004"),a);break;case d("WAPREList").PRE_METRIC.WA_JOB_MANAGER:t(c("qpl")._(25308825,"136"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_KEY_ROTATION:t(c("qpl")._(25304909,"1204"),a);break;case d("WAPREList").PRE_METRIC.STANZA_QUEUE_MESSAGE_CONSUMER:break;case d("WAPREList").PRE_METRIC.DOWNLOAD_AND_DECRYPT:d("WALogger").ERROR(p(),a.name);break;case d("WAPREList").PRE_METRIC.ONE_QUEUE:t(c("qpl")._(25308201,"2007"),a);break;case d("WAPREList").PRE_METRIC.WA_NO_SIGNED_PRE_KEY:s(d("WAOdsEnums").Entity.WA_NO_SIGNED_PRE_KEY,a);break}}function s(a,b){var c;switch(b.stage){case"START":break;case"RESUME":case"POINT":case"ANNOTATE":case"CANCEL":break;case"SUCCESS":d("MAWODSProxy").odsBumpEntityKey({entity:a,key:(c=(c=b.annotations)==null?void 0:(c=c.string)==null?void 0:c.key)!=null?c:"success"},!0);break;case"FAIL":d("MAWODSProxy").odsBumpEntityKey({entity:a,key:b.reason},!0);break;default:b.stage;d("WALogger").ERROR(o());break}}function t(a,b){var e=babelHelpers["extends"]({},b.annotations);switch(b.stage){case"START":if(q.get(a).has(b.instanceKey))return;var f=babelHelpers["extends"]({},e,{"int":babelHelpers["extends"]({},e["int"],{sharedWorkerRev:c("SiteData").client_revision})});f=d("MAWQplProxy").startQplUserFlow(a,f,{providedTimeoutInMs:b.timeoutInMs});q.get(a).set(b.instanceKey,f);break;case"ANNOTATE":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(n(),b.name);return}f.addAnnotations(e);break;case"RESUME":if(b.instanceKey==null){d("WALogger").ERROR(m());return}if(u(a,b.instanceKey))return;f=d("MAWQplProxy").startQplUserFlow(a,e,{providedInstanceKey:b.instanceKey});q.get(a).set(b.instanceKey,f);break;case"POINT":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(l(),b.name);return}f.addPoint(b.reason,e);break;case"SUCCESS":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(k(),b.name);return}f.endSuccess(e);q.get(a)["delete"](b.instanceKey);break;case"CANCEL":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(j(),b.name);return}f.endCancel(e);q.get(a)["delete"](b.instanceKey);break;case"FAIL":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(i(),b.name);return}f.endFail(b.reason,e);q.get(a)["delete"](b.instanceKey);break;default:d("WALogger").ERROR(h());break}}function u(a,b){return q.get(a).has(b)||a===c("qpl")._(25313175,"1551")}g.initializeWAPREMetrics=a;g.testOnly_logger=b}),98);
__d("WAAbPropConverters",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(!a)return{};var b={};Object.keys(a).forEach(function(c){var d=a[c];d!=null&&(b[c]=d)});return b}f.convertAbPropsToPlainObject=a}),66);
__d("WAAbPropsCache",["WAAbPropConverters"],(function(a,b,c,d,e,f,g){"use strict";var h=86400;a=function(){function a(a){var b=a.abKey,c=a.abHash,d=a.lastSyncTime,e=a.expoKeyStr,f=a.refresh,g=a.internalExpoKeys,h=a.propExpoKeys,i=a.propValues;a=a.overridePropValues;this.$1=a!=null?a:{};this.$2=i;this.$4=c;this.$3=b;this.$5=d;this.$7=f;this.$6=e;this.$8=g;this.$9=h}var b=a.prototype;b.getAbProp=function(a){var b;return this.$1[a]!=null?this.$1[a]:(b=this.$2)==null?void 0:b[a]};b.getHash=function(){return this.$4};b.getRefreshSecs=function(){var a;return(a=this.$7)!=null?a:h};b.overrideAbProp=function(a,b){this.$1[a]=b};b.readAll=function(){var a={abKey:this.$3,hash:this.getHash(),refresh:this.getRefreshSecs(),lastSyncTime:this.$5||0};this.$9!=null&&(a.propExpoKeys=this.$9);this.$8!=null&&(a.internalExpoKeys=this.$8);this.$6!=null&&(a.expoKeyStr=this.$6);if(this.$2!=null){var b=this.$2;b!=null&&(a.propValues=d("WAAbPropConverters").convertAbPropsToPlainObject(b),this.$1!=null&&(a.propValues=babelHelpers["extends"]({},a.propValues,{},d("WAAbPropConverters").convertAbPropsToPlainObject(this.$1))))}return a};b.rewrite=function(a){var b=a.abKey,c=a.abHash,d=a.lastSyncTime,e=a.expoKeyStr,f=a.refresh,g=a.internalExpoKeys,h=a.propExpoKeys;a=a.propValues;this.$2=a;this.$4=c;this.$3=b;this.$5=d;this.$7=f;this.$6=e;this.$8=g;this.$9=h};return a}();g.AbPropsCache=a}),98);
__d("WAAbPropsConverters",["WAAbPropsTypes","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["convertDbAbPropsToParsed: unsure how to read ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["convertAbPropsParsedToDbEntity: unsure how to read ",""]);i=function(){return a};return a}function a(a){var b={expoKeyStr:a.expoKeyStr,internalExpoKeys:a.internalExpoKeys?Array.from(a.internalExpoKeys):[],lastSyncTime:a.lastSyncTime,refresh:a.refresh};a.abHash!=null&&(b.abHash=a.abHash);a.abKey!=null&&(b.abKey=a.abKey);if(a.propExpoKeys){var c=a.propExpoKeys,e=[];Object.keys(c).forEach(function(a){a=Number(a);var b={expoKey:a};c[a]!=null&&(b.value=c[a]);e.push(b)});b.propExpoKeys=e}if(a.propValues){var f=a.propValues,g=[];Object.keys(f).forEach(function(a){var b={name:a,value:{}};switch(typeof f[a]){case"boolean":b.value.boolValue=f[a];break;case"number":b.value.intValue=f[a];break;case"string":b.value.strValue=f[a];break;default:d("WALogger").WARN(i(),f[a]);return}g.push(b)});b.propValues=g}return b}function b(a){var b={expoKeyStr:a.expoKeyStr,internalExpoKeys:a.internalExpoKeys,lastSyncTime:a.lastSyncTime,propExpoKeys:a.propExpoKeys,refresh:a.refresh};a.hash!=null&&(b.abHash=a.hash);a.abKey!=null&&(b.abKey=a.abKey);if(a.propValues){var c=a.propValues,d={};Object.keys(c).forEach(function(a){c[a]!=null&&(d[a]=c[a])});b.propValues=d}return b}function c(a){var b=a.abHash,c=a.abKey,e=a.expoKeyStr,f=a.internalExpoKeys,g=a.lastSyncTime,i=a.propExpoKeys,j=a.propValues;a=a.refresh;b={abHash:b,abKey:c,expoKeyStr:e,lastSyncTime:g,refresh:a};f!=null&&(b.internalExpoKeys=new Set(f));if(i!=null){var k={};i.forEach(function(a){a.expoKey!=null&&(k[a.expoKey]=a.value)});b.propExpoKeys=k}if(j!=null){var l={};j.forEach(function(a){var b=a.name,c=d("WAAbPropsTypes").ABPropConfigs[b];if(c==null||c.length<3)return;c=c[2];switch(typeof c){case"boolean":l[b]=a.value.boolValue;return;case"number":l[b]=a.value.intValue;return;case"string":l[b]=a.value.strValue;return;default:d("WALogger").WARN(h(),c);return}});b.propValues=l}return b}g.convertAbPropsParsedToDbEntity=a;g.convertAbPropsDataToParsed=b;g.convertDbAbPropsToParsed=c}),98);
__d("WAGetAbPropsApi",["WAGetMetaApiV2"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WAGetMetaApiV2").getMeta().then(function(a){a=a.abProps;return a})};g.getAbProps=a}),98);
__d("WASetAbPropsApi",["WASetMetaApiV2"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASetMetaApiV2").setMeta({abProps:a})};g.setAbProps=a}),98);
__d("WAAbPropsInit",["Promise","WAAbProps","WAAbPropsCache","WAAbPropsConverters","WAAbPropsToUI","WAAbPropsTypes","WABridge","WAGetAbPropsApi","WALogger","WASetAbPropsApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ABProps inited"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting ABProps store"]);j=function(){return a};return a}var k;function a(){if(!k)throw c("err")("Trying to get hash before AbProps gets initialized");return(h||(h=b("Promise"))).resolve(k.getHash())}function e(){if(!k)throw c("err")("Trying to get refresh secs before AbProps gets initialized");return(h||(h=b("Promise"))).resolve(k.getRefreshSecs())}var l={getAbProps:function(){if(!k)throw c("err")("Trying to read ABProps before they gets initialized");return(h||(h=b("Promise"))).resolve(k.readAll())},getHash:a,getRefreshSecs:e,setAbProps:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=d("WAAbPropsConverters").convertAbPropsDataToParsed(a);(b=k)==null?void 0:b.rewrite(a);yield d("WASetAbPropsApi").setAbProps(d("WAAbPropsConverters").convertAbPropsParsedToDbEntity(a));m(a)});function c(b){return a.apply(this,arguments)}return c}()};function m(a){if(!a.propValues)return;a=d("WAAbPropsToUI").prepareAbPropsForUI(a.propValues);d("WABridge").getBridge().fireAndForget("event","abPropsUpdated",{abProps:a})}function f(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(j());var a=(yield d("WAGetAbPropsApi").getAbProps()),b={};a&&(b=d("WAAbPropsConverters").convertDbAbPropsToParsed(a));k=new(d("WAAbPropsCache").AbPropsCache)(b);d("WAAbProps").startAbProps(l,d("WAAbPropsTypes").ABPropConfigs);m(b);d("WALogger").LOG(i())});return n.apply(this,arguments)}function o(a,b){if(k==null)throw c("err")("Trying to override ABProp before they get initialized");var e=k;e.overrideAbProp(a,b);m(d("WAAbPropsConverters").convertAbPropsDataToParsed(e.readAll()))}function p(a){return d("WAAbPropsTypes").ABPropConfigs[a][2]}function q(){if(!k)throw c("err")("Trying to read ABProps before they get initialized");return k.readAll()}function r(a){if(!k)throw c("err")("Trying to read ABProp "+a+" before AbProps gets initialized");var b=k.getAbProp(a);return b!=null?b:p(a)}g.getHash=a;g.getRefreshSecs=e;g.initAbProps=f;g.overrideAbProp=o;g.getAbDefault=p;g.getAbProps=q;g.getAbProp=r}),98);
__d("MAWWebWorkerLogger",["MAWBridge","MAWConsoleLogger","MAWLeakDetection","MAWLoggingSwitches","MAWSaveLogToDisk","WAAbPropsInit","WAJids","WATagsLogger","asyncToGeneratorRuntime","err","fb-error"],(function(a,b,c,d,e,f,g){"use strict";var h=2;function a(){d("WATagsLogger").initializeWaLogger(i)}var i={count:function(a,b){k("count",a,b),d("MAWConsoleLogger").logToConsole("count",a,b)},debug:function(a,b,c){d("MAWConsoleLogger").logToConsole("log",a,b,c)},devConsole:function(a,b,c,e){for(var f=arguments.length,g=new Array(f>4?f-4:0),h=4;h<f;h++)g[h-4]=arguments[h];switch(a){case"COUNT":d("MAWConsoleLogger").logToConsole.apply(void 0,["count",b,c,e].concat(g));break;case"DEV":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c,e].concat(g));break;case"DEV_XMPP":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c,e].concat(g));break;case"LOG":d("MAWConsoleLogger").logToConsole.apply(void 0,["info",b,c,e].concat(g));break;case"WARN":d("MAWConsoleLogger").logToConsole.apply(void 0,["warn",b,c,e].concat(g));break;case"ERROR":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c,e].concat(g));break;case"CATCHING":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c,e].concat(g));break}},error:function(a,b,e){a=d("MAWLeakDetection").maybeReplaceVaultedString(a);e?m(a,b,e):m("webworker",b,c("err")(d("WAJids").maybeSanitizeLogLineText(a)));d("MAWConsoleLogger").logToConsole("error",a,b)},info:function(a,b){k("log",a,b),d("MAWConsoleLogger").logToConsole("info",a,b)},logRestricted:function(a,b){k("logRestricted",a,b),d("MAWConsoleLogger").logToConsole("log",a,b)},warn:function(a,b){k("warn",a,b),d("MAWConsoleLogger").logToConsole("warn",a,b)}};function j(){try{return d("WAAbPropsInit").getAbProp("msgrw_logger_entries")}catch(a){return d("WAAbPropsInit").getAbDefault("msgrw_logger_entries")}}function k(a,b,c){if(d("MAWLoggingSwitches").removeLoggingFromBridge){d("MAWSaveLogToDisk").saveLogEntry("worker",d("MAWSaveLogToDisk").formatLog({date:Date.now(),logLevel:a,logString:b,tags:c}));a==="count"&&d("MAWBridge").getBridge().fireAndForget("event","log",{logLevel:a,logString:b,tags:c},!0);return}a!=="debug"&&d("MAWBridge").getBridge().fireAndForget("event","log",{logLevel:a,logString:b,tags:c},!0)}function e(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWSaveLogToDisk").forceCachedLogEntryPersist()});return l.apply(this,arguments)}function m(a,b,e){var f=0;if(e.taalOpcodes!=null){var g;(g=e.taalOpcodes)==null?void 0:g.forEach(function(a){a===c("fb-error").TAALOpcode.PREVIOUS_FRAME&&f++})}else f=h;d("MAWLoggingSwitches").removeLoggingFromBridge&&d("MAWSaveLogToDisk").saveLogEntry("worker",d("MAWSaveLogToDisk").formatErrorForLogging(a,b,e,f,j(),e.stack));d("MAWBridge").getBridge().fireAndForget("event","logError",{entriesToReport:j(),framesToPop:f,logString:a,message:e.message,stack:e.stack,tags:b},!0)}g.setupWebWorkerWaLogger=a;g.flushLogs=e}),98);
__d("WAQPLProxy",["WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""]);i=function(){return a};return a}function a(a,b,e,f,g){g===void 0&&(g=!0);if(j==null){d("WALogger").ERROR(i(),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.start(a,b,e,f,g)}function b(a,b){if(j==null){d("WALogger").ERROR(h(),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.resume(a,b)}var j=null;function e(a){j=a}g.waQPLProxyStart=a;g.waQPLProxyStartResume=b;g.provideProxyImplementationForWAQPLProxy=e}),98);
__d("BackendInitLoggingUtils",["ErrorMetadata","MAWCommonWebWorkerErrorLogging","MAWLoggerUtils","MAWPREListeners","MAWQplProxy","MAWWebWorkerLogger","MWSetupDBEncryption","WAQPLProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){return d("MAWQplProxy").measurePerfInQPL_USE_WITH_CARE(c("qpl")._(25310776,"6155"),"backend_"+a,b)};b=function(a){return d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),a)};e=function(a){return d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056839232,"112"),a)};function a(){d("MAWWebWorkerLogger").setupWebWorkerWaLogger(),d("MAWCommonWebWorkerErrorLogging").init(),c("ErrorMetadata").addGlobalMetadata("MESSENGER_E2EE_WEB","ENVIRONMENT","worker"),d("MAWLoggerUtils").initMessengerWebLogging(),d("WAQPLProxy").provideProxyImplementationForWAQPLProxy({resume:d("MAWQplProxy").makeQplUserFlowFromExistedInstance,start:function(a,b,c,e,f){return d("MAWQplProxy").startQplUserFlow(a,b,{callBridgeWithTimestamp:f,providedInstanceKey:c,providedTimeoutInMs:e})}}),d("MAWPREListeners").initializeWAPREMetrics(),d("MWSetupDBEncryption").setPerformanceMeasurementTool(h)}g.measureMawInit=h;g.MAWInitPoint=b;g.MAWMICPoint=e;g.initializeBackendLogging=a}),98);
__d("BroadcastChannelClientServerHandshake",["FBLogger","Promise","Random","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.addEventListener("message",function(b){var c;((c=b.data)==null?void 0:c.type)==="BroadcastChannelHandshake-syn"&&a.postMessage({nonce:b.data.nonce,type:"BroadcastChannelHandshake-syn-ack"})})}function e(a,e){var f=d("Random").random(),g=0;return new(h||(h=b("Promise")))(function(b,d){var h=!1,i=function b(){if(g===6){h=!0;a.removeEventListener("message",j);try{throw c("FBLogger")("messenger_web").mustfixThrow("[LS] BC handshake failed, failing, likely worker failure%s",e!=null?" for"+e:"")}catch(a){d(a)}return}if(h)return;a.postMessage({nonce:f,type:"BroadcastChannelHandshake-syn"});c("setTimeout")(b,100*Math.pow(2,g++))},j=function c(d){var e;((e=d.data)==null?void 0:e.type)==="BroadcastChannelHandshake-syn-ack"&&((e=d.data)==null?void 0:e.nonce)===f&&(b(),h=!0,a.removeEventListener("message",c))};a.addEventListener("message",j);i()})}g.listen=a;g.checkAlive=e}),98);
__d("CoalescingLoader",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g;function h(){return new(g||(g=b("Promise")))(function(a){return globalThis.setTimeout(a,0)})}a=function(){function a(a,b){b===void 0&&(b=h),this.$1=a,this.$2=[],this.$3=null,this.$4=b}var c=a.prototype;c.gen=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){this.$2.push(a);a=this.$2.length-1;var b=(yield this.$5());return b[a]});function c(b){return a.apply(this,arguments)}return c}();c.$5=function(){if(this.$3!=null)return this.$3;this.$3=this.$6();return this.$3};c.$6=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield this.$4();var a=this.$2;this.$2=[];this.$3=null;return this.$1([].concat(a))});function c(){return a.apply(this,arguments)}return c}();return a}();f.CoalescingLoader=a}),66);
__d("CometTaskFrameworkTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UNKNOWN","BACKGROUND","CURRENT_THREAD","LS_WORKER","MAW_WORKER","TEST"]);c="comet_task_framework";f.ExecutionContext=a;f.TASK_FRAMEWORK_PREFIX=c}),66);
__d("InstamadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={33:(a=c("JSResourceForInteraction"))("IGDUnsendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),46:a("IGDSendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_edit_message:a("IGDEditMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_react_message:a("IGDSendRemoveReactionTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_media_message:a("IGDSendMediaMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_xma_receiver_fetch:a("IGDSendXmaReceiverFetchTaskHandler").__setRef("InstamadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("CometTaskHandlers",["ArmadilloTaskHandlers","InstamadilloTaskHandlers"],(function(a,b,c,d,e,f,g){"use strict";a=babelHelpers["extends"]({},d("ArmadilloTaskHandlers").TASK_HANDLERS_RESOURCES,{},d("InstamadilloTaskHandlers").TASK_HANDLERS_RESOURCES);g.TASK_HANDLERS_RESOURCES=a}),98);
__d("WorkerBootstrap",["HasteSupportData","ServerJSDefine"],(function(a,b,c,d,e,f,g){"use strict";function h(a){Object.keys(a).forEach(function(b){c("ServerJSDefine").handleDefine(b,[],a[b],-1,null)})}function a(a,c){var f,g;a.hsdp&&d("HasteSupportData").handle(a.hsdp);var i=(f=(g=a.jsmods)!=null?g:a.dynamicModules)!=null?f:{};h(i);var j=b.call(null,c);a.rds!=null&&a.rds.length>0&&e.call(null,a.rds,function(){});if(typeof j==="function"||j!==null)try{for(var k=arguments.length,l=new Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];j.apply(void 0,l)}catch(a){}}function f(a){a=a;if(typeof a==="function"||a!==null)try{a()}catch(a){}}g.initDynamicModules=h;g.start=a;g.startServerJS=f}),98);
__d("CurrentSharedWorker",["HasteSupportData","QPLUserFlow","SharedWorkerStatusLock","WorkerBootstrap","emptyFunction","err","justknobx","qpl","structuredClone"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=[],j=new Set(),k=[],l=!1,m=!1,n=null,o=!1,p=c("qpl")._(931609794,"2369");c("QPLUserFlow").start(p);var q=d("SharedWorkerStatusLock").getStatusLock();c("QPLUserFlow").addPoint(p,"status_lock");c("QPLUserFlow").addAnnotations(p,{string:{id:self.worker_id}});self.setTimeout(function(){if(!o){try{var a;(a=j.values().next().value)==null?void 0:a.postMessage({type:"self-terminate",response:{from:"bundle",workerID:self.worker_id}})}catch(a){c("QPLUserFlow").endFailure(p,"timeout_termination_error"),x(a)}self.close()}},3e5);function r(){m=!0,n=null,h!==null&&(c("QPLUserFlow").addPoint(p,"process_message_buffer"),c("QPLUserFlow").addAnnotations(p,{"int":{message_buffer_size:i.length}}),i.forEach(function(a){return a()}),i=[]),c("QPLUserFlow").endSuccess(p)}function s(a,f){var g=a.data;if(typeof g==="object"&&(g==null?void 0:g.type)==="execute-worker"){var k=!l;try{if(!l&&g.args instanceof Array){var t=g.args[0],u=t.hsdp,v=t.jsmods,w=t.dynamicModules;t=t.rds;c("QPLUserFlow").addPoint(p,"first_init");u!=null&&d("HasteSupportData").handle(u);d("WorkerBootstrap").initDynamicModules((u=v!=null?v:w)!=null?u:{});t!=null&&t.length>0&&e.call(null,t,function(){});q.init({requestWorkerIdStatusLockToo:c("justknobx")._("4202")});c("QPLUserFlow").addPoint(p,"status_lock_init");l=!0;n!=null&&(n(),r())}v=b.call(b,"SiteData");j.size>1&&f.postMessage({type:"execute-worker-imports",response:{}});f.postMessage({type:"execute-worker-ack",response:{firstInit:k,workerRevision:v.client_revision,spinMode:v.spin,spinTime:v.__spin_t}});o=!0}catch(a){c("QPLUserFlow").endFailure(p,"worker_init_error"),q.release(),f.postMessage({type:"execute-worker-ack",response:{firstInit:k,error:a.message}}),self.close()}}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-get-rev")try{w=b.call(b,"SiteData");f.postMessage({type:"sw-get-rev",response:{workerRevision:w.client_revision,spinMode:w.spin,spinTime:w.__spin_t}})}catch(a){f.postMessage({type:"sw-get-rev",response:{error:a.message}})}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-shutdown"){u=Array.isArray(g.args)?g.args[0]:null;typeof u==="object"&&(u==null?void 0:u.upgrade)===!0?y("requested-upgrade"):typeof u==="object"&&typeof (u==null?void 0:u.reason)==="string"?y(u==null?void 0:u.reason):y()}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-uptime-tracking"){v=typeof (g==null?void 0:g.args)==="object"?(t=g.args)==null?void 0:t.trackerID:null;f.postMessage({type:"sw-uptime-tracking",response:{trackerID:v}})}else typeof g==="object"&&(g==null?void 0:g.type)==="ww-hrp-init"?f.postMessage({type:"ww-hrp-init",response:{}}):typeof g==="object"&&(g==null?void 0:g.type)==="ww-connection-ack"?f.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id,hrpStatus:"processed"}}):h!==null&&m?h(g):i.push(function(){return s(a,f)})}function a(a){var b=h==null;h=a!=null?a:c("emptyFunction");b&&m&&(i.forEach(function(a){return a()}),i=[])}function t(a,b){j.forEach(function(c){try{c.postMessage(a,b)}catch(b){c.postMessage(a)}})}function f(a){if(l){c("QPLUserFlow").addPoint(p,"init_complete_handler_ran");a();r();return}c("QPLUserFlow").addPoint(p,"init_complete_handler_attached");n=a}["log","error","info","debug","warn"].forEach(function(a){if(self.console[a]==null)throw c("err")('"'+a+'" is not a valid console method.');var b=self.console[a];self.console[a]=function(){for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];b.apply(void 0,e);var g=!1;try{c("structuredClone")!=null&&c("structuredClone")(e),g=!0}catch(a){}if(!g){t({type:"console",response:{method:"error",args:["DataCloneError: Failed to forward console message from web worker due to args not being serializable."]}});return}t({type:"console",response:{method:a,args:e}})}});try{c("QPLUserFlow").addPoint(p,"bootstrap_start");var u=self.shared_worker_bootstrap_buffer==null?void 0:self.shared_worker_bootstrap_buffer(y);if(u!=null){var v=u.ports,w=u.messages;c("QPLUserFlow").addAnnotations(p,{"int":{bootstrap_ports_num:v.length}});v==null?void 0:v.forEach(function(a){try{a.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id,hrpStatus:"processed"}}),a.addEventListener("message",function(b){return s(b,a)}),j.add(a)}catch(a){c("QPLUserFlow").addPoint(p,"connection_fail"),x(a)}});w==null?void 0:w.forEach(function(a){try{s(a.e,a.port)}catch(b){c("QPLUserFlow").addPoint(p,"message_processing_fail");c("QPLUserFlow").addAnnotations(p,{string:{failed_msg_type:(a=(a=a.e.data)==null?void 0:a.type)!=null?a:"unknown"}});x(b)}c("QPLUserFlow").addAnnotations(p,{"int":{msg_num:w.length},string_array:{msgs:w.map(function(a){return(a=a.e.data)==null?void 0:a.type})}})})}else c("QPLUserFlow").addPoint(p,"bootstrap_buffer_empty")}catch(a){x(a),c("QPLUserFlow").endFailure(p,"uncaught_bootstrap_error")}function x(a){try{t({type:"sw-uncaught-error",e:{message:a.message,lineno:a.lineno,colno:a.colno,filename:a.filename,error:a.error}})}catch(b){c("QPLUserFlow").addPoint(p,"sending_error_failed");c("QPLUserFlow").addAnnotations(p,{string:{error:String((a=b.message)!=null?a:b)}})}}self.addEventListener("error",function(a){if(j.size===0){k.push(a);return}x(a)});self.addEventListener("connect",function(a){var b=a.ports[0];b.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id,hrpStatus:"processed"}});b.addEventListener("message",function(a){return s(a,b)});b.start();j.add(b);k.length>0&&(k.forEach(x),k.splice(0,k.length))});function y(a){q.release(),t({type:"sw-shutdown",response:{reason:a,workerID:self.worker_id,isInitialized:o}}),self.close()}g.setMessageHandler=a;g.postMessage=t;g.onInitComplete=f;g.shutdownWorker=y}),98);
__d("CurrentSharedWorkerAdapter",["CurrentSharedWorker","FBLogger"],(function(a,b,c,d,e,f,g){a=function(){function a(){}var b=a.prototype;b.addEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(function(a){return b({data:a})});break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.removeEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(null);break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.postMessage=function(a,b){d("CurrentSharedWorker").postMessage(a,b)};return a}();g.CurrentSharedWorkerAdapter=a}),98);
__d("CurrentWorkerMessagePort",["err","ifRequired"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(){if(h==null)if("SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope){var a;h=(a=c("ifRequired")("SharedWorkerBootstrapExperimental",function(a){return new a.CurrentSharedWorkerExperimentalAdapter()},function(){return null}))!=null?a:c("ifRequired")("CurrentSharedWorkerAdapter",function(a){return new a.CurrentSharedWorkerAdapter()},function(){return null})}else if("DedicatedWorkerGlobalScope"in self&&self instanceof self.DedicatedWorkerGlobalScope)h=self;else throw new Error("CurrentWorkerAdapter: Unsupported worker type");if(h==null)throw c("err")("CurrentWorkerAdapter: None of shared worker adapters are available");return h}g.getMessagePort=a}),98);
__d("EBMessagePointQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="24207115425591416"}),null);
__d("EBMessagePointQuery.graphql",["EBMessagePointQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},d={defaultValue:null,kind:"LocalArgument",name:"restore_type"},e=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],f={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},l=[g,h];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"EBMessagePointQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,a],kind:"Operation",name:"EBMessagePointQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages_point_restore",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},f,g,h,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_tags",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[i,f,g,h,j,k],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[i,f,g,h,j,k,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessagePointQuery_facebookRelayOperation"),metadata:{},name:"EBMessagePointQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("MAWConvertEchoMessagesToEBProtobufs",["MAWHandleEBRestoreWithHIM"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWHandleEBRestoreWithHIM").convertEchoMessagesToEBProtobufs(a,b)}g.convertEchoMessagesToEBProtobufs=a}),98);
__d("EBMessagePointQuery",["Base64Utils","EBAPIDecryptionModule","EBAPIQPLPoints","EBAPIWorkerCheck","EBLS","EBMessagePointQuery.graphql","EBMessageRangeQueryForThreads","FBLogger","I64","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSFactory","LSMEBTaskCreationSource","LSShape","LSVec","MAWConvertEchoMessagesToEBProtobufs","MAWCurrentUser","MAWEncryptedBackupUtils","MAWJobDefinitions","QPLUserFlow","WAGetSafeQPLError","WAHashStringToNumber","WAJids","WAResultOrError","WorkerRelay","WorkerRelayNetwork","asyncToGeneratorRuntime","gkx","handleRestoreMessagesGraphQLResponse","qpl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h!==void 0?h:h=b("EBMessagePointQuery.graphql");function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatJid,e=a.instanceKey,g=a.messageId;a=a.source;var h=c("qpl")._(521474469,"2612"),k=d("WAHashStringToNumber").hashStringToNumber(e!=null?e:c("uuidv4")());try{var l,m;if(!d("EBAPIWorkerCheck").runningInWorker())return d("WAResultOrError").makeError("unsupported-context");c("QPLUserFlow").start(h,{annotations:{"int":{source:a!=null?a:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:k});a=(yield d("EBLS").init()).db;c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.LSDB_SINGLETON_RETRIEVED,{instanceKey:k});var n=(yield d("handleRestoreMessagesGraphQLResponse").getClientState(a));c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CLIENT_STATE_RETRIEVED,{data:{string:{device_id:(i||(i=d("I64"))).to_string((l=n==null?void 0:n.device_id)!=null?l:(i||(i=d("I64"))).zero)}},instanceKey:k});if(n==null){c("QPLUserFlow").endFailure(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}},instanceKey:k});return d("WAResultOrError").makeError("no-client-state")}var o=d("WAJids").threadIdForChatJid(b);l=n.backupId;var p=n.device_id,q=n.locally_available_epochs,r=n.mailboxRootKey;n=n.ocmfClientStateBlob;if(l==null||p==null||r==null||n==null){c("QPLUserFlow").endFailure(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}},instanceKey:k});return d("WAResultOrError").makeError("invalid-client-state")}m=""+((m=d("MAWCurrentUser").getAppID())!=null?m:0);q={restore_context:{act_thread_id:o,site:"www",tam_thread_subtype:0},success:{device_context:{device_id:i.to_string(p),locally_available_epochs:q,raw_tokens:{mailbox_root_key:d("Base64Utils").fromArrayBuffer(r),ocmf_client_state_blob:d("Base64Utils").fromArrayBuffer(n)}},message_id:g}};r={app_id:m,restore_payload_string:JSON.stringify(q),restore_type:"POINT_QUERY_RESTORE"};c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_START,{instanceKey:k});yield d("WorkerRelayNetwork").createWorkerNetworkExecute();c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_END,{instanceKey:k});c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:k});n=(yield d("WorkerRelay").createWorkerQuery(j,r));c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,{instanceKey:k});r=n==null?void 0:(g=n.viewer)==null?void 0:(m=g.encrypted_backup)==null?void 0:(q=m.mailbox)==null?void 0:q.messages_point_restore;if(r==null){c("QPLUserFlow").endFailure(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:k});return d("WAResultOrError").makeError("invalid-graphql-response")}if((r==null?void 0:r.encrypted_messages)==null){c("QPLUserFlow").endFailure(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:k});return d("WAResultOrError").makeError("invalid-graphql-response")}n=r.backup_id;g=r.encrypted_messages;m=r.epoch_derivation_set;q=r.exception_string;if(q!=null){c("QPLUserFlow").endFailure(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:q}},instanceKey:k});return d("WAResultOrError").makeError("server-side-exception")}n==null&&c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,{instanceKey:k});c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,{instanceKey:k});c("QPLUserFlow").addAnnotations(h,{bool:{hasEpochs:m!=null&&m.epoch_edges.length>0}},{instanceKey:k});yield d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(m,a,p,void 0,!0);c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,{instanceKey:k});r=d("handleRestoreMessagesGraphQLResponse").processMessageArray(g,n!=null?n:(i||(i=d("I64"))).to_string(l));var s=r.encryptedLSEchoMessages,t=r.encryptedMessagesWithProtobufs;q=r.encryptedNonLSEchoMessages;m=r.encryptedNonLSProtobufs;if(c("gkx")("7473")){c("QPLUserFlow").addPoint(h,"native_decryption_start",{instanceKey:k});p=(yield d("EBAPIDecryptionModule").decryptUsingNativeJS(a,o,m,q));if(!p.success){c("QPLUserFlow").addPoint(h,"native_decryption_error",{instanceKey:k});return d("WAResultOrError").makeError("native-decryption-error")}g=p.value.decryptedEchoMessages;n=p.value.decryptedProtobufs;l=d("EBMessageRangeQueryForThreads").convertNativeDecryptionResponseToDecryptedMessageType(g,n);c("QPLUserFlow").addPoint(h,"native_decryption_success",{instanceKey:k});r=c("LSVec").toArray(l.echo);m=l.protobuf;q=r.map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)});p=[];g.length>0?p=d("MAWConvertEchoMessagesToEBProtobufs").convertEchoMessagesToEBProtobufs(q,b):p=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(m);c("QPLUserFlow").endSuccess(h,{annotations:{bool:{isEcho:g.length>0,isProtobuf:n.length>0}},instanceKey:k});return d("WAResultOrError").makeResult({instanceKey:e,messages:p})}if(t.length!==0&&s.length!==0){c("QPLUserFlow").endSuccess(h,{instanceKey:k});return d("WAResultOrError").makeResult({instanceKey:e,messages:[]})}if(t.length!==0){l={decryptedProtobufs:[],protobufDecryptionFailures:!1};c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,{instanceKey:k});r=(yield a.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:o,encryptedMessagesWithProtobufs:c("LSVec").ofArray(t)})},"readwrite",void 0,void 0,f.id+":492"));q=r[0];m=r[1];if(m!=null){l.protobufDecryptionFailures=!0;c("QPLUserFlow").endFailure(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROTOBUF_DECRYPTION_FAILURE,{instanceKey:k});return d("WAResultOrError").makeError("empty-decryption-response")}if(q!=null){g=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(q);l.decryptedProtobufs=[].concat(g)}c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,{instanceKey:k});c("QPLUserFlow").endSuccess(h,{annotations:{bool:{isEcho:!1,isProtobuf:!0}},instanceKey:k});return d("WAResultOrError").makeResult({instanceKey:e,messages:l.decryptedProtobufs})}else{n={decryptedEchoDocuments:[],echoDecryptionFailures:!1};c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,{instanceKey:k});p=(yield a.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:o,encryptedMessages:c("LSVec").ofArray(s)})},"readwrite",void 0,void 0,f.id+":568"));r=p[0];m=p[1];if(m!=null){n.echoDecryptionFailures=!0;c("QPLUserFlow").endFailure(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_DECRYPTION_FAILURE,{instanceKey:k});return d("WAResultOrError").makeError("empty-decryption-response")}if(r!=null){q=c("LSVec").toArray(r).map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(d("LSShape").toRecord(a).value)});g=d("MAWConvertEchoMessagesToEBProtobufs").convertEchoMessagesToEBProtobufs(q,b);n.decryptedEchoDocuments=[].concat(g);c("QPLUserFlow").addPoint(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,{instanceKey:k})}c("QPLUserFlow").endSuccess(h,{annotations:{bool:{isEcho:!0,isProtobuf:!1}},instanceKey:k});return d("WAResultOrError").makeResult({instanceKey:e,messages:n.decryptedEchoDocuments})}}catch(a){c("QPLUserFlow").endFailure(h,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{annotations:{string:{error_description:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a),errorStackTrace:(l=a.stack)!=null?l:""}},error:a,instanceKey:k});c("FBLogger")("wmi_eb").catching(a).mustfix("Runtime error performing messagePointQuery: %s",a);return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)}});return k.apply(this,arguments)}g.messagePointQuery=a}),98);
__d("EBAPIMessagePointQuery",["EBMessagePointQuery"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=d("EBMessagePointQuery").messagePointQuery}),98);
__d("EBMessageRangeQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9919734971481483"}),null);
__d("EBMessageRangeQuery.graphql",["EBMessageRangeQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},d={defaultValue:null,kind:"LocalArgument",name:"restore_type"},e=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],f={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},l=[g,h];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"EBMessageRangeQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,a],kind:"Operation",name:"EBMessageRangeQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},f,g,h,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_tags",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[i,f,g,h,j,k],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[i,f,g,h,j,k,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessageRangeQuery_facebookRelayOperation"),metadata:{},name:"EBMessageRangeQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBMessageRangeQuery",["Base64Utils","EBAPIDecryptionModule","EBAPIQPLPoints","EBAPIWorkerCheck","EBGraphQLTypeUtils","EBLS","EBMessageRangeQuery.graphql","EBMessageRangeQueryForThreads","EBMessageRangeQueryUtils","FBLogger","I64","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSEncryptedBackupsMessagesRangeQueryDirection","LSFactory","LSMEBTaskCreationSource","LSShape","LSVec","MAWConvertEchoMessagesToEBProtobufs","MAWCurrentUser","MAWEncryptedBackupUtils","MAWJobDefinitions","QPLUserFlow","WAHashStringToNumber","WAJids","WAResultOrError","WorkerRelay","WorkerRelayNetwork","asyncToGeneratorRuntime","first","gkx","handleRestoreMessagesGraphQLResponse","last","qpl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h!==void 0?h:h=b("EBMessageRangeQuery.graphql");function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.instanceKey,e=a.after,g=e[0];e[1];e=a.source;var h=a.chatJid,k=a.direction;a=a.numMessages;var l=c("qpl")._(521471755,"2586"),m=d("WAHashStringToNumber").hashStringToNumber(b!=null?b:c("uuidv4")());try{var n,o;if(!d("EBAPIWorkerCheck").runningInWorker())return d("WAResultOrError").makeError("unsupported-context");c("QPLUserFlow").start(l,{annotations:{"int":{source:e!=null?e:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:m});yield d("EBLS").init();e=(yield d("EBLS").getLSStorage());c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.LSDB_SINGLETON_RETRIEVED,{instanceKey:m});var p=(yield d("handleRestoreMessagesGraphQLResponse").getClientState(e));c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CLIENT_STATE_RETRIEVED,{data:{string:{device_id:(i||(i=d("I64"))).to_string((n=p==null?void 0:p.device_id)!=null?n:(i||(i=d("I64"))).zero)}},instanceKey:m});if(p==null){c("QPLUserFlow").endFailure(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}},instanceKey:m});return d("WAResultOrError").makeError("no-client-state")}var q=d("WAJids").threadIdForChatJid(h);n=p.backupId;var r=p.device_id,s=p.locally_available_epochs,t=p.mailboxRootKey;p=p.ocmfClientStateBlob;if(n==null||r==null||t==null||p==null){c("QPLUserFlow").endFailure(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}},instanceKey:m});return d("WAResultOrError").makeError("invalid-client-state")}o=""+((o=d("MAWCurrentUser").getAppID())!=null?o:0);var u=k==="before"?c("LSEncryptedBackupsMessagesRangeQueryDirection").BEFORE:c("LSEncryptedBackupsMessagesRangeQueryDirection").AFTER,v=d("WAJids").threadIdForChatJid(h);s={restore_context:{act_thread_id:q,site:"www",tam_thread_subtype:0},success:{device_context:{device_id:i.to_string(r),locally_available_epochs:s,raw_tokens:{mailbox_root_key:d("Base64Utils").fromArrayBuffer(t),ocmf_client_state_blob:d("Base64Utils").fromArrayBuffer(p)}},direction:u,query_num_messages:a,reference_timestamp:d("EBMessageRangeQueryUtils").safeTimestampMsString(g),server_thread_key:d("EBGraphQLTypeUtils").threadIdToThreadIdInt(v)}};t={app_id:o,restore_payload_string:JSON.stringify(s),restore_type:"RANGE_QUERY_RESTORE"};c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_START,{instanceKey:m});yield d("WorkerRelayNetwork").createWorkerNetworkExecute();c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.CREATE_WORKER_NETWORK_EXECUTE_END,{instanceKey:m});c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:m});p=(yield d("WorkerRelay").createWorkerQuery(j,t));c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END,{instanceKey:m});v=p==null?void 0:(u=p.viewer)==null?void 0:(a=u.encrypted_backup)==null?void 0:(g=a.mailbox)==null?void 0:g.messages;if(v==null){c("QPLUserFlow").endFailure(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:m});return d("WAResultOrError").makeError("invalid-graphql-response")}o=v;if((o==null?void 0:o.encrypted_messages)==null){c("QPLUserFlow").endFailure(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}},instanceKey:m});return d("WAResultOrError").makeError("invalid-graphql-response")}s=o.backup_id;t=o.encrypted_messages;p=o.epoch_derivation_set;u=o.exception_string;a=o.message_range_info;if(u!=null){c("QPLUserFlow").endFailure(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:u}},instanceKey:m});return d("WAResultOrError").makeError("server-side-exception")}s==null&&c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL,{instanceKey:m});c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START,{instanceKey:m});c("QPLUserFlow").addAnnotations(l,{bool:{hasEpochs:p!=null&&p.epoch_edges.length>0}},{instanceKey:m});yield d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(p,e,r,void 0,!0);c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END,{instanceKey:m});g=a||{};v=g.has_more_after;o=g.has_more_before;if(o==null||v==null){c("QPLUserFlow").endFailure(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}},instanceKey:m});return d("WAResultOrError").makeError("missing-message-range-info")}u=k==="after"?v:o;p=k==="after"?o:v;r=d("handleRestoreMessagesGraphQLResponse").processMessageArray(t,s!=null?s:(i||(i=d("I64"))).to_string(n));var w=r.encryptedLSEchoMessages,x=r.encryptedMessagesWithProtobufs;a=r.encryptedNonLSEchoMessages;g=r.encryptedNonLSProtobufs;c("FBLogger")("wmi_eb").debug("messageRangeQuery echo: %s, protobuf: %s",w.length,x.length);k=[];if(c("gkx")("7473")){c("QPLUserFlow").addPoint(l,"native_decryption_start",{instanceKey:m});o=(yield d("EBAPIDecryptionModule").decryptUsingNativeJS(e,q,g,a));if(!o.success){c("QPLUserFlow").addPoint(l,"native_decryption_error",{instanceKey:m});return d("WAResultOrError").makeError("native-decryption-error")}v=o.value.decryptedEchoMessages;t=o.value.decryptedProtobufs;s=d("EBMessageRangeQueryForThreads").convertNativeDecryptionResponseToDecryptedMessageType(v,t);c("QPLUserFlow").addPoint(l,"native_decryption_success",{instanceKey:m});n=c("LSVec").toArray(s.echo);r=s.protobuf;g=n.map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)});a=d("MAWConvertEchoMessagesToEBProtobufs").convertEchoMessagesToEBProtobufs(g,h);o=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(r);k.push.apply(k,a);k.push.apply(k,o)}else{v=!1;t=!1;if(w.length>0){c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START,{instanceKey:m});s=(yield e.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:q,encryptedMessages:c("LSVec").ofArray(w)})},"readwrite",void 0,void 0,f.id+":535"));n=s[0];g=s[1];g!=null&&(v=!0,c("QPLUserFlow").endFailure(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.ECHO_DECRYPTION_FAILURE,{instanceKey:m}));if(n!=null){r=c("LSVec").toArray(n).map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(d("LSShape").toRecord(a).value)});a=d("MAWConvertEchoMessagesToEBProtobufs").convertEchoMessagesToEBProtobufs(r,h);k.push.apply(k,a);c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END,{instanceKey:m})}}if(x.length>0){c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START,{instanceKey:m});o=(yield e.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:q,encryptedMessagesWithProtobufs:c("LSVec").ofArray(x)})},"readwrite",void 0,void 0,f.id+":595"));s=o[0];g=o[1];g!=null&&(t=!0,c("QPLUserFlow").endFailure(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.PROTOBUF_DECRYPTION_FAILURE,{instanceKey:m}));if(s!=null){n=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(s);k.push.apply(k,n)}c("QPLUserFlow").addPoint(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END,{instanceKey:m})}if(v&&t)return d("WAResultOrError").makeError("empty-decryption-response")}k.sort(function(a,b){return a.toplevelProtobuf.protobufTimestampMS-b.toplevelProtobuf.protobufTimestampMS});c("QPLUserFlow").endSuccess(l,{annotations:{bool:{isEcho:w.length>0,isProtobuf:x.length>0}},instanceKey:m});if(k.length===0)return d("WAResultOrError").makeResult({cursorInfo:{endCursor:null,hasNext:u,hasPrevious:p,startCursor:null},instanceKey:b,messages:[]});r=c("first")(k);h=c("last")(k);a={endCursor:r&&[r.otid,String(r.toplevelProtobuf.protobufTimestampMS)],hasNext:u,hasPrevious:p,startCursor:h&&[h.otid,String(h.toplevelProtobuf.protobufTimestampMS)]};return d("WAResultOrError").makeResult({cursorInfo:a,instanceKey:b,messages:k})}catch(a){c("QPLUserFlow").endFailure(l,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{annotations:{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,errorStackTrace:(e=a.stack)!=null?e:""}},error:a,instanceKey:m});c("FBLogger")("wmi_eb").catching(a).mustfix("Runtime error performing messageRangeQuery: %s",a);return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)}});return k.apply(this,arguments)}g.messageRangeQuery=a}),98);
__d("EBAPIMessageRangeQuery",["EBMessageRangeQuery"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=d("EBMessageRangeQuery").messageRangeQuery}),98);
__d("EncryptedBackupsCreateAttachmentContext",["EBLogger","EncryptedBackupsUploadEntity","MAWProtobufDeserializers","WAMediaTransport.pb","WAMediaUtils","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h=d("EBLogger").EBLogger.tags(["labyrinth_web","CreateAttachmentContext"]);function a(a){var b=new Map();try{a=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(a);a=a.encryptedTransportMessage();if(a==null){h.warn("transport message subprotocol is undefined");return[]}a=k(a);if(a!=null)if(a.type!==d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)j(a,b);else{a=a.payload;i(a.favicon,b);i(a.headerImage,b);a.previews!=null&&a.previews.forEach(function(a){i(a,b)});a=a.associatedMessage;if(a!=null&&a.payload!=null){a=new(d("MAWProtobufDeserializers").DeserializedMessageApplication)(a.payload);a=k(a);a!=null&&j(a,b)}}}catch(a){h.warn("Unable to create attachment context for message")}return Array.from(b.entries()).map(function(a){var b=a[0];a=a[1];return{mediaObjectId:b,mediaType:a}})}function i(a,b){if(a==null)return;a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,a.payload);a=(a=a.integral)==null?void 0:(a=a.transport)==null?void 0:(a=a.ancillary)==null?void 0:a.objectId;a!=null&&b.set(d("WAMediaUtils").stringToDeliveryObjectId(a),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}function j(a,b){var c,e=a.type;a=a.payload;a=a.integral;if((a==null?void 0:(c=a.transport)==null?void 0:(c=c.ancillary)==null?void 0:c.objectId)==null){h.warn("object id for attachment is null");return}c=d("WAMediaUtils").stringToDeliveryObjectId(a==null?void 0:(c=a.transport)==null?void 0:(c=c.ancillary)==null?void 0:c.objectId);b.set(c,e);e=a==null?void 0:(e=a.transport)==null?void 0:(a=e.ancillary)==null?void 0:(e=a.thumbnail)==null?void 0:(a=e.downloadableThumbnail)==null?void 0:a.objectId;if(e!=null&&e!==c){a=d("WAMediaUtils").stringToDeliveryObjectId(e);b.set(a,d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW)}}function k(a){var b=a.consumerMessage();a=a.armadillo();if(b!=null){var c;b=b.payload;if((b==null?void 0:(c=b.content)==null?void 0:c.imageMessage)!=null){return{payload:d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,b==null?void 0:(c=b.content)==null?void 0:(c=c.imageMessage.image)==null?void 0:c.payload),type:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE}}if((b==null?void 0:(c=b.content)==null?void 0:c.videoMessage)!=null){var e;c=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,b==null?void 0:(c=b.content)==null?void 0:(c=c.videoMessage.video)==null?void 0:c.payload);return{payload:c,type:(c==null?void 0:(e=c.ancillary)==null?void 0:e.gifPlayback)!==!0||(c==null?void 0:(e=c.ancillary)==null?void 0:e.gifAttribution)!=null?d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO}}if((b==null?void 0:(c=b.content)==null?void 0:c.stickerMessage)!=null){return{payload:d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,b==null?void 0:(e=b.content)==null?void 0:(c=e.stickerMessage.sticker)==null?void 0:c.payload),type:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.STICKER}}if((b==null?void 0:(e=b.content)==null?void 0:e.audioMessage)!=null){return{payload:d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,b==null?void 0:(c=b.content)==null?void 0:(e=c.audioMessage.audio)==null?void 0:e.payload),type:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT}}if((b==null?void 0:(c=b.content)==null?void 0:c.documentMessage)!=null){return{payload:d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").DocumentTransportSpec,b==null?void 0:(e=b.content)==null?void 0:(c=e.documentMessage.document)==null?void 0:c.payload),type:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT}}}if(a!=null){b=a.payload;if((b==null?void 0:(e=b.content)==null?void 0:e.extendedContentMessage)!=null){return{payload:b==null?void 0:(c=b.content)==null?void 0:c.extendedContentMessage,type:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA}}}}g.createAttachmentContext=a}),98);
__d("EncryptedBackupsCreateUploadEntity",["EBGenerateMessageTags","EBLogger","EncryptedBackupsConvertToLegacyAttachmentContext","EncryptedBackupsCreateAttachmentContext","EncryptedBackupsUploadEntity","EncryptedBackupsUtils","I64","MAWEBSwitch","MAWProtobufDeserializers","WAGlobals","WAJids","WAResultOrError","WATimeUtils","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot generate upload entity for message ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Backup message has incorrect metadata"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["transport message subprotocol is undefined"]);k=function(){return a};return a}var l=d("EBLogger").EBLogger.tags(["CreateUploadEntity"]),m=d("WAJids").createJidUtils({platform:"msgr"});function a(a,b,e){var f=a.backupDirective,g=a.externalId,n=a.payload,o=a.threadId;try{a=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(n);var p=a.encryptedTransportMessage();if(p==null){l.WARN(k());return d("WAResultOrError").makeError("invalid-protobuf-no-transport-message")}p=a.proto.metadata;if((p==null?void 0:p.senderId)==null||(p==null?void 0:p.timestampMs)==null||typeof (p==null?void 0:p.timestampMs)!=="number"){l.WARN(j());return d("WAResultOrError").makeError("invalid-protobuf-no-metadata")}a=p.senderId;p=p.timestampMs;var q=!c("MAWEBSwitch").isEnabled(),r=d("WATimeUtils").castMilliSecondsToUnixTime(p),s=m.toUserJid(a);s=s===d("WAGlobals").getMyUserJid()?d("WAJids").AUTHOR_ME:s;var t={author:s,chat:o,externalId:g};s=d("EncryptedBackupsCreateAttachmentContext").createAttachmentContext(n);var u=[],v=c("EncryptedBackupsConvertToLegacyAttachmentContext")(s),w=s.map(function(a){return d("EBGenerateMessageTags").generateEBMessageTags(a.mediaType)}).filter(Boolean);v.length>0&&v.forEach(function(a){var b=a.mediaObjectId;a=a.mediaType;u.push({deliveryObjectId:b,mediaType:a,messageId:t.externalId,productType:"msgr",threadId:d("WAJids").threadIdForChatJid(o),threadJid:o,ts:r})});v={backupActionType:f.actionType,backupDirective:f,failTsMs:d("WATimeUtils").castToMillisTime(0),instanceKey:b,isRetroactiveUpload:q,msgId:t,msgIdKey:d("EncryptedBackupsUtils").convertWAMsgIdToStringId(t),msgType:"text",originalMsgProtocolId:f.originalMsgProtocolId,protobuf:n,senderId:(h||(h=d("I64"))).of_string(a),serverTs:r,sortOrderMs:d("WATimeUtils").castLongIntToMillisTime(p),tags:w,triggerSource:e,uploadStatus:d("EncryptedBackupsUploadEntity").EbUploadStatus.NEEDS_BACKUP,uploadTsSec:d("WATimeUtils").unixTime()};s.length>0&&(v=babelHelpers["extends"]({},v,{attachmentContext:s,legacyAttachmentContext:u,msgType:"media"}));return d("WAResultOrError").makeResult(v)}catch(a){l.catching(c("getErrorSafe")(a)).MUSTFIX(i(),g);return d("WAResultOrError").makeError("runtime-error")}}g.createUploadEntity=a}),98);
__d("EBEnqueueMessagesForUpload",["EBAPIQPLPoints","EBLogger","EncryptedBackupsCreateUploadEntity","EncryptedBackupsUploadQueue","MWEBODSEntityName.enum","MWEBODSUtils","QPLFlow","WAHashStringToNumber","WAResultOrError","asyncToGeneratorRuntime","justknobx","qpl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to enqueue entities: ",""]);h=function(){return a};return a}var i=d("EBLogger").EBLogger.tags(["EBEnqueueMessagesForUpload"]);function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.messages,e=a.triggerSource,f=new Map(),g=new Map();if(b.length===0)return f;a=d("EncryptedBackupsUploadQueue").ebUploadQueue();d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.process",b.length);var j=[],k=c("qpl")._(521477113,"2698");b.forEach(function(a){var b=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")());g.set(a.externalId,d("QPLFlow").startQPLFlow(k,{instanceKey:b,timeoutInMs:c("justknobx")._("308")}));b=d("EncryptedBackupsCreateUploadEntity").createUploadEntity(a,b,e);if(b.success){var h;j.push(b.value);(h=g.get(a.externalId))==null?void 0:h.addPoint(d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATED)}else{f.set(a.externalId,d("WAResultOrError").makeError(b.error));(h=g.get(a.externalId))==null?void 0:h.endFail(d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATION_FAILURE)}});d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.enqueue",j.length);try{yield a.addAndCommit(j),j.forEach(function(a){f.set(a.msgId.externalId,d("WAResultOrError").makeResult());(a=g.get(a.msgId.externalId))==null?void 0:a.endSuccess()})}catch(a){i.MUSTFIX(h(),String(a)),j.forEach(function(a){f.set(a.msgId.externalId,d("WAResultOrError").makeError("enqueue-error"));(a=g.get(a.msgId.externalId))==null?void 0:a.endFail(d("EBAPIQPLPoints").EBUploadQueueQPLPoints.ENQUEUE_FAILURE)})}return f});return j.apply(this,arguments)}g["default"]=a}),98);
__d("EBQPLPoints",[],(function(a,b,c,d,e,f){"use strict";a={ATTACHMENT_CONTEXT_END:"attachment_context_end",ATTACHMENT_CONTEXT_START:"attachment_context_start",DIRECTIVE_GENERATION_END:"directive_generation_end",DIRECTIVE_GENERATION_FAIL:"directive_generation_fail",DIRECTIVE_GENERATION_START:"directive_generation_start",MESSAGE_TAG_GENERATION_END:"message_tag_generation_end",MESSAGE_TAG_GENERATION_START:"message_tag_generation_start"};f.EBEnqueueMinosQPLCommonPoints=a}),66);
__d("MAWMPSCreateBackupDirective",["EBLogger","MpsMessageToBridgeWrapper","MpsTypes","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=d("EBLogger").EBLogger.tags(["mps"]);function i(a){switch(a){case d("MpsTypes").ActionType.UpsertTopLevel:return 1;case d("MpsTypes").ActionType.UpsertSupplemental:return 2;case d("MpsTypes").ActionType.DeleteTopLevel:return 3;case d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:return 4;case d("MpsTypes").ActionType.DeleteSupplemental:case d("MpsTypes").ActionType.Preprocess:case d("MpsTypes").ActionType.Noop:case d("MpsTypes").ActionType.DeleteThread:case d("MpsTypes").ActionType.Unknown:h.warn("Action type %d not supported on EB upload",a);return 0}}function a(a,b){var c=i(a.actionType);if(c===0){h.warn("Unknown EB upload action type - cannot upload message");return}c={actionType:c,originalMsgProtocolId:b};a.supplementalKey!=null&&(c=babelHelpers["extends"]({},c,{supplementalKey:d("MpsTypes").fromSupplementalKey(a.supplementalKey)}));return c}function b(a,b){var c=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(b);return{author:c.getAuthor(),chat:c.getChatJid(),externalId:a.actionType===d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder?d("WAStanzaUtils").toStanzaId(b.messageId):d("WAStanzaUtils").toStanzaId(a.targetMessageId)}}g.createBackupDirectiveFromMPSMessage=a;g.getTargetProtocolMsgIdForMessage=b}),98);
__d("EBEnqueueMinosMessage",["EBGenerateMessageTags","EBMinosFakeData","EBMinosFalcoLoggerUtils","EBMinosLoadMailboxKeys","EBMinosLogger","EBMinosQplFlow","EBMinosTypes","EBQPLPoints","EBSenderUploadQueue","EncryptedBackupsCreateAttachmentContext","EncryptedBackupsUploadEntity","FBLogger","MAWEBSwitch","MAWMPSCreateBackupDirective","MessageBackupSupplementalKeyGenerator","MpsTypes","Promise","WAErrorMessage","WAJids","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to enqueue: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Enqueueing message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["skip enqueueing message. No recipient epoch heads."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to generate backup directive"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["start enqueueing message"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Runtime error in getEpochHeadsForContacts: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing required fields for mailbox keys: ",""]);o=function(){return a};return a}var p=d("WATagsLogger").TAGS(["enqueueMinosMsg"]);function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("EBMinosLoadMailboxKeys").loadMailboxKeys(a));if((b==null?void 0:b.epoch_head)==null||(b==null?void 0:b.encryption_public_key)==null||(b==null?void 0:b.public_key_fbid)==null){(b==null?void 0:b.epoch_head)!=null&&((b==null?void 0:b.encryption_public_key)==null||(b==null?void 0:b.public_key_fbid)==null)&&p.ERROR(o(),b);return}return{epochHead:b.epoch_head,mailboxKey:b.encryption_public_key,mailboxKeyFbid:b.public_key_fbid,participantId:a}});return function(b){return a.apply(this,arguments)}}())));return d("WAResultOrError").makeResult(a.filter(Boolean))}catch(a){c("FBLogger")("wmi_minos").MUSTFIX(n(),a);return d("WAResultOrError").makeError("runtime-error")}});return r.apply(this,arguments)}function s(a){a=d("WAJids").unsafeCoerceToUserJid(a);return d("EBMinosTypes").unsafeCastToUserFbId(d("WAJids").userIdFromJid(a))}function a(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.message;a=a.updateDirective;d("EBMinosLogger").minosLogger.DEV(m());var e=d("EBMinosQplFlow").startMinosMessageEnqueueQpl({threadId:b.threadId}),f={isEbEnabled:c("MAWEBSwitch").isEnabled(),messageId:b.messageId,threadId:b.threadId};try{e.addPoint(d("EBQPLPoints").EBEnqueueMinosQPLCommonPoints.DIRECTIVE_GENERATION_START);var g=d("MAWMPSCreateBackupDirective").getTargetProtocolMsgIdForMessage(a,b);g=d("MAWMPSCreateBackupDirective").createBackupDirectiveFromMPSMessage(a,g);if(g==null){e.endFailWithError(d("EBQPLPoints").EBEnqueueMinosQPLCommonPoints.DIRECTIVE_GENERATION_FAIL,"null backup directive");d("EBMinosFalcoLoggerUtils").logEBMinosArmadilloReceiveWriteDbFailure(f);p.ERROR(l());return d("WAResultOrError").makeError("directives-generation-error")}e.addPoint(d("EBQPLPoints").EBEnqueueMinosQPLCommonPoints.DIRECTIVE_GENERATION_END);var h=w(g.actionType,b.messageId,a.targetMessageId);e.addPoint(d("EBQPLPoints").EBEnqueueMinosQPLCommonPoints.ATTACHMENT_CONTEXT_START);var n=d("EncryptedBackupsCreateAttachmentContext").createAttachmentContext(d("EncryptedBackupsUploadEntity").toEbBackupMessageBytes(b.payload));e.addPoint(d("EBQPLPoints").EBEnqueueMinosQPLCommonPoints.ATTACHMENT_CONTEXT_END);e.addPoint(d("EBQPLPoints").EBEnqueueMinosQPLCommonPoints.MESSAGE_TAG_GENERATION_START);var o=n==null?void 0:n.map(function(a){return d("EBGenerateMessageTags").generateEBMessageTags(a.mediaType)}).filter(Boolean);e.addPoint(d("EBQPLPoints").EBEnqueueMinosQPLCommonPoints.MESSAGE_TAG_GENERATION_END);var r=s(b.threadId),t=d("EBMinosTypes").unsafeCastToUserFbId(b.senderId);e.addPoint("get_participant_epoch_heads_start");t=c("gkx")("14827")?yield q([t,r]):yield d("EBMinosFakeData").getFakeMinosData().then(function(a){return d("WAResultOrError").makeResult([{epochHead:a.recipientEpochHead,mailboxKey:a.recipientEncryptionKeyPair.pk,mailboxKeyFbid:a.recipientMailboxKeyFbId,participantId:a.recipientUserFbId}])});if(t.success===!1){e.endFailWithError("get_participant_epoch_heads_failed");return d("WAResultOrError").makeError("unable-to-fetch-epoch-heads-error")}r=t.value;if(r.length===0){d("EBMinosLogger").minosLogger.DEV(k());e.addPoint("get_participant_epoch_heads_end",{bool:{no_recipient_epoch_heads:!0}});e.endSuccess();return d("WAResultOrError").makeResult()}e.addPoint("get_participant_epoch_heads_end");var x=u({attachmentContext:n,deletionOfflineThreadingId:h,directive:g,mailboxKeys:r,message:b,supplementalOpToken:v(a),tags:o});p.LOG(j());yield d("EBSenderUploadQueue").enqueueMessages([x]).then(function(){d("EBMinosFalcoLoggerUtils").logEBMinosArmadilloReceiveWriteDbSuccess(babelHelpers["extends"]({},f,{isSupplementalUpload:x.directive.originalMsgProtocolId!==x.messageId})),e.endSuccess()});return d("WAResultOrError").makeResult()}catch(a){t=d("WAErrorMessage").maybeGetMessageFromError(a);p.ERROR(i(),t);e.endFailWithError("runtime-error",t);d("EBMinosFalcoLoggerUtils").logEBMinosArmadilloReceiveWriteDbFailure(f);return d("WAResultOrError").makeError("runtime-error")}});return t.apply(this,arguments)}function u(a){var b=a.attachmentContext,c=a.deletionOfflineThreadingId,d=a.directive,e=a.mailboxKeys,f=a.message,g=a.supplementalOpToken;a=a.tags;return babelHelpers["extends"]({attachmentContext:b,deletionOfflineThreadingId:c,directive:d,mailboxKeys:e},f,{supplementalOpToken:g,tags:a})}function v(a){a=a.supplementalKey;if(a==null)return void 0;a=d("MpsTypes").fromSupplementalKey(a);a=d("MessageBackupSupplementalKeyGenerator").parseIdentifierString(a);return d("EBMinosTypes").castToSupplementalOpToken(a.type)}function w(a,b,c){switch(a){case 4:return c;case 3:return b;default:return void 0}}g.getRecipientUserFbIdFromThreadId=s;g.enqueueSentMinosMessageForUpload=a}),98);
__d("EBWorkerEBSMStateUtils",["EBLS","I64","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state))}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a!=null?a:yield d("EBLS").getLSStorage();a=(yield i(a));return a==null?"clientStateRow is null":"clientStateRow:\n        backupId: "+(h||(h=d("I64"))).to_string(a.backupId)+",\n        backupTenancy: "+(a.backupTenancy==null?"null":(h||(h=d("I64"))).to_string(a.backupTenancy))+",\n        authLevel: "+(h||(h=d("I64"))).to_string(a.authorityLevel)+"\n        deviceId: "+(a.deviceId==null?"null":(h||(h=d("I64"))).to_string(a.deviceId))});return j.apply(this,arguments)}g.getEBSMWorkerStateRow=i;g.getEBSMWorkerState=a}),98);
__d("EBWorkerAddDeviceWithKeys",["EBGating","EBLS","EBSMAPI","EBWorkerAddDeviceUtils","EBWorkerEBDBApiDeferred","EBWorkerEBSMStateUtils","EBWorkerODSEntityName.enum","MessengerWebInitData","ODS","ReQL","WALogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy successful but ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy successful"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy done: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy failed, error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key copy eb state tables start"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key get auto restore param failed: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key get auto restore param end"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key get auto restore param start"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key calling EBAPI"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key got add device param, param is ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key not run, device already exist"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key got client state row"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key start"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] Add device with key: session id is null from MessengerWebInitData"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key returned early - not in worker or gk not passed"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with key triggered"]);x=function(){return a};return a}function a(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").LOG(x());if(c("gkx")("6240"))return;if(!d("EBGating").isEBSMv2Phase1Enabled()){d("WALogger").LOG(w());return}var b=d("MessengerWebInitData").sessionId;if(b==null){d("WALogger").ERROR(v());return}var e=a;d("WALogger").LOG(u());(h||(h=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_ADD_DEVICE_WITH_KEYS,e+".start");var f=a===c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_WORKER,g=(yield d("EBLS").getLSStorage()),i=(yield d("EBWorkerEBSMStateUtils").getEBSMWorkerStateRow(g));d("WALogger").LOG(t());if(i!=null&&!f){d("WALogger").LOG(s());E(e);return}f=(yield f&&i!=null?z(g,i,e):i==null?B(g,e):null);d("WALogger").LOG(r(),f!=null?"not null":"null");if(f!=null){d("WALogger").LOG(q());E(e);return c("EBSMAPI").addDeviceWithEBKeys(babelHelpers["extends"]({},f,{db:g,isInWorker:!0,newDeviceRegistrationId:b,source:a,trackAddingDevice:function(a){void d("EBWorkerEBDBApiDeferred").addNewDevice(a)}}))}});return y.apply(this,arguments)}function z(a,b,c){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("WALogger").LOG(p());var e=b==null?void 0:b.deviceId;a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_epochs)).then(function(a){return a!=null}));if(a&&e!=null){d("WALogger").LOG(o());return{backupId:b.backupId,previousDeviceId:e}}d("WALogger").ERROR(n(),a?"epoch not found":"device id is null");D(c);return null});return A.apply(this,arguments)}function B(a,b){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d("WALogger").LOG(m());yield c("EBSMAPI").fetchBackupIds(a,{isInWorker:!0});var e=(yield d("EBWorkerAddDeviceUtils").copyEBStateTablesFromMainthreadToWorker(["secure_encrypted_backups_epochs","secure_encrypted_backups_client_state"],a)["catch"](function(a){d("WALogger").ERROR(l(),a);D(b);return null}));d("WALogger").LOG(k(),e);if(e==="success"){d("WALogger").LOG(j());a=(yield d("EBWorkerEBSMStateUtils").getEBSMWorkerStateRow(a));var f=a==null?void 0:a.deviceId;if(a==null||f==null){d("WALogger").ERROR(i(),a==null?"client state row is null":"device id is null");return null}return{backupId:a.backupId,previousDeviceId:f}}else if(e==="fail"){D(b);return null}else{E(b,e);return null}});return C.apply(this,arguments)}function D(a){(h||(h=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_ADD_DEVICE_WITH_KEYS,a+".fail")}function E(a,b){(h||(h=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_ADD_DEVICE_WITH_KEYS,a+".success"+(b!=null?"."+b:""))}g.addDeviceWithKeysInWorker=a}),98);
__d("MAWEncryptedBackupsClearRecoveryCode",["Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return(h||(h=b("Promise"))).all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_recovery_code_data)),d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_recovery_code_status))]).then(function(c){var d=c[0],e=c[1];if(d!=null||e!=null)return a.runInTransaction(function(a){return(h||(h=b("Promise"))).all([(d==null?void 0:d.taskId)!=null?a.secure_recovery_code_data["delete"](d.taskId):(h||(h=b("Promise"))).resolve(),(e==null?void 0:e.pk)!=null?a.secure_encrypted_backups_recovery_code_status["delete"](e.pk):(h||(h=b("Promise"))).resolve()])},"readwrite",void 0,void 0,f.id+":27")})}g.encryptedBackupsClearRecoveryCode=a}),98);
__d("EBWorkerAddDeviceWithPin",["EBGating","EBLS","EBSMAPI","EBWorkerEBDBApiDeferred","EBWorkerODSEntityName.enum","MAWEncryptedBackupsClearRecoveryCode","ODS","Promise","WALogger","asyncToGeneratorRuntime","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with rc success"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with rc EBAPI start"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with rc failed with invalid recovery code"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with rc failed, error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with rc fetch backup id done"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with rc failed, error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with rc start"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with rc returned early - gk not passed"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] worker add device with rc triggered"]);r=function(){return a};return a}function a(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){d("WALogger").LOG(r());if(c("gkx")("6240"))return;if(!d("EBGating").isEBSMv2Phase1Enabled()){d("WALogger").LOG(q());return}d("WALogger").LOG(p());(i||(i=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_ADD_DEVICE_WITH_RC,"start");yield d("EBLS").init();yield d("EBLS").clearEBSMStorage();var f=(yield d("EBLS").getLSStorage());yield c("EBSMAPI").fetchBackupIds(f,{isInWorker:!0})["catch"](function(a){d("WALogger").LOG(o(),a);(i||(i=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_ADD_DEVICE_WITH_RC,"fail");throw a});d("WALogger").LOG(n());yield d("MAWEncryptedBackupsClearRecoveryCode").encryptedBackupsClearRecoveryCode(f);yield c("EBSMAPI").addDeviceWithRecoveryCode({environment:null,isInWorker:!0,onFailure:function(a){d("WALogger").ERROR(m(),a)},onInvalidRecoveryCode:function(){d("WALogger").ERROR(l())},onStart:function(){d("WALogger").LOG(k())},onSuccess:function(){d("WALogger").LOG(j()),c("promiseDone")(c("EBSMAPI").fetchBackupIds(f,{isInWorker:!0}))},recoveryCode:a,storage:f,trackAddingDevice:function(){return d("EBWorkerEBDBApiDeferred").addNewDevice()},trackOverprompting:function(){return(h||(h=b("Promise"))).resolve()},userId:e});i.bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_ADD_DEVICE_WITH_RC,"success")});return s.apply(this,arguments)}g.addDeviceWithPinInWorker=a}),98);
__d("EBWorkerGetEBState",["EBLS","I64","LSAuthorityLevel","LSIntEnum","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;yield d("EBLS").init();var b=(yield d("EBLS").getLSStorage()),e=(yield (a=d("ReQL")).firstAsync(a.fromTableAscending(b.tables.encrypted_backups)));a=(yield a.firstAsync(a.fromTableAscending(b.tables.secure_encrypted_backups_client_state)));if(e==null)return 2;else if((h||(h=d("I64"))).equal(e.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC)))return 1;else if((h||(h=d("I64"))).equal(e.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return l(a,e);else return-1});return j.apply(this,arguments)}var k="-1";function l(a,b){b=b.backupId;if(b==null)return 2;if((h||(h=d("I64"))).to_string(b)===k)return-1;if(a==null||!(h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return 4;return!(h||(h=d("I64"))).equal(a.backupId,b)?4:3}g.getEBWorkerState=a}),98);
__d("LSOptOutOfBackup",["LSAppendDataTraceAddon","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] Beginning execution."),c("justknobx")._("1099")?d.sequence([function(a){return d.sequence([function(a){return void 0!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),void 0,d.i64.cast([0,1469]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[11]=a[0],a})},function(a){return e[11]?e[12]=!0:e[12]=!1,e[12]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[14]="LSDataTraceMciTraceLog native op not supported",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",e[14]].join("")),e[13]=d.createArray(),void 0!==void 0?e[15]=(e[13].push(void 0),e[13]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",e[14],e[13],d.i64.cast([0,3]))):d.resolve()}])},function(c){return e[8]=new d.Map(),e[8].set("backup_id",a[0]),e[8].set("trace_id",void 0),e[9]=d.toJSON(e[8]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_opt_out",d.i64.cast([0,50019]),e[9],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[10]=a[0],a})},function(a){return e[1]=d.i64.cast([0,0])}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] backup opt out flow is not enabled"),e[1]=d.i64.cast([0,1])))},function(a){return e[2]=d.i64.of_float(Date.now()),e[3]=d.i64.random(),e[5]="Finishing execution. Execution time: ",e[6]=d.i64.to_string(d.i64.sub(e[2],e[0])),e[7]=" ms",e[4]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsOptOutOfBackupStoredProcedure] ",e[4],e[5],e[4],e[6],e[4],e[7]].join("")),d.i64.eq(d.i64.mod_(e[3],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[8]=",",e[9]=d.createArray(),void 0!==void 0?e[10]=(e[9].push(void 0),e[9]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsOptOutOfBackupStoredProcedure",[e[5],e[8],e[6],e[8],e[7]].join(""),e[9],d.i64.cast([0,4]))):d.resolve()},function(a){return f[0]=e[1]}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsOptOutOfBackupStoredProcedure";a.__tables__=[];d=a;g["default"]=d}),98);
__d("LSOptOutOfBackupStoredProcedure",["LSOptOutOfBackup","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOptOutOfBackup"),e.backupId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("encryptedBackupsOptOutOfBackup",["LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSOptOutOfBackupStoredProcedure","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)).then(function(b){if(b==null)return[(h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").FAILURE)];var e=b.backupId;return e!=null?a.runInTransaction(function(a){return c("LSOptOutOfBackupStoredProcedure")(c("LSFactory")(a),{backupId:e})},"readwrite",void 0,void 0,f.id+":32"):[(h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").FAILURE)]})}g.optOutOfBackupStoredProcedure=a}),98);
__d("EBWorkerOptOut",["EBGating","EBLS","EBSMAPI","EBWorkerODSEntityName.enum","ODS","ReQL","asyncToGeneratorRuntime","encryptedBackupsOptOutOfBackup","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("gkx")("6240"))return;if(!d("EBGating").isEBSMv2Phase1Enabled())return;(h||(h=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_OPT_OUT,"start");yield d("EBLS").init();var a=(yield d("EBLS").getLSStorage());yield d("encryptedBackupsOptOutOfBackup").optOutOfBackupStoredProcedure(a).then(function(e){var f=a.tables.secure_encrypted_backups_client_state.subscribe(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state)),function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){if(b!=null)if(b.length===0){yield c("EBSMAPI").fetchBackupIds(a,{isInWorker:!0});(h||(h=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_OPT_OUT,"success");return f()}else return;else{(h||(h=d("ODS"))).bumpEntityKey(7319,c("EBWorkerODSEntityName.enum").EB_WORKER_OPT_OUT,"fail");return f()}});return function(a){return e.apply(this,arguments)}}())})})});return i.apply(this,arguments)}g.ebOptOutInWorker=a}),98);
__d("EncryptedBackupsDYIMediaManager",["Promise","WAMediaManager","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=new Map(),k=new Map();function a(a,b,c){var d=j.get(a);d==null?j.set(a,new Map([[b,c]])):d.set(b,c)}function c(a,b,c){k.set(a,{protocolMsgId:b,sortOrderMs:c})}function e(a){k["delete"](a)}function f(){j.clear(),k.clear(),i=null}function l(){i==null&&(i=d("WAMediaManager").createMediaManager({dbCallbacks:{getMediaEntries:function(a){a=j.get(a);return a==null?(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeError("no-media-by-plaintext-hash")):(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult(a))},getProtocolMsgIdAndSortOrderMs:function(a){return(h||(h=b("Promise"))).resolve(k.get(a))},updateMediaEntryForMsg:function(){return(h||(h=b("Promise"))).resolve()}}}));return i}g.addMediaEntry=a;g.addMessage=c;g.deleteMessage=e;g.cleanup=f;g.dyiMediaManager=l}),98);
__d("MAWShadowTestMediaStorage",["MAWBridge","MAWQplProxy","MWFBLogger","Random","WAErrorMessage","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["runMediaStorageShadowTesting failed: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["runMediaStorageShadowTesting succeeded for "," storage type"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["runMediaStorageShadowTesting started"]);j=function(){return a};return a}var k=d("MWFBLogger").MWMediaLogger.tags(["MediaStorageShadowTest"]),l=["webcache","opfs"],m=9e4;function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){k.DEBUG(j());var b=function(b){var e=d("Random").uint32(),f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521472095,"2859"),{"int":{input_file_size:a.byteLength},string:{storage_type:b}},{providedInstanceKey:e,providedTimeoutInMs:m});return d("MAWBridge").getBridge().sendAndReceive("event","getMediaStorageResult",{file_bytes:a,storage_type:b},!0,void 0,{toLastActiveClient:!0}).then(function(a){if(a.success)k.DEBUG(i(),b),f.endSuccess({"double":{cleanup_latency:a.value.cleanupLatency,read_latency:a.value.readLatency,setup_latency:a.value.setupLatency,write_latency:a.value.writeLatency}});else{f.addAnnotations({string:{error_name:a.error.errorName,fail_error_message:(a=a.error.errorMessage)!=null?a:"unknown"}});f.endFail("shadow_test_fail")}})["catch"](function(a){k.MUSTFIX(h(),a),f.endFail("shadow_test_bridge_fail",{string:{error_message:d("WAErrorMessage").maybeGetMessageFromError(a)}})})};for(var e of l)yield b(e)});return n.apply(this,arguments)}g.runMediaStorageShadowTesting=a}),98);
__d("EncryptedBackupsDYIMediaDownload",["EncryptedBackupsDYIMediaManager","FBLogger","MAWDbMsg","MAWDownloadAndHandleMedia","Promise","WAHashUtils","WAResultOrError","WAStartMediaDownloadQplFlow","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.mediaEntry,f=a.plaintextHash,g=a.protocolMsgId;a=a.sortOrderMs;var i=d("EncryptedBackupsDYIMediaManager").dyiMediaManager(),j=c("FBLogger")("labyrinth_web").tags(["labyrinth_web","labyrinth_dyi"]),k=d("MAWDbMsg").toMsgId(g.chat+"_"+g.externalId+"_m");if(k==null){j.mustfix("Failed to construct the msgId from protocolMsgId for media with plaintext hash: %s",d("WAHashUtils").sanitisePlaintextHash(f));return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeError("missing-media-entry"))}d("EncryptedBackupsDYIMediaManager").addMediaEntry(f,k,e);d("EncryptedBackupsDYIMediaManager").addMessage(k,g,a);e="DYIMediaManager";k=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:e,msgType:null,protocolMsgId:null,triggerUIView:null});j.debug("Enqueuing DYI media download for media with plaintext hash: %s",d("WAHashUtils").sanitisePlaintextHash(f));g=(yield i.enqueueDownloadFullSize({fullSizePlaintextHash:f,mediaDownloadFlow:k,priority:d("MAWDownloadAndHandleMedia").getPriorityFromDownloadEntry(e)}));g.success?k.endSuccess():k.endFail(g.error);return g});return i.apply(this,arguments)}g.downloadDYIMedia=a}),98);
__d("EncryptedBackupsUploadQueueAckUtils",["EBLogger","EncryptedBackupsUploadQueueProcessor","ExecutionEnvironment","MAWBridgeSafeActionsWorkerAndUI","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["ackWithInstanceKey failed with error"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid instanceKey provided to ackWithInstanceKey: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["ackWithInstanceKey failed with error"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["No instance keys provided to ackWithInstanceKeyBatched"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["ackWithInstanceKeyBatchedWorker failed with error"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid instanceKey provided to ackWithInstanceKeyBatchedWorker: ",""]);o=function(){return a};return a}var p=d("EBLogger").EBLogger.tags(["EncryptedBackupsUploadQueueAckUtils"]);function a(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.instancesWithOutcomes;if(b.length===0){p.WARN(m());return}if((i||(i=c("ExecutionEnvironment"))).isInWorker)try{yield r(b)}catch(a){p.catching(a).MUSTFIX(l())}else d("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("ackWithInstanceKeyBatched",a)});return q.apply(this,arguments)}function r(a){return(h||(h=b("Promise"))).all(a.map(function(a){var b=a.instanceKey;a=a.success;if(Number.isNaN(b)){p.MUSTFIX(o(),b);return}try{b=parseInt(b,10);return d("EncryptedBackupsUploadQueueProcessor").ackWithInstanceKeyWorkerOnly(b,a)}catch(a){p.catching(a).MUSTFIX(n())}}))}function e(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(Number.isNaN(a)){p.MUSTFIX(k(),a);return(h||(h=b("Promise"))).resolve()}if((i||(i=c("ExecutionEnvironment"))).isInWorker)try{return yield d("EncryptedBackupsUploadQueueProcessor").ackWithInstanceKeyWorkerOnly(a,e)}catch(a){p.catching(a).MUSTFIX(j())}else d("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("ackWithInstanceKey",{instanceKey:a,success:e});return(h||(h=b("Promise"))).resolve()});return s.apply(this,arguments)}g.ackWithInstanceKeyBatched=a;g.ackWithInstanceKey=e}),98);
__d("IGDAWAdminWriteICDCMsgTxn",["Promise","cr:10743","cr:2327"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2327"))!=null?c:b("cr:10743");function a(a,c,d){return i?i.writeICDCAdminMsg(a,c,d):(h||(h=b("Promise"))).resolve()}g.writeICDCAdminMsg=a}),98);
__d("IGDAWAdminWriteUserDeviceMsgTxn",["Promise","cr:10744","cr:2693"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2693"))!=null?c:b("cr:10744");function a(a,c,d,e,f,g){return i?i.writeUserDeviceAdminMsg(a,c,d,e,f,g):(h||(h=b("Promise"))).resolve()}g.writeUserDeviceAdminMsg=a}),98);
__d("IGDAWDbAddDeviceChangeAlertsTxn",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.put(b)});return g.apply(this,arguments)}f.addDeviceChangeAlertsTxn=a}),66);
__d("IGDAWDbUpdateDeviceChangeAlertsTxn",["I64","MAWUnsafeCoerce","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.upsert([b.deviceChangeAlertsId],b)});return i.apply(this,arguments)}function c(a){return d("MAWUnsafeCoerce").unsafeCoerce((h||(h=d("I64"))).of_float(a))}g.updateDeviceChangeAlertsTxn=a;g.convertDeviceChangeAlertsId=c}),98);
__d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["IGDAWDbUpdateDeviceChangeAlertsTxn","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.e2ee_deviceChangeAlerts.index("deviceJid")).getKeyRange(c).filter(function(a){return!a.loggedOut})));yield (h||(h=b("Promise"))).all(c.map(function(b){return d("IGDAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,babelHelpers["extends"]({},b,{loggedOut:!0}))}))});return i.apply(this,arguments)}g.updateDeviceChangeAlertsLogInStatusTxn=a}),98);
__d("IGDDbThreadTxns",["I64","Promise","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){return new Map(yield a.runInTransaction(function(a){return(i||(i=b("Promise"))).all(c.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c;b=d("WAJids").extractUserId(b);return[b,yield (c=d("ReQL")).toArrayAsync(c.mergeJoin(c.fromTableAscending(a.participants.index("contactIdThreadKey"),[]).getKeyRange((h||(h=d("I64"))).of_string(b)),d("ReQL").fromTableAscending(a.threads)).map(function(a){a[0];a=a[1];return a}))]});return function(a){return c.apply(this,arguments)}}()))},"readonly",void 0,void 0,f.id+":24"))});return j.apply(this,arguments)}g.getAllThreadsForUsers=a}),98);
__d("IGDHandleICDCErrorInstruction",["IGDAWAdminWriteICDCMsgTxn","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.shouldShowAdminMessages,i=e.threads;if(!g)return;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all(i.map(function(b){return d("IGDAWAdminWriteICDCMsgTxn").writeICDCAdminMsg(a,b,c.notificationTs)})),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.ICDC,key:"icdc"})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleICDCError=a}),98);
__d("IGDHandleIdentityAddedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbAddDeviceChangeAlertsTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.contactId,k=e.isMe,l=e.shouldShowAdminMessages,m=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=j(a,c,k,g),f=e.promise;e=e.showSelfAlerts;var n=l?m.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,i,k,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(n));(e||l)&&d("MAWODSProxy").odsBumpEntityKey({entity:k?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").ADD})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":47")});return i.apply(this,arguments)}function j(a,c,e,f){var g=!1,i=(h||(h=b("Promise"))).resolve();if(e&&c.model!=null&&c.platform!=null&&c.notificationTs!=null){g=!0;e=c.instruction==="identityChanged"?d("MAWDbDeviceChangeAlerts").KEY_CHANGE:d("MAWDbDeviceChangeAlerts").ADD;i=d("IGDAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:e,deviceJid:c.device,identity:c.identity,isArchived:!f,isConfirmed:!1,isNotified:!1,model:c.model,platform:c.platform,ts:c.notificationTs})}return{promise:i,showSelfAlerts:g}}g.handleIdentityAdded=a;g.addDeviceChangeAlerts=j}),98);
__d("IGDHandleIdentityChangedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDHandleIdentityAddedInstruction","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAJids","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=d("IGDHandleIdentityAddedInstruction").addDeviceChangeAlerts(a,c,i,g),f=e.promise;e=e.showSelfAlerts;var l=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,d("WAJids").extractUserId(c.jid),i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(l));(e||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").KEY_CHANGE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":31")});return i.apply(this,arguments)}g.handleIdentityChanged=a}),98);
__d("IGDHandleIdentityRemovedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.contactId,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=i?d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(a,c.device):(h||(h=b("Promise"))).resolve(),f=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,g,i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([e].concat(f));(i||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").REMOVE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleIdentityRemoved=a}),98);
__d("IGDAWProtocolQueueInstructions",["FBLogger","IGDDbThreadTxns","IGDHandleICDCErrorInstruction","IGDHandleIdentityAddedInstruction","IGDHandleIdentityChangedInstruction","IGDHandleIdentityRemovedInstruction","MAWDbAppMeta","MAWReStoreDb","Promise","WAAssertUnreachable","WAGlobals","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWReStoreDb").getDB(f.id+":33")),e=(yield j(b,a)),g=e[0],h=g.allowSecurityAlertForContact;g=g.allowSecurityAlertForSelf;e=e[1];var i=[];for(a of a){var k=a.jid,m=d("WAJids").extractUserId(k);k=k===d("WAGlobals").getMyUserJid();var n=l({allowSecurityAlertForContact:h,isICDCError:a.instruction==="icdcError",isMe:k});n={allowSecurityAlertForSelf:g,contactId:m,isMe:k,shouldShowAdminMessages:n,threads:(k=e.get(m))!=null?k:[]};try{yield o(b,a,n),i.push(a.stanzaQueueId)}catch(a){c("FBLogger")("igd_web").warn("Failed to handle instruction. The error is %s",a)}}return{followUpParams:void 0,toAck:i}});return i.apply(this,arguments)}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=new Set(b.map(function(a){return a.jid})),e=(yield m(a)),f=e.allowSecurityAlertForContact&&b.some(function(a){return a.jid!==d("WAGlobals").getMyUserJid()});b=b.some(function(a){return a.instruction==="icdcError"});f=f||b;b=f?yield d("IGDDbThreadTxns").getAllThreadsForUsers(a,Array.from(c)):new Map();return[e,b]});return k.apply(this,arguments)}function l(a){var b=a.allowSecurityAlertForContact,c=a.isICDCError;a=a.isMe;return!a&&(b||c)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all([a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf),a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert)]));var c=a[0];a=a[1];return{allowSecurityAlertForContact:(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1,allowSecurityAlertForSelf:(a=c==null?void 0:c.value.allowSecurityAlertForSelf)!=null?a:!0}});return n.apply(this,arguments)}function o(a,b,e){switch(b.instruction){case"identityChanged":return d("IGDHandleIdentityChangedInstruction").handleIdentityChanged(a,b,e);case"identityAdded":return d("IGDHandleIdentityAddedInstruction").handleIdentityAdded(a,b,e);case"identityRemoved":return d("IGDHandleIdentityRemovedInstruction").handleIdentityRemoved(a,b,e);case"icdcError":return d("IGDHandleICDCErrorInstruction").handleICDCError(a,b,e);default:throw c("WAAssertUnreachable")(b)}}g.handleInstructions=a;g.getShouldShowAdminMessages=l}),98);
__d("MAWFbCat",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(a){h=a}function b(){if(h==null)throw c("FBLogger")("messenger_web").mustfixThrow("FBCat is not set");return h}g.setFbCat=a;g.getFbCat=b}),98);
__d("MAWRotateCAT",["FBLogger","MAWBridge","MAWCatQuery.graphql","MAWCryptoAuthToken","MAWFbCat","MAWODSProxy","MAWQplProxy","Promise","WAArrayBufferUtils","WADbDeviceRegistration","WADbMetaTxnsV2","WALogger","WAOdsEnums","WAPromiseRetryLoop","WARetryUtils","asyncToGeneratorRuntime","createWorkerQuery","getErrorSafe","gkx","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Rotate CAT finished, ending rotate CAT promise retry loop"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to rotate CAT"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWRotateCAT] Got an error while attempting to rotate CAT: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["CAT Finished Rotating"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting rotate CAT Task Bridge event"]);m=function(){return a};return a}var n=c("requireDeferred")("WorkerRelayNetwork").__setRef("MAWRotateCAT"),o=c("qpl")._(1056847537,"2667"),p=0,q=function(){return c("gkx")("15590")};function r(a){var e=a.initiator;a=a.qplAnnotations;p++;var f=d("MAWQplProxy").startQplUserFlow(o,{"int":babelHelpers["extends"]({},a["int"],{totalRotationCounter:p}),string:babelHelpers["extends"]({},a.string,{initiator:e})});d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.CAT_ROTATION,key:"rotateCAT"});d("WALogger").LOG(m());c("gkx")("8216")?(f.addAnnotations({string:{fetchFrom:"worker"}}),a=t(f)["catch"](function(a){if(q()){f.addPoint("fallback_to_ui");return v()["catch"](function(d){d=c("getErrorSafe")(d);f.addPoint("fallback_error",{string:{errorDescriptionUI:d.message}});return(h||(h=b("Promise"))).reject(a)})}return(h||(h=b("Promise"))).reject(a)})):(f.addAnnotations({string:{fetchFrom:"tab"}}),a=v());return a.then(function(a){if(!a){f.addPoint("no_valid_result");throw c("FBLogger")("messenger_web").mustfixThrow("CAT Rotation failed: no valid result")}return d("WADbMetaTxnsV2").saveCAT(a)}).then(function(a){f.addPoint("set_fb_cat");d("MAWFbCat").setFbCat(d("WAArrayBufferUtils").stringToArrayBuffer(a.encrypted_serialized_cat));d("WALogger").LOG(l());f.endSuccess();return a})["catch"](function(a){a=c("getErrorSafe")(a);d("WALogger").ERROR(k(),a);f.endFail("error",{string:{errorDescription:a.message}});return null})}var s=null;function a(a){var e;if(s!=null)return s.promise();var f=(e=a==null?void 0:a.retries)!=null?e:d("WADbDeviceRegistration").MAX_ROTATE_CRYPTO_AUTH_TOKEN_RETRIES,g=0;e=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({code:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e;if(g===f){d("WALogger").COUNT(j());throw c("FBLogger")("messenger_web").mustfixThrow("Unable to rotate CAT")}e=(yield r({initiator:"MAWRotateCAT::tryRotateCAT",qplAnnotations:{"int":babelHelpers["extends"]({},(e=a.qplAnnotations)==null?void 0:e["int"],{retryLoopAllowedRetries:f,retryLoopZeroBasedIteration:g}),string:babelHelpers["extends"]({},(e=a.qplAnnotations)==null?void 0:e.string,{retryLoopInitiator:a.initiator})}}));e!=null&&(d("WALogger").LOG(i()),b());g++});function h(a){return e.apply(this,arguments)}return h}(),name:"rotateCAT",timer:d("WARetryUtils").fibonacciBackoff(!0)});e.start();e.promise()["finally"](function(){s=null});s=e;return e.promise()}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){q()&&(yield n.load().then(function(a){a=a.createWorkerNetworkExecute;a()}));return c("createWorkerQuery")(c("MAWCatQuery.graphql"),{},{onExecute:function(){a.addPoint("query_executed")},onResponse:function(b){a.addPoint("response_received",{bool:{response_is_array:Array.isArray(b),response_is_null:b===null},"int":{response_array_size:Array.isArray(b)?b.length:void 0},string:{response_type:typeof b}});if(typeof b==="object"){b=Array.isArray(b)?b[0]:b;b!=null&&a.addAnnotations({string:{response_payload:JSON.stringify(b.payload)},string_array:{response_keys:Object.keys(b)}})}}}).then(function(a){return d("MAWCryptoAuthToken").processCatResponse(a)}).then(function(a){if(a.error!=null)throw c("FBLogger")("messenger_web").mustfixThrow(a.error);return a.success})});return u.apply(this,arguments)}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWQplProxy").workerBridgeDeferred.getPromise();return d("MAWBridge").getBridge().sendAndReceive("event","rotateCryptoAuthToken",{})});return w.apply(this,arguments)}g.rotateCAT=r;g.tryRotateCAT=a}),98);
__d("MAWSharedCOPLogger",["MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWFBLogger").MWLogger.tags(["COP"]);g["default"]=a}),98);
__d("WADexiePersistedQueueApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{ack:k,clear:m,"delete":l,index:i,keys:n,read:h,write:j}}function h(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.toCollection();(b==null?void 0:b.order)==="desc"&&(a=a.reverse());(b==null?void 0:b.filter)!=null&&(a=a.filter(b.filter));(b==null?void 0:b.limit)!=null&&(a=a.limit(b.limit));return a.toArray()},"read")}function i(a,b){return{equals:function(c){return{read:function(e){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.where(b).equals(c.length===1?c[0]:c);(e==null?void 0:e.order)==="desc"&&(a=a.reverse());(e==null?void 0:e.filter)!=null&&(a=a.filter(e.filter));(e==null?void 0:e.limit)!=null&&(a=a.limit(e.limit));return a.toArray()},"index-equal")}}},keys:function(){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.orderBy(b);return a.uniqueKeys()},"index-keys")},read:function(c){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.orderBy(b);(c==null?void 0:c.order)==="desc"&&(a=a.reverse());(c==null?void 0:c.filter)!=null&&(a=a.filter(c.filter));(c==null?void 0:c.limit)!=null&&(a=a.limit(c.limit));return a.toArray()},"index-read")}}}function j(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkAdd(b).then(function(){})},"write")}function k(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkDelete(b)},"ack")}function l(a,b){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.bulkDelete(b)},"delete")}function m(a){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READWRITE,function(a){return a.clear().then(function(){})},"clear")}function n(a){return d("WADbTransactor").persistedQueueTransactor(a,d("MAWTransactionMode").READONLY,function(a){a=a.toCollection();return a.primaryKeys()},"keys")}g.dexieApiForPersistedQueue=a;g.persistedQueueRead=h;g.persistedQueueIndex=i;g.persistedQueueWrite=j;g.persistedQueueAck=k;g.persistedQueueDelete=l;g.persistedQueueClear=m;g.persistedQueueKeys=n}),98);
__d("MAWIsQuotaExceededError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a.name==="QuotaExceededError"||a.inner&&a.inner.name==="QuotaExceededError"};f.isQuotaExceededError=a}),66);
__d("MAWExpiredXMACleaner",["FBLogger","MAWMsgCleaner","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ExpiredXMACleaner: Adding timestamps backend(",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}var j=null;function a(a){j==null&&(j=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.XMA))}function b(a){if(j==null){var b="Trying to add new addNewExpiredXMACleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("FBLogger")("messenger_web").mustfixThrow(b)}else d("WALogger").DEV(h(),a),j.update(a)}function e(){return j}function f(){j=null}g.startExpiredXMACleaner=a;g.addNewExpiredXMACleanerTimestamp=b;g.getExpiredXMACleaner_FOR_TESTING_ONLY=e;g.resetExpiredXMACleaner_FOR_TESTING_ONLY=f}),98);
__d("WAFtsTokenizerBaseNormalizer",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this,c=[];this.$1=new Map();a.forEach(function(a){var d=a[0];a=a[1];b.$1.set(d,a);c.push(d)});this.$2=new RegExp(c.join("|"),"g")}var b=a.prototype;b.normalize=function(a){var b=this;a===void 0&&(a="");return a.replace(this.$2,function(a){var c=b.$1.get(a);return c!=null?c:a})};return a}();f["default"]=a}),66);
__d("WAFtsTokenizerPostLowercaseNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0131","i"],["\u0629","\u0647"],["\u0640",""],["\u0649","\u064a"],["\u0671","\u0627"],["\u06a4","\u0641"],["\u06a9","\u0643"],["\u06ba","\u0646"],["\u06be","\u0647"],["\u06c3","\u06c2"],["\u06cc","\u064a"],["\u06d2","\u064a"],["\u06d5","\u0647"],["\u06f0","\u0660"],["\u06f1","\u0661"],["\u06f2","\u0662"],["\u06f3","\u0663"],["\u06f4","\u0664"],["\u06f5","\u0665"],["\u06f6","\u0666"],["\u06f7","\u0667"],["\u06f8","\u0668"],["\u06f9","\u0669"],["\u08bb","\u0641"],["\u08bc","\u0642"],["\u08bd","\u0646"],["\u200c",""],["\u0966","0"],["\u0967","1"],["\u0968","2"],["\u0969","3"],["\u096a","4"],["\u096b","5"],["\u096c","6"],["\u096d","7"],["\u096e","8"],["\u096f","9"],["\u0901","\u0902"],["\u0903",""],["\u093c",""],["\u09e6","0"],["\u09e7","1"],["\u09e8","2"],["\u09e9","3"],["\u09ea","4"],["\u09eb","5"],["\u09ec","6"],["\u09ed","7"],["\u09ee","8"],["\u09ef","9"],["\u0a66","0"],["\u0a67","1"],["\u0a68","2"],["\u0a69","3"],["\u0a6a","4"],["\u0a6b","5"],["\u0a6c","6"],["\u0a6d","7"],["\u0a6e","8"],["\u0a6f","9"],["\u0c66","0"],["\u0c67","1"],["\u0c68","2"],["\u0c69","3"],["\u0c6a","4"],["\u0c6b","5"],["\u0c6c","6"],["\u0c6d","7"],["\u0c6e","8"],["\u0c6f","9"],["\u0ae6","0"],["\u0ae7","1"],["\u0ae8","2"],["\u0ae9","3"],["\u0aea","4"],["\u0aeb","5"],["\u0aec","6"],["\u0aed","7"],["\u0aee","8"],["\u0aef","9"],["\u0ce6","0"],["\u0ce7","1"],["\u0ce8","2"],["\u0ce9","3"],["\u0cea","4"],["\u0ceb","5"],["\u0cec","6"],["\u0ced","7"],["\u0cee","8"],["\u0cef","9"],["\u0d66","0"],["\u0d67","1"],["\u0d68","2"],["\u0d69","3"],["\u0d6a","4"],["\u0d6b","5"],["\u0d6c","6"],["\u0d6d","7"],["\u0d6e","8"],["\u0d6f","9"],["\u0142","l"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsTokenizerPreNFKDNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0675","\u0674\u0627"],["\u0676","\u0674\u0648"],["\u0677","\u0674\u06c7"],["\u0678","\u0674\u0649"],["\u0905\u0946","\u0904"],["\u0905\u093e","\u0906"],["\u0930\u094d\u0907","\u0908"],["\u0909\u0941","\u090a"],["\u090f\u0945","\u090d"],["\u090f\u0946","\u090e"],["\u090f\u0947","\u0910"],["\u0905\u0949","\u0911"],["\u0906\u0945","\u0911"],["\u0905\u094a","\u0912"],["\u0906\u0946","\u0912"],["\u0905\u094b","\u0913"],["\u0906\u0947","\u0913"],["\u0905\u094c","\u0914"],["\u0906\u0948","\u0914"],["\u0905\u0945","\u0972"],["\u0905\u093a","\u0973"],["\u0905\u093b","\u0974"],["\u0906\u093a","\u0974"],["\u0905\u094f","\u0975"],["\u0905\u0956","\u0976"],["\u0905\u0957","\u0977"],["\u0985\u09be","\u0986"],["\u098b\u09c3","\u09e0"],["\u098c\u09e2","\u09e1"],["\u0a05\u0a3e","\u0a06"],["\u0a72\u0a3f","\u0a07"],["\u0a72\u0a40","\u0a08"],["\u0a73\u0a41","\u0a09"],["\u0a73\u0a42","\u0a0a"],["\u0a72\u0a47","\u0a0f"],["\u0a05\u0a48","\u0a10"],["\u0a73\u0a4b","\u0a13"],["\u0a05\u0a4c","\u0a14"],["\u0a85\u0abe","\u0a86"],["\u0a85\u0ac5","\u0a8d"],["\u0a85\u0ac7","\u0a8f"],["\u0a85\u0ac8","\u0a90"],["\u0a85\u0ac9","\u0a91"],["\u0a85\u0acb","\u0a93"],["\u0a85\u0abe\u0ac5","\u0a93"],["\u0a85\u0acc","\u0a94"],["\u0a85\u0abe\u0ac8","\u0a94"],["\u0ac5\u0abe","\u0ac9"],["\u0b05\u0b3e","\u0b06"],["\u0b0f\u0b57","\u0b10"],["\u0b13\u0b57","\u0b14"],["\u0bb8\u0bcd\u0bb0\u0bc0","\u0bb6\u0bcd\u0bb0\u0bc0"],["\u0c12\u0c55","\u0c13"],["\u0c12\u0c4c","\u0c14"],["\u0c3f\u0c55","\u0c40"],["\u0c46\u0c55","\u0c47"],["\u0c4a\u0c55","\u0c4b"],["\u0c89\u0cbe","\u0c8a"],["\u0c92\u0ccc","\u0c94"],["\u0c8b\u0cbe","\u0ce0"],["\u0d07\u0d57","\u0d08"],["\u0d09\u0d57","\u0d0a"],["\u0d0e\u0d46","\u0d10"],["\u0d12\u0d3e","\u0d13"],["\u0d12\u0d57","\u0d14"],["\u0d23\u0d4d\u200d","\u0d7a"],["\u0d28\u0d4d\u200d","\u0d7b"],["\u0d30\u0d4d\u200d","\u0d7c"],["\u0d32\u0d4d\u200d","\u0d7d"],["\u0d33\u0d4d\u200d","\u0d7e"],["\u0d85\u0dcf","\u0d86"],["\u0d85\u0dd0","\u0d87"],["\u0d85\u0dd1","\u0d88"],["\u0d8b\u0ddf","\u0d8c"],["\u0d8d\u0dd8","\u0d8e"],["\u0d8f\u0ddf","\u0d90"],["\u0d91\u0dca","\u0d92"],["\u0d91\u0dd9","\u0d93"],["\u0d94\u0ddf","\u0d96"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsMultiLangTokenizer",["WAFtsTokenizerPostLowercaseNormalizer","WAFtsTokenizerPreNFKDNormalizer"],(function(a,b,c,d,e,f,g){"use strict";var h={NFC_CHARACTER:/(?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u3005\u3007\u3021-\u3029\u3030\u3038-\u303B\u303D\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u3297\u3299\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFF66-\uFF6F\uFF71-\uFF9D]|\uD81B[\uDFF0\uDFF1]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/g,NFC_WORD:/((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E01-\u0E3A\u0E40-\u0E5B])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0F00-\u0F47\u0F49-\u0F6C\u0F71-\u0F97\u0F99-\u0FBC\u0FBE-\u0FCC\u0FCE-\u0FD4\u0FD9\u0FDA])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1000-\u109F\uA9E0-\uA9FE\uAA60-\uAA7F])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1780-\u17DD\u17E0-\u17E9\u17F0-\u17F9\u19E0-\u19FF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u02EA\u02EB\u3105-\u312F\u31A0-\u31BF])+/g},i=/(?![\u0902\u094D])(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])+/g,j=/(?:[!-#%-\/:-@\[-`\{-~\xA1\xA7\xA8\xAB\xAC\xAF\xB1\xB4\xB6-\xB8\xBB\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u037E\u0384\u0385\u0387\u03F6\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0606-\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u200D\u2010-\u2027\u2030-\u205E\u207A-\u207E\u208A-\u208E\u2118\u2140-\u2144\u214B\u2190-\u2194\u219A\u219B\u21A0\u21A3\u21A6\u21AE\u21CE\u21CF\u21D2\u21D4\u21F4-\u22FF\u2308-\u230B\u2320\u2321\u2329\u232A\u237C\u239B-\u23B3\u23DC-\u23E1\u25B7\u25C1\u25F8-\u25FF\u266F\u2768-\u2775\u27C0-\u27FF\u2900-\u2AFF\u2B30-\u2B44\u2B47-\u2B4C\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u309B\u309C\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA700-\uA716\uA720\uA721\uA789\uA78A\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uAB5B\uAB6A\uAB6B\uABEB\uFB29\uFBB2-\uFBC1\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE2\uFFE3\uFFE9-\uFFEC]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]|\uD83B[\uDEF0\uDEF1]|\uD83C[\uDFFB-\uDFFF])/g,k=/(^|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)[\"\'\xAB\xBB\u2018-\u201F\u2039\u203A\u2E42\u300C-\u300F\u301D-\u301F\uFE41-\uFE44\uFF02\uFF07\uFF62\uFF63]((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)($|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))/g,l=/(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F])+/g,m=/(?:[\$\xA2-\xA5\u058F\u060B\u07FE\u07FF\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BF\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]|\uD807[\uDFDD-\uDFE0]|\uD838\uDEFF|\uD83B\uDCB0)+/g;function n(a){return a.replace(k,function(a,b,c,d,e){return" "+c+d+" "+c+" "+d+" "})}function o(a){return a.split(l)}function p(a){return a.replace(j,"")}function q(a){return a.replace(i,"")}function r(a){return a.normalize("NFC").replace(h.NFC_CHARACTER,function(a){return" "+a+" "})}function s(a){return a.normalize("NFC").replace(h.NFC_WORD,function(a){return" "+a+" "})}function t(a){return a.replace(m,function(a){return" "+a+" "})}a=function(){function a(){}var b=a.prototype;b.tokenize=function(a){a===void 0&&(a="");a=n(a);a=t(r(s(a)));a=o(a);a=a.map(function(a){a=a;a=p(a);if(!a.length)return a;else a.match(h.NFC_CHARACTER)?a=a.normalize("NFC"):a.match(h.NFC_WORD)?a=a.normalize("NFC"):(a=q(c("WAFtsTokenizerPreNFKDNormalizer").normalize(a).normalize("NFKD")),a=a.toLocaleLowerCase("en-US"),a=c("WAFtsTokenizerPostLowercaseNormalizer").normalize(a));return a});return new Set(a.filter(function(a){return!!a&&!!a.trim()&&!a.match(l)}))};return a}();g["default"]=a}),98);
__d("MAWFTSIsMessageValidForSearch",["MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0}function a(a){var b=a.msgContent,c=a.sortOrderMs,e=a.type;b=b==null?void 0:b.content;if(b==null||c==null)return null;if(e!==d("MAWMsgType").MSG_TYPE.TEXT&&e!==d("MAWMsgType").MSG_TYPE.XMA)return null;return h(a)?null:{content:b,sortOrderMs:c}}g.verifyMessageValidity=a}),98);
__d("MpsMessageToSearchBridge",["MpsMessageToBridgeWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.toplevelProtobuf);if(a.expiryTimestampMs!=null)return;a=(a=b.deserialize().encryptedTransportMessage())==null?void 0:(a=a.consumerMessage())==null?void 0:(a=a.payload)==null?void 0:(a=a.content)==null?void 0:(a=a.messageText)==null?void 0:a.text;return a==null?null:{chatJid:b.getChatJid(),externalId:b.getExternalId(),msg:{content:a,sender:b.message.senderId,ts:b.getUnixTs()},sortOrderMs:b.message.timestampMs}}g.messageToSearchBridge=a}),98);
__d("MAWDbGroupInviteTxns",["MAWDexieTable","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.groupInvites.put(b).then(function(){return b})}function b(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]])["delete"]()}function h(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).equals([b,c]).first()}function c(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]]).toArray()}function e(a,b){return b.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE?b.invitedParticipantUserJid==null?d("MAWDexieTable").dexieResolve():h(a,b.threadJid,b.invitedParticipantUserJid):d("MAWDexieTable").dexieResolve()}g.putGroupInvite=a;g.deleteGroupInvitesByThreadAndInvitedParticipant=b;g.maybeGetGroupInvite=h;g.getGroupInvitesByThreadAndInvitedParticipant=c;g.getAndCheckGroupInviteFromMsg=e}),98);
__d("MAWRemoveGroupInvitesApi",["MAWDbGroupInviteTxns","MAWIndexedDb","MAWTransactionMode","WALogger","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeGroupInvites deleted "," record(s) from "," for ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READWRITE},"removeGroupInvites",function(a){return function(b,e){return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,e).then(function(a){d("WALogger").DEV(h(),a,b,e),c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:{threadJid:b}})}).then(function(){c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"GroupInviteLoaded",value:{actorId:e,threadJid:b}})})}});g.removeGroupInvites=a}),98);
__d("MAWLoadGroupInvitesTxns",["MAWBridgeTypesCreators","MAWDbGroupInviteTxns","MAWDexieTable","MAWIndexedDb","MAWUserJidWrapper","WAJids","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=[],f=d("MAWUserJidWrapper").getMyUserJid();b.forEach(function(b){return d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(){e.push(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant(a,b.jid,f))},user:c("emptyFunction")})});return d("MAWDexieTable").dexieAll(e).then(function(a){a.forEach(function(a,b){a.forEach(function(b,a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypesCreators").createBridgeGroupInvite(b)})})})})}g.loadGroupInvites=a}),98);
__d("MAWDbPollTxns",["MAWIndexedDb","MAWTransactionMode","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";e=d("MAWIndexedDb").makeMsgrTransactor({poll:d("MAWTransactionMode").READONLY},"handleIncomingMessagesStanzas",function(a){return function(b,c){return a.poll.get([b,d("WAStanzaUtils").toStanzaId(c)])}});function a(a,b){return a.poll.put(b).then(function(){return b})}function b(a,b,c){return a.poll.get([b,d("WAStanzaUtils").toStanzaId(c)])}function c(a,b,c){return a.messages.where(["threadJid","pollStanzaId","sortOrderMs"]).between([c,b,Number.MIN_SAFE_INTEGER],[c,b,Number.MAX_SAFE_INTEGER],!1,!1).reverse().first()}g.getDbPoll=e;g.updatePoll=a;g.getPoll=b;g.maybeGetLatestPollUpdateMsg=c}),98);
__d("MAWLoadMessagesRequest",["FBLogger","MAWMessagesCompare","MAWMessagesDirection","MessagesRangesV2ExternalIds","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";b={admin:!1,editMsgHistory:!1,media:!1,polls:!1,reactions:!1,receiverFetch:!1,xma:!1};function h(a,b,e){if(a.length===0)return[];e=d("MAWMessagesCompare").getSortComparisonFunctionForDirection(d("MAWMessagesDirection").translateMawDirectionToMwpDirection(e));a=[].concat(a).sort(e);if(b.lowerBoundExternalId!=null&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){e=a.findIndex(function(a){return a.externalId===b.lowerBoundExternalId});e!==-1?a=a.slice(e):c("FBLogger")("messenger_web").mustfix("Get messages for range: no external id in source msgs list")}a=i(a,b);return a.slice(0,b.numMsgs)}function a(a,b,c,e){a=a.filter(function(a){var c;return((c=a.sortOrderMs)!=null?c:Number.MAX_SAFE_INTEGER)>=b.gte[0]&&((c=a.sortOrderMs)!=null?c:Number.MIN_SAFE_INTEGER)<=b.lte[0]});var f=d("MAWMessagesDirection").switchOnMAWMessagesDirection(c,{after:[b.gte,b.lte],before:[b.lte,b.gte]}),g=f[0],i=g[0];g=g[1];f=f[1];f[0];var j=f[1];f=h(a,{includeLowerBoundMsg:!0,lowerBoundExternalId:d("WAStanzaUtils").toStanzaId(g),lowerBoundSortOrderMs:i,numMsgs:e},c);if(j!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&j!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){a=f.findIndex(function(a){return a.externalId===j});if(a!==-1)return f.slice(0,a)}return f}function i(a,b){if(b.includeLowerBoundMsg||a.length===0)return a;return a[0].externalId===b.lowerBoundExternalId||a[0].sortOrderMs===b.lowerBoundSortOrderMs?a.slice(1):a}g.loadMsgsConfigForCheckingOnly=b;g.getMsgsForRange=h;g.getMsgsForBounds=a}),98);
__d("MAWLoadMsgsDedupper",["MAWDbMsgUtil","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=new Set();return function(b){b=d("MAWDbMsgUtil").getProtocolMsgIdFromDbMsg(b);if(b==null)return!0;b=d("WAMsg").craftWAMsgIdString(b);if(b!=null){if(a.has(b))return!1;a.add(b)}return!0}}g["default"]=a}),98);
__d("MAWLoadMsgsUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d=0,e=0,f=!1,g=null;return function(h){e++;if(g!=null&&g===h.sortOrderMs)return!1;if(e>b&&h.sortOrderMs!==a)return!0;h.msgId===c&&(f=!0);f&&d++;if(d>b)return!0;g=h.sortOrderMs;return!1}}function b(a){var b=!0,c=0,d=null;return function(e){if(d===null)c++;else if(d===e.sortOrderMs){c+=b?0:1;return!1}else c++,b=!1;if(c>a)return!0;d=e.sortOrderMs;return!1}}f.makeUntilWithRangeExtension=a;f.makeUntilWithRangeExtensionBothDirections=b}),66);
__d("MAWLoadMsgsTxnsV2",["I64","MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeReceiverFetchInfo","MAWBridgeTypesCreators","MAWBridgeXMA","MAWCurrentUser","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbPollTxns","MAWDbReactionsTxns","MAWDbReceiverFetchTxns","MAWDbXMATxns","MAWDexieTable","MAWGetIsMediaDownloadStatusEnabled","MAWHandleXmaTransactionUtil","MAWLoadMessagesRequest","MAWLoadMsgsDedupper","MAWLoadMsgsUtil","MAWLoadReplyMediaTxns","MAWLoggerUtils","MAWMediaUtils","MAWMessagesDirection","MAWODSProxy","MAWRavenUtils","MAWXMAUtils","MWFBLogger","WAMsgType","WAOdsEnums","WATimeUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMsgsByExternalId: From: externalId:",". ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs, chatJid: ",", result: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs: From:"," orignalMsgId:",", chatJid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs, chatJid: ",", range: ",".}"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""]);m=function(){return a};return a}function n(a,b,d,e,f,g){switch(d){case"before":return h();case"after":return i().then(function(a){return a.reverse()})}function h(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,0],[b,e],!0,!0).reverse().filter(f).filter(d).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null}).until(g,!0).toArray()}function i(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,e],[b,Number.MAX_SAFE_INTEGER],!0,!0).filter(f).filter(d).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null}).until(g,!0).toArray()}}function o(a,b){return d("MAWDbReactionsTxns").getReactionsFromMessages(a,b).then(function(a){return a.map(function(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null)return;return c==null?{reaction:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:f,reactToMsgId:e}),type:"delete"}:{reaction:d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a}),type:"upsert"}}).filter(Boolean)})}function p(a,b){return d("MAWDbMediaTxns").getMsgMediaPairFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b[0],e=b[1];return d("MAWDbChunkTxns").hasMediaChunk(a,e.hashedPlaintextHash).then(function(b){return q(a,c.threadJid,e).then(function(f){var g=f.map(function(a){return a.msgId}),h=d("MAWMediaUtils").createHdTypesForBridgeMedia(f);g=c.ravenEphemeralType!=null&&c.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,hdTypes:h,media:e,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(c.ravenEphemeralType,c.ravenEphemeralMediaState),sortOrderMs:c.sortOrderMs}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,hdTypes:h,media:e,sortOrderMs:c.sortOrderMs});return d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,g,f)})})}))})}function q(a,b,c){return a.messages.where("msgId").anyOf(c.msgIds).toArray().then(function(a){return a.filter(function(a){return a.threadJid===b})})}function r(a,b){return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return d("MAWDexieTable").dexieResolve(null);if(d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusForXMAsEnabledWithChunkVerification()){var c=[b.defaultPreviewMediaId,b.faviconMediaId,b.headerMediaId].filter(Boolean);return d("MAWDbMediaTxns").maybeBulkGetMediaFromMediaId(a,c).then(function(c){if(c.size===0)return d("MAWBridgeXMA").createBridgeXMA(null,b,{hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1});var e=b.defaultPreviewMediaId!=null?c.get(b.defaultPreviewMediaId):null,f=b.headerMediaId!=null?c.get(b.headerMediaId):null;c=b.faviconMediaId!=null?c.get(b.faviconMediaId):null;return d("MAWHandleXmaTransactionUtil").verifyAllMediaChunksForXMA(e,c,f,a).then(function(a){var c=a.hasMedia,f=a.hasXmaFaviconMedia;a=a.hasXmaHeaderMedia;return d("MAWBridgeXMA").createBridgeXMA(e,b,{hasMedia:c,hasXmaFaviconMedia:f,hasXmaHeaderMedia:a})})})}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(c){return c==null?d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1}):d("MAWDexieTable").dexieAll([c,d("MAWDbChunkTxns").hasMediaChunk(a,c==null?void 0:c.hashedPlaintextHash)]).then(function(a){var c=a[0];a=a[1];return d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:a,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1})})})}))}).then(function(a){return a.filter(Boolean)})}function s(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return b.receiverFetchId==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbReceiverFetchTxns").maybeGetReceiverFetchInfoFromReceiverFetchId(a,b.receiverFetchId).then(function(a){return a==null?d("MAWDexieTable").dexieResolve(null):d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(b.threadJid,b.msgId,b.sortOrderMs,b.ts,a)})})).then(function(a){return a.filter(Boolean)})}function t(a,b){var c=new Map();return d("MAWDexieTable").dexieAll(b.map(function(b){if(b.type!==d("WAMsgType").MSG_TYPE.GROUP_POLL_CREATE&&b.type!==d("WAMsgType").MSG_TYPE.GROUP_POLL_UPDATE)return null;var e=b.type===d("WAMsgType").MSG_TYPE.GROUP_POLL_CREATE?b.externalId:b.pollStanzaId;if(e==null){d("MWFBLogger").MWMediaLogger.tags(["GroupPollsE2EE"]).mustfix("pollStanzaId is null for poll msg in MLV2");return null}var f=c.get(e);if(f!=null){if(f.externalId===b.externalId){return u(a,b.threadJid,e,f.msgId,d("WATimeUtils").castToMillisTime((f=f==null?void 0:f.sortOrderMs)!=null?f:0))}return null}return d("MAWDbPollTxns").maybeGetLatestPollUpdateMsg(a,e,b.threadJid).then(function(f){if(f==null){var g;return u(a,b.threadJid,e,b.msgId,d("WATimeUtils").castToMillisTime((g=b.sortOrderMs)!=null?g:0))}c.set(e,f);if(f.externalId===b.externalId){return u(a,b.threadJid,e,f.msgId,d("WATimeUtils").castToMillisTime((g=f==null?void 0:f.sortOrderMs)!=null?g:0))}else return null})})).then(function(a){return a.filter(Boolean)})["finally"](function(){c.clear()})}function u(a,b,c,e,f){return a.poll.get([b,c]).then(function(a){if(a==null){d("MWFBLogger").MWMediaLogger.tags(["GroupPollsE2EE"]).mustfix("Poll is null in MLV2");return null}return{contactIdForCurrentUser:(h||(h=d("I64"))).of_string(d("MAWCurrentUser").getID()),dbPoll:a,latestUpdateMsgId:e,latestUpdateTimestampMs:f}})}function v(a,b,e){if(!c("gkx")("15418"))return d("MAWDexieTable").dexieResolve([e,[]]);var f=e.map(function(c){return c.quote==null?null:d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,c.quote.content.externalId,b,(c=c.quote)==null?void 0:c.content.author)}).filter(Boolean);return f.length<=0?d("MAWDexieTable").dexieResolve([e,[]]):d("MAWDexieTable").dexieAll(f).then(function(a){return[e,a.filter(Boolean)]})}function w(a,b,c,e,f,g,h){h===void 0&&(h=function(){return!0});var i=d("WATimeUtils").unixTime(),j=function(a){return a.messageExpirationTs==null||a.messageExpirationTs>i};c=d("MAWLoadMsgsUtil").makeUntilWithRangeExtension(f,c,g);return n(a,b,e,f,function(a){return h(a)&&j(a)},c).then(function(c){return v(a,b,c)}).then(function(b){var c=b[0],e=b[1];return d("MAWDexieTable").dexieAll([].concat(c,e).map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:c,quoteMsgs:e,replyMediaInfo:a}})})}function x(a,b){return a.messages.where("externalId").equals(b).toArray()}function y(a,b){return x(a,b).then(function(c){c.length>1&&d("MWFBLogger").MWLogger.tags(["Pinned"]).warn("duplicate MAW msg returned for externalId",b);return d("MAWDexieTable").dexieAll(c.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:c,replyMediaInfo:a}})})}function z(a){a=a.filter(function(a){return a.ephemeralCounterStarted});if(a.length>0){d("MWFBLogger").MWLogger.tags([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.OnLoad]).DEBUG(m(),String(a.map(function(a){return a.msgId})));return d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a).msgs}return[]}function A(a,b){return a!=null?a:d("MAWMessagesDirection").switchOnMAWMessagesDirection(b,{after:Number.MIN_SAFE_INTEGER,before:Number.MAX_SAFE_INTEGER})}function a(a){var b=a.chatJid,c=a.config,e=a.db,f=a.direction,g=a.range,h=d("WATimeUtils").unixTime();a=function(a){var b=a.messageExpirationTs!=null&&a.messageExpirationTs<h,e=a.type===d("WAMsgType").MSG_TYPE.ADMIN&&!c.admin;a=a.isCollapsed===!0;return!b&&!e&&!a};var i=g.includeLowerBoundMsg?g.numMsgs:g.numMsgs+1;i=d("MAWLoadMsgsUtil").makeUntilWithRangeExtensionBothDirections(i);var j=A(g.lowerBoundSortOrderMs,f);return n(e,b,f,j,a,i).then(function(a){return v(e,b,a)}).then(function(a){var b=a[0],c=a[1],h=d("MAWLoadMessagesRequest").getMsgsForRange(b,g,f);return d("MAWDexieTable").dexieAll([].concat(h,c).map(function(a){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(e,a)})).then(function(a){return{msgsForRange:h,quotedMsgs:c,replyMediaInfo:a}})}).then(function(a){var h=a.msgsForRange,i=a.quotedMsgs;a=a.replyMediaInfo;d("MWFBLogger").MWLogger.tags(["MAWSecureLocalDBDataSource"]).DEBUG(l(),b,String(g));return B(e,h,i,a,f,g.numMsgs,c,b)})}function b(a,b,c,e,f,g,h,i){var j=A(f,e);return w(a,b,c,e,j,h,function(a){var b=a.isCollapsed===!0;a=!i.admin&&a.type===d("WAMsgType").MSG_TYPE.ADMIN;return!(b||a)}).then(function(f){var l=f.msgs,m=f.quoteMsgs;f=f.replyMediaInfo;var n=l;g||(n=n.filter(function(a){return a.msgId!==h}),n.length===l.length&&l.length!==0&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.LOAD_MORE_NO_ORIGINAL_MSG_IN_MAW,key:"mismatch"}));d("MWFBLogger").MWLogger.tags(["MAWSecureLocalDBDataSource"]).DEBUG(k(),j,h,b);return B(a,n,m,f,e,c,i,b)})}function B(a,b,c,e,f,g,h,i){var k=b.length;if(k===0)return d("MAWDexieTable").dexieResolve({editMsgHistory:[],expiringCountdown:[],hasMoreAfter:D(k,g,f),hasMoreBefore:C(k,g,f),medias:[],msgs:[],polls:[],quotedMsgs:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]});var l=b.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(e||[])[b])}).filter(Boolean),m=z(b);d("MWFBLogger").MWLogger.tags(["MAWSecureLocalDBDataSource"]).DEBUG(j(),i,String(l.map(function(a){return a.msgId+":"+a.sortOrderMs})));return d("MAWDexieTable").dexieAll([h.reactions?o(a,b):d("MAWDexieTable").dexieResolve([]),h.media?p(a,b):d("MAWDexieTable").dexieResolve([]),h.xma?r(a,b):d("MAWDexieTable").dexieResolve([]),h.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,b):d("MAWDexieTable").dexieResolve([]),h.receiverFetch?s(a,b):d("MAWDexieTable").dexieResolve([]),h.polls?t(a,b):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],e=a[1],h=a[2],i=a[3],j=a[4];a=a[5];return{editMsgHistory:i,expiringCountdown:m,hasMoreAfter:D(k,g,f),hasMoreBefore:C(k,g,f),medias:e,msgs:l,polls:a,quotedMsgs:c.map(function(a){return d("MAWBridgeMsg").createBridgeMsg(a)}),reactions:b,receiverFetchInfoPayloads:j,xmas:h}})}function C(a,b,c){switch(c){case"before":return a>=b;default:c;return!0}}function D(a,b,c){switch(c){case"after":return a>=b;default:c;return!0}}function e(a,b,c){return y(a,b).then(function(e){var f=e.msgs,g=e.replyMediaInfo;if(f.length===0)return{editMsgHistory:[],medias:[],msgs:[],polls:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]};var h=f.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(g||[])[b])}).filter(Boolean);d("MWFBLogger").MWLogger.tags(["MAWFetchMessageByPinnedExternalId"]).DEBUG(i(),b,String(h.map(function(a){return""+a.msgId})));return d("MAWDexieTable").dexieAll([c.reactions?o(a,f):d("MAWDexieTable").dexieResolve([]),c.media?p(a,f):d("MAWDexieTable").dexieResolve([]),c.xma?r(a,f):d("MAWDexieTable").dexieResolve([]),c.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,f):d("MAWDexieTable").dexieResolve([]),c.receiverFetch?s(a,f):d("MAWDexieTable").dexieResolve([]),c.polls?t(a,f):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4];a=a[5];return{editMsgHistory:e,medias:c,msgs:h,polls:a,reactions:b,receiverFetchInfoPayloads:f,xmas:d}})})}g.loadMoreMsgsAndMediaForRange=a;g.loadMoreMsgsAndMediaFromTs=b;g.loadMsgsAndMediaByExternalId=e}),98);
__d("MAWLoadMsgsTxns",["MAWIndexedDb","MAWLoadMsgsTxnsV2","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g){f===void 0&&(f=!1);g===void 0&&(g="before");return d("MAWLoadMsgsTxnsV2").loadMoreMsgsAndMediaFromTs(a,b,e,g,null,f,null,{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0}).then(function(a){var b=a.editMsgHistory,e=a.expiringCountdown,f=a.hasMoreAfter,g=a.hasMoreBefore,h=a.medias,i=a.msgs,j=a.reactions,k=a.receiverFetchInfoPayloads;a=a.xmas;var l=!c("qex")._("4739");i.length>0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:i}});e.length>0&&d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:{msgs:e}});j.filter(function(a){return a.type==="upsert"}).forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"UpsertReaction",value:a.reaction},l)});j.filter(function(a){return a.type==="delete"}).forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:a.reaction},l)});a.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:a})});b.length>0&&d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:b},l);h.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:a})});k.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:a})});return{hasMoreAfter:f,hasMoreBefore:g}})}g.loadMsgAndMedia_COMPAT=a}),98);
__d("MAWLoadOneToOneMessageRequestCapabilitiesTxn",["MAWDexieTable","MAWIndexedDb","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a.map(d("WAJids").interpretAsUserJid).forEach(function(a){return a!=null&&d("MAWIndexedDb").afterTransaction({tag:"OneToOneMessageRequestLoaded",value:{fbid:d("WAJids").extractUserId(a),threadJid:a}})});return d("MAWDexieTable").dexieResolve()}g.loadOneToOneMessageRequestCapabilities=a}),98);
__d("MAWLoadThreadsTxns",["FBLogger","I64","MAWBridgeThread","MAWBridgeTypesCreators","MAWDbParticipantTxns","MAWDexieTable","MAWIndexedDb","MAWLoadGroupInvitesTxns","MAWLoadMsgsTxns","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWMpsGating","MAWThreadMappingQPL","MAWTransactionMode","MAWUserJidWrapper","WAJids","WALogger","emptyFunction","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,e,f){f===void 0&&(f="unknown");b.forEach(function(a){var b=d("MAWThreadMappingQPL").getInstanceKeyForJidInWorker(a.jid);d("MAWThreadMappingQPL").startInWorker({instanceKey:b,jid:a.jid,threadKey:a.optimisticThreadKey==null?void 0:(h||(h=d("I64"))).of_string(a.optimisticThreadKey),trigger:"loadContentsForThreads_"+f});d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,e==null?void 0:e.get(a.jid),void 0,"loadContentsForThreads_"+f,null,b)})});return d("MAWMpsGating").isFullMpsEnabled()?d("MAWDexieTable").dexieResolve(b):d("MAWDexieTable").dexieAll([].concat(b.map(function(b){return j(a,b,c)}),[i(a,b),k(a,b),d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities(b.map(function(a){return a.jid})),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])).then(function(){return b})}function b(a,b,c,e){return d("MAWDexieTable").dexieAll([i(a,[c]),j(a,c,e)]).then(function(e){e=e[0];b||m(a,c.jid,d("WAJids").interpretAsGroupJid(c.jid)!=null,!1,c.cannotReplyReason,c.archived);return e})}function e(a,b,c){return i(a,[c]).then(function(e){b||m(a,c.jid,d("WAJids").interpretAsGroupJid(c.jid)!=null,!1,c.cannotReplyReason,c.archived);return e})}function i(a,b){return b.length===0?d("MAWDexieTable").dexieResolve([]):d("MAWDbParticipantTxns").getParticipantsInThreads(a,b.map(function(a){return a.jid}))}function j(a,b,c){return d("MAWLoadMsgsTxns").loadMsgAndMedia_COMPAT(a,b.jid,c,!0)}function k(a,b){var e=[];b.forEach(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return e.push(a)},user:c("emptyFunction")})});return a.groupInfo.bulkGet(e).then(function(a){a.forEach(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}f=function(a){a=a.threadJid;return l(a)};var l=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"checkIfGroupParticipant",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return m.apply(void 0,[a].concat(c))}});function m(a,b,e,f,g,h){e===void 0&&(e=!0);f===void 0&&(f=!0);var i=d("MAWUserJidWrapper").getMyUserJid();return d("MAWDbParticipantTxns").getParticipant(a,b,i).then(function(a){if(!a.success){var j=e?"group":"one_to_one";d("WALogger").LOG(["[Occamadillo] User is not a participant of "+j+" thread\n        "+b.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);if(g==null){var k;c("FBLogger")("maw_db","checkIfParticipant").catching((k=a.payload)!=null?k:c("err")(a.error)).warn("[Occamadillo] User %s is not a participant of %s thread %s, occam: %s, archived: %s, cannotReplyReason null.",i,j,b.toString(),f,h)}c("FBLogger")("labyrinth_web","checkIfParticipant").warn("[Occamadillo] User not a participant from checkIfParticipant");k={cannotReplyReason:"viewer_not_subscribed",threadJid:b};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(k)})}})}g.loadContentsForThreads=a;g.loadParticipantsAndMsgs=b;g.loadParticipantsAndThreadInfo=e;g.loadParticipants=i;g.loadGroups=k;g.checkIfGroupParticipant=f;g.checkIfParticipant=m}),98);
__d("MAWDbGroupInfoTxns",["MAWBridgeTypesCreators","MAWIndexedDb","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b.jid).then(function(c){var d=b.participantVersion;c.success&&c.value.participantVersion!=null&&b.participantVersion==null&&(d=c.value.participantVersion);c=b.subject.content;c!=null&&c.length===0&&(c=void 0);var e={creationTs:b.creationTs,creator:b.creator,groupJid:b.jid,inviter:b.inviter,memberAddMode:b.memberAddMode,name:c,nameOwner:b.subject.user,nameTs:b.subject.ts,participantVersion:d};return i(a,e).then(function(){return e})})}function h(a,b){return a.groupInfo.get({groupJid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function i(a,b){return a.groupInfo.put(b).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(b)})})}function b(a,b){return a.groupInfo.bulkPut(b).then(function(){b.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}function c(a,b){return a.groupInfo.bulkGet(b)}function e(a,b){return a.groupInfo["delete"](b)}g.putGroupInfo=a;g.getGroupInfo=h;g.updateGroupInfo=i;g.bulkUpdateGroupInfo=b;g.getGroupInfos=c;g.deleteGroupInfo=e}),98);
__d("MAWGroupInviteManagementTxns",["MAWDbGroupInviteTxns","MAWDbParticipantTxns","MAWDexieTable","MAWUserJidWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=!1;return d("MAWDbParticipantTxns").getInvitedParticipantsInThread(a,b).then(function(e){if(e.length===0){c=!0;var f=d("MAWUserJidWrapper").getMyUserJid();return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,f).then(function(){return c})}else{var g=[];e.forEach(function(c){g.push(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,c.userJid))});return d("MAWDexieTable").dexieAll(g).then(function(){return c})}})}g.deleteGroupInvitesByThread=a}),98);
__d("MAWThreadManagementTxns",["MAWBridgeEventTransmitter","MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbGroupInfoTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWGetOrCreateThreadTxns","MAWGroupInviteManagementTxns","MAWIndexedDb","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWQplProxy","WAJids","WALogger","WAMsgType","WASortedLists","WATimeUtils","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted "," media rows and "," chunk rows"]);h=function(){return a};return a}function a(a,b,e,f){var g=b.authoritativeThreadKey,h=b.createTs,i=b.description,j=b.folder,k=b.lastActivityTimestamp,m=b.lastReadWatermarkTimestamp,n=b.offlineThreadingId,o=b.skipVerifyThread,p=b.userJid;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:g,clientThreadKey:n,createTs:h,description:i,folder:j,instanceKey:f,jid:p,lastActivityTimestamp:k,lastReadWatermarkTimestamp:m,skipVerifyThread:o},e).then(function(b){var g=b.created;b=b.thread;e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"process-setup-thread-start",{instanceKey:e});f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056836502,"2778"),"process_setup_thread_start",{instanceKey:f});g=l(a,p,g,b);e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"process-setup-thread-end",{instanceKey:e});f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056836502,"2778"),"process_setup_thread_end",{instanceKey:f});return g})}function b(a,b,c,e){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b).then(function(b){if(!b.success)return null;var f=b.value;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:d("WATimeUtils").castUnixTimeToMillisTime(f.creationTs),description:"getOrRepairGroupThread",folder:c,jid:f.groupJid,skipVerifyThread:e}).then(function(a){var b=a.created;a=a.thread;return{created:b,groupInfo:f,thread:a}})})}function i(a,b){var c=[],e=[];b.forEach(function(a){d("MAWDbMsg").isMediaMsg(a)&&a.mediaId!=null&&(c.push(a.mediaId),e.push(a.msgId))});return a.media.bulkGet(c).then(function(b){var c=[],f=[];b.forEach(function(a,b){if(a!=null){var g=e[b];a.msgIds=d("WASortedLists").filter(a.msgIds,function(a){return a!==g});a.mediaEntries["delete"](g);a.msgIds.length===0&&a.mediaEntries.size===0&&(a.plaintextHash!=null&&c.push(a.hashedPlaintextHash),f.push(a.mediaId))}});b=a.media.bulkDelete(f);var g=a.chunk.where("hashedPlaintextHash").anyOf(c)["delete"]();return d("MAWDexieTable").dexieAll([b,g]).then(function(){d("WALogger").LOG(h(),f.length,c.length)})})}function j(a,b){return d("MAWDbMsgTxns").getThreadNewestMessageMs(a,b.jid).then(function(c){return a.messages.where("threadJid").equals(b.jid).toArray().then(function(d){return k(a,b,c,d,!0)})})}function e(a,b,c,e){var f=c==null?void 0:c.lastMessageTimestamp;if(c==null)return j(a,b);var g=a.messages.where("threadJid").equals(b.jid).toArray(),h=d("MAWDbMsgTxns").getThreadNewestMessageMs(a,b.jid);return d("MAWDexieTable").dexieAll([g,h]).then(function(g){var h=g[0];g=g[1];var i=[],j=new Set();f!=null&&h.forEach(function(a){var b;b=(b=a.originalTs)!=null?b:a.ts;b<=f+1&&(j.add(a.msgId),i.push(a))});if((c==null?void 0:c.messages.length)!==0){var l=new Set();c.messages.forEach(function(a){l.add((a=a.key)==null?void 0:a.id)});h.forEach(function(a){l.has(a.externalId)&&!j.has(a.msgId)&&(j.add(a.msgId),i.push(a))})}if(i.length!==h.length)for(var m of h)if(!j.has(m.msgId)&&m.type!==d("WAMsgType").ADMIN)return k(a,b,g,i,!1,e);return k(a,b,g,h,!0,e)})}function k(a,b,e,f,g,h){var j=d("WAJids").interpretAsGroupJid(b.jid),k=g?d("MAWDbThreadTxns").deleteThread(a,b.jid):d("MAWDexieTable").dexieResolve(),l=g?d("MAWDbParticipantTxns").deleteAllParticipantsForThread(a,b.jid):d("MAWDexieTable").dexieResolve(),m=d("MAWDexieTable").dexieResolve(!1),n=d("MAWDexieTable").dexieResolve();j!=null&&g&&(m=d("MAWGroupInviteManagementTxns").deleteGroupInvitesByThread(a,j),n=d("MAWDbGroupInfoTxns").deleteGroupInfo(a,j));return d("MAWDexieTable").dexieAll([i(a,f),d("MAWDbReactionsTxns").deleteAllReactionsForMessages(a,f),d("MAWDbMsgTxns").deleteMessages(a,f,h),k,l,n,m]).then(function(a){a[0];a[1];a[2];a[3];a[4];a[5];a=a[6];g?(d("MAWBridgeEventTransmitter").deleteMessagesOfThreadAfterTxn(b,e),j!=null&&a&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:d("MAWBridgeTypesCreators").createBridgeDeleteGroupInvite(b.jid)}),d("MAWIndexedDb").afterTransaction({tag:"ThreadHiddenV2",value:b.jid})):c("qex")._("4486")||d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.jid,f)});return{deletedMessages:f.map(function(a){return d("MAWDbMsg").getWAMsgId(a)})}})}function l(a,b,c,e){a=d("MAWDbParticipantTxns").bulkRemoveIncorrectAndInsertMissingParticipantsInOneToOneThread(a,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)})});return d("MAWDexieTable").dexieAll([d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities([e.jid]),a]).then(function(){return{created:c,thread:e}})}g.getOrSetupOneToOneThread=a;g.getGroupThread=b;g.deleteAllThreadData=j;g.metaSyncChatDeleteThread=e;g.processSetupThreadResponseForOneToOneThread=l}),98);
__d("MAWGroupInfoStore",["MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadThreadsTxns","MAWThreadManagementTxns","MAWTransactionMode","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null&&typeof a==="object"&&a.groupStatus!=null&&typeof a.groupStatus==="string"?a.groupStatus:void 0}function i(a){return a!=null&&typeof a==="object"&&a.clientThreadKey!=null&&typeof a.clientThreadKey==="string"?a.clientThreadKey:void 0}function j(a){return a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number"?a.folder:void 0}function k(a){return a!=null&&typeof a==="object"&&a.updateParticipantMedatadata!=null&&typeof a.updateParticipantMedatadata==="boolean"?a.updateParticipantMedatadata:void 0}function l(a){return a===null?{}:a}a=function(){function a(a){var b=this;this.get=function(a,c){c=j(c);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadManagementTxns").getGroupThread(b.db,a,c).then(function(a){return a!=null?a:null}).then(function(a){return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWLoadThreadsTxns").loadContentsForThreads(b.db,[a.thread],1,null,"getGroupInfoStore").then(function(){return a.groupInfo}).then(function(a){return d("WAResultOrError").makeResult(m(a))})}))};this.create=function(a,c){var e=h(c)==="added"?d("WATimeUtils").millisTime():d("WATimeUtils").castUnixTimeToMillisTime(a.creationTs);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetOrCreateThreadTxns").getOrCreateThread(b.db,{clientThreadKey:i(c),createTs:e,description:"MAWGroupInfoStore-create",folder:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:a.jid}).then(function(c){var e=c.created,f=c.thread,g=n(a);return d("MAWDexieTable").dexieAll([b.db.groupInfo.put(g),d("MAWDbMsgTxns").getThreadNewestMessageId(b.db,f.jid)]).then(function(a){a[0],a[1],d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)})}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(b.db,[f.jid]):d("MAWDexieTable").dexieResolve()}).then(function(){return e?d("WAResultOrError").makeResult(g.groupJid):d("WAResultOrError").makeError("existing")})}))};this["delete"]=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([b.db.threads.get({jid:a}),b.db.groupInfo["delete"](a)]).then(function(a){a=a[0];return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").deleteThread(b.db,a.jid),b.db.participants.where("threadJid").equals(a.jid)["delete"]()]).then(function(){return d("WAResultOrError").makeResult()})}))};this.update=function(a,c,e){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(f){return f==null?d("WAResultOrError").makeError("missing_group"):b.db.groupInfo.get(a).then(function(a){if(a==null)return d("WAResultOrError").makeError("missing_group");a=m(a);a=c(a);var g=n(a);return b.db.groupInfo.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)});k(e)===!0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(f.jid)});return d("WAResultOrError").makeResult()})})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.groupInfo.clear())};this.db=a}var b=a.prototype;b.has=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.groupInfo.get(a).then(function(a){return a!=null?!0:!1}))};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,editMsgHistory:b.READONLY,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,poll:b.READONLY,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};function m(a){return babelHelpers["extends"]({jid:a.groupJid},l(a.creator!=null?{creator:a.creator}:null),{creationTs:a.creationTs},l(a.participantVersion!=null?{participantVersion:a.participantVersion}:null),{inviter:a.inviter,memberAddMode:a.memberAddMode,subject:babelHelpers["extends"]({content:a.name},l(a.nameOwner!=null?{user:a.nameOwner}:null),{},l(a.nameTs!=null?{ts:a.nameTs}:null))})}function n(a){var b=a.subject.content;b!=null&&b.length===0&&(b=void 0);return{creationTs:a.creationTs,creator:a.creator,groupJid:a.jid,inviter:a.inviter,memberAddMode:a.memberAddMode,name:b,nameOwner:a.subject.user,nameTs:a.subject.ts,participantVersion:a.participantVersion}}g.MAWGroupInfoStore=a}),98);
__d("MAWThreadFetchAndEmitTxns",["MAWDexieTable","MAWLoadGroupInvitesTxns","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWLoadThreadsTxns","MAWThreadManagementTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){f===void 0&&(f="fetchAndEmitThread");return d("WAJids").switchOnMsgrChatJidType(b,{group:function(b){return d("MAWThreadManagementTxns").getGroupThread(a,b,c).then(function(a){return a==null?null:{created:a.created,thread:a.thread}})},user:function(b){return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{createTs:e==null?void 0:d("WATimeUtils").castUnixTimeToMillisTime(e),description:f,folder:c!=null?c:void 0,userJid:b})}}).then(function(b){return b==null||b.thread==null?null:d("MAWLoadThreadsTxns").loadContentsForThreads(a,[b.thread],1,null,f).then(function(){return b})})}function b(a,b){if(b.size===0)return d("MAWDexieTable").dexieResolve();b=Array.from(b);return a.threads.where("jid").anyOf(b).toArray().then(function(b){b=b.filter(Boolean);return d("MAWDexieTable").dexieAll([d("MAWLoadThreadsTxns").loadParticipants(a,b),d("MAWLoadThreadsTxns").loadGroups(a,b),d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities(b.map(function(a){return a.jid})),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])}).then(c("emptyFunction"))}g.fetchAndEmitThread=a;g.emitThreadContents=b}),98);
__d("MAWMessageStore",["MAWAckLevel","MAWAuthor","MAWBridgeMsg","MAWDbMsgTxns","MAWDbThread","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","MAWLocalizationUtils","MAWMsgType","MAWThreadFetchAndEmitTxns","MAWTransactionMode","MAWWriteMsgTxns","WAJids","WALogger","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."]);h=function(){return a};return a}function i(a){if(a!=null&&typeof a==="object"&&a.optimisticMsg!=null){a=a.optimisticMsg;if(typeof a.msgId==="string"&&typeof a.ts==="number")return{msgId:a.msgId,ts:a.ts}}return void 0}function j(a){return a!=null&&typeof a==="object"&&a.openMessageOtid!=null&&typeof a.openMessageOtid==="string"?a.openMessageOtid:void 0}function k(a){if(a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number")if(a.folder===d("MAWFolderTypes").FOLDER_ID.INBOX)return d("MAWFolderTypes").FOLDER_ID.INBOX;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.PENDING)return d("MAWFolderTypes").FOLDER_ID.PENDING;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.OTHER)return d("MAWFolderTypes").FOLDER_ID.OTHER;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.ARCHIVED)return d("MAWFolderTypes").FOLDER_ID.ARCHIVED;return null}a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a,b){var e=this,f=i(b),g=j(b);b=k(b);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(this.db,a.id.chat,b,void 0,"MAWMessageStore_DEPRECATED-create").then(function(b){if(b==null)return d("WAResultOrError").makeError({type:"missing_thread"});b=b.thread;if(a.type===d("MAWMsgType").MSG_TYPE.TEXT){var h=void 0;a.ephemeralSetting!=null&&(h={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});h={ack:a.ack,altIndex:void 0,author:a.id.author,ephemeralSetting:h,externalId:a.id.externalId,forwardingScore:a.forwardingScore,isForwarded:a.forwardingScore>0,msgContent:{content:((h=a.msgContent)==null?void 0:h.content)||""},serverTs:a.serverTs,threadJid:b.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.TEXT};return d("MAWWriteMsgTxns").writeMsg(e.db,h,b,{openMessageOtid:g,optimisticMsg:f}).then(function(){return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ICDC_ALERT){h={ack:a.ack,altIndex:void 0,author:a.id.author,externalId:a.id.externalId,msgContent:{adminType:a.msgContent.adminType,authorName:a.msgContent.authorName},serverTs:a.serverTs,threadJid:b.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(e.db,h,b,{openMessageOtid:g,optimisticMsg:f}).then(function(){a.hasUnknownName&&!d("WAJids").isAuthorMe(a.id.author)&&!d("WAJids").isAuthorSystem(a.id.author)&&d("MAWIndexedDb").afterTransaction({tag:"SyncContacts",value:[d("WAJids").userIdFromJid(a.id.author)]});return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ADMIN){h={ack:a.ack,altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:a.id.externalId,msgContent:babelHelpers["extends"]({},a.msgContent,{version:d("MAWLocalizationUtils").isAdminMsgNormalized(a.msgContent.adminType)?1:0}),serverTs:a.serverTs,threadJid:b.jid,ts:a.ts,type:a.type};return d("MAWWriteMsgTxns").writeMsg(e.db,h,b).then(function(){return d("WAResultOrError").makeResult()})}throw c("err")("non renderable store not implemented yet")}))};b.get=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.chat}),this.db.messages.where("externalId").equals(a.externalId).toArray()]).then(function(b){var c,e=b[0];b=b[1];if(e==null)return d("MAWDexieTable").dexieResolve(null);b=b.find(function(b){return b.threadJid===e.jid&&b.author===a.author});return b==null||b.type!=="Text"?d("MAWDexieTable").dexieResolve(null):d("MAWDexieTable").dexieResolve({ack:b.ack,forwardingScore:(c=b.forwardingScore)!=null?c:0,id:a,msgContent:{content:b.msgContent.content},ts:b.ts,type:b.type})}))};b.update=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.id.chat}),this.db.messages.where("externalId").equals(a.id.externalId).toArray()]).then(function(c){var e=c[0];c=c[1];if(e==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));var f=c.find(function(b){return b.threadJid===e.jid&&b.author===a.id.author});if(f==null||f.type!=="Text")return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));c=f.ack<d("MAWAckLevel").ACK.sent;f.ack=a.ack;f.ts=a.ts;f.serverTs=a.sentTs;var g=void 0;a.ephemeralSetting!=null&&(g={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});f.ephemeralSetting=g;g=a.sentTs;g=g==null?g:d("WATimeUtils").castUnixTimeToMillisTime(g);c=g!=null&&c?b.db.threads.put(babelHelpers["extends"]({},e,{newestMsgTs:g,threadOrder:d("MAWDbThread").craftThreadOrder(g,e.jid)})):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([b.db.messages.put(f),c]).then(function(){var a=null;d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f,void 0,a)});return d("WAResultOrError").makeResult()})}))};b.deleteReactionsForMsg=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.reactions.where("reactToExternalId").equals(a.externalId).filter(function(b){return d("MAWAuthor").getAuthorUserJid(b.reactToAuthor)===d("MAWAuthor").getAuthorUserJid(a.author)&&b.threadJid===a.chat}).toArray().then(function(a){return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))}))};b.bulkDelete=function(a){var b=this,c=d("MAWDexieTable").dexieAll(a.map(function(a){var c=a.author,e=a.chat;a=a.externalId;var f=d("MAWAuthor").getAuthorUserJid(c);return b.db.reactions.where("reactToExternalId").equals(a).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===f&&a.threadJid===e}).toArray()})).then(function(a){return a.flat()}).then(function(a){d("WALogger").LOG(h(),a.length);return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))});return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbMsgTxns").getMsgsByProtocolMsgId(this.db,a).then(function(a){var e=a.map(function(a){return a.rowId});return d("MAWDexieTable").dexieAll([b.db.messages.bulkDelete(e),c]).then(function(){return e.length})}))};b.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.messages.where("threadJid").equals(a).toArray()).then(function(b){return b==null||b.length===0?[]:b.map(function(b){return{author:b.author,chat:a,externalId:b.externalId}})})};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:b.READWRITE,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,poll:b.READONLY,reactions:b.READWRITE,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};g.MAWMessageStore_DEPRECATED_DO_NOT_USE=a}),98);
__d("WAResultOrErrorUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=[];a.forEach(function(a){a.success&&b.push(a.value)});return b}function b(a){var b=[];a.forEach(function(a){a.success||b.push(a.error)});return b}f.unpackValues=a;f.unpackErrors=b}),66);
__d("MAWParticipantsStore",["MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAArrayGroupBy","WAArrayZip","WAGlobals","WAResultOrError","WAResultOrErrorUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var b=this;this.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(a){return a!=null?d("MAWDbParticipantTxns").getParticipantsInThread(b.db,a.jid).then(function(b){return d("WAResultOrError").makeResult(b.map(function(b){return h(b,a.jid)}))}):d("WAResultOrError").makeError("missing_group")}))};this.bulkPut=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,a.map(function(a){a=a.chatJid;return a})).then(function(b){return d("WAResultOrErrorUtils").unpackValues(a.map(function(a){return!b.has(a.chatJid)?d("WAResultOrError").makeError():d("WAResultOrError").makeResult({participantId:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),waParticipant:a})}))}).then(function(a){return b.db.participants.bulkGet(a.map(function(a){a=a.participantId;return a})).then(function(b){return d("WAArrayZip").zip(a,b).map(function(a){var b=a[0].waParticipant;a=a[1];return{chatJid:b.chatJid,dbParticipantToPut:babelHelpers["extends"]({deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0)},a,{},i(b)),existed:a!=null,participant:b}})})}).then(function(a){var c=a.map(function(a){a=a.dbParticipantToPut;return babelHelpers["extends"]({},a)});c.forEach(function(a){return d("MAWDbParticipantTxns").logIfIllegalParticipant(a,"MAWParticipantsStore::bulkPut")});return b.db.participants.bulkPut(c).then(function(){return l(b.db,a)})}))};this.bulkDelete=function(a,c){c=c||{};var e=c.remover,f=d("WAArrayGroupBy").groupBy(a.map(function(a,b){return{index:b,key:a}}),function(a){a=a.key;return a.groupJid});c=f.map(function(a){a=a[0];return a});return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,c).then(function(a){return f.flatMap(function(b){var c=b[0];b=b[1];return b.map(function(b){var e=b.index;b=b.key;return!a.has(c)?d("WAResultOrError").makeError({index:e,message:"missing_group"}):d("WAResultOrError").makeResult({groupJid:c,index:e,participantId:d("MAWDbParticipant").craftParticipantId(c,b.userJid),participantKey:[c,b.userJid],userJid:b.userJid})})})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),e=d("WAResultOrErrorUtils").unpackErrors(a).map(function(a){return d("WAResultOrError").makeError(a)});a=c.map(function(a){a=a.participantId;return a});return b.db.participants.bulkGet(a).then(function(a){return d("WAArrayZip").zip(c,a).map(function(a){var b=a[0];a=a[1];return a==null?d("WAResultOrError").makeError({index:b.index,message:"missing_participant"}):d("WAResultOrError").makeResult(b)}).concat(e)})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),f=c.map(function(a){a=a.participantKey;return a}),g=c.map(function(a){var b=a.groupJid;a=a.userJid;return{groupJid:b,userJid:a}});return d("MAWDbParticipantTxns").bulkDeleteParticipants(b.db,f).then(function(){return m(b.db,g,e)}).then(function(){return a})}).then(function(a){return a.map(function(a){return a.success?{index:a.value.index,result:d("WAResultOrError").makeResult()}:{index:a.error.index,result:d("WAResultOrError").makeError(a.error.message)}}).sort(function(a,b){a=a.index;b=b.index;return a-b}).map(function(a){a=a.result;return a})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.participants.clear())};this.db=a};a.tableLocks={participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE};function h(a,b){var c=a.addressable!=null?{addressable:a.addressable}:null;return babelHelpers["extends"]({chatJid:b,type:a.type,user:a.userJid},c)}function i(a){return{addressable:a.addressable,id:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),threadJid:a.chatJid,type:a.type,userJid:a.user}}function j(a){return a.map(function(a){return a.user}).filter(function(a){return a===d("WAGlobals").getMyUserJid()||a==="@me"}).length>0}function k(a,b){a=a.threads;return a.where("jid").anyOf(b).toArray().then(function(a){return new Set(a.map(function(a){a=a.jid;return a}))})}function l(a,b){var c=b.filter(function(a){a=a.existed;return!a}).map(function(a){var b=a.chatJid;a=a.participant;return{chatJid:b,participant:a}});c=d("WAArrayGroupBy").groupBy(c,function(a){a=a.chatJid;return a}).map(function(a){var b=a[0];a=a[1];return[b,a.map(function(a){a=a.participant;return a})]});b.forEach(function(a){a=a.dbParticipantToPut;d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:{participants:[d("MAWBridgeParticipants").createBridgeParticipant(a)]}})});b=c.filter(function(a){a[0];a=a[1];return j(a)}).map(function(a){a=a[0];return a});return d("MAWDbThreadTxns").subscribeToThreads(a,b)}function m(a,b,c){b=Array.from(b);b.forEach(function(a){a=a.groupJid;return d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(a)})});var e=new Set(b.filter(function(a){return a.userJid===d("WAGlobals").getMyUserJid()&&(c===d("WAGlobals").getMyUserJid()||c==="@me")}).map(function(a){return a.groupJid}));b=new Set(b.filter(function(a){a=a.userJid;return a!==c&&(a===d("WAGlobals").getMyUserJid()||a==="@me")}).filter(function(a){a=a.groupJid;return!e.has(a)}).map(function(a){a=a.groupJid;return a}));return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").archiveThreads(a,Array.from(e),!0),d("MAWDbThreadTxns").unsubscribeFromThreads(a,Array.from(b))])}g.MAWParticipantsStore=a}),98);
__d("MAWRunInTransaction",["MAWDexie","MAWGroupInfoStore","MAWIndexedDb","MAWMessageStore","MAWParticipantsStore","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";var h={GroupInfoStore:d("MAWGroupInfoStore").MAWGroupInfoStore.tableLocks,MessagesStore:d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE.tableLocks,ParticipantsStore:d("MAWParticipantsStore").MAWParticipantsStore.tableLocks};a=function(a,b,e){var f=[];for(var g in a)a[g]===!0&&f.push(g);g=f.flatMap(function(a){return Object.entries(h[a])}).reduce(function(a,b){var c=b[0];b=b[1];if(a[c]===d("MAWTransactionMode").READWRITE)return a;c=c;return babelHelpers["extends"]({},a,(a={},a[""+c]=b,a))},{});f=d("MAWIndexedDb").makeMsgrTransactor(g,e!=null?e:"runInTransaction",function(e){return function(){var f={CollectionVersionStore:null,GroupInfoStore:a.GroupInfoStore===!0?new(d("MAWGroupInfoStore").MAWGroupInfoStore)(e):null,MessagesStore:a.MessagesStore===!0?new(d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE)(e):null,MissingKeyStore:null,ParticipantsStore:a.ParticipantsStore===!0?new(d("MAWParticipantsStore").MAWParticipantsStore)(e):null,PendingMutationStore:null,SyncActionStore:null,SyncKeyStore:null};return new(c("MAWDexie").Promise)(function(a){a(b(f))})}});return f()};g.runInTransaction=a}),98);
__d("MAWAddGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"addGroupParticipants")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h,i){h=a.GroupInfoStore;var j=a.MessagesStore;a=a.ParticipantsStore;var k=(yield h.get(c));if(!k.success)return d("WAResultOrError").makeError("missing_group");k=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:a.type,user:a.user}});yield a.bulkPut(k);if(b!=null){f=d("MAWAdminMsgHelpers").createParticipantAddAdminMessage(c,k.map(function(a){return a.user}),e,i);yield j.create(f);yield h.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h,i){return a.apply(this,arguments)}}();g.addGroupParticipants=a;g.addGroupParticipantsTransactor=h}),98);
__d("MAWMarkMsgDroppedApi",["MAWAckLevel","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWQplProxy","MAWTransactionMode","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"markMsgDropped",function(a){return function(b,e,f){f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_msg_and_reaction_fetch_start",{instanceKey:f.qplInstanceKey});return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b)]).then(function(b){var g=b[0];b=b[1];f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_msg_and_reaction_fetch_end",{instanceKey:f.qplInstanceKey});if(g!=null){var h=(e==null?void 0:e.isRetriable)===!0?d("MAWAckLevel").ACK.failedRetryable:d("MAWAckLevel").ACK.expired,i=c("gkx")("7471");f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_update_system_ack_start",{annotations:{"int":{ack:h}},instanceKey:f.qplInstanceKey});return d("MAWDbMsgTxns").updateSystemAck(a,g.msgId,h,void 0,void 0,i&&(e==null?void 0:e.applicationErrorCode)!=null?e==null?void 0:e.applicationErrorCode:void 0).then(function(a){f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_update_system_ack_end",{instanceKey:f.qplInstanceKey});return a==null?"missing":a.ack<=d("MAWAckLevel").ACK.clock?"dropped":"sent"})}if(b!=null){f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_update_delete_reaction_start",{instanceKey:f.qplInstanceKey});return d("MAWDbReactionsTxns").deleteReaction(a,b).then(function(){f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_update_delete_reaction_end",{instanceKey:f.qplInstanceKey});return"dropped"})}f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(f.qplEventType,"mark_msg_dropped_msg_and_reaction_missing",{instanceKey:f.qplInstanceKey});return"missing"})}});g.markMsgDropped=b}),98);
__d("MAWMessageSendScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h=24e4,i;function a(){i==null&&(i=d("WorkerScheduler").makeScheduler("message-send",{concurrency:5,defaultSamplingRate:500,maxConcurrency:5,maxThrottleMs:500,timeToStuckMs:h}));return i}g.messageSendScheduler=a}),98);
__d("MAWMessageSendsCommon",["MAWMarkMsgDroppedApi","MAWMessageSendScheduler","MAWQplProxy","MWFBLogger","WAGetSafeQPLError","WAPromiseDelays","WAResultOrError","WATimeUtils","WAWaitForComms","WorkerScheduler","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Guard: should not happen, result is null"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message send fail. Error: ",""]);i=function(){return a};return a}var j=1e3,k=d("MWFBLogger").MWLogger.tags(["MessageSend"]);function l(){if(!c("justknobx")._("4635"))return{activeTasks:[],pendingTasks:[]};var a=d("MAWMessageSendScheduler").messageSendScheduler().getDebugState();return{activeTasks:a.activeTasks.map(function(a){return"executionTimeMs"+a.executionTimeMs+" priority: "+a.priority+" name: "+a.task+" waitTimeMs:"+a.waitTimeMs}),pendingTasks:a.pendingTasksByPriority.map(function(a){return a.map(function(a){return"name: "+a.task+" waitTimeMs:"+a.waitTimeMs})}).flat()}}function m(a,b,c,d,e){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){d("MAWQplProxy").sendQplPointThroughBridge(a,"backend_reached",{annotations:{bool:{backendSetupReadyFromWorker:!d("WAWaitForComms").isStillWaitingForComms()}},instanceKey:b});var n;try{d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_start",{annotations:{},instanceKey:b});yield d("WAWaitForComms").waitForComms();d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_end",{annotations:{},instanceKey:b});var o=l(),p=o.activeTasks;o=o.pendingTasks;d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_start",{annotations:c("justknobx")._("4635")?{string_array:{activeTasksBeforeSchedule:p,pendingTasksByPriorityBeforeSchedule:o}}:{},instanceKey:b});n=(yield d("MAWMessageSendScheduler").messageSendScheduler().runTask({customFlags:{runtimeReliability:!0},fn:function(){return e(d("WATimeUtils").unixTime())},name:f,priority:d("WorkerScheduler").BLOCKING_PRIORITY}));if(n.success===!0)d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_end",{instanceKey:b});else{var q;p=l();o=p.activeTasks;p=p.pendingTasks;d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorType:(q=(q=n.error)==null?void 0:q.type)!=null?q:"unknown-error"},string_array:c("justknobx")._("4635")?{activeTasksBeforeSchedule:o,pendingTasksByPriorityBeforeSchedule:p}:{}},instanceKey:b})}}catch(e){q=l();o=q.activeTasks;p=q.pendingTasks;k.catching(e).MUSTFIX(i(),d("WAGetSafeQPLError").getSafeQPLErrorMessage(e));d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(e),errorType:"runtime-error",sendFailureError:d("WAGetSafeQPLError").getSafeQPLErrorMessage(e)},string_array:c("justknobx")._("4635")?{activeTasksBeforeSchedule:o,pendingTasksByPriorityBeforeSchedule:p}:{}},instanceKey:b});g!=null&&(yield d("MAWMarkMsgDroppedApi").markMsgDropped(g,void 0,{qplEventType:a,qplInstanceKey:b}));throw e}if(!n){q="null-response-from-message-send";k.MUSTFIX(h());d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{instanceKey:b});return d("WAResultOrError").makeError({applicationErrorCode:null,details:q,isRetriable:!0,type:"unexpected-message-codepath"})}if(n.success===!0)return n;n.success;g!=null&&(yield d("MAWMarkMsgDroppedApi").markMsgDropped(g,n.error,{qplEventType:a,qplInstanceKey:b}));if(((o=n.error)==null?void 0:o.type)==="retryable-error"){q=(p=n.error.backoff)!=null?p:j;yield d("WAPromiseDelays").delayMs(q);return m(a,b,e,f,g)}else return n});return n.apply(this,arguments)}g.messageSendLogger=k;g.messageSendObserver=m}),98);
__d("MAWDebugMsg",["MAWBridgeMsg","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWExternalId","MAWIndexedDb","MAWJidUtils","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWTransactionMode","MAWTransactor","MAWUseProtocolMsgIdForMsgId","OfflineThreadingId","WAStanzaUtils","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWTransactor").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"writeDebugMsg",function(a){return function(b,e,f){return!c("gkx")("23958")?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;var c=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,c.jid),d("MAWDbMsgTxns").getThreadNewestMessageMs(a,c.jid),(f==null?void 0:f.decryptionError)==="errDuplicateMsg"?d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f.protocolMsgId).then(function(a){if(a==null)return", no existing message";return a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?", existing ciphertext message":",  existing message"}):d("MAWDexieTable").dexieResolve(""),d("MAWUseProtocolMsgIdForMsgId").shouldUseProtocolMsgIdForMsgId()?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").getNextMsgIdNumberForThread(a,c)]).then(function(a){var b=a[0],f=a[1],g=a[2];a=a[3];a=a!=null?d("MAWDbMsg").craftDebugMsgId(c.chatId,a-1):d("MAWJidUtils").formatProtocolMsgIdFromExternalId(c.jid,d("WAStanzaUtils").toStanzaId(d("OfflineThreadingId").createOfflineThreadingID()));f=d("WATimeUtils").castToMillisTime(((b=(b=b==null?void 0:b.sortOrderMs)!=null?b:f)!=null?b:0)+1);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:["[fb-only][DEBUG]: "+(e+g)],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG,version:0},c.jid,d("MAWExternalId").generateExternalId());d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(babelHelpers["extends"]({},b,{msgId:a,sortOrderMs:f}))})})})}});g.writeDebugMsg=b}),98);
__d("MAWGetEditMsgForSending",["FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsg"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsgProtocolMsgId"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get edit history"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,reactions:a.READONLY,threads:a.READONLY},"getEditMsgForSending",function(a){return function(b,e){return l(a,b,e).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var e=d("MAWAsMessageApplication").asEditMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("FBLogger")("messenger_web").mustfixThrow("This cannot happen because there are no system edit");return{dbMsg:a,editOriginalExternalId:a.originalMsgExternalId,messageApplication:e,messageType:{isEdit:!0,isRevoked:!1,type:"text"},protocolMsgId:b,type:"unsent"}})}});function l(a,b,c){return d("MAWDbEditMsgHistoryTxns").getEditHistoryMsgByEditedProtocolMsgId(a,b,c).then(function(b){if(b==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_history")}else if(b.sendStatus!=null&&b.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.originalMsgExternalId);if(c==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.threadJid),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(a){var c=a[0];a=a[1];if(!c.success){d("WALogger").ERROR(i(),c.success);return d("WAResultOrError").makeError("missing_thread")}if(a==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("missing_msg")}return a.ack>d("MAWAckLevel").ACK.clock?d("WAResultOrError").makeError("sent"):d("WAResultOrError").makeResult({msg:b,thread:c.value})})})}g.getEditMsgForSending=b}),98);
__d("MAWMediaType",["WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"XMA":return"xma-image";case"EphemeralScreenshotAction":case"Raven":case"RavenAction":case"EditAction":case"BumpExistingMessage":return null;default:return d("WAServerMediaType").getMediaType(a)}}g.getMediaType=a}),98);
__d("MAWSendMsgUtil",["MAWMediaType","WAConsumerApplication.pb","WAMsgType","decodeProtobuf","getMediaTypeFromConsumerMessage"],(function(a,b,c,d,e,f,g){"use strict";({});function h(a){var b=d("MAWMediaType").getMediaType(a),c=a===d("WAMsgType").MSG_TYPE.REVOKED;if(b!=null)return{mediaType:b,type:"media"};else if(a===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION)return{isInvisible:!0,isRevoked:!1,type:"text"};else return{isRevoked:c,type:"text"}}function a(a){var b=d("MAWMediaType").getMediaType(a);if(b!=null)return{mediaType:b,type:"media"};switch(a){case"XMA":case"Raven":case"RavenAction":case"EphemeralScreenshotAction":case"EditAction":case"BumpExistingMessage":return{isRevoked:!1,type:"text"};default:return h(a)}}function b(a){var b;a=(a=a.payload)==null?void 0:(a=a.subProtocol)==null?void 0:a.consumerMessage;if(a==null)return{isRevoked:!1,type:"text"};a=d("decodeProtobuf").decodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a.payload);if(a==null?void 0:(b=a.payload)==null?void 0:(b=b.applicationData)==null?void 0:b.revoke)return{isRevoked:!0,type:"text"};b=d("getMediaTypeFromConsumerMessage").getMediaTypeFromConsumerMessage(a);return b!=null?{mediaType:b,type:"media"}:{isRevoked:!1,type:"text"}}g.waGetMessageTypeFromMsg=h;g.getMessageTypeFromMsg=a;g.getMessageTypeFromMessageApplication=b}),98);
__d("MAWGetMsgForSendingApi",["FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWSendMsgUtil","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get XMA: isXma: ",", type: "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Done"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Unrecognized type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Error: ",""]);l=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY,xma:a.READONLY},"getMsgForSending",function(a){return function(b){return m(a,b).then(function(a){if(!a.success){d("WALogger").LOG(l(),b,a.error);return{type:a.error}}a=a.value;var e=a.groupInvite,f=a.isReplyMsg,g=a.media,h=a.msg;a=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(h.type)&&!d("MAWDbMsg").isContentMsg(h)){d("WALogger").LOG(k(),b,h.type);throw c("FBLogger")("messenger_web").mustfixThrow("We do not support message sending with "+h.type+" type")}var i=d("MAWAsMessageApplication").asMessageApplication(h,g,e,a,h.threadJid),m=null;h.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE&&e?m={invitedParticipantUserJid:e.inviteeJid,isRevoked:!1,type:"text"}:m=d("MAWSendMsgUtil").getMessageTypeFromMsg(h.type);if(d("WAJids").isAuthorSystem(h.author))throw c("FBLogger")("messenger_web").mustfixThrow("A system message cannot be sent");d("WALogger").LOG(j(),b);return{dbMsg:h,isReplyMsg:f,isXMAMsg:a!=null,media:g,messageApplication:i,messageType:m,protocolMsgId:{author:h.author,chat:h.threadJid,externalId:a!=null&&a.associatedMessage!=null?a.associatedMessage.externalId:h.externalId},type:"unsent",xmaPayload:a}})}});function m(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(c){var e=c[0];c=c[1];var f=c.value,g=e||f;if(g==null){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("missing_msg")}else if(g.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var j=d("MAWXMAUtils").maybeXMAMessage(e),k=g.quote!=null;return d("MAWDexieTable").dexieAll([e?d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,e):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()),c.success?d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,c.value):d("MAWDexieTable").dexieResolve(),j?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):null]).then(function(a){var b=a[0],c=a[1];a=a[2];if(!b.success)return b;if(a!=null&&!a.success){d("WALogger").ERROR(h(),j,g.type);return d("WAResultOrError").makeError("missing_xma")}b=b.value;return d("WAResultOrError").makeResult({groupInvite:c,isReplyMsg:k,media:b,msg:g,xmaPayload:a!=null?a.value:null})})})}g.getMsgForSending=b}),98);
__d("MAWGetNoteReplyMsgForSendingApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWSendMsgUtil","MAWTransactionMode","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"]);h=function(){return a};return a}function i(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b)]).then(function(a){a=a[0];a=a;if(a==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("missing_msg")}else if(a.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("WAResultOrError").makeResult({msg:a})})}b=d("MAWIndexedDb").makeMsgrTransactor({media:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getNoteReplyForSending",function(a){return function(b){return i(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asNoteReplyMessageApplication(a),e=d("MAWSendMsgUtil").getMessageTypeFromMsg(a.type);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("A system message cannot be sent");return{dbMsg:a,messageApplication:b,messageType:e,protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getNoteReplyForSending=b}),98);
__d("MAWGetReactionForSending",["FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWDbReactionsTxns","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing");else if(b.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("MAWDbThreadTxns").getThread(a,b.threadJid).then(function(a){return!a.success?d("WAResultOrError").makeError(a.error):d("WAResultOrError").makeResult({msg:b})})})}a=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getReactionForSending",function(a){return function(b){return h(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asReactionMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("FBLogger")("messenger_web").mustfixThrow("This cannot happen because there are no system reactions");return{chat:a.threadJid,dbMsg:a,externalId:a.externalId,messageApplication:b,messageType:{isInvisible:!0,type:"reaction"},protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getReactionForSending=a}),98);
__d("MAWLoadThreadParticipantsApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWLoadThreadParticipantsApi -- loadThreadParticipants -- there is no thread in db"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"loadThreadParticipants",function(a){return function(b){return a.threads.get({jid:b}).then(function(b){if(b==null){d("WALogger").ERROR(h());return[]}return d("MAWDbParticipantTxns").getParticipantsInThread(a,b.jid).then(function(a){return a.map(function(a){return a.userJid})})})}});g.loadThreadParticipants=a}),98);
__d("MAWMarkEditMsgDroppedApi",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAGlobals","WAJids","WALogger","WAMsgType","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is not a text message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] thread is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is not the newest edit"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] previousEditedMsg is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is null"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalProtocolMsgId is null"]);o=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markEditMsgDropped",function(a){return function(b,e){var f=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(f==null){d("WALogger").ERROR(o());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([a.threads.get({jid:b.chat}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,f)]).then(function(f){var g=f[0],o=f[1],p=f[2];f=p.sort(function(a,b){return b.editTs-a.editTs});var q=p.find(function(a){return a.editExternalId===b.externalId}),r=f[1];if(o==null){d("WALogger").ERROR(n());return d("WAResultOrError").makeError("missing_original_msg")}if(q==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_newest_edited_msg")}if(r==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_previous_edited_msg")}if(q.editExternalId!==f[0].editExternalId){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("invalid_newest_edited_msg")}if(g==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_thread")}if(o.type!==d("WAMsgType").MSG_TYPE.TEXT){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("invalid_original_msg")}return a.messages.where("quoteExternalId").equals(e).toArray().then(function(e){var f,g=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent,editCount:((f=o.editCount)!=null?f:0)-1,msgContent:r.msgContent}),i=d("WAGlobals").getMyUserJid(),j=[];f=e.find(function(a){var c;return(((c=a.quote)==null?void 0:c.content.author)===d("WAJids").AUTHOR_ME||((c=a.quote)==null?void 0:c.content.author)===i)&&a.threadJid===b.chat});if(f!=null){e=f.quote;var k=f.quoteExternalId;if(e==null)c("FBLogger")("messenger_web").warn("[markEditMsgDropped] Failed to get the quoted content for a msg that has been quoted.",k);else{k=babelHelpers["extends"]({},f,{quote:babelHelpers["extends"]({},e,{content:babelHelpers["extends"]({},e.content,{msgContent:babelHelpers["extends"]({},g.msgContent)})})});j.push(k)}}f=[];o.editCount===1&&p.length===2&&f.push(r.editMsgHistoryId);f.push(q.editMsgHistoryId);return d("MAWDexieTable").dexieAll([a.messages.put(g),a.editMsgHistory.bulkDelete(f)]).then(function(){d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g)});j.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});return d("WAResultOrError").makeResult()})})})}});g.markEditMsgDropped=a}),98);
__d("MAWMarkEditMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory has already been sent"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editedMsg?.editExternalId is null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsgHistory is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalProtocolMsgId is null"]);n=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,ftsBackloggedMessages:a.READWRITE,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"markEditMsgSent",function(a){return function(b,e,f,g){var o=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(o==null){d("WALogger").ERROR(n());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,o),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,o),d("MAWFTSTxns").maybePutMessageToBacklog(a,e)]).then(function(n){var o=n[0];n=n[1];var p=n.find(function(a){return a.editExternalId===e}),q=n.find(function(a){return a.editExternalId===b.externalId});if(o==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_original_msg")}if(p==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_original_msg_edit_history")}if((q==null?void 0:q.editExternalId)==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_edit_external_id")}if(q.sendStatus!=null&&q.sendStatus>d("MAWAckLevel").ACK.clock&&o.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j());return d("WAResultOrError").makeError("already_sent")}if(q.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("not_author")}d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([q.editExternalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});var r=[];if(n.length===2&&o.editCount===1){n=babelHelpers["extends"]({},p,{sendStatus:d("MAWAckLevel").ACK.sent});r.push(n)}p=babelHelpers["extends"]({},q,{editTs:f,sendStatus:d("MAWAckLevel").ACK.sent});r.push(p);var s=r.map(function(a){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:o.msgId})}),t=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent});g!=null&&(t.reportingMeta=g);return d("MAWDexieTable").dexieAll([a.editMsgHistory.bulkPut(r),a.messages.put(t),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,t)]).then(function(a){a[0];a=a[2];d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(t,void 0,a)});d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:s});return d("WAResultOrError").makeResult()})})}});g.markEditMsgSent=b}),98);
__d("MAWMarkMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbMsgTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWMsgType","MAWTransactionMode","MAWUpdateThreadActivity","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Thread missing from DB"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg missing from DB"]);j=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(g){var k=g[0];g=g[1];if(k==null&&!g.success){d("WALogger").LOG(j());return}else if(k!=null){d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([k.externalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});g.success&&d("WALogger").ERROR(i());var l=k.ack<d("MAWAckLevel").ACK.sent;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").updateSystemAck(a,k.msgId,d("MAWAckLevel").ACK.sent,e,f),d("MAWDbThreadTxns").getThread(a,k.threadJid)]).then(function(b){var c=b[0];b=b[1];if(!b.success){d("WALogger").ERROR(h());return}var f=b.value;b=d("WATimeUtils").castUnixTimeToMillisTime(e);b=babelHelpers["extends"]({},f,{lastReadMsgTs:b,newestMsgTs:b,threadOrder:d("MAWDbThread").craftThreadOrder(b,f.jid)});b=l?d("MAWDbThreadTxns").updateThread(a,b):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,c),b]).then(function(){if(c!=null)return d("MAWUpdateThreadActivity").updateThreadActivityFromInsertionTxn(a,c,f.jid,"outgoing_msg")})})}else if(g.success){var m=g.value;return d("MAWDbUnrenderedMsgTxns").updateSystemAckForUnrenderedMsg(a,m.msgId,d("MAWAckLevel").ACK.sent).then(function(){if(m.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE)return d("MAWEphemeralSettingsTxns").updateContactWhenEphemeralSettingChangeMarkedSent(a,b.chat,e)})}})}});g.markMsgSent=b}),98);
__d("MAWSendWrittenMsg",["EBAPI","EBLogger","MAWBridge","MAWDebugMsg","MAWGetEditMsgForSending","MAWGetMsgForSendingApi","MAWGetNoteReplyMsgForSendingApi","MAWGetReactionForSending","MAWJids","MAWLoadThreadParticipantsApi","MAWMarkEditMsgDroppedApi","MAWMarkEditMsgSentApi","MAWMarkMsgDroppedApi","MAWMarkMsgSentApi","MAWMessageSendsCommon","MAWMpsGating","MAWODSProxy","MAWSendMsgUtil","MpsTypes","WAAPI","WAAsMessageApplication","WABuildMpsPayload","WAFrankingTypes","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WebMps","asyncToGeneratorRuntime","encodeProtobuf","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to save message to MPS: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END "," : ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg not sending message: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg ",""]);k=function(){return a};return a}function l(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(k(),String(a.protocolMsgId));b.addPoint("get_msg_for_sending_start",{string:{type:a.type}});var f,g,l,m,n=null,o;if(e==null){if(a.type==="message"||a.type==="revoke"||a.type==="bump")n=(yield d("MAWGetMsgForSendingApi").getMsgForSending(a.protocolMsgId));else if(a.type==="reaction")n=(yield d("MAWGetReactionForSending").getReactionForSending(a.protocolMsgId));else if(a.type==="edit")n=(yield d("MAWGetEditMsgForSending").getEditMsgForSending(a.protocolMsgId,a.referencedOriginalExternalId));else if(a.type==="noteReply")n=(yield d("MAWGetNoteReplyMsgForSendingApi").getNoteReplyForSending(a.protocolMsgId));else{a.type;throw c("err")("This cannot happen because type has `message` as default argument but flow does not know that")}if(n.type!=="unsent"){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(j(),n.type);return d("WAResultOrError").makeError({details:n.type,isRetriable:!0,type:"wrong-message-state"})}var p=n,q=p.dbMsg,r=p.isReplyMsg;p=p.isXMAMsg;o=n.protocolMsgId;f=n.messageApplication;l=n.messageType;g=q==null?void 0:q.type;m=n.editOriginalExternalId;q=(q==null?void 0:q.ephemeralSetting)!=null&&((q=(q=q.ephemeralSetting)==null?void 0:q.ephemeralExpirationInSec)!=null?q:0)>0;b.addPoint("get_msg_for_sending_end",{bool:{isEditMsg:m!=null,isEphemeralMsg:q,isReplyMsg:r,isXMAMsg:p},string:{msgType:l.type}});q&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_OLD_MESSAGE_SEND,key:"sendEphemeralMsg"},!0)}else f=e.messageApplication,l=d("MAWSendMsgUtil").getMessageTypeFromMessageApplication(f),m=null,o=a.protocolMsgId;r=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,f).readBuffer();p={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(new Uint8Array(r)),version:"v3"};b.addPoint("wa_send_msg_start");q=(yield c("WAAPI").sendChatMessage({loadThreadParticipants:d("MAWLoadThreadParticipantsApi").loadThreadParticipants,messagePayload:{backupDirective:null,frankingKey:((q=f.metadata)==null?void 0:q.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array((e=f.metadata)==null?void 0:e.frankingKey)):null,frankingVersion:(a=f.metadata)==null?void 0:a.frankingVersion,messageBytes:p,messageType:l,protocolMsgId:o}},b));if(q.success===!1){b.addPoint("wa_send_msg_fail",{string:{errorType:q.error.type,msgType:g}});m!=null?yield d("MAWMarkEditMsgDroppedApi").markEditMsgDropped(o,m):yield d("MAWMarkMsgDroppedApi").markMsgDropped(o,q.error);d("MAWMessageSendsCommon").messageSendLogger.MUSTFIX(i(),q.error.type,String((e=q.payload)!=null?e:""));switch(q.error.type){case"non-retryable-error":if(q.error.applicationErrorCode!=null&&q.error.applicationErrorCode===10009)try{d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"RefreshContact",value:d("MAWJids").convertChatJidToIntJid(o.chat)}]})}catch(a){d("EBLogger").EBLogger.catching(a).mustfix("Failed to call bridge handler RefreshContact for JID %s and mediaType %s",o.chat,g)}return q;case"missing-receipt":case"wrong-message-state":case"unexpected-message-codepath":case"result-parsing-error":case"retryable-error":case"no-recipients":case"encryption-error":case"too-many-retries":return q;default:q.error.type;throw c("err")("Unreachable code")}}q.success;b.addPoint("wa_send_msg_end");((a=q.value.meta)==null?void 0:a.pOrDhashMismatch)&&(b.addPoint("dhash_phash_mismatch"),c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(o.chat,"Outgoing msg "+o.externalId+" got a phash mismatch")));n!=null&&(b.addPoint("mark_edit_msg_sent_start"),m!=null?yield d("MAWMarkEditMsgSentApi").markEditMsgSent(o,m,q.value.serverTs,q.value.reportingMeta):yield d("MAWMarkMsgSentApi").markMsgSent(o,q.value.serverTs,q.value.reportingMeta),b.addPoint("mark_edit_msg_sent_end"));if(d("MAWMpsGating").isMpsEnabled())try{yield d("WebMps").mps().saveNewMessages([{directive:null,insertionSource:d("MpsTypes").InsertionSource.Send,message:d("WABuildMpsPayload").buildMpsMessage({encryptedTransportMessage:r},{externalId:o.externalId,senderJid:d("WAGlobals").getMyUserJid(),serverTs:q.value.serverTs,threadId:o.chat})}],{source:"wa-message-sent"})}catch(a){d("MAWMessageSendsCommon").messageSendLogger.MUSTFIX(h(),a)}if(n!=null&&!d("MAWMpsGating").isEbUploadViaMpsEnabled()){b.addPoint("eb_upload_scheduling_start");l=n;e=l.dbMsg;a=l.isXMAMsg;m=l.media;r=l.xmaPayload;yield c("EBAPI").uploadSentMessage({dbMsg:e,instanceKey:o.externalId,isXMAMsg:a,media:m,messageApplication:f,messageApplicationBytes:p.bytes,protocolMsgId:o,serverTs:q.value.serverTs,xmaPayload:r});b.addPoint("eb_upload_scheduling_end")}return q});return m.apply(this,arguments)}function a(a,b,c,d){b.addAnnotations({bool:{is_secure:!0},string:{description:c,jid:a.protocolMsgId.chat}});return l(a,b,d)}g.sendWrittenMsgExternal=a}),98);
__d("MAWBuildNewMsgPayload",["FBLogger","MAWAdminMsgType","MAWAuthor","MAWDbMsg","MAWJids","MAWMsgType","WAArmadilloXMA.pb","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msgToQuotedMsg: Unsupported message type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["BumpExistingMessage does not have quote content when replying"]);i=function(){return a};return a}function a(a,b,e,f){if(d("MAWDbMsg").isUnrenderedMsgType(a))throw c("FBLogger")("messenger_web").mustfixThrow("getNewMsg called for wrong message type "+a);var g,h;if(e.quote!=null&&(f==null?void 0:f.content)!=null){var i;h=f==null?void 0:(i=f.content)==null?void 0:i.externalId;g={content:f==null?void 0:f.content,remoteJid:(i=f==null?void 0:f.remoteJid)!=null?i:void 0}}if(e.noteContent!=null){f=d("MAWJids").toUserJid(b.threadJid);g={content:{author:f,expirationTs:d("WATimeUtils").castToUnixTime(e.noteExpirationTs),externalId:b.externalId,msgContent:{content:e.noteContent},ts:b.ts,type:d("WAMsgType").NOTE_REPLY},remoteJid:void 0}}i=babelHelpers["extends"]({},b,{quote:g,quoteExternalId:h});f=e.mediaGroupMetadata;switch(a){case"Text":return babelHelpers["extends"]({},i,{msgContent:{commands:e.commands,content:e.content!=null?e.content:"",mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},i,{hdType:e.hdType,type:d("MAWMsgType").MSG_TYPE.IMAGE},f);case"Video":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(e.xmaMessageType==null)throw c("FBLogger")("messenger_web").mustfixThrow("XMA Message Missing xmaMessageType");f=e.content!=null&&e.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE?e.content:"";return babelHelpers["extends"]({},i,{msgContent:{commands:e.commands,content:f,mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.xmaMessageType});case"EditAction":throw c("FBLogger")("messenger_web").mustfixThrow("EditAction is not supported yet");case"BumpExistingMessage":return babelHelpers["extends"]({},i,{type:d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE});case"ReceiverFetch":throw c("FBLogger")("messenger_web").mustfixThrow("ReceiverFetch is not supported yet");case"GroupPollCreate":return babelHelpers["extends"]({},b,{msgContent:{adminMsgContent:[(f=e.title)!=null?f:""],adminType:d("MAWAdminMsgType").CURRENT_USER_CREATED_POLL,version:1},type:d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE});case"GroupPollUpdate":throw c("FBLogger")("messenger_web").mustfixThrow("GroupPollUpdate is not supported yet");case"Revoked":case"DeleteForMe":case"Ciphertext":case"Futureproof":case"Unavailable":case"Admin":case"ExpiredEphemeral":case"EphemeralSettingAdmin":case"EphemeralScreenshotAction":case"AlertICDC":case"GroupInvite":case"Reaction":case"Raven":case"RavenAction":throw c("FBLogger")("messenger_web").mustfixThrow("Should not be writing ciphertext, futureproof, unsent, admin,\n        ephemeral setting messages, ephemeral screenshot action, group invite messages");default:throw c("WAAssertUnreachable")(a)}}function b(a,b,e,f){if(!d("MAWDbMsg").isUnrenderedMsgType(a))throw c("FBLogger")("messenger_web").mustfixThrow("getNewUnrenderedMsg called for wrong message type "+a);switch(a){case"EphemeralSyncResponse":if(e.ephemeralSetting==null)throw c("FBLogger")("messenger_web").mustfixThrow("Ephemeral Sync Response without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE});case"EphemeralSettingChangeFromCurrentDevice":var g;if(e.ephemeralSetting==null)throw c("FBLogger")("messenger_web").mustfixThrow("Ephemeral Setting Change without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,isEphemeralSettingReset:(g=e.isEphemeralSettingReset)!=null?g:!1,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE});case"GroupInvite":g=d("WAJids").interpretAsGroupJid(b.threadJid);if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group Invite without valid group jid");if(e.invitedParticipantUserJid==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group Invite without invited user jid");return babelHelpers["extends"]({},b,{groupName:e.groupName==null?void 0:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE});case"SenderKeyDistribution":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION});case"RavenAction":if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("Raven Action without Raven Message External Id");if(e.actionType==null)throw c("FBLogger")("messenger_web").mustfixThrow("Raven Action without Action Type");return babelHelpers["extends"]({},b,{actionType:e.actionType,ravenActionToMsgExternalId:d("WAStanzaUtils").toStanzaId(f),type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION});case"EditAction":throw c("FBLogger")("messenger_web").mustfixThrow("Edit action not implemented yet");default:throw c("WAAssertUnreachable")(a)}}function e(a){var b,e={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,plaintextHash:a.plaintextHash,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("MAWMsgType").MSG_TYPE.REVOKED:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE});case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(((b=a.quote)==null?void 0:b.content)==null){d("WALogger").ERROR(i());return null}return babelHelpers["extends"]({},a.quote.content,{author:d("MAWAuthor").getAuthorUserJid(a.quote.content.author)||d("WAJids").AUTHOR_ME});case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH});case d("MAWMsgType").MSG_TYPE.RAVEN:return babelHelpers["extends"]({},e,{ravenEphemeralMediaState:a.ravenEphemeralMediaState,ravenEphemeralType:a.ravenEphemeralType,ravenMediaType:a.ravenMediaType,type:d("MAWMsgType").MSG_TYPE.RAVEN});default:d("WALogger").ERROR(h(),a.type);throw c("FBLogger")("messenger_web").mustfixThrow("Trying to reply to a message type that does not support replies")}}g.buildNewMsg=a;g.getNewUnrenderedMsg=b;g.msgToQuotedMsg=e}),98);
__d("MAWWriteOutgoingMsgApi",["MAWAckLevel","MAWBuildNewMsgPayload","MAWDbMsg","MAWDbMsgTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWQplProxy","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b,c,e){b!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c,a,{annotations:e,instanceKey:b})};b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"writeOutgoingMsg",function(a){return function(b,c,d,e,f,g,h){return i(a,b,c,d,e,f,g,h)}});function i(a,b,c,e,f,g,i,l){f.content!=null&&(f.content=d("MAWVault").vault(f.content));h("write_outgoing_msg_start",l,i);return d("MAWDexieTable").dexieAll([a.threads.get({jid:c}),a.messages.where("externalId").equals(b).toArray(),j(a,f.quote,c),d("MAWDbRavenActionTxns").maybeGetRavenMsgQueryByProtocolMsgId(a,f.ravenProtocolMsgId,g)]).then(function(c){var j=c[0],m=c[1],n=c[2];c=c[3];h("write_outgoing_msg_data_fetched",l,i,{bool:{isUnrenderedMsgType:d("MAWDbMsg").isUnrenderedMsgType(g)}});if(j==null)return{type:"missing_thread"};m=m.find(function(a){return a.threadJid===j.jid&&a.author===d("WAJids").AUTHOR_ME});if(m!=null)return m.ack>=d("MAWAckLevel").ACK.sent?{msgId:m.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:j.jid,externalId:m.externalId},type:"already_sent"}:{msgId:m.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:j.jid,externalId:m.externalId},type:"not_sent"};else{if(!d("MAWDbMsg").isUnrenderedMsgType(g)){m={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:f.ephemeralSetting,externalId:b,isForwarded:f.isForwarded,specialTextSize:f.specialTextSize,threadJid:j.jid,ts:e};var o=d("MAWBuildNewMsgPayload").buildNewMsg(g,m,f,n),p=f.isFirstMsg,q=f.openMessageOtid,r=f.openMessageParticipantCount,s=f.optimisticMsg,t=f.participantCount;m=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,o).then(function(b){return d("MAWWriteMsgTxns").writeMsg(a,o,j,{isCurrentDeviceSendingMsg:!0,isFirstMsg:p,isOutgoing:!0,openMessageOtid:q,openMessageParticipantCount:r,optimisticMsg:s,participantCount:t,quotedReplyAttachmentMeta:b})})}else{n={ack:d("MAWAckLevel").ACK.clock,author:d("WAJids").AUTHOR_ME,externalId:b,threadJid:j.jid,ts:e};n=d("MAWBuildNewMsgPayload").getNewUnrenderedMsg(g,n,f,c==null?void 0:c.externalId);m=d("MAWWriteMsgTxns").writeUnrenderedMsg(a,n,j)}return m.then(function(c){h("write_outgoing_msg_promise_resolved",l,i);return k(a,g,j.jid,e).then(function(){return{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:j.jid,externalId:b},type:"not_sent"}})})}})}function j(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){var e=d("MAWBuildNewMsgPayload").msgToQuotedMsg(b);if(e==null)return null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function k(a,b,e,f){if(b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE)return d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){var c;if(b==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo={syncResponseRetries:((c=(c=b.ephemeralSyncResponseBackoffInfo)==null?void 0:c.syncResponseRetries)!=null?c:0)+1,syncResponseSentTs:f};return a.ephemeralSettings.put(b)}).then(c("emptyFunction"))}});return b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){if(b==null||b.ephemeralSyncResponseBackoffInfo==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo=void 0;return a.ephemeralSettings.put(b).then(c("emptyFunction"))})}}):d("MAWDexieTable").dexieResolve()}g.writeOutgoingMsg=b;g.writeOutgoingMsgImpl=i;g.getQuoteInfo=j}),98);
__d("MAWChangeGroupParticipantAdminStatusApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupParticipantAdminStatus")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){var i=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;var k=(yield i.get(c));if(!k.success)return d("WAResultOrError").makeError("missing_group");k=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:g,user:a.user}});yield a.bulkPut(k);if(b!=null){yield i.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})});for(f=0;f<k.length;f++)g==="admin"?a=d("MAWAdminMsgHelpers").createParticipantPromoteAdminMsg(c,k[f].user,e,h):a=d("MAWAdminMsgHelpers").createParticipantDemoteAdminMsg(c,k[f].user,e,h),yield j.create(a)}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.changeGroupParticipantAdminStatus=a;g.changeGroupParticipantAdminStatusTransactor=h}),98);
__d("MAWRemoveGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAAPI","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(e))},"removeGroupParticipants").then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.success&&(yield c("WAAPI").setRotateSenderKeyToTrue([e[1]]));return a});return function(b){return a.apply(this,arguments)}}())};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){var i=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;var k=(yield i.get(c));if(!k.success)return d("WAResultOrError").makeError("missing_group");k=f.map(function(a){return a.user});f=k.map(function(a){return{groupJid:c,userJid:a}});yield a.bulkDelete(f,{remover:e});if(b!=null){a=d("MAWAdminMsgHelpers").createParticipantRemoveAdminMsg(c,k,e,h);yield j.create(a);yield i.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.removeGroupParticipants=a;g.removeGroupParticipantsTransactor=h}),98);
__d("createInstamadilloAddMessagePayload",["I64","InstamadilloMessageIdUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return a!=null?{ephemeralityParams:{ephemeralDurationSec:(h||(h=d("I64"))).to_int32(a)}}:{}}function j(a){return a.isForwarded===!0?{forwardingParams:{forwardedThreadId:(h||(h=d("I64"))).to_string(a.threadKey)}}:{}}function k(a){if(a.replySourceId==null&&a.replySourceTimestampMs==null)return{};function b(){return a.replySourceId!=null?{repliedToMessageOtid:d("InstamadilloMessageIdUtils").fromInstamadilloMessageId(a.replySourceId).stanzaId}:{}}function c(){return a.replySourceTimestampMs!=null?{repliedToMessageWaServerTimeSec:(h||(h=d("I64"))).to_string(a.replySourceTimestampMs)}:{}}return{repliedToMessage:babelHelpers["extends"]({},b(),{},c())}}function a(a,b){b={content:{text:{text:b?void 0:a.text}},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),{},j(a),{},k(a))};return b}function b(a,b){b={content:{media:b},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),{},j(a),{},k(a))};return b}function c(a,b){b={content:{receiverFetchXma:JSON.parse(b)},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),{},j(a),{},k(a))};return b}g.createInstamadilloAddMessageTextPayload=a;g.createInstamadilloAddMessageMediaPayload=b;g.createInstamadilloAddMessageReceiverFetchXmaPayload=c}),98);
__d("createInstamadilloTransportPayload",[],(function(a,b,c,d,e,f){"use strict";function a(a){a={add:a};return a}function b(a){a={supplement:a};return a}function c(a){a={"delete":a};return a}function d(a){a={franking:a};return a}f.createInstamadilloAddMessageTransportPayload=a;f.createInstamadilloSupplementMessageTransportPayload=b;f.createInstamadilloDeleteMessageTransportPayload=c;f.createInstamadilloFrankingTransportPayload=d}),66);
__d("MWBUtil",[],(function(a,b,c,d,e,f){"use strict";a=30;b=["impersonation"];c=["ig_user_impersonation"];d=Array.of.apply(Array,b.concat(c));f.SPAM_REPORT_MESSAGE_COUNT=a;f.MSGR_IMPERSONATION_TAGS=b;f.IG_IMPERSONATION_TAGS=c;f.ALL_IMPERSONATION_TAGS=d}),66);
__d("MAWXMAManagementTxns",["FBLogger","MAWDexieTable","MAWMediaManagementTxns","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g){var i=b.unstoredDbXMA,j=b.unstoredFavicon,k=b.unstoredHeaderMedia,l=b.unstoredPreviews;f===void 0&&(f=!1);g===void 0&&(g="wa");var m=new Map(),n=function(b){return b!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b,c,g,!0).then(function(a){return[b.plaintextHash,a]}):d("MAWDexieTable").dexieResolve([void 0,void 0])};f||(m.set(j==null?void 0:j.plaintextHash,n(j)).set(k==null?void 0:k.plaintextHash,n(k)),l==null?void 0:l.forEach(function(a){m.set(a==null?void 0:a.plaintextHash,n(a))}));b=Array.from(m.values());return d("MAWDexieTable").dexieAll(b).then(function(b){var g=new Map(b),m=(l!=null?l:[]).map(function(a){return g.get(a.plaintextHash)}).filter(Boolean);return h(a,f?d("MAWXMAUtils").buildUnstoredTombstonedXMA(i):i,g.get(j==null?void 0:j.plaintextHash),g.get(k==null?void 0:k.plaintextHash),m,c,e).then(function(a){return{dbMedias:b.map(function(a){a[0];a=a[1];return a}).filter(Boolean),dbXMA:a,firstPreview:m[0]}})})}function h(a,b,d,e,f,g,h){b=babelHelpers["extends"]({},b,{associatedMessageId:h!=null?h:void 0,defaultPreviewMediaId:(b=f[0])==null?void 0:b.mediaId,defaultPreviewMediaPlaintextHash:(h=f[0])==null?void 0:h.plaintextHash,faviconMediaId:d==null?void 0:d.mediaId,faviconPlaintextHash:d==null?void 0:d.plaintextHash,headerMediaId:e==null?void 0:e.mediaId,headerMediaPlaintextHash:e==null?void 0:e.plaintextHash,msgId:g.msgId,previewMediaIds:f.map(function(a){return a.mediaId})});return a.xma.add(b).then(function(b){return a.xma.get(b)}).then(function(a){if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Failed to write XMA to db");return a})}function b(a,b,c,e,f,g,h,i,j,k,l,m,n){var o=d("MAWXMAUtils").isXMAExpired(!1,j.targetExpiringAtSec);j=babelHelpers["extends"]({},j,{associatedMessageId:h!=null?h:void 0,author:i.author,externalId:i.externalId,isTombstoned:o,msgId:g,offlineAttachmentId:k,targetType:f,threadJid:i.chat});var p=o?j:babelHelpers["extends"]({},j,{defaultPreviewMediaId:b!=null?b:void 0,defaultPreviewMediaPlaintextHash:l!=null?l:void 0,faviconMediaId:e!=null?e:void 0,faviconPlaintextHash:n!=null?n:void 0,headerMediaId:c!=null?c:void 0,headerMediaPlaintextHash:m!=null?m:void 0,previewMediaIds:b!=null?[b]:[]});return a.xma.add(p).then(function(a){return babelHelpers["extends"]({},p,{xmaId:a})})}g.handleUnstoredXMAContent=a;g.saveXMA=b}),98);
__d("MAWCommonScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("msgr-common",{concurrency:1,maxConcurrency:10,maxThrottleMs:5e3}));return h}g.mawCommonScheduler=a}),98);
__d("isUseridAnnotationEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("24163")}g["default"]=a}),98);
__d("MAWUserHash",["MAWCurrentUser","WAGlobals","WAJids","isUseridAnnotationEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("MAWCurrentUser").isEmployee()&&c("isUseridAnnotationEnabled")()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null}g.getUserHash=a}),98);
__d("MAWIncomingMsg",["MAWUserHash","MWFBLogger","WAGetPlatformFromStanzaId","WAHashStringToNumber","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWFBLogger").MWLogger.tags(["ServerRPC","HandleIncomingMsg"]);b=function(a){var b=a.encTypes,c=a.incomingType,e=a.msg,f=a.queueType,g=a.retryCount;a=a.taskSource;var h=e.details;e=e.decrypted;return{"int":{messageAge:d("WATimeUtils").unixTime()-h.ts,msgId:d("WAHashStringToNumber").hashStringToNumber(h.externalId.toString()),offlineDelivery:h.offline,retryCount:g,taskSource:a},string:{e2eePlatform:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(h.externalId),incomingType:c,jid:h.from.chat,msgDecryptedDataType:e.type,msgType:h.type,queueType:f,threadType:h.from.type,userHash:d("MAWUserHash").getUserHash()},string_array:{encTypes:b}}};g.logger=a;g.prepareAnnotationsForIncomingMessage=b}),98);
__d("MAWMessageReceiveReliabilityLogger",["WAHashStringToNumber","WAQPLProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(1056840931,"814"),i=c("qpl")._(521477947,"2395"),j=60*1e3;function a(a){return d("WAQPLProxy").waQPLProxyStart(a.incomingType==="wa"?h:i,{"int":{msgId:d("WAHashStringToNumber").hashStringToNumber(a.stanzaId)},string:{incomingType:a.incomingType,jid:a.jid,msgType:a.type}},d("WAHashStringToNumber").hashStringToNumber(a.stanzaId),j)}b=5*60*1e3;g.logRRStartForMessage=a;g.RECEIVE_RELIABILITY_TIMEOUT=b}),98);
__d("MAWChangeGroupMemberAddModeApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupMemberAddMode")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){var h=a.GroupInfoStore;a=a.MessagesStore;var i=(yield h.get(b));if(!i.success)return d("WAResultOrError").makeError("missing_group");yield h.update(b,function(a){return babelHelpers["extends"]({},a,{memberAddMode:e})});if(g==="create_admin_message"){i=d("MAWAdminMsgHelpers").createMemberAddModeChangeAdminMsg(b,e,c,f);i!=null&&(yield a.create(i))}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g){return a.apply(this,arguments)}}();g.changeGroupMemberAddMode=a;g.changeGroupMemberAddModeTransactor=h}),98);
__d("MAWAdminAddParticipantMsg",["MAWLocalizationType","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e){switch(a){case 1:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER}}function l(a,b){switch(a){case 1:return{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU};case 2:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER}}return{adminMsgContent:[(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER}}function m(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER}}return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER}}function n(a,b){var c=d("MAWUserJidWrapper").getMyUserJid(),e=b[0],f=b[1],g=d("WAJids").userIdFromJid(e);f=f!=null?d("WAJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?l(b.length,e===c?f:g):m(b.length,g,f);if(a===c)return j(b.length,g,f);a=d("WAJids").userIdFromJid(a);return b.includes(c)?i(b.length,a,e===c?f:g):k(b.length,a,g,f)}function a(a,b){return babelHelpers["extends"]({},n(a,b),{version:h})}g.createAddParticipantsAdminMessage=a}),98);
__d("MAWAdminRemoveParticipantMsg",["MAWAdminMsgType","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c,e){switch(a){case 1:return e?{adminMsgContent:[],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_LEFT_GROUP}:{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e,f){switch(a){case 1:return f?{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_LEFT_GROUP}:{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER}}function l(a,b){var c=d("MAWUserJidWrapper").getMyUserJid(),e=b[0],f=b[1],g=d("WAJids").userIdFromJid(e);f=f!=null?d("WAJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?{adminMsgContent:[],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_REMOVED_YOU}:{adminMsgContent:[g],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_REMOVED_ONE_USER};if(a===c)return j(b.length,g,f,e===c);var h=d("WAJids").userIdFromJid(a);return b.includes(c)?i(b.length,h,e===c?f:g):k(b.length,h,g,f,e===a)}function a(a,b){return babelHelpers["extends"]({},l(a,b),{version:h})}g.createRemoveParticipantsAdminMessage=a}),98);
__d("MAWAdminWriteChangeParticipantsAdminMsgTxn",["FBLogger","MAWAdminAddParticipantMsg","MAWAdminRemoveParticipantMsg","MAWDbThreadTxns","MAWLocalizationUtils","MAWUserJidWrapper","MAWWriteMsgTxns","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b,d("MAWAdminAddParticipantMsg").createAddParticipantsAdminMessage)}function b(a,b){return h(a,b,d("MAWAdminRemoveParticipantMsg").createRemoveParticipantsAdminMessage)}function h(a,b,e){var f=b.admin,g=b.chatJid,h=b.participants,i=b.serverTs;if(h.length===0)throw c("FBLogger")("messenger_web").mustfixThrow("invalid number of participants when writing participants change admin msg");return d("MAWDbThreadTxns").getThread(a,g).then(function(g){if(!g.success)throw c("FBLogger")("messenger_web").mustfixThrow("no thread when writing participants change admin msg");g=g.value;var j=d("MAWUserJidWrapper").getMyUserJid();j=f==="@me"?j:f;if(j==null)return;j=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(e(j,h),g.jid,b.externalId,i);return d("MAWWriteMsgTxns").writeMsg(a,j,g).then(c("emptyFunction"))})}g.writeAddParticipantAdminMsg=a;g.writeRemoveParticipantAdminMsg=b}),98);
__d("MAWAdminWriteGroupNameChangeTxn",["MAWAdminMsgType","MAWDexieTable","MAWExternalId","MAWLocalizationUtils","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=b.name;if(f==null)return d("MAWDexieTable").dexieResolve();var g=d("MAWUserJidWrapper").getMyUserJid(),h=[];b.nameOwner===g?(g=d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_NAMED_GROUP,h.push(f)):b.nameOwner==null?(g=d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_NAMED_GROUP,h.push(f)):(g=d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_NAMED_GROUP,h.push(d("WAJids").userIdFromJid(b.nameOwner),f));b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:h,adminType:g,version:1},e.jid,d("MAWExternalId").generateExternalId(),d("WATimeUtils").castMillisTimeToUnixTime(d("WATimeUtils").millisTime()));return d("MAWWriteMsgTxns").writeMsg(a,b,e).then(c("emptyFunction"))}g.writeGroupNameChangeInfo=a}),98);
__d("MAWParticipantManagementTxns",["MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWUserJidWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(e){if(c.length===0&&e.length===0)return{addedJids:[],participants:e,removedJids:[],typeUpdateJids:[]};var f=new Map();e.forEach(function(a){f.set(a.userJid,a)});var g=new Set(c.map(function(a){return a.userJid})),h=[],i=[],j=[],k=[];f.forEach(function(a,b){g.has(b)||(a.type!=="invitedParticipant"?h.push(b):(k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},a))))});c.forEach(function(a){var b=f.get(a.userJid);b==null?(i.push(a),a.type==="admin"&&k.push({type:a.type,userJid:a.userJid})):(b.type!==a.type&&k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},b,{},a)))});var l=h.indexOf(d("MAWUserJidWrapper").getMyUserJid())>=0;e=function(){return[d("MAWDbParticipantTxns").bulkAddParticipants(a,b,i),d("MAWDbParticipantTxns").bulkUpdateParticipants(a,j),d("MAWDbParticipantTxns").bulkDeleteParticipantsInThread(a,b,h),l?d("MAWDbThreadTxns").archiveThreads(a,[b],!0):d("MAWDexieTable").dexieResolve()]};return d("MAWDexieTable").dexieAll(e()).then(function(a){var b=a[0];a=a[1];return{addedJids:i.map(function(a){return a.userJid}),participants:[].concat(b,a),removedJids:h,typeUpdateJids:k}})})}g.syncParticipantList=a}),98);
__d("MAWGroupManagementTxns",["MAWAdminWriteChangeParticipantsAdminMsgTxn","MAWAdminWriteGroupNameChangeTxn","MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWExternalId","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWParticipantManagementTxns","MAWThreadManagementTxns","MAWUserJidWrapper","WATimeUtils","isGroupInvitesEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDexieTable").dexieAll([d("MAWThreadManagementTxns").deleteAllThreadData(a,c),d("MAWDbGroupInfoTxns").deleteGroupInfo(a,b)]).then(function(a){a=a[0];return a}).then(function(a){return a})}b=function(a,b){var e=b.authoritativeThreadKey,f=b.deduplicationKey,g=b.extras,h=b.folder,i=b.groupStatus,j=b.groupToCreate,k=b.serverTs;b=i==="added"?d("WATimeUtils").unixTime():j.creationTs;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:e,clientThreadKey:g==null?void 0:g.clientThreadKey,createTs:d("WATimeUtils").castUnixTimeToMillisTime(b),deduplicationKey:f,description:"createGroup",folder:h==null?d("MAWFolderTypes").FOLDER_ID.INBOX:h,jid:j.jid}).then(function(b){var e=b.created,f=b.thread;b=j.participants.map(function(a){return a.error?c("isGroupInvitesEnabled")()&&a.error.errorCode===403?{addressable:!0,type:"invitedParticipant",userJid:a.error.user}:null:{addressable:a.value.addressable,type:a.value.type,userJid:a.value.user}}).filter(Boolean);var g=e?d("MAWDbParticipantTxns").bulkAddParticipants:d("MAWParticipantManagementTxns").syncParticipantList;g=g(a,f.jid,b);b=d("MAWUserJidWrapper").getMyUserJid();b=i==="added"&&!e&&j.creator!==b?d("MAWAdminWriteChangeParticipantsAdminMsgTxn").writeAddParticipantAdminMsg(a,{admin:j.inviter,chatJid:f.jid,externalId:d("MAWExternalId").generateExternalId(),participants:[b],serverTs:k}):d("MAWDexieTable").dexieResolve();j.description;j.participants;var h=babelHelpers.objectWithoutPropertiesLoose(j,["description","participants"]);return d("MAWDexieTable").dexieAll([g,d("MAWDbGroupInfoTxns").putGroupInfo(a,h),b]).then(function(b){b[0];b=b[1];return e&&i==="added"?d("MAWAdminWriteGroupNameChangeTxn").writeGroupNameChangeInfo(a,b,f):d("MAWDexieTable").dexieResolve()}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(a,[f.jid]):d("MAWDbThreadTxns").subscribeToThreads(a,[f.jid])}).then(function(a){return f.jid})})};g.deleteGroup=a;g.createGroupInternal=b}),98);
__d("MAWThreadTypes",["MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b={chunk:(a=d("MAWTransactionMode")).READWRITE,deletedMessages:a.READWRITE,editMsgHistory:a.READWRITE,groupInfo:a.READWRITE,groupInvites:a.READWRITE,media:a.READWRITE,messages:a.READWRITE,participants:a.READWRITE,pendingStanzas:a.READWRITE,reactions:a.READWRITE,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READWRITE};g.ThreadRelatedTablesPermissions=b}),98);
__d("MAWDeleteGroupsApi",["MAWDbThreadTxns","MAWDexieTable","MAWGroupManagementTxns","MAWIndexedDb","MAWThreadTypes","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor(d("MAWThreadTypes").ThreadRelatedTablesPermissions,"deleteGroups",function(a){return function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.group;return d("MAWDbThreadTxns").getThread(a,c).then(function(b){return!b.success?d("WAResultOrError").makeError("missing_thread"):d("MAWGroupManagementTxns").deleteGroup(a,c,b.value).then(function(a){return d("WAResultOrError").makeResult({deletedGroupId:c,deletedMsgIds:a.deletedMessages})})})})).then(function(a){return a})}});g.deleteGroupsFromMAW=a}),98);
__d("WADeleteGroupFollowUpLowLevelApi",["MAWDexieTable","MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE},"deleteGroupFollowUpLowLevel",function(a){return function(b,c){return d("MAWDexieTable").dexieAll([d("WADbPersonalSenderKeyStatusTxns").bulkDeletePersonalSenderKeyStatus(a,[b]),h(a,c)]).then(function(){})}});function h(a,b){return a.receipts.where("waMsgId").anyOf(b)["delete"]().then(function(){})}g.deleteGroupFollowUpLowLevel=a}),98);
__d("WADeleteGroupFollowUpLowLevelApiV2",["Promise","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){return d("WASignalDB").getDb().runInTransaction(["senderKeySessions","personalSenderKeyStatuses"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){yield (h||(h=b("Promise"))).all([c.stores.senderKeySessions.readIndex("groupJid",[a]).then(function(a){return c.stores.senderKeySessions.bulkDelete(a.map(function(a){return a.id}))}),c.stores.personalSenderKeyStatuses["delete"](a)])});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("deleteGroupFollowUpLowLevel"))};g.deleteGroupFollowUpLowLevel=a}),98);
__d("MAWDeleteGroup",["MAWDeleteGroupsApi","Promise","WADeleteGroupFollowUpLowLevelApi","WADeleteGroupFollowUpLowLevelApiV2","WALogger","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteGroups failed to delete group to a non-existent thread"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e=(yield d("MAWDeleteGroupsApi").deleteGroupsFromMAW(e.map(function(b){return{deleter:a,group:b}})));return(h||(h=b("Promise"))).all(e.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a.success)d("WALogger").ERROR(i());else{a=a.value;var c=a.deletedGroupId;a=a.deletedMsgIds;yield (h||(h=b("Promise"))).all([d("WADeleteGroupFollowUpLowLevelApi").deleteGroupFollowUpLowLevel(c,a),d("WADeleteGroupFollowUpLowLevelApiV2").deleteGroupFollowUpLowLevel(c,a)])}});return function(b){return a.apply(this,arguments)}}())).then(c("emptyFunction"))});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWUpdateGroupSubjectApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAJids","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"updateGroupSubject")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.GroupInfoStore;a=a.MessagesStore;var f=(yield e.get(b));if(!f.success)return d("WAResultOrError").makeError("missing_group");f=f.value;if(f.subject.ts!=null&&(c.ts==null||f.subject.ts>c.ts))return d("WAResultOrError").makeResult();yield e.update(b,function(a){return babelHelpers["extends"]({},a,{subject:c})});e=(yield e.get(f.jid));if(!e.success)return d("WAResultOrError").makeError("missing_group");f=e.value;e=f.subject.user;f=d("MAWAdminMsgHelpers").createGroupNameChangeAdminMsg(b,f,e!=null?d("WAJids").userIdFromJid(e):void 0,(b=c.ts)!=null?b:d("WATimeUtils").unixTime());f!=null&&(yield a.create(f));return d("WAResultOrError").makeResult()});return function(b,c,d){return a.apply(this,arguments)}}();g.updateGroupSubject=a;g.updateGroupSubjectTransactor=h}),98);
__d("MAWHandleGroupNotifications",["FBLogger","MAWAddGroupParticipantsApi","MAWChangeGroupMemberAddModeApi","MAWChangeGroupParticipantAdminStatusApi","MAWDeleteGroup","MAWRemoveGroupInvitesApi","MAWRemoveGroupParticipantsApi","MAWUpdateGroupSubjectApi","Promise","WAAPI","WACreateGroup","WAGlobals","WAResultOrError","asyncToGeneratorRuntime","emptyFunction","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a=a.notification;switch(a.type){case"join":return i(a).then(function(){return d("WAResultOrError").makeResult()});case"add":return k(a);case"remove":return l(a);case"promote":return n(a);case"demote":return m(a);case"delete":var e=a.groupJid,f=a.participant;if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group delete notification without deleter JID: "+e);return c("MAWDeleteGroup")(f,[e]).then(function(){return d("WAResultOrError").makeResult()});case"subject":return o(a).then(function(){return d("WAResultOrError").makeResult()});case"memberAddMode":return p(a);default:a.type;return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.isE2EEMigration)return;var b=a.group,e=a.isNew,f=a.key,g=a.serverTs;yield d("WACreateGroup").createGroups([{extras:f!=null?{deduplicationKey:f,platform:"msgr"}:null,folder:null,groupStatus:e?"new":"added",groupToCreate:b,key:f,serverTs:g}]);e=a.group.participants.map(function(a){if(a.success)return a.value.user;else return a.error.user});var h=d("WAGlobals").getMyUserJid();f=c("justknobx")._("1162");f&&e.find(function(a){return a===h})&&(yield d("MAWRemoveGroupInvitesApi").removeGroupInvites(b.jid,h));yield c("WAAPI").getDevices({ignoreDhash:!1,reason:"added-to-group",users:new Set(e)})});return j.apply(this,arguments)}function k(a){var b=a.groupJid,e=a.participant,f=a.participants,g=a.previousVersionId,h=a.reason,i=a.serverTs;a=a.versionId;if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group add participant notification without adder JID: "+b);return d("MAWAddGroupParticipantsApi").addGroupParticipants({current:a,previous:g},b,e,f,!1,h,i)}function l(a){var b=a.groupJid,e=a.participant,f=a.participants,g=a.previousVersionId,h=a.serverTs;a=a.versionId;if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group remove participant notification without remover JID: "+b);var i=null;a!=null&&(i={current:a,previous:g});return d("MAWRemoveGroupParticipantsApi").removeGroupParticipants(i,b,e,f,!1,h)}function m(a){var b=a.groupJid,c=a.participant,e=a.participants,f=a.previousVersionId,g=a.serverTs;a=a.versionId;return d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:a,previous:f},b,c,e,"participant",g)}function n(a){var b=a.groupJid,c=a.participant,e=a.participants,f=a.previousVersionId,g=a.serverTs;a=a.versionId;return d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:a,previous:f},b,c,e,"admin",g)}function o(a){var b=a.groupJid,e=a.participant,f=a.subject;a=a.ts;return d("MAWUpdateGroupSubjectApi").updateGroupSubject(b,{content:f,ts:a,user:e}).then(c("emptyFunction"))}function p(a){var b=a.groupJid,c=a.memberAddMode,e=a.participant;a=a.serverTs;return d("MAWChangeGroupMemberAddModeApi").changeGroupMemberAddMode(b,e,c,a,"create_admin_message")}g.persistGroupNotification=a}),98);
__d("WAParticipant",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"admin":case"superadmin":return!0;default:return!1}}f.isGroupAdminParticipantType=a}),66);
__d("WASyncParticipantsApi",["WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=a.ParticipantsStore;var e=(yield a.bulkGetInGroup(b));if(e.success!==!0)return d("WAResultOrError").makeError("missing_participants");if(c.length===0&&e.value.length===0)return d("WAResultOrError").makeResult({removedJids:[],addedJids:[],typeUpdateJids:[]});var f=new Map();e.value.forEach(function(a){f.set(a.user,a)});var g=new Set(c.map(function(a){return a.user})),h=[],i=[],j=[],k=[];f.forEach(function(a,c){g.has(c)||(a.type!=="invitedParticipant"?h.push({userJid:c,groupJid:b}):(k.push({previousType:a.type,newType:a.type,userJid:a.user}),j.push(babelHelpers["extends"]({},a))))});c.forEach(function(a){var b=f.get(a.user);b==null?(i.push(a),a.type==="admin"&&k.push({previousType:"nonparticipant",newType:a.type,userJid:a.user})):(b.type!==a.type&&k.push({previousType:b.type,newType:a.type,userJid:a.user}),j.push(babelHelpers["extends"]({},b,{},a)))});yield a.bulkPut(i);yield a.bulkPut(j);yield a.bulkDelete(h);return d("WAResultOrError").makeResult({removedJids:h.map(function(a){a=a.userJid;return a}),addedJids:i.map(function(a){return a.user}),typeUpdateJids:k})});return function(b,c,d){return a.apply(this,arguments)}}();g.syncParticipantsTransactor=a}),98);
__d("MAWResetGroupParticipantInfoApi",["MAWAdminMsgHelpers","MAWRunInTransaction","Promise","WAAPI","WALogger","WAParticipant","WAResultOrError","WASyncParticipantsApi","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received an error when sync-ing participants"]);i=function(){return a};return a}a=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return j.apply(void 0,[a].concat(e))},"resetGroupParticipantInfo").then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.success&&(yield c("WAAPI").setRotateSenderKeyToTrue([e[0]]));return a});return function(b){return a.apply(this,arguments)}}())};var j=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;e=e.map(function(a){return{addressable:a.addressable,chatJid:c,type:a.type,user:a.user}});a=(yield d("WASyncParticipantsApi").syncParticipantsTransactor({ParticipantsStore:a},c,e));if(f!=null){e=(yield g.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:f})}));if(!e.success)return e}if(a.success!==!0){d("WALogger").ERROR(i());return a}g=a.value;e=[];if(g.removedJids.length>0){a=d("MAWAdminMsgHelpers").createParticipantRemoveAdminMsg(c,g.removedJids,null,d("WATimeUtils").unixTime());e.push(j.create(a))}if(g.addedJids.length>0){a=d("MAWAdminMsgHelpers").createParticipantAddAdminMessage(c,g.addedJids,null,d("WATimeUtils").unixTime());e.push(j.create(a))}if(g.typeUpdateJids.length>0)for(a=0;a<g.typeUpdateJids.length;a++){var k=g.typeUpdateJids[a].previousType,l=g.typeUpdateJids[a].newType;k=d("WAParticipant").isGroupAdminParticipantType(k);l=d("WAParticipant").isGroupAdminParticipantType(l);var m=!k&&l;k=k&&!l;if(m){l=d("MAWAdminMsgHelpers").createParticipantPromoteAdminMsg(c,g.typeUpdateJids[a].userJid,null,d("WATimeUtils").unixTime());e.push(j.create(l))}else if(k){m=d("MAWAdminMsgHelpers").createParticipantDemoteAdminMsg(c,g.typeUpdateJids[a].userJid,null,d("WATimeUtils").unixTime());e.push(j.create(m))}}return(h||(h=b("Promise"))).all(e).then(function(){return d("WAResultOrError").makeResult()})});return function(b,c,d,e){return a.apply(this,arguments)}}();g.resetGroupParticipantInfo=a;g.resetGroupParticipantInfoTransactor=j}),98);
__d("MAWProtocolQueueGroupNotification",["FBLogger","MAWHandleGroupNotifications","MAWResetGroupParticipantInfoApi","Promise","WAAPI","WACreateGroup","WALogger","WAQueryGroup","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create group infos"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to recover missing group info"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[doGroupRecovery] Cannot get a group, as per ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get group info"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received a participant with an error"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ParticipantRecovery] Cannot get a group, as per ",""]);p=function(){return a};return a}function a(a){var b=a.notification;return d("MAWHandleGroupNotifications").persistGroupNotification(a).then(function(a){return a.success?a:d("WAResultOrError").makeResult({errorResult:a,groupNotification:b})})}function e(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[];yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var b=(yield d("WAQueryGroup").queryGroup(a,"participant_change_recovery"));if(b.success===!1){var f;d("WALogger").ERROR(p(),b.error);throw c("FBLogger")("messenger_web").mustfixThrow("[ParticipantRecovery] Cannot get a group, as per "+JSON.stringify((f=b.error)!=null?f:null))}f=b.value;b=f.participants.map(function(a){if(a.error){d("WALogger").ERROR(o());return null}return a.value}).filter(Boolean);b=(yield d("MAWResetGroupParticipantInfoApi").resetGroupParticipantInfo(a,b,f.participantVersion));f=b.error;!b.success&&f==="missing_group"&&e.push(a)}catch(a){d("WALogger").DEV(n()).devConsole(a)}});return function(b){return a.apply(this,arguments)}}()));try{c("WAAPI").queryGroups({groups:e,type:"array"})["catch"](function(a){d("WALogger").DEV(m()).devConsole(a)})}catch(a){d("WALogger").DEV(l()).devConsole(a)}});return q.apply(this,arguments)}function f(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[];yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield d("WAQueryGroup").queryGroup(a,"interactive"));if(a.success===!1){var b;d("WALogger").ERROR(k(),a.error);throw c("FBLogger")("messenger_web").mustfixThrow("[doGroupRecovery] Cannot get a group, as per "+JSON.stringify((b=a.error)!=null?b:null))}e.push(a.value)}catch(a){d("WALogger").DEV(j()).devConsole(a)}});return function(b){return a.apply(this,arguments)}}()));try{yield d("WACreateGroup").createGroups(e.map(function(a){return{extras:null,folder:null,groupStatus:"queried",groupToCreate:a,key:null,serverTs:d("WATimeUtils").unixTime()}}))}catch(a){d("WALogger").DEV(i()).devConsole(a)}});return r.apply(this,arguments)}g.handleProtocolQueueGroupNotification=a;g.doParticipantRecovery=e;g.doGroupRecovery=f}),98);
__d("MAWAdminWriteUsersConnectedMsgTxn",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWExternalId","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWUserJidWrapper","MAWWriteMsgTxns","MessengerMSplitFlag","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg found a thread without messages from both users, which we'll not append to."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg failed to create or get 1:1 thread"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg is called for self thread"]);j=function(){return a};return a}function a(a,b,e,f){var g=d("MAWUserJidWrapper").getMyUserJid();if(b===g){d("WALogger").WARN(j());return d("MAWDexieTable").dexieResolve()}return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success){d("WALogger").WARN(i());return}var j=b.value;b=d("MAWDbMsgTxns").doesThreadHaveMsgsMatchCriteria(a,j.jid,function(a){return a.type===d("MAWMsgType").MSG_TYPE.ADMIN?!1:a.author===g||a.author===d("WAJids").AUTHOR_ME});var k=d("MAWDbMsgTxns").doesThreadHaveMsgsMatchCriteria(a,j.jid,function(a){return a.type===d("MAWMsgType").MSG_TYPE.ADMIN?!1:a.author!==g&&a.author!==d("WAJids").AUTHOR_ME});return d("MAWDexieTable").dexieAll([b,k]).then(function(b){var g=b[0];b=b[1];if(!g||!b){d("WALogger").WARN(h());return}g=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:c("MessengerMSplitFlag").is_msplit_account||e?d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED_ONE_MSPLIT:d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED,version:1},j.jid,d("MAWExternalId").generateExternalId(),f);return d("MAWWriteMsgTxns").writeDedupedUsersConnectedAdminMessage(a,g,j).then(function(){var a=d("WAJids").interpretAsUserJid(j.jid);if(a==null)return;d("MAWIndexedDb").afterTransaction({tag:"UpdateContactAsConnected",value:{contactUserId:d("WAJids").extractUserId(a),threadJid:j.jid}})})})})}g.writeUsersConnectedAdminMsg=a}),98);
__d("MAWHandleConnectedAdminMsgApi",["MAWAdminWriteUsersConnectedMsgTxn","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleConnectedAdminMsg: chat ",""]);h=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({ftsBackloggedMessages:(a=d("MAWTransactionMode")).READWRITE,groupInfo:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"handleConnectedAdminMsg",function(a){return function(b){var c=b.chatJid,e=b.isOtherContactMsplit;b=b.notificationTs;d("WALogger").LOG(h(),c);return d("MAWAdminWriteUsersConnectedMsgTxn").writeUsersConnectedAdminMsg(a,c,e,b)}});g.handleConnectedAdminMsg=b}),98);
__d("MAWUpdateThreadFolderApi",["MAWBridgeTypesCreators","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread "," folder with folder id ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread ",""]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE},"updateThreadFolder",function(a){return function(b,c){d("WALogger").LOG(i(),b);return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;return d("MAWDbThreadTxns").updateThread(a,babelHelpers["extends"]({},b.value,{folder:c})).then(function(a){d("WALogger").LOG(h(),b.value.jid,c);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({folder:c,threadJid:b.value.jid})});return})})}});g.updateThreadFolder=a}),98);
__d("MAWProtocolQueueNotification",["MAWBridge","MAWFolderTypes","MAWHandleConnectedAdminMsgApi","MAWODSProxy","MAWProtocolQueueGroupNotification","MAWUpdateThreadFolderApi","MWFBLogger","Promise","WAJids","WAOdsEnums","WAResultOrError","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") unknown thread action, jid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") connected, jid: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") with folder id ",", jid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unsupported notification type: ",""]);l=function(){return a};return a}var m=d("MWFBLogger").MWLogger.tags(["ProtocolQueue"]);function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.stanzaId;a=a.notification;var f=a.actions,g=a.chatJid,l=a.ts,n=d("WAJids").interpretAsUserJid(g),o=(yield d("MAWBridge").getBridge().sendAndReceive("event","getLSDBUsersIsMsplit",{users:[n].filter(Boolean)}));return(h||(h=b("Promise"))).all(f.map(function(a){switch(a.type){case"folder":var c;c=(c=a.folderId)!=null?c:d("MAWFolderTypes").FOLDER_ID.INBOX;m.DEBUG(k(),e,c,g);return d("MAWUpdateThreadFolderApi").updateThreadFolder(g,c);case"connected":m.DEBUG(j(),e,g);c=n!=null&&o.get(n)===!0;return d("MAWHandleConnectedAdminMsgApi").handleConnectedAdminMsg({chatJid:g,isOtherContactMsplit:c,notificationTs:l});default:a.type;m.MUSTFIX(i(),e,g);return(h||(h=b("Promise"))).reject("Handle thread notification: unknown thread action")}})).then(c("emptyFunction"))});return o.apply(this,arguments)}function a(a){return(h||(h=b("Promise"))).all(a.map(function(a){a=a.notification;a=p(a);return a})).then(function(b){var c={groupRecoveries:[],participantRecoveries:[]},d=[];b.map(function(b,e){if(b.success===!0){d.push(a[e].stanzaQueueId);if(b.value!=null){e=b.value;e.type==="group"&&c.groupRecoveries.push(e.data.groupNotification.groupJid)}}});return{followUpParams:c,toAck:d}})}function p(a){switch(a.type){case"group":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WA_PROTOCOL_QUEUE_NOTIFICATION,key:a.type+"."+a.notification.type});return d("MAWProtocolQueueGroupNotification").handleProtocolQueueGroupNotification(a).then(function(a){return a.value?d("WAResultOrError").makeResult({data:a.value,type:"group"}):d("WAResultOrError").makeResult()});case"thread":a.notification.actions.forEach(function(b){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WA_PROTOCOL_QUEUE_NOTIFICATION,key:a.type+"."+b.type})});return n(a).then(function(){return d("WAResultOrError").makeResult()});default:a;m.MUSTFIX(l(),a.type);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}g.handleIncomingNotificationStanzas=a}),98);
__d("MAWCOPNotificationsHandler",["MAWCommonScheduler","MAWIsQuotaExceededError","MAWProtocolQueueGroupNotification","MAWProtocolQueueNotification","MAWSharedCOPLogger","WorkerScheduler","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing notifications batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Notification consumer error"]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").catching(a).MUSTFIX(i());return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var e=(yield d("MAWProtocolQueueNotification").handleIncomingNotificationStanzas(a));e.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());a=e.followUpParams;var f=a.groupRecoveries,g=a.participantRecoveries;g.length>0&&c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){return d("MAWProtocolQueueGroupNotification").doParticipantRecovery(g)},name:"ParticipantsRecovery",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));f.length>0&&c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWProtocolQueueGroupNotification").doGroupRecovery(f)});function c(){return a.apply(this,arguments)}return c}(),name:"GroupsRecovery",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));return e.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("WADbHandlePermitedIdentitiesApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"handlePermitedIdentitiesPerDevice",function(a){return function(b){var c=Array.from(b.keys());return a.receipts.where("waMsgId").anyOf(c).toArray().then(function(a){return a.map(function(a){var c;c=(c=b.get(a.waMsgId))!=null?c:new Set();for(c of c){var d;(d=a.permittedIdentitiesPerDevice)==null?void 0:d["delete"](c)}return a})}).then(function(b){return a.receipts.bulkPut(b).then(function(){})})}});g.handlePermitedIdentitiesPerDevice=a}),98);
__d("WAPreKeysStanzaUtils",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;return(b=d("WAWap")).wap("key",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.id,3)),b.wap("value",null,a.keyPair.publicKey))}function b(a){var b;return(b=d("WAWap")).wap("skey",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.id,3)),b.wap("value",null,a.keyPair.publicKey),b.wap("signature",null,a.signature))}function c(a){var b=a.child("skey"),c=null;if(a.hasChild("key")){var d=a.child("key");c={id:d.child("id").contentUint(3),publicKey:d.child("value").contentSerializedPubKey()}}return{identity:a.child("identity").contentSerializedPubKey(),signedKey:{id:b.child("id").contentUint(3),publicKey:b.child("value").contentSerializedPubKey(),signature:b.child("signature").contentBytes(64)},oneTimeKey:c}}g.xmppPreKey=a;g.xmppSignedPreKey=b;g.readSessionInfo=c}),98);
__d("WAReceiptUtils",["WACryptoManagerUtils","WADeprecatedSendIq","WAMapWithDefault","WAMsg","WAPreKeysStanzaUtils","WARequestPreKeyDigest","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.retryCount;c=c+1;c>=3&&(yield d("WARequestPreKeyDigest").requestPreKeyDigestFn(function(a){return a(b)}));var e=null;c>=2&&(e=(yield d("WACryptoManagerUtils").getSignalInfoForRetry(b.cryptoManager)));var f=b.cryptoManager.regInfo.regId;return k(a,c,f,e)});return i.apply(this,arguments)}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.externalId,e=a.from,f=a.participant,g;e.type==="group"?g=e.groupJid:(e.type,g=e.deviceJid);yield d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(yield h(a,b),{id:c,"class":"receipt",from:g,participant:f})});return j.apply(this,arguments)}function k(a,b,c,e){var f=null;if(e!=null){var g=e.keyType,h=e.signedPreKey,i=e.preKey;e=e.publicKey;var j=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null;f=d("WAWap").wap("keys",null,d("WAWap").wap("type",null,d("WAWap").BIG_ENDIAN_CONTENT(g,1)),d("WAWap").wap("identity",null,e),d("WAPreKeysStanzaUtils").xmppPreKey(i),d("WAPreKeysStanzaUtils").xmppSignedPreKey(h),j)}a.from.type==="group"?g=a.from.groupJid:(a.from.type,g=a.from.deviceJid);return d("WAWap").wap("receipt",{category:a.category!=null?d("WAWap").CUSTOM_STRING(a.category):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(a.externalId),participant:a.participant?d("WAWap").DEVICE_JID(a.participant):d("WAWap").DROP_ATTR,recipient:a.recipient?d("WAWap").USER_JID(a.recipient):d("WAWap").DROP_ATTR,to:d("WAWap").JID(g),type:"retry"},d("WAWap").wap("retry",{count:d("WAWap").INT(b),id:d("WAWap").CUSTOM_STRING(a.externalId),t:d("WAWap").INT(a.ts),v:"1"}),d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(c)),f)}function c(a){var b=new(d("WAMapWithDefault").MapWithDefault)(function(a){return new Set()});for(a of a){var c=a.receipt;if(c.receiptType==="group"||c.receiptType==="user")for(var e of c.externalIds)b.get(d("WAMsg").craftWAMsgIdString({author:c.messageAuthor,chat:c.chat,externalId:e})).add(c.from.author);else if(c.receiptType==="group-server-agg")for(e of c.receivers)b.get(d("WAMsg").craftWAMsgIdString({author:c.messageAuthor,chat:c.chat,externalId:c.externalId})).add(e.device)}return b.toMap()}g.makeRetryReceipt=h;g.sendRetryReceipt=a;g.calculateIdentitiesToDelete=c}),98);
__d("MAWBulkGetAppDataForRetryApi",["MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=30*d("WATimeUtils").DAY_SECONDS;a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READONLY},"bulkGetAppDataForRetry",function(a){return function(b){var c=b.map(function(a){a=a.externalId;return a});return a.appData.where("externalId").anyOf(c).toArray().then(function(a){var c=new Map(a.map(function(a){return[a.externalId,a]}));return b.map(function(a){var b=a.deviceJid;a=a.externalId;a=c.get(a);if(a==null)return{type:"missing"};b=a.permittedIdentitiesPerDevice.get(b);return b==null||!d("WATimeUtils").happenedWithin(a.ts,h)?{type:"unauthorized"}:{appData:a.contents,deviceIdentity:b,permittedIdentitiesPerDevice:a.permittedIdentitiesPerDevice,type:"unacked"}})})}});g.bulkGetAppDataForRetry=a}),98);
__d("MAWConstants",[],(function(a,b,c,d,e,f){"use strict";a=5;b="Facebook user";c="Instagram user";d=3;f.MESSAGE_RETRY_COUNT_LIMIT=a;f.FB_UNKNOWN_USER=b;f.INS_UNKNOWN_USER=c;f.CURRENT_REGISTRATION_VERSION=d}),66);
__d("MAWWriteAppDataRetryApi",["MAWIndexedDb","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"writeAppDataRetry",function(a){return function(b,d,e){return a.appData.get({externalId:b}).then(function(b){if(b==null)return;var f=b.permittedIdentitiesPerDevice,g=f.get(d);if(g==null)return;g.baseKey=e;f.set(d,g);return a.appData.update(b.appDataId,{permittedIdentitiesPerDevice:f}).then(c("emptyFunction"))})}});g.writeAppDataRetry=a}),98);
__d("WAMarkParticipantNeedsKeyApi",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"markParticipantNeedsKey",function(a){return function(b,c){return d("WADbPersonalSenderKeyStatusTxns").removeDevicesToMultiplePersonalSenderKeyStatuses(a,[b],[c]).then(function(){})}});g.markParticipantNeedsKey=a}),98);
__d("WAMarkParticipantNeedsKeyApiV2",["WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c){return d("WASignalDB").getDb().runInTransaction(["personalSenderKeyStatuses"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.stores.personalSenderKeyStatuses.get(a));if(d==null||d.rotateSenderKey)return;d.hasSenderKey["delete"](c);yield b.stores.personalSenderKeyStatuses.bulkPut([d])});return function(a){return d.apply(this,arguments)}}(),d("WASignalDB").signalOp("markParticipantNeedsKey"))};g.markParticipantNeedsKey=a}),98);
__d("WASendAppDataIndividualProtocol",["WAAsMessageApplication","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendAppData Failed to encrypt appdata"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata retry to device with error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to device with error: ",""]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["sendAppDataIndividual"]);function a(a,b,c,e,f){return o(a,b,c,void 0,e,f)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);n.ERROR(m(),a);return d("WAResultOrError").makeError("runtime-error")})}function c(a,b,c,e,f,g){return o(a,b,c,e,f,g)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);n.ERROR(l(),a);return d("WAResultOrError").makeError("runtime-error")})}function o(a,b,c,d,e,f){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){n.LOG(k(),b);a=d("WAConvertAppData").convertAppData(a);var l={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArrayView()),version:"v3"};a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WAEncUserMsg").encryptDeviceJidMessage(c,{messageBytes:l,type:"appdata"},{cryptoManager:a},void 0,g,f)},{operationType:"encrypt",flush:!0}));if(a==null){n.LOG(j());return d("WAResultOrError").makeError("encrypt-failure")}var m;e!=null&&(m={appdataT:d("WATimeUtils").unixTime(),encRetryMixinArgs:{encCount:e}});e={appdataTo:c,encVersionFutureproofMixinArgs:{encV:parseInt(a.v,10)},encTypeIndividualMixinArgs:{encType:a.type,encElementValue:a.ciphertext},retryMixinArgs:m};e={peerPeerSingle:e};var o=void 0;if(a.type==="pkmsg"){var p=(yield d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());p=p==null?void 0:p.identityKey;if(p==null){n.ERROR(i());return d("WAResultOrError").makeError("no-public-identity")}o={deviceIdentityElementValue:p}}p={appdataId:b,peerMsgTypesArgs:e,deviceIdentityMixinArgs:o};b=(yield d("WASmaxAppdataPublishPeerRPC").sendPeerRPC(p));switch(b.name){case"PeerResponseSuccess":return d("WAResultOrError").makeResult({baseKey:a.baseKey});default:b.name;n.ERROR(h(),b.value.error);return d("WAResultOrError").makeError("ack-failure")}});return p.apply(this,arguments)}g.sendAppDataToIndividualDeviceProtocol=a;g.sendAppDataRetryToIndividualDeviceProtocol=c}),98);
__d("WAWriteMsgRetryApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"writeMsgRetry",function(a){return function(b,c,e){return h(a,d("WAMsg").craftWAMsgIdString({author:b.author,chat:b.chat,externalId:b.externalId}),c,e)}});function h(a,b,c,d){return a.receipts.get({waMsgId:b}).then(function(b){if(b==null||b.permittedIdentitiesPerDevice==null)return;var e=b.permittedIdentitiesPerDevice,f=e.get(c);if(f==null)return;f.baseKey=d;e.set(c,f);return a.receipts.put(babelHelpers["extends"]({},b,{permittedIdentitiesPerDevice:e})).then(function(){})})}g.writeMsgRetry=a}),98);
__d("WAWriteMsgRetryCountApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"writeMsgRetryCount",function(a){return function(b,c,e){return h(a,d("WAMsg").craftWAMsgIdString({author:b.author,chat:b.chat,externalId:b.externalId}),c,e)}});function h(a,b,c,d){return a.receipts.get({waMsgId:b}).then(function(b){var e;if(b==null||d==null)return;e=(e=b.retryCountsPerDevice)!=null?e:new Map();e.set(c,d);return a.receipts.put(babelHelpers["extends"]({},b,{retryCountsPerDevice:e})).then(function(){})})}g.writeMsgRetryCount=a}),98);
__d("MAWSharedHandleRetryRequest",["MAWBulkGetAppDataForRetryApi","MAWConstants","MAWDebugMsg","MAWWriteAppDataRetryApi","Promise","WACryptoManagerUtils","WACryptoUtils","WADexieToWormMigration","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMarkParticipantNeedsKeyApi","WAMarkParticipantNeedsKeyApiV2","WAQPLProxy","WASendAppDataIndividualProtocol","WASendMsgInternal","WASentBytesCache","WAWap","WAWriteMsgRetryApi","WAWriteMsgRetryCountApi","asyncToGeneratorRuntime","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied because receipt is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied because (messageId, deviceJID, retryCount) is already executed for retryCount ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type "," id: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest unexpected receipt"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest called for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown receipt categories: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied due to retry count"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received retry request from peer without recipient set"]);q=function(){return a};return a}function r(){var a=0,b=0,c=new Map();return{getMetrics:function(){var d;return{appDataMissing:(d=c.get("appDatamissing"))!=null?d:0,appDataUnauthorized:(d=c.get("appDataunauthorized"))!=null?d:0,appDataUnsupported:(d=c.get("appDataunsupported"))!=null?d:0,msgMissing:(d=c.get("msgmissing"))!=null?d:0,msgUnauthorized:(d=c.get("msgunauthorized"))!=null?d:0,msgUnsupported:(d=c.get("msgunsupported"))!=null?d:0,receiptFailures:b,receiptSuccesses:a}},markError:function(){return b++},markSuccess:function(){return a++},setError:function(a){var b=c.get(a);b!=null?c.set(a,b+1):c.set(a,1)}}}function s(a,b){return b+"_"+a}function a(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];d("WALogger").LOG(n(),a.map(function(a){a=a.externalId;return a}).join(","));var e=d("WAQPLProxy").waQPLProxyStart(c("qpl")._(25308942,"164"),{bool:{bulk:!0},"int":{receipts:a.length},string:{origin:self.location.origin}}),f=new Set(a.filter(function(a){return a.category!=null&&!C(a)||D(a)}).map(function(a){return a.externalId})),g=a.filter(function(a){return!f.has(a.externalId)&&!C(a)}),i=a.filter(C);i=(yield (h||(h=b("Promise"))).all([u(i),x(g)]));g=i[0];i=i[1];e.addPoint("get_msg_for_retry_complete");var j=[],k=r();for(a of a){var l=g.get(a.externalId),o=i.get(s(a.from.author,a.externalId));f.has(a.externalId)?(e.addPoint("just_ack"),k.markError(),k.setError("just_ack"),E(a)):l!=null?(e.addPoint("app_data_for_retry"),yield F(a,l,e,!1,k),e.addPoint("app_data_for_retry_complete")):o!=null?(e.addPoint("msg_for_retry"),yield H(a,o,e,!1,k),e.addPoint("msg_for_retry_complete")):(d("WALogger").ERROR(m()),k.markError(),k.setError("unexpected_receipt"));j.push(B(a))}e.endSuccess({"int":babelHelpers["extends"]({},k.getMetrics())});return j});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return new Map();var b=a.map(function(a){var b=a.externalId;a=a.from;return{deviceJid:a.author,externalId:b}});b=(yield d("MAWBulkGetAppDataForRetryApi").bulkGetAppDataForRetry(b));return new Map(b.map(function(b,c){c=a[c];return[c.externalId,b]}))});return v.apply(this,arguments)}function w(a){return a.map(function(a){var b=a.externalId,c=a.from,e=a.recipient,f=c.chat;if(c.type==="device"&&d("WAJids").extractUserJid(c.author)===d("WAJids").extractUserJid(d("WAGlobals").getMyDeviceJid())){if(e==null){d("WALogger").ERROR(q());return}f=e}e={author:"@me",chat:f,externalId:b};return{deviceJid:c.author,protocolMsgId:e,retryCount:a.retryCount}})}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return new Map();var b=w(a),c=a.filter(function(a,c){return b[c]!=null}),e=b.filter(Boolean);a=(yield d("WASentBytesCache").sentBytesCache().getMsgsForRetry(e));a=new Map(a.map(function(a,b){return[s(e[b].deviceJid,c[b].externalId),{msgForRetry:a,retryRequest:e[b]}]}));return a});return y.apply(this,arguments)}function z(a,b){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=void 0,e=(yield d("WAGlobals").getWaOneQueue().enqueue(function(b){b=b.cryptoManager;return d("WACryptoManagerUtils").getParticipantInfo(a.from.author,b)},{flush:!1,operationType:"get_participant_info"}));if(a.keys!=null){var f=a.keys,g=a.timestamp;b={baseKey:b.baseKey,keys:f,timestamp:g};f=J(a,e);f?c={session:b,type:"compareTSAndUseSession"}:c={session:b,type:"useSession"}}else{g=e==null||a.regId!==e.regId;g&&(c={type:"requestNewSession"})}return c});return A.apply(this,arguments)}function B(a){var b,c=a.externalId;a=a.from;return(b=d("WAWap")).wap("ack",{"class":"receipt",id:b.CUSTOM_STRING(c),participant:b.PARTICIPANT_JID(a),to:b.TO_JID(a),type:"retry"})}function C(a){a=a.category;return a==="peer_appdata"||a==="peer"}function D(a){a=a.retryCount;return a>=d("MAWConstants").MESSAGE_RETRY_COUNT_LIMIT}function E(a){if(D(a)){d("WALogger").LOG(p());return}if(a.category!=null){d("WALogger").WARN(o(),a.category);return}}function F(a,b,c,d,e){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){e===void 0&&(e=!0);var g=a.externalId,h=a.from,i=a.retryCount;c.addPoint("get_app_data_for_retry");if(b.type!=="unacked"){d("WALogger").LOG(l(),b.type,g);e?c.endFail(b.type):c.addPoint(b.type);f==null?void 0:f.markError();f==null?void 0:f.setError("appData"+b.type);return}e=b.appData;b=b.deviceIdentity;a=(yield z(a,b));c.addPoint("get_session_info");e=(yield d("WASendAppDataIndividualProtocol").sendAppDataRetryToIndividualDeviceProtocol(e,g,h.author,i,b.pubKey,a));c.addPoint("send_app_data");if(i>=2&&e.success===!0&&e.value.baseKey!=null){b=e.value.baseKey;yield d("MAWWriteAppDataRetryApi").writeAppDataRetry(g,h.author,b)}f==null?void 0:f.markSuccess();return e});return G.apply(this,arguments)}function H(a,b,c,d,e){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var h;f===void 0&&(f=!0);var l=b.msgForRetry;b=b.retryRequest;var m=a.externalId,n=a.from,o=a.retryCount,p=b.protocolMsgId.chat;if(l.type!=="unacked"){f&&e.endFail(l.type);d("WALogger").LOG(k(),l.type);g==null?void 0:g.markError();g==null?void 0:g.setError("msg"+l.type);return}if(l.retryCount!=null&&l.retryCount>0&&l.retryCount===o){f&&e.endFail("unauthorized");d("WALogger").LOG(j(),o);g==null?void 0:g.markError();g==null?void 0:g.setError("msgunauthorized");return}if(n.type==="group"){var q=d("WADexieToWormMigration").isWorm("MAWSharedHandleRetryRequest")?d("WAMarkParticipantNeedsKeyApiV2").markParticipantNeedsKey:d("WAMarkParticipantNeedsKeyApi").markParticipantNeedsKey;yield q(n.chat,n.author);e.addPoint("mark_participant_needs_key_complete")}q=l.backupDirective;var r=l.frankingKey,s=l.frankingVersion,t=l.isInstamadillo,u=l.messageBytes,v=l.messageType,w=l.protocolMsgId,x=(yield d("WALoadReceiptApi").loadReceipt({author:w.author,chat:w.chat,externalId:w.externalId}).then(function(a){return a.success?a.value:null}));h=x==null?void 0:(h=x.permittedIdentitiesPerDevice)==null?void 0:h.get(b.deviceJid);if(x==null||h==null){f&&e.endFail("unauthorized");d("WALogger").LOG(i());g==null?void 0:g.markError();g==null?void 0:g.setError("msgunauthorized");return}x=(yield z(a,h));e.addPoint("get_session_info_complete");c("gkx")("24021")&&(yield d("MAWDebugMsg").writeDebugMsg(p,"Handling retry request for message: "+l.protocolMsgId.externalId.toString()+" to user "+n.author));f=(yield d("WAGenReportingMeta").genReportingMeta(u.bytes,r,s));a=(yield d("WASendMsgInternal").sendMessage({backupDirective:q,chat:p,count:o,deviceIdentity:null,externalId:m,identityKey:h.pubKey,messageBytes:u,messageType:v,protocolMsgId:w,reportingMeta:f,sessionInfo:x,to:n.author,type:"direct"},e,t));e.addPoint("send_message_complete");if(o>=2&&a.success&&a.value.baseKey!=null){l=a.value.baseKey;yield d("WAWriteMsgRetryApi").writeMsgRetry(b.protocolMsgId,n.author,l)}o>=1&&a.success&&(yield d("WAWriteMsgRetryCountApi").writeMsgRetryCount(b.protocolMsgId,n.author,o));g==null?void 0:g.markSuccess()});return I.apply(this,arguments)}function J(a,b){if(a.offline==null)return!1;var c=b==null||a.regId!==b.regId;b=b!=null&&a.keys!=null&&!d("WACryptoUtils").uint8ArraysEqual(b.pubKey,a.keys.identity);return c||b}g.bulkHandleRetryRequest=a}),98);
__d("MAWCOPRetryHandler",["MAWIsQuotaExceededError","MAWSharedCOPLogger","MAWSharedHandleRetryRequest","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Receipt consumer error"]);h=function(){return a};return a}function a(a){return i(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").catching(a).MUSTFIX(h());return[]})}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];yield d("MAWSharedHandleRetryRequest").bulkHandleRetryRequest(a.map(function(a){return a.retry}));return a.map(function(a){return a.stanzaQueueId})});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWSplitProtocolEntityByType",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b={appdatas:[],instructions:[],messages:[],notifications:[],receipts:[],retries:[]};a.forEach(function(a){switch(a.type){case"message":b.messages.push(a);return;case"retryReceipt":b.retries.push(a);return;case"appdata":b.appdatas.push(a);return;case"notification":b.notifications.push(a);return;case"receipt":b.receipts.push(a);return;default:a;b.instructions.push(a);return}});return b}f["default"]=a}),66);
__d("SendMsgArgsToProtobuf",["FBLogger","MAWAsConsumerApplication","MAWMsgType","MAWParseSubprotocolVersionConsts","WAArmadilloApplication.pb","WAConsumerApplication.pb","WAFranking","WAGlobals","WAJids","WAMsgApplication.pb","encodeMAWDocumentFileMessage","encodeProtobuf","nullthrows","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(a){switch(a){case d("MAWMsgType").MSG_TYPE.IMAGE:return d("MAWAsConsumerApplication").encodeValidatedImageMessage;case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:return d("MAWAsConsumerApplication").encodeValidatedVideoMessage;case d("MAWMsgType").MSG_TYPE.PTT:return d("MAWAsConsumerApplication").encodeValidatedAudioMessage;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("encodeMAWDocumentFileMessage").encodeValidatedFileMessage;case d("MAWMsgType").MSG_TYPE.STICKER:return d("MAWAsConsumerApplication").encodeValidatedStickerMessage}return null}function i(a,b,e){var f=null,g=null,h=null,i=null;if(b.associatedMsgSendArgs!=null){e=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,c("nullthrows")(m(d("MAWMsgType").MSG_TYPE.TEXT,b.associatedMsgSendArgs,e)));f={payload:e.readBuffer(),version:d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION}}e=j(b.faviconMetadata,a.accessibilityLabel);e!=null&&(g={payload:e,version:d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION});e=j(b.headerMetadata,a.accessibilityLabel);e!=null&&(h={payload:e,version:d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION});e=j(b.previewMetadata,a.accessibilityLabel);e!=null&&(i={payload:e,version:d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION});e=b.xmaArgs;return{payload:{content:{extendedContentMessage:{associatedMessage:f,commands:a.commands,contentRef:e.contentRef,ctas:e.defaultCTA==null?void 0:[e.defaultCTA].concat(e.ctas).filter(Boolean),favicon:g,headerImage:h,headerTitle:e.headerTitle,maxSubtitleNumOfLines:e.maxSubtitleNumOfLines,maxTitleNumOfLines:e.maxTitleNumOfLines,mentionedJid:a.mentionedJids,messageText:a.content,overlayDescription:e.overlayDescription,overlayIconGlyph:e.overlayIconGlyph,overlayTitle:e.overlayTitle,previews:i?[i]:void 0,sentWithMessageId:f?b.xmaMsgExternalId:void 0,subtitleText:e.subtitleText,targetExpiringAtSec:e.targetExpiringAtSec,targetId:e.targetId,targetType:a.xmaMessageType,targetUsername:e.targetUsername,titleText:e.titleText,xmaLayoutType:e.xmaLayoutType}}}}}function j(a,b){return(a==null?void 0:a.mediaEntry)==null?null:d("MAWAsConsumerApplication").encodeValidatedMediaToImageTransport(babelHelpers["extends"]({accessibilitySummaryText:b,mediaType:a.mediaType,size:a.file.size},a.mediaInfo),a.mediaEntry)}function k(a,b){var e;switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:return{metadata:d("MAWAsConsumerApplication").encodeConsumerApplicationMetadata(b.specialTextSize),payload:{content:{messageText:{commands:b.commands,mentionedJid:b.mentionedJids,text:(e=b.content)!=null?e:""}}}};case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:e=b;return{payload:{content:{editMessage:{key:{fromMe:!0,id:e.originalProtocolMsgId.externalId,remoteJid:e.originalProtocolMsgId.author},message:{commands:e.editMsgContent.commands,mentionedJid:e.editMsgContent.mentionedJids,text:e.editMsgContent.content},timestampMs:Date.now()}}}};case d("MAWMsgType").MSG_TYPE.REACTION:e=b;return{payload:{content:{reactionMessage:{groupingKey:e.groupingKey,key:{fromMe:!0,id:e.reactToProtocolMsgId.externalId,remoteJid:e.reactToProtocolMsgId.author},senderTimestampMs:Date.now(),text:e.reaction}}}};case d("MAWMsgType").MSG_TYPE.REVOKED:e=b;return{payload:{applicationData:{revoke:{key:{fromMe:!0,id:e.msgId.externalId}}}}};case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.IMAGE:e=c("nullthrows")(h(a));var f=b;return e(babelHelpers["extends"]({accessibilitySummaryText:b.accessibilityLabel,mediaType:a,size:f.fileSize},f.mediaInfo),f.mediaEntry);default:return null}}function l(a,b,e,f){switch(a){case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:a=b.quote;if(a==null){c("FBLogger")("mps").mustfix("bumps should always have quotes!");return null}var g=d("WAJids").isAuthorMe(a.author)||a.author===d("WAGlobals").getMyUserJid();return{payload:{content:{bumpExistingMessage:{key:{fromMe:g,id:a.externalId,participant:g?null:a.author,remoteJid:e}}}}};case d("MAWMsgType").MSG_TYPE.XMA:return!f?null:i(b,f,e);default:return null}}function m(a,b,e,f){var g;switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:case d("MAWMsgType").MSG_TYPE.REACTION:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.REVOKED:var h=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,c("nullthrows")(k(a,b))).readBuffer();g={consumerMessage:{payload:h,version:1}};break;case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.XMA:if(a===d("MAWMsgType").MSG_TYPE.XMA&&c("qex")._("310")!==!0)break;h=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,c("nullthrows")(l(a,b,e,f))).readBuffer();g={armadillo:{payload:h,version:1}};break}g=c("nullthrows")(g,"Unsupported message type");a=b.ephemeralSetting;e=b.forwardingScore;f=b.isForwarded;h=b.mediaGroupMetadata;var i=b.quote;a={metadata:babelHelpers["extends"]({chatEphemeralSetting:a&&{ephemeralExpiration:a.ephemeralExpirationInSec,ephemeralSettingTimestamp:a.ephemeralLastUpdatedOrSetTimestamp*1e3},forwardingScore:e!=null?e:0,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},h,{groupId:(a=b.mediaGroupMetadata)==null?void 0:a.groupId,groupIndex:(e=b.mediaGroupMetadata)==null?void 0:e.groupIndex,groupSize:(h=b.mediaGroupMetadata)==null?void 0:h.groupSize,isForwarded:f,quotedMessage:i&&{participant:i.author===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyUserJid():i.author,stanzaId:i.externalId}}),payload:{subProtocol:g}};return a}g.createMessageApplication=m}),98);
__d("MAWTSUtils",["WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return!c("justknobx")._("2554")?null:a!=null?d("WATimeUtils").castToUnixTime(Math.floor(a/1e3)):a}g.gatedLSOptimisticTsToMaybeUnixTime=a}),98);
__d("MAWStateManagerSyncToMainThread",["FBLogger","MAWBridge","WACommsConnectionState"],(function(a,b,c,d,e,f,g){"use strict";var h={WACommsConnectionState:d("WACommsConnectionState").WACommsConnectionState};function a(){var a=function(a){var b=h[a];i(a,b.get());b.onSet(function(b){i(a,b)})};for(var b of Object.keys(h))a(b)}function b(a,b){var d=h[a];if(d==null){c("FBLogger")("messenger_e2ee_web").warn("Unable to find GenericStateManager for key %s",a);return}d.set(b)}function e(){for(var a of Object.keys(h)){var b=h[a];i(a,b.get())}}function i(a,b){d("MAWBridge").getBridge().fireAndForget("event","updateStateManagerStateInMainThread",{stateManagerKey:a,value:b})}g.subscribeAndSyncStateManagerValuesToMainThread=a;g.updateStateManagerInMainThreadFromBridgeCall=b;g.resendCurrentValuesToMainThread=e}),98);
__d("WAFrameSocket",["WABinary","WAErrors","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket: queueing partial frame of "," bytes"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Buffer to send: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed, waiting for pending processing"]);l=function(){return a};return a}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c="SocketClosed";a=b.call(this,a!=null?a:c)||this;a.name=c;return a}var c=a.prototype;c.toString=function(){return this.name};return a}(babelHelpers.wrapNativeSuper(Error));a=function(){function a(a,b){var c=this;this.$3=new(d("WABinary").Binary)();this.closed=!1;this.$4=!1;this.onFrame=null;this.onClose=null;this.$5=function(a){c.$3.writeByteArray(a),c.convertBufferedToFrames()};this.$6=function(){if(c.$3.peek(n)){d("WALogger").LOG(l());c.$4=!0;return}c.$9()};this.$7=function(a){d("WALogger").DEV(k()).devConsole(a)};this.$2=b;this.$1=a;a.onData=this.$5;a.onClose=this.$6;a.onError=this.$7}var b=a.prototype;b.sendFrame=function(a){if(this.$4)return;this.throwIfClosed();var b=this.$2,c=a.byteLength;this.$8(c);var d=this.$1.dataToSend;b?(this.$2=null,d.ensureAdditionalCapacity(b.length+3+c),d.writeByteArray(b)):d.ensureAdditionalCapacity(3+c);d.writeUint8(c>>16);d.writeUint16(c&65535);d.write(a);this.$1.requestSend()};b.$9=function(){if(this.closed)return;d("WALogger").LOG(j());this.$4=!1;this.closed=!0;var a=this.onClose;a&&a()};b.$8=function(a){if(a>=1<<24){d("WALogger").WARN(i(),a);throw new(d("WAErrors").BufferTooLargeError)("Buffer too large: "+a)}};b.convertBufferedToFrames=function(){var a=this.$3,b=this.onFrame;while(b&&a.peek(n)){var c=o(a);c=a.readByteArrayView(c);b(c);b=this.onFrame}this.$4&&!a.peek(n)&&this.$9();b&&a.size()&&d("WALogger").LOG(h(),a.size())};b.throwIfClosed=function(){if(this.closed)throw new m()};b.close=function(){this.$1.close()};return a}();function n(a){if(a.size()<3)return!1;var b=o(a);return b<=a.size()}function o(a){return a.readUint8()<<16|a.readUint16()}g.SocketClosed=m;g.FrameSocket=a}),98);
__d("WANoiseSocket",["Promise","WACryptoDependencies","WALogger","WAPromiseQueue","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendFrame adding to queue with frame size: "," bytes"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["NoiseSocket socket closed while encrypting frame"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending encrypted frame to web socket"]);k=function(){return a};return a}a=(h||(h=b("Promise"))).reject("UNINITIALIZED HANDSHAKE");var l=new Uint8Array(0);a["catch"](function(){});c=function(){function a(a,b,c){var e=this;this.$4=[];this.$5=new(d("WAPromiseQueue").PromiseQueue)();this.$6=new(d("WAPromiseQueue").PromiseQueue)();this.$7=0;this.$8=0;this.$9=!1;this.$14=function(a){!e.$1.closed?(d("WALogger").DEV(k()).tags("WANoiseSocket"),e.$1.sendFrame(a)):d("WALogger").LOG(j())};this.$12=function(a){var b=e.$7++;e.$5.enqueueHandlers(o(e.$2,b,void 0,a),e.$15)};this.$13=function(){e.$9=!0,e.$5.wait().then(function(){e.$9=!1;var a=e.$11;a&&a()})};this.$15=function(a){e.$10?e.$10(a):e.$4.push(a)};this.$1=a;this.$3=b;this.$2=c;a.onFrame=this.$12;this.$1.onClose=this.$13;a.convertBufferedToFrames()}var c=a.prototype;c.sendFrameAsync=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield this.sendFrame(a));return a});function c(b){return a.apply(this,arguments)}return c}();c.sendFrame=function(a){if(this.$9)return(h||(h=b("Promise"))).resolve();this.$1.throwIfClosed();var c=this.$8++;d("WALogger").DEV(i(),a.length).tags("WANoiseSocket");return this.$6.enqueueHandlers(n(this.$3,c,void 0,a),this.$14)};c.setOnFrame=function(a){this.$10=a};c.setOnClose=function(a){this.$11=a};c.close=function(){this.$1.close()};return a}();function m(a){var b=new ArrayBuffer(12),c=new DataView(b);c.setUint32(8,a);return new Uint8Array(b)}function n(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}function o(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}g.NoiseSocket=c}),98);
__d("WAClearSignalStores",["MAWDexieTable","MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,tasks:d("MAWTransactionMode").READWRITE},"clearSignalStores",function(a){return function(){return d("MAWDexieTable").dexieAll([a.tasks.clear(),a.personalSenderKeyStatuses.clear()]).then(function(){})}});g.clearSignalStores=a}),98);
__d("WAClearSignalStoresV2",["Promise","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){return d("WASignalDB").getDb().runInTransaction(["identity","contacts","meta","prekey","prekeyGeneration","senderKeySessions","session","signedPrekey","personalSenderKeyStatuses"],"readwrite",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all([a.stores.identity.clear(),a.stores.contacts.clear(),a.stores.meta.clear(),a.stores.prekey.clear(),a.stores.prekeyGeneration.clear(),a.stores.senderKeySessions.clear(),a.stores.session.clear(),a.stores.signedPrekey.clear(),a.stores.personalSenderKeyStatuses.clear()])});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("clearSignalStores"))};g.clearSignalStores=a}),98);
__d("MAWClearSignalAndTempStores",["MAWDeleteOldLogsFromDisk","MAWJobActionsV2","MAWJobsIndexedDb","MAWLoggingSwitches","MAWTransactionMode","Promise","WAClearSignalStores","WAClearSignalStoresV2","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MAWJobsIndexedDb").makeJobsTransactor("jobs",d("MAWTransactionMode").READWRITE,"clearJob")(d("MAWJobActionsV2").clearJobs);a=function(){return(h||(h=b("Promise"))).all([d("MAWLoggingSwitches").removeLoggingFromBridge&&d("MAWDeleteOldLogsFromDisk").clearLogs(),d("WAClearSignalStores").clearSignalStores(),i(),d("WAClearSignalStoresV2").clearSignalStores()]).then(c("emptyFunction"))};g.clearSignalAndTempStores=a}),98);
__d("WAMockServerShell",["cr:8600"],(function(a,b,c,d,e,f,g){"use strict";a=b("cr:8600")!=null;g.isMockServerMode=a;g.getMockServer=b("cr:8600")}),98);
__d("MAWDbGetDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.get(b)}f.getDeviceChangeAlertsTxn=a}),66);
__d("WADevToolsDebugFns",["WADevToolsBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={};for(var c in a){var e=a[c];b[c]={id:c,args:e.serializedArgs,desc:e.desc,title:e.name}}d("WADevToolsBridge").getDevToolBridge().setHandlers("backend",{getDebugFns:function(){return b},callDebugFn:function(b){var c=b.id;b=b.args;(c=a[c]).execute.apply(c,b)}})}function b(a,b){return babelHelpers["extends"]({name:a},b)}g.registerDebugFnsToDevTool=a;g.defineDebugFunction=b}),98);
__d("MAWDebugSendMultipleMsgs",["MAWBridge","MAWExternalId","MAWLoggerUtils","Promise","WADevToolsDebugFns","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;a=d("WADevToolsDebugFns").defineDebugFunction("sendMultipleMsgs",{desc:"Sends multiple messages to a thread",execute:function(a,e){return(h||(h=b("Promise"))).all(Array.from(Array(e).keys()).map(function(b){return d("MAWBridge").getBridge().sendAndReceive("backend","sendMsg",{args:{content:b+" message"},chatJid:a,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})}))},serializedArgs:[{desc:"ChatJid of the thread to send messages to",name:"chatJid",placeholder:"1234@msgr",type:"string"},{desc:"Number of messages to send",name:"numberOfMsgs",placeholder:"100",type:"number"}]});g.sendMultipleMsgs=a}),98);
__d("MAWSendSenderKeyDistributionMsg",["MAWDebugMsg","MAWMsgType","MAWSendWrittenMsg","MAWWriteOutgoingMsgApi","Promise","WAQPLProxy","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set();function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){if(i.has(a))return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());yield d("MAWDebugMsg").writeDebugMsg(a,"Sending key distribution msg");e=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(e,a,d("WATimeUtils").unixTime(),{},d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION,c("qpl")._(25313175,"1551"),f));if(e.type==="already_sent")return d("WAResultOrError").makeError("already_sent");else if(e.type==="missing_thread")return d("WAResultOrError").makeError("missing_thread");yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:e.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(c("qpl")._(25313175,"1551"),f),"MAWSendSenderKeyDistributionMsg");return d("WAResultOrError").makeResult()});return j.apply(this,arguments)}g.sendSenderKeyDistributionMsg=a}),98);
__d("WAIndexDBStorage",["Promise","err"],(function(a,b,c,d,e,f,g){var h,i="idb-storage-testing-db",j="idb-storage-testing-store";function a(){return new(h||(h=b("Promise")))(function(a,b){var c=indexedDB.open(i);c.onerror=function(a){b(a.target.error)};c.onupgradeneeded=function(a){a=a.target.result;a.createObjectStore(j)};c.onsuccess=function(b){b=b.target.result;a(b)}})}function d(a){var c=a.idb,d=a.fileBuffer,e=a.key;return new(h||(h=b("Promise")))(function(a,b){var f=c.transaction([j],"readwrite");f.oncomplete=function(){a()};f.onerror=function(a){b(a.target.error)};f.onabort=function(a){b(a.target.error)};f=f.objectStore(j);f=f.put(d,e);f.onerror=function(a){b(a.target.error)};f.onsuccess=function(){a()}})}function e(a){var d=a.idb,e=a.key;return new(h||(h=b("Promise")))(function(a,b){var f=d.transaction([j],"readonly");f.onerror=function(a){b(a.target.error)};f.onabort=function(a){b(a.target.error)};f=f.objectStore(j);var g=f.get(e);g.onerror=function(a){b(a.target.error)};g.onsuccess=function(){if(!(g.result instanceof ArrayBuffer)){b(c("err")("Result is not an ArrayBuffer"));return}a(g.result)}})}function f(a){var c=a.idb;return new(h||(h=b("Promise")))(function(a,b){var d=c.transaction([j],"readwrite");d.oncomplete=function(){a()};d.onerror=function(a){b(a.target.error)};d.onabort=function(a){b(a.target.error)};d=d.objectStore(j);d=d.clear();d.onerror=function(a){b(a.target.error)};d.onsuccess=function(){a()}})}function k(a){a=a.idb;a.close();indexedDB.deleteDatabase(i)}g.prepareIDB=a;g.writeToIDB=d;g.readFromIDB=e;g.cleanupIDB=f;g.deleteIdb=k}),98);
__d("WAOpfsSyncStorage",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g,h="opfs-storage-testing-filesystem";function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;if((navigator==null?void 0:(a=navigator.storage)==null?void 0:a.getDirectory)==null)return(g||(g=b("Promise"))).reject("OPFS is not supported");a=(yield navigator.storage.getDirectory());a=(yield a.getDirectoryHandle(h,{create:!0}));return a});return i.apply(this,arguments)}function c(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.directoryHandle,c=a.fileBuffer;a=a.fileName;b=(yield b.getFileHandle(a,{create:!0}));a=(yield b.createSyncAccessHandle());b=new DataView(c);a.write(b,{at:0});return a.close()});return j.apply(this,arguments)}function d(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.directoryHandle;a=a.fileName;b=(yield b.getFileHandle(a));a=(yield b.createSyncAccessHandle());b=a.getSize();b=new ArrayBuffer(b);var c=new DataView(b);yield a.read(c,{at:0});a.close();return b});return k.apply(this,arguments)}function e(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c,d=a.directoryHandle;a=a.fileName;if((navigator==null?void 0:(c=navigator.storage)==null?void 0:c.getDirectory)==null)return(g||(g=b("Promise"))).reject("OPFS is not supported");yield d.removeEntry(a)});return l.apply(this,arguments)}f.prepareFileSystem=a;f.writeToFileSystem=c;f.readFromFileSystem=d;f.cleanupFileSystem=e}),66);
__d("WATestBenchmark",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g=function(){return performance.now()};function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){var e={},f=[],h=function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,d){f.push(b);e[b]=[];for(var h=0;h<a;h++){var i=g();for(var j=0;j<c;j++)yield d(h,j);j=g();e[b].push((j-i)/c)}});return function(a,b){return d.apply(this,arguments)}}();yield d(h);return f.map(function(a){var b=e[a].sort(function(a,b){return a-b}),c=b.length;return{name:a,min:b[0],p50:b[Math.floor(c/2)],avg:b.reduce(function(a,b){return a+b},0)/c}})});return h.apply(this,arguments)}function i(a){if(a<1){var b=Math.round(a*1e4);return b+"\u03bcs"}b=Math.round(a);return b+"ms"}function c(a,b){b.forEach(function(b){var c=b.name,d=b.min,e=b.avg;b=b.p50;a("["+c+"] min: "+i(d)+", avg: "+i(e)+", p50: "+i(b))})}function d(a,b){var c="\n";b.forEach(function(a){var b=a.name,d=a.min,e=a.avg;a=a.p50;c+=b+","+Math.round(d)+","+Math.round(e)+","+Math.round(a)+"\n"});a(c)}f.createBenchmark=a;f.printReport=c;f.printAsCSVInMS=d}),66);
__d("WAWebCacheStorage",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g="web-cache-storage-testing";function a(){return caches.open(g)}function c(a){var b=a.cache,c=a.fileBuffer;a=a.key;c=new Response(c);return b.put(a,c)}function d(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.cache;a=a.key;b=(yield b.match(a));return b.arrayBuffer()});return h.apply(this,arguments)}function e(){return caches["delete"](g).then(function(){})}f.prepareCache=a;f.writeToCache=c;f.readFromCache=d;f.cleanupCache=e}),66);
__d("WARunStorageBenchmark",["Promise","WAIndexDBStorage","WAOpfsSyncStorage","WATestBenchmark","WAWebCacheStorage","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g){var i=1024*e;i=new Blob([new Uint8Array(i).fill(255)]);var j=(yield i.arrayBuffer());a("datapoints: "+f+" repetitions: "+g+" blob size: "+e+"KB");var k=(yield d("WAIndexDBStorage").prepareIDB());yield d("WAIndexDBStorage").cleanupIDB({idb:k});yield d("WAWebCacheStorage").cleanupCache();var l=(yield d("WAWebCacheStorage").prepareCache()),m=(yield d("WAOpfsSyncStorage").prepareFileSystem());a("start write benchmark...");i=(yield d("WATestBenchmark").createBenchmark(f,g,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a("IndexedDB write",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("WAIndexDBStorage").writeToIDB({idb:k,fileBuffer:yield j,key:a+"_"+b})});return function(b,c){return a.apply(this,arguments)}}()),yield a("Web Cache write",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("WAWebCacheStorage").writeToCache({cache:l,fileBuffer:j,key:a+"_"+b})});return function(b,c){return a.apply(this,arguments)}}()),yield a("OPFS Sync write",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("WAOpfsSyncStorage").writeToFileSystem({directoryHandle:m,fileBuffer:j,fileName:a+"_"+b})});return function(b,c){return a.apply(this,arguments)}}())});return function(b){return a.apply(this,arguments)}}()));a("end write benchmark...");c?d("WATestBenchmark").printAsCSVInMS(a,i):d("WATestBenchmark").printReport(a,i);a("start read benchmark...");e=(yield d("WATestBenchmark").createBenchmark(f,g,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c;yield a("IndexedDB read",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){c=(yield d("WAIndexDBStorage").readFromIDB({idb:k,key:a+"_"+b}))});return function(b,c){return a.apply(this,arguments)}}());var e;yield a("Web Cache read",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){e=(yield d("WAWebCacheStorage").readFromCache({cache:l,key:a+"_"+b}))});return function(b,c){return a.apply(this,arguments)}}());var f;yield a("OPFS Sync read",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){f=(yield d("WAOpfsSyncStorage").readFromFileSystem({directoryHandle:m,fileName:a+"_"+b})),yield d("WAOpfsSyncStorage").cleanupFileSystem({directoryHandle:m,fileName:a+"_"+b})});return function(b,c){return a.apply(this,arguments)}}());if(c instanceof ArrayBuffer&&e instanceof ArrayBuffer&&f instanceof ArrayBuffer)return;return(h||(h=b("Promise"))).reject("read result is not ArrayBuffer")});return function(b){return a.apply(this,arguments)}}()));a("end read benchmark...");c?d("WATestBenchmark").printAsCSVInMS(a,e):d("WATestBenchmark").printReport(a,e)});return function(b,c,d,e,f){return a.apply(this,arguments)}}();g.runStorageBenchmark=a}),98);
__d("WormDbDebuggingUtils",["WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["identity"],"readonly",function(a){return a.stores.identity.readAll()},"debug-get-identities")});return i.apply(this,arguments)}function j(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["contacts"],"readonly",function(a){return a.stores.contacts.readAll()},"debug-get-contacts")});return k.apply(this,arguments)}function l(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["session"],"readonly",function(a){return a.stores.session.readAll()},"debug-get-sessions")});return m.apply(this,arguments)}function n(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["senderKeySessions"],"readonly",function(a){return a.stores.senderKeySessions.readAll()},"debug-get-sender-key-sessions")});return o.apply(this,arguments)}function a(){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["prekey"],"readonly",function(a){return a.stores.prekey.readAll()},"debug-get-prekeys")});return p.apply(this,arguments)}function c(){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["prekeyGeneration"],"readonly",function(a){return a.stores.prekeyGeneration.readAll()},"debug-get-prekey-generations")});return q.apply(this,arguments)}function e(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["signedPrekey"],"readonly",function(a){return a.stores.signedPrekey.readAll()},"debug-get-signed-prekeys")});return r.apply(this,arguments)}function f(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["meta"],"readonly",function(a){return a.stores.meta.readAll()},"debug-get-meta-rows")});return s.apply(this,arguments)}function t(a){return h().then(function(b){return b.filter(function(b){return b.userJid===a})})}function u(a){return j().then(function(b){return b.find(function(b){return b.contactJid===a})})}function v(a){return l().then(function(b){return b.filter(function(b){return d("WAJids").extractUserJid(b.id)===a})})}function w(a){return n().then(function(b){return b.filter(function(b){return b.userJid===a})})}g.getIdentities=h;g.getContacts=j;g.getSessions=l;g.getSenderKeySessions=n;g.getPrekeys=a;g.getPrekeyGenerations=c;g.getSignedPrekeys=e;g.getMetaRows=f;g.getIdentitiesForUser=t;g.getContact=u;g.getSessionsForUser=v;g.getSenderKeySessionsForUser=w}),98);
__d("MAWDebug",["EBDBConsistencyApi","EBDeps","EBLS","EBMinosFakeData","EBMinosQplFlow","EBUploadSentMessageForReceipients","EBWorkerEBDBApi","EBWorkerEBSMStateUtils","ExecutionEnvironment","FBLogger","LSMEBTaskCreationSource","MAWAdminWriteCutoverThreadMsgTxn","MAWArmadilloPollTableSchema.pb","MAWBackend","MAWBridge","MAWBulkHandleIncomingMsgApi","MAWCacheServiceDB","MAWConfig","MAWCurrentUser","MAWDbAddDeviceChangeAlertsTxn","MAWDbAppDataTxns","MAWDbChunkTxns","MAWDbDeviceChangeAlerts","MAWDbEditMsgHistoryTxns","MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWDbGetDeviceChangeAlertsTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbGroupInfoTxns","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbObjDecode","MAWDbObjEncode","MAWDbParticipantTxns","MAWDbPendingReceiptTxns","MAWDbPoll","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWDbVersion","MAWDbXMATxns","MAWDebugSendMultipleMsgs","MAWDexieTable","MAWEphemeralCleaner","MAWEphemeralSettingsTxns","MAWExternalId","MAWGroupSetMemberAddMode","MAWJids","MAWJobDefinitions","MAWJobManager","MAWKeychainNaClCrypto","MAWLoadMsgsApi","MAWLoggerUtils","MAWMediaUtils","MAWMpsGating","MAWMsgType","MAWRotateDTSG","MAWSendEphemeralSettingMsg","MAWSendNoteReplyMsg","MAWSendSenderKeyDistributionMsg","MAWTransactionMode","MAWTransactor","MAWUnsafeCoerce","MAWVault","OfflineThreadingId","Promise","WAAPI","WAAbPropsInit","WABuildMpsPayload","WADbPersonalSenderKeyStatusTxns","WADbTransactor","WADevicesState","WAExceededStorageQuota","WAGatherMediaInfo","WAGetPlatformFromStanzaId","WAGlobals","WAGzip","WAHandleFailureUtils","WAJids","WAJobOrchestratorTypes","WALogger","WAMPSFlushable","WAMediaUtils","WAPREList","WAPREMetrics","WAProtocolQueue","WARotateSignedPreKey","WARunStorageBenchmark","WASignalDB","WASignalOther","WATimeUtils","WebStorageEstimator","WormDbDebuggingUtils","asyncToGeneratorRuntime","emptyFunction","err","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);j=function(){return a};return a}var k={addBadProtocolQueueInstruction:function(){var a={instruction:"bad",type:"instruction"};return d("WAProtocolQueue").protocolQueue().addAndCommit([a])},addDeviceChangeAlerts:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(a))},addGroupParticipants:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.addGroupParticipants(a,b,c))},addICDCAlert:function(a){return d("WAGlobals").getWaOneQueue().enqueue(function(){d("MAWMpsGating").isMpsM3OrLater()===!1&&d("WAProtocolQueue").pqFlushable.enqueue({instruction:"icdcError",jid:a,notificationTs:d("WATimeUtils").unixTime(),priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow,type:"instruction"});d("WAMPSFlushable").mpsFlushable.enqueue(d("WABuildMpsPayload").buildMpsIcdcAdminMessage(a,d("WATimeUtils").unixTime(),d("WAGlobals").getDependencies().generateExternalId()),function(){},"maw_debug");return(i||(i=b("Promise"))).resolve()},{flush:!0,operationType:"debug_operation"}).then(c("emptyFunction"))},benchmarkStorage:function(a,b,c,e){a===void 0&&(a=!1),b===void 0&&(b=1),c===void 0&&(c=50),e===void 0&&(e=500),void d("WARunStorageBenchmark").runStorageBenchmark(function(a){return!1},a,b,c,e)},checkStorageQuota:function(){return d("WAExceededStorageQuota").checkStorageQuota()},createGroup:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").createStartJobInfo("createGroup",{extras:{clientThreadKey:c,platform:"msgr"},key:c,s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey(),subject:a,users:b}))},createTestPoll:function(a){void m({poll:d("MAWTransactionMode").READWRITE})(function(b){return b.poll.put({chatJid:a,encKey:new ArrayBuffer(0),latestSenderTimestampsMs:new Map([["@me",d("WATimeUtils").millisTime()]]),pollAuthor:"@me",pollOptions:new Map([[d("MAWDbPoll").convertStringToOptionHash("option1Hash"),{optionText:"option1",voteAuthors:new Set(["@me"])}]]),pollParticipantCount:2,pollStanzaId:d("MAWExternalId").generateExternalId(),pollState:d("MAWArmadilloPollTableSchema.pb").POLL_STATE.OPEN,selectableOptionsCount:0,title:"Test Poll"})})(a)},createThread:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","createThread",{contactFbid:a,description:"MAWDebug",threadKey:d("OfflineThreadingId").createOfflineThreadingID()})},decodeEAR:function(a,b){return d("MAWDbObjDecode").decodeDbObj(a,b)},deflate:function(a){var b=d("WAGzip").createDeflate();b.push(a,!0);return b.result()},deleteGroupInvitesByThreadAndInvitedParticipant:function(a,b){return l(m({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant)(a,b))},demoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.demoteGroupParticipants(a,b))},deregisterPhone:function(){c("promiseDone")(d("WAHandleFailureUtils").deregisterPhone())},dropExpiredMessagesFromDB:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.backend.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},dropExpiredMessagesFromUI:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.ui.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},encodeEAR:function(a,b){return d("MAWDbObjEncode").encodeDbObj(a,b)},encryptEARTweetNaCl:function(a,b,c){return d("MAWKeychainNaClCrypto").encryptTweetNaCl(a,b,c)},estimateStorage:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WebStorageEstimator").estimateStorage());return a});function c(){return a.apply(this,arguments)}return c}(),executeQuery:function(a){var b=Object.keys(d("MAWDbVersion").CURRENT_MAW_STORES).filter(function(a){return d("MAWDbVersion").CURRENT_MAW_STORES[a]!=null}).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b+""]=d("MAWTransactionMode").READWRITE,a))},{});return m(b)(a)()},forwardMsg:function(a,b){return d("MAWBridge").getBridge().sendAndReceive("backend","forwardMsg",{args:{args:{},chatJid:a,externalId:d("MAWExternalId").generateExternalId(),protocolMsgId:b},qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},fromUnixTime:function(a){return d("WATimeUtils").toDate(a)},gatherMediaInfo:function(){c("promiseDone")(d("WAGatherMediaInfo").gatherMediaInfo())},generateAndUploadPreKeys:function(){return c("WAAPI").generateAndUploadPreKeys({reason:"test"})},generateAndUploadPreKeysMultipleCalls:function(){return(i||(i=b("Promise"))).all([c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"})])},generateCipherTextMessagesForChat:function(a,c){return(i||(i=b("Promise"))).all(Array.from({length:c}).map(function(b,c){b=d("WATimeUtils").castMilliSecondsToUnixTime(Date.now());var e=d("MAWExternalId").generateExternalId(),f={ack:2,altIndex:void 0,author:"@me",externalId:e,msgContent:{content:"Stub message #"+c},msgId:d("MAWDbMsg").craftMsgIdV2(1,1,{externalId:e}),serverTs:b,threadJid:a,ts:b,type:d("MAWMsgType").MSG_TYPE.CIPHERTEXT};return m({messages:d("MAWTransactionMode").READWRITE})(function(a){return a.messages.add(f)})(f)}))},generateDuplicateMessagesForChat:function(a,b){return k.generateMessagesForChat(a,b).then(function(a){var b=a.msgResults.values().map(function(a){return(a=a.value)==null?void 0:a.protocolMsgId.externalId}).filter(Boolean),e=b[0];return m({messages:d("MAWTransactionMode").READWRITE})(function(a){return d("MAWDexieTable").dexieAll(b.map(function(b){return a.messages.get({externalId:b}).then(function(b){if(b!=null)return a.messages.put(babelHelpers["extends"]({},b,{externalId:e,protocolMsgId:void 0}))})})).then(c("emptyFunction"))})(b)})},generateMessagesForChat:function(a,b){return d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(Array.from({length:b}).map(function(b,c){b=d("WATimeUtils").castMilliSecondsToUnixTime(Date.now());var e=d("MAWExternalId").generateExternalId();c={ack:2,altIndex:void 0,author:"@me",externalId:e,msgContent:{content:"Stub message #"+c},serverTs:b,ts:b,type:"Text"};return{msgData:{folder:null,id:{author:"@me",chat:a,externalId:e},msg:{encoded:new Uint8Array(0),version:"v2"},recipientsCount:null,reportingMeta:null,ts:b,type:"IncomingMsg"},receiveFlow:d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE,{}),stanzaSource:"wa",unstoredContent:{unstoredDbMedia:null,unstoredDbMsg:c,unstoredDbReaction:null,unstoredDbReceiverFetchInfo:null}}}),c("LSMEBTaskCreationSource").TEST_ONLY)},getAbProp:function(a){return d("WAAbPropsInit").getAbProp(a)},getAbProps:function(){return d("WAAbPropsInit").getAbProps()},getAppDatas:function(a){return l(m({appData:d("MAWTransactionMode").READONLY})(d("MAWDbAppDataTxns").bulkGetAppData)(a))},getAppMetaByKey:function(a){return l(m({appMeta:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTypeVersionTxns").getAppMetaValue)(a))},getChunksByChunkId:function(a){return l(m({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").bulkGetChunks)(a))},getConfig:function(){return Object.fromEntries(Object.entries(d("MAWConfig").getConfig()).map(function(a){var b=a[0];a=a[1];var c;a;try{c=a()}catch(b){c=a}return[b,c]}))},getCurrentUserDeviceList:function(){return c("WAAPI").getCurrentUserDeviceList()},getDeviceChangeAlerts:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsTxn").getDeviceChangeAlertsTxn)(a))},getDeviceChangeAlertsByOptions:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn)(a))},getDeviceChangeAlertsByOptionsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getDeviceChangeAlertsByOptions",{options:a})},getDevices:function(a,b){return c("WAAPI").getDevices({ignoreDhash:b,reason:"debug",users:new Set(a)})},getDevicesState:function(){return d("WADevicesState").getDevicesState()},getEBDBClientState:function(){return d("EBWorkerEBDBApi").getSecureEBClientState()},getEBDeps:function(){return d("EBDeps").getDeps()},getEBSMConsistency:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return d("EBDBConsistencyApi").checkRegistrationConsistency((yield d("EBLS").genLSClient()).db)});function c(){return a.apply(this,arguments)}return c}(),getEBSMWorkerState:function(){return(h||(h=c("ExecutionEnvironment"))).isInWorker?d("EBWorkerEBSMStateUtils").getEBSMWorkerState():d("MAWBridge").getBridge().sendAndReceive("backend","getEBSMWorkerState")},getEditMsgHistoryByEditMsgHistoryId:function(a){return l(m({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").bulkGetEditMsgHistorys)(a))},getEditMsgHistoryByProtocolMsgId:function(a){return l(m({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId)(a))},getGroupInfosByGroupJid:function(a){return l(m({groupInfo:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInfoTxns").getGroupInfos)(a))},getGroupInvite:function(a,b){return l(m({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").maybeGetGroupInvite)(a,b))},getGroupInvitesByThreadAndInvitedParticipant:function(a,b){return l(m({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant)(a,b))},getHmacKeyFromGlobals:function(){return d("WAGlobals").getHMACKey()},getMediaBackupForObjectId:function(a){return l(m({mediaBackup:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId)(a))},getMediaByIdWithDecodedMediaEntries:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield m({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a));a.forEach(function(a){if(!(a==null?void 0:a.mediaEntries))return;a.mediaEntries=new Map(Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return[b,d("WAMediaUtils").decodeMediaEntryData(a)]}))});return l((i||(i=b("Promise"))).resolve(a))});function c(b){return a.apply(this,arguments)}return c}(),getMediaByMediaId:function(a){return l(m({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a))},getMediaByPlaintextHash:function(a){return l(m({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash)(a))},getMessagesByMsgIds:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return a.filter(Boolean)})})(a))},getMsgsByChat:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("threadJid").equals(a).toArray()})())},getMsgsByMsgId:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByMsgIds)(a))},getMsgsByProtocolMsgId:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByProtocolMsgId)(a))},getNewDTSG:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield d("MAWRotateDTSG").getNewDTSG()).token});function c(){return a.apply(this,arguments)}return c}(),getParticipantsByParticipantKeys:function(a){return l(m({participants:d("MAWTransactionMode").READONLY})(d("MAWDbParticipantTxns").bulkGetParticipants)(a))},getPendingReceipts:function(a){return l(m({pendingReceipts:d("MAWTransactionMode").READONLY})(d("MAWDbPendingReceiptTxns").getPendingReceipts)(a))},getPersonalSenderKeyStatusesByGroupJid:function(a){return l(n({personalSenderKeyStatuses:d("MAWTransactionMode").READONLY})(d("WADbPersonalSenderKeyStatusTxns").bulkGetPersonalSenderKeyStatuses)(a))},getPlatform:function(a){return d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a)},getProtocolMsgId:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:a})},getReactionByReactToExternalId:function(a){return l(m({reactions:d("MAWTransactionMode").READONLY})(function(b){return b.reactions.where("reactToExternalId").anyOf(a).toArray()})(a))},getReactionByReactToMsgId:function(a){return l(m({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return d("MAWDbReactionsTxns").getReactionsFromMessages(b,a)})})(a))},getReceiptByWAMsgId:function(a){return l(n({receipts:d("MAWTransactionMode").READONLY})(function(a,b){return a.receipts.get({waMsgId:b})})(a))},getThreadsByChatJids:function(a){return l(m({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThreads)(a))},getUnArchivedDeviceChangeAlertsCount:function(){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn)())},getUnrenderedMsgsByMsgId:function(a){return l(m({unrenderedMessages:d("MAWTransactionMode").READONLY})(d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByMsgIds)(a))},getXMAByXMAId:function(a){return l(m({xma:d("MAWTransactionMode").READONLY})(d("MAWDbXMATxns").bulkGetXMAs)(a))},hmacPlaintextHash:function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)},inflate:function(a){return d("WAGzip").inflate(a)},leaveGroups:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.leaveGroups(a))},loadMsgs:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(yield d("MAWLoadMsgsApi").loadMsgsFromTs(a.chatJid,(b=a.numMsgs)!=null?b:10,a.direction,a.sortOrderMs,a.loadOriginalMsg,a.msgId,{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0}));return babelHelpers["extends"]({},b,{msgs:b.msgs.map(function(a){return babelHelpers["extends"]({},a,{content:a.content!=null?d("MAWVault").unvault(a.content):""})})})});function c(b){return a.apply(this,arguments)}return c}(),makeError:function(a){throw c("FBLogger")("messenger_web_devx").mustfixThrow(a)},makeWAError:function(a){d("WALogger").ERROR(j(),a)},markThreadAsRead:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.markThreadAsRead(a,null,!1,!1,b,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}))},maybeGetChunksByPlaintextHash:function(a){return l(m({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").maybeGetChunkByPlaintextHash)(a))},maybeGetXMAFromProtocolMsgId:function(a){return l(m({xma:d("MAWTransactionMode").READONLY})(d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId)(a))},minosUploadTest:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("EBUploadSentMessageForReceipients").uploadSentMessageForReceipients({qplFlow:d("EBMinosQplFlow").startMinosMessageUploadQpl({threadId:d("EBMinosFakeData").FAKE_UPLOAD_ENTITY.threadId}),uploadEntity:d("EBMinosFakeData").FAKE_UPLOAD_ENTITY})});function c(){return a.apply(this,arguments)}return c}(),notifyDeviceChange:function(a){return c("WAAPI").notifyDeviceChange({users:a})},overrideAbProp:function(a,b){d("WAAbPropsInit").overrideAbProp(a,b)},promoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.promoteGroupParticipants(a,b))},protocolQueue:function(){return d("WAProtocolQueue").protocolQueue()},putGroupInvite:function(a){return l(m({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").putGroupInvite)(a))},putNewPersonalSenderKeyStatus:function(a){return n({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE})(d("WADbPersonalSenderKeyStatusTxns").putNewPersonalSenderKeyStatus)(a)},queryAllGroups:function(){return c("WAAPI").queryGroups({type:"all"}).then(c("emptyFunction"))},readCacheStore:function(a){return d("MAWCacheServiceDB").getOrSetupMAWCacheDB().then(function(b){return b.runInTransaction([a],"readonly",function(b){return b.stores[a].readAll()},"Debug - read "+a,f.id+":1144")})},readProtocolQueue:function(){return d("WAProtocolQueue").protocolQueue().read()},readWormStore:function(a){return d("WASignalDB").getDb().runInTransaction([a],"readonly",function(b){return b.stores[a].readAll()},"Debug - read "+a,f.id+":1159")},removeDevice:function(a,b){return c("WAAPI").removeDevice({deviceId:a,identity:b})},removeGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.removeGroupParticipants(a,b))},reportUserSpam:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.reportUserSpam(a,"frx",b,!1,["harassment"],"fake debug context"))},reregisterPhone:function(){return d("WAHandleFailureUtils").reregisterPhone()},revokeMsg:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.revokeMsgs({msgIds:[a],s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey()}))},rotateSignedPreKey:function(){return d("WARotateSignedPreKey").rotateSignedPreKey()},sendAppData:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:a,deviceJids:b}))},sendBumpMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendBumpMsg(a,b))},sendEditMsg:function(a,b){return d("MAWBridge").getBridge().sendAndReceive("backend","sendEditMsg",{args:{editMsgContent:{content:a.editMsgContent.content,mentionedJids:[]},originalProtocolMsgId:a.originalProtocolMsgId},chatJid:a.originalProtocolMsgId.chat,externalId:b,qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},sendEphemeralSettingMsg:function(a,b){return d("MAWSendEphemeralSettingMsg").sendEphemeralSettingMsgFn({args:b,chatJid:a,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},sendInvisibleMsg:function(a){return d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a,d("MAWExternalId").generateExternalId(),d("MAWLoggerUtils").getInstanceKey())},sendInvisibleMsgToAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a.groupJid,d("MAWExternalId").generateExternalId(),d("MAWLoggerUtils").getInstanceKey()));return b});function c(){return a.apply(this,arguments)}return c}(),sendMessageTooAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(k.sendMsg(a.groupJid,{content:"message to "+a.groupJid+" at "+new Date().getTime(),s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey()}));return b});function c(){return a.apply(this,arguments)}return c}(),sendMsg:function(a,b){var e=b.s2sInstanceKey;b.s2sUserFlowQPLEvent;b=babelHelpers.objectWithoutPropertiesLoose(b,["s2sInstanceKey","s2sUserFlowQPLEvent"]);return d("MAWBridge").getBridge().sendAndReceive("backend","sendMsg",{args:b,chatJid:a,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:e})},sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs.execute,sendNoteReplyMsg:function(a,b){return d("MAWSendNoteReplyMsg").sendNoteReplyMsgFn({args:{content:b.content,noteContent:b.noteContent,noteExpirationTs:b.noteExpirationTs},chatJid:a,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},sendReaction:function(a,b,e,f){return d("MAWBridge").getBridge().sendAndReceive("backend","sendReactionMsg",{args:{groupingKey:"",reaction:f,reactToAuthor:e,reactToProtocolMsgId:b},chatJid:a,externalId:b.externalId,qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},setEphemeralSettingWithoutUpdate:function(a,b,c,e){c=c==null?d("WATimeUtils").unixTime():d("WATimeUtils").futureUnixTime(c);return l(m({ephemeralSettings:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange)(a,b,c,e))},setGroupSubject:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.setGroupSubject(a,b))},setMemberAddMode:function(a,b){return d("MAWGroupSetMemberAddMode").setMemberAddModeFn({groupJid:a,memberAddMode:b})},startComms:function(){var a;void ((a=d("MAWBackend").getWaComms())==null?void 0:a.startComms())},stopComms:function(){var a;(a=d("MAWBackend").getWaComms())==null?void 0:a.stopComms()},syncAbProps:function(a){a=a!==!0;return c("WAAPI").syncAbProps({sendHash:a})},triggerSecureStorageKeyChangeAlert:function(){var a={action:d("MAWDbDeviceChangeAlerts").KEY_CHANGE,deviceJid:d("WAJids").toDeviceJid(d("MAWJids").toUserJid(d("MAWCurrentUser").getID()),d("WAGlobals").getMyDeviceJid()),identity:d("MAWUnsafeCoerce").unsafeCoerce(d("WASignalOther").makeBytes(33)),isArchived:!1,model:"secure_storage",platform:"Meta",ts:d("WATimeUtils").unixTime()};return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(a))},updateDeviceChangeAlerts:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn)(a))},updateDeviceChangeAlertsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","updateDeviceChangeAlerts",{alert:a})},updateDeviceChangeAlertsLogInStatus:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn)(a))},wormGetContact:function(a){return d("WormDbDebuggingUtils").getContact(a)},wormGetContacts:function(){return d("WormDbDebuggingUtils").getContacts()},wormGetIdentities:function(){return d("WormDbDebuggingUtils").getIdentities()},wormGetIdentitiesForUser:function(a){return d("WormDbDebuggingUtils").getIdentitiesForUser(a)},wormGetMetaRows:function(){return d("WormDbDebuggingUtils").getMetaRows()},wormGetPrekeyGenerations:function(){return d("WormDbDebuggingUtils").getPrekeyGenerations()},wormGetPrekeys:function(){return d("WormDbDebuggingUtils").getPrekeys()},wormGetSenderKeySessions:function(){return d("WormDbDebuggingUtils").getSenderKeySessions()},wormGetSenderKeySessionsForUser:function(a){return d("WormDbDebuggingUtils").getSenderKeySessionsForUser(a)},wormGetSessions:function(){return d("WormDbDebuggingUtils").getSessions()},wormGetSessionsForUser:function(a){return d("WormDbDebuggingUtils").getSessionsForUser(a)},wormGetSignedPrekeys:function(){return d("WormDbDebuggingUtils").getSignedPrekeys()},writeCutoverThreadAdminMsg:function(a,b){var c;return l(m({chunk:(c=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:c.READWRITE,groupInfo:c.READONLY,media:c.READONLY,messages:c.READWRITE,threads:c.READWRITE})(d("MAWAdminWriteCutoverThreadMsgTxn").writeCutoverThreadAdminMsg)(a,b))},writeRollbackCutoverThreadAdminMsg:function(a){a=m({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThread)(a);return a.then(function(a){if(!a.success)return(i||(i=b("Promise"))).resolve();a=a.value;return l(m({chunk:d("MAWTransactionMode").READONLY,ftsBackloggedMessages:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWAdminWriteCutoverThreadMsgTxn").writeRollbackCutoverAdminMsg)(a))})}};function l(a){return a.then(function(a){return a})}c("gkx")("23903")&&(self.Debug=k,self.WAAPI=c("WAAPI"));function m(a){return function(b){return d("MAWTransactor").makeMsgrTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}function n(a){return function(b){return d("WADbTransactor").makeSignalTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}g.MAWDebugFuncs=k}),98);
__d("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/api/v1/direct_v2/restoration_cdn_url/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("endpoints",["CSRFGuard","PolarisConfig","Promise","XHRRequest","XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder","getAsyncParams"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return new(h||(h=b("Promise")))(function(b,e){var f=c("getAsyncParams")("POST"),g=new(c("XHRRequest"))(c("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder").buildURL({}));g.setMethod("POST").setRequestHeader("X-IG-App-ID",d("PolarisConfig").getIGAppID()).setData(babelHelpers["extends"]({},f,{payload:a})).setResponseHandler(function(a){try{a=a.trim();d("CSRFGuard").exists(a)&&(a=d("CSRFGuard").clean(a));a=JSON.parse(a);b(a.payload.restoration_cdn_url)}catch(a){e(a)}}).setErrorHandler(function(a){e(a)}).send()})}g.fetchEBRestoreCDNUrl=a}),98);
__d("IGDAWDebug",["I64","IGDAWProtocolQueueInstructions","MAWDebug","MAWReStoreDb","MAWUnsafeCoerce","WAJids","WAProtocolQueue","WASignalKeys","asyncToGeneratorRuntime","cr:7711","endpoints"],(function(a,b,c,d,e,f,g){"use strict";var h;a={UNSAFE_triggerICDCErrorForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAJids").toMsgrUserJid(a);var b=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),c=d("MAWUnsafeCoerce").unsafeCoerce(42);a={instruction:"icdcError",jid:a,notificationTs:b,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:c,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([a])});function c(b){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityAddedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,identity:d("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityAdded",jid:a,model:"Chrome",notificationTs:c,platform:"Instagram",priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityChangedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,identity:d("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityChanged",jid:a,model:"Chrome",notificationTs:c,platform:"Instagram",priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityRemovedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,instruction:"identityRemoved",jid:a,notificationTs:c,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),fetchEBRestoreCDNUrl:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield d("endpoints").fetchEBRestoreCDNUrl(a))}catch(a){}});function c(b){return a.apply(this,arguments)}return c}(),fetchInstamadilloMessage:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){try{var g=(yield d("MAWReStoreDb").getDB(f.id+":144"));yield b("cr:7711")==null?void 0:b("cr:7711")(g,(h||(h=d("I64"))).of_float(a),c,e)}catch(a){}});function c(b,c,d){return a.apply(this,arguments)}return c}()};Object.assign(d("MAWDebug").MAWDebugFuncs,a)}),34);
__d("MAWParseXMAIGConfig",["WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";b=new Set([(a=d("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION]);g.IGD_SUPPORTED_TARGET_TYPES=b}),98);
__d("IGDAWMainWebWorkerConfig",["MAWGK","MAWParseXMAIGConfig","WADbDeviceRegistration","WorkerUtils","getOrchestratorVersion","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i=1;a={S508658PreventOldSessionLookupAndPromote:function(){return!0},armadilloWebProcessFutureproof:function(){return c("MAWGK").armadillo_web_process_futureproof},batchSize:function(){return 500},getDevicesV2:function(){return c("gkx")("4551")},getSignalFutureMessagesMax:function(){return c("justknobx")._("847")},icdcAlertTriggerFailureCounter:function(){return c("justknobx")._("1970")},icdcCooldownIntervalInMinutes:function(){return 1e4},icdcIntervalInMinutes:function(){return c("justknobx")._("1972")},ignoreReadReceipts:function(){return c("qex")._("3109")===!1},isDocumentReceiveEnabled:function(){return!1},isEphemeralMessagesEnabled:function(){return!0},isFrankingDropOnInvalid:function(){return c("gkx")("23973")},isFrankingDropOnMissing:function(){return c("gkx")("23974")},isFrankingEnabled:function(){return c("justknobx")._("1347")},isGifEnabled:function(){return c("justknobx")._("1147")},isICDCErrorEnabled:function(){return c("gkx")("23975")},isMediaFallbackToAlternativeHmacSaltsEnabled:function(){return c("gkx")("23976")},isMetaAiInvocationMessageRenderEnabled:function(){return!1},isOctetStreamAttachmentMimeTypeEnabled:function(){return c("gkx")("4644")},isPollsEnabled:function(){return!1},isProgressiveJpegSendEnabled:function(){return c("justknobx")._("2412")},isSenderKeyPredistributionEnabled:function(){return c("gkx")("23981")},isSharedWorkerContext:function(){return(h||(h=d("WorkerUtils"))).isSharedWorkerContext()},isStickerEnabled:function(){return c("justknobx")._("2619")},isStickerReceiverFetchEnabled:function(){return!1},isStoryMentionXMAEnabled:function(){return!1},jpegThumbnailTargetByteSizeKB:function(){return c("justknobx")._("2338")},limitPullMode:function(){return c("gkx")("10270")},maxPrekeysToUpload:function(){return 200},maxUsersForNotifyDeviceChange:function(){return d("WADbDeviceRegistration").MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE},offlineQueueStuckTimeoutMs:function(){return c("justknobx")._("3264")},oneQueueTimeoutMs:function(){return c("justknobx")._("2583")},orchestratorVersion:function(){return c("getOrchestratorVersion")()},pjpegPreviewAvoidLastScan:function(){return c("justknobx")._("67")},sendMsgWithoutJob:function(){return!0},sessionDropIfTooOld:function(){return c("justknobx")._("2240")},shouldDeviceStateTimesout:function(){return!0},skipDownloadablePreviewForProgressiveJpeg:function(){return c("justknobx")._("2371")},skipProcessingGroupInvite:function(){return c("justknobx")._("3899")},useLongSessionDrop:function(){return c("gkx")("1244")},waDanglingQueue:function(){return c("justknobx")._("1921")}};b={productTypeForEBAttachments:"igd",shouldFallbackToPreviewForFailedProgressiveJpeg:function(){return c("gkx")("2909")},supportedTypesVersion:function(){return c("MAWGK").armadillo_web_process_futureproof?i+1:i},supportedXMATargetTypes:function(){return d("MAWParseXMAIGConfig").IGD_SUPPORTED_TARGET_TYPES}};g.waConfig=a;g.mawConfig=b}),98);
__d("IGDBridgedAPIHandler",["JSResourceForInteraction","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["igdapi: unsupported api call ",""]);h=function(){return a};return a}function a(a){var b=a.args;a=a.type;switch(a){case"46":return c("JSResourceForInteraction")("IGDSendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"33":return c("JSResourceForInteraction")("IGDUnsendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendEditMessage":return c("JSResourceForInteraction")("IGDEditMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendMediaMessage":return c("JSResourceForInteraction")("IGDSendMediaMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendOrRemoveReaction":return c("JSResourceForInteraction")("IGDSendRemoveReactionTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendXmaReceiverFetch":return c("JSResourceForInteraction")("IGDSendXmaReceiverFetchTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});default:d("WALogger").DEV(h(),a).devConsole(b);return}}g.igdapi=a}),98);
__d("IGDHandleContinueMediaDownload",["MediaDownloadMediator","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("MediaDownloadMediator").handleNewCDNUrlFromMI(a.deliveryObjectId,a.cdnUrl);return(h||(h=b("Promise"))).resolve()});return i.apply(this,arguments)}g.handleContinueMediaDownload=a}),98);
__d("MAWBulkCancelDownloadMediaForUI",["MAWMediaManager"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a.forEach(function(a){d("MAWMediaManager").getMawMediaManager().dequeueDownload(a)})}g.bulkCancelDownloadMediaForUI=a}),98);
__d("MAWBulkLoadMessagesForThread",["MAWDexieTable","MAWIndexedDb","MAWLoadMsgsTxns","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READONLY,poll:a.READONLY,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READONLY,xma:a.READONLY},"bulkLoadMessagesForThread",function(a){return function(b){b=b.threads;return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.jid;b=b.numOfMsgsToLoad;return d("MAWLoadMsgsTxns").loadMsgAndMedia_COMPAT(a,c,b,!0)})).then(c("emptyFunction"))}});g.bulkLoadMessagesForThread=b}),98);
__d("MAWBulkMaybeCreateOrUpdateThreadScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("bulk-maybe-create-or-update-thread",{maxConcurrency:1,maxThrottleMs:500,timeToStuckMs:6e4}));return h}g.bulkMaybeCreateOrUpdateThreadScheduler=a}),98);
__d("MAWCreateUpdateThreadUtils",["MAWMICSchema","MAWQplProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,e,f){b.forEach(function(b){return d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056836502,"2778"),a,{annotations:e,instanceKey:b})}),f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"thread_mapping_"+a,{instanceKey:f})}function a(a,b,c,d){b!=null&&h(a,[b],c,d)}function b(a,b,e){b!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056842055,"807"),a,{instanceKey:b},!1,e)}function e(a,b,c,e){a==="init_sync"&&d("MAWQplProxy").sendQplPointThroughBridge(d("MAWMICSchema").EVENT,b,{annotations:e!=null?e:{}},void 0,{toClientId:c})}function f(a,b,c){a==="init_sync"&&d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(d("MAWMICSchema").EVENT,b,!0,void 0,{toClientId:c})}g.sendThreadMappingQPLPoints=h;g.sendThreadMappingQPLPoint=a;g.sendBridgeQPLPoint=b;g.maybeSendMICPoint=e;g.maybeSendMICState=f}),98);
__d("MAWBulkMaybeUpsertThreadAndParticipants",["MAWBridgeThread","MAWCreateUpdateThreadUtils","MAWDbParticipantTxns","MAWDexieTable","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWODSProxy","MAWTransactionMode","MaybeCreateOrUpdateThreadResultCache","Promise","WAJids","WAOdsEnums","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c){var e=a.threads.filter(function(a){return!d("MaybeCreateOrUpdateThreadResultCache").cache__I_KNOW_WHAT_I_AM_DOING.has(a.chatJid)});return(e.length>0?i(babelHelpers["extends"]({threads:e},a),c).then(function(a){return a.forEach(function(a){a.status==="fulfilled"&&d("MaybeCreateOrUpdateThreadResultCache").cache__I_KNOW_WHAT_I_AM_DOING.set(a.value.chatJid,a)})}):(h||(h=b("Promise"))).resolve()).then(function(){return a.threads.map(function(b){var c;return(c=d("MaybeCreateOrUpdateThreadResultCache").cache__I_KNOW_WHAT_I_AM_DOING.get(b.chatJid))!=null?c:{jid:b.chatJid,reason:a.reason,status:"rejected"}})})};var i=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READWRITE,participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"bulkMaybeCreateOrUpdateThread",function(a){return function(b,c){var e=b.reason,f=b.s2sInstanceKey,g=b.threads,h=function(a){d("MAWCreateUpdateThreadUtils").maybeSendMICState(e,a,c==null?void 0:c.fromClientId)};p(e,c,g.length);b=Array.from(new Map(g.map(function(a){return[a.authoritativeThreadKey,a]})).values());var i=new Map(),l=b.map(function(a){var b=a.chatJid;a=a.instanceKey;a!=null&&i.set(b,a);return a}).filter(Boolean);d("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoints("bulk_get_or_create_thread_start",l,void 0,f);return d("MAWGetOrCreateThreadTxns").bulkGetOrCreateThread(a,q(b),{logState:h}).then(function(a){h("threadMapping4BulkGetDone");return a.map(function(a){var b=a.adminMsgParams,c=a.created;a=a.thread;var e=i.get(a.jid);d("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("bulk_get_or_create_thread_end",e,void 0,f);return{adminMsgParams:b,created:c,instanceKey:e,thread:a}})}).then(function(b){return b.map(function(b){var c=b.adminMsgParams,e=b.created,g=b.instanceKey,h=b.thread;return d("WAJids").switchOnMsgrChatJidType(h.jid,{group:function(b){return j(a,b,g,f).then(function(a){return n(h,a,e,c)})},user:function(b){return k(a,b,g,f).then(function(a){return m(h,a,e,c)})}})})}).then(function(a){return d("MAWDexieTable").dexieAllSettled(a).then(function(a){o(c,h);var b=[];for(a of a.entries()){var d=a[0],e=a[1];e.status==="rejected"?b.push(babelHelpers["extends"]({jid:g[d].chatJid},e)):b.push(e)}return b})})}});function j(a,b,c,e){d("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("get_participants_for_group_start",c,void 0,e);return d("MAWDbParticipantTxns").getParticipantsInThreads(a,[b]).then(function(a){d("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("get_participants_for_group_end",c,{"int":{participantsLoaded:a.length}},e);return a})}function k(a,b,c,e){d("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("upsert_participants_in_1_to_1_start",c,void 0,e);return d("MAWDbParticipantTxns").bulkRemoveIncorrectAndInsertMissingParticipantsInOneToOneThread(a,b,!1).then(function(a){d("MAWCreateUpdateThreadUtils").sendThreadMappingQPLPoint("upsert_participants_in_1_to_1_end",c,{"int":{participantsLoaded:a.length}},e);return a})}function l(a,b,c,e){return{adminMsgParams:e,chatJid:a.jid,clientThreadKey:a.optimisticThreadKey,folder:a.folder,isCreated:c,lastActivityTs:d("MAWBridgeThread").getLastActivityTs(a.snippetMsgTs,a.newestMsgTs),participants:b.map(function(a){var b=a.type;a=a.userJid;return{type:b,userJid:a}})}}function m(a,b,c,d){return babelHelpers["extends"]({},l(a,b,c,d),{shouldQueryForGroup:!1})}function n(a,b,c,d){return babelHelpers["extends"]({},l(a,b,c,d),{shouldQueryForGroup:c||b.length===0||b.some(function(a){return a.addressable!==!0})})}function o(a,b){b("threadMapping5LoadedParticipantsAndMsg"),d("MAWCreateUpdateThreadUtils").sendBridgeQPLPoint("lla_end",a==null?void 0:a.bridgeQPLInstanceKey,{toClientId:a==null?void 0:a.fromClientId})}function p(a,b,c){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_MAPPING,key:"bulk_create_thread_backend."+(a!=null?a:"unknown")});var e=function(c,e){d("MAWCreateUpdateThreadUtils").maybeSendMICPoint(a,c,b==null?void 0:b.fromClientId,e)};d("MAWCreateUpdateThreadUtils").sendBridgeQPLPoint("lla_start",b==null?void 0:b.bridgeQPLInstanceKey,{toClientId:b==null?void 0:b.fromClientId});e("bulk_create_thread_start",{"int":{thread_mapping_unique_threads:c}})}function q(a){return a.map(function(a){return{authoritativeThreadKey:a.authoritativeThreadKey,description:"bulkCreateThread",instanceKey:a.instanceKey,jid:a.chatJid,lastActivityTimestamp:d("WATimeUtils").castToMillisTime(a.lastActivityTimestampMs),lastReadWatermarkTimestamp:d("WATimeUtils").castToMillisTime(a.lastReadWatermarkTimestampMs)}})}g.bulkMaybeCreateOrUpdateThread=a}),98);
__d("MAWCancelDownloadMediaForUI",["MAWMediaManager"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MAWMediaManager").getMawMediaManager().dequeueDownload(a)}g.cancelDownloadMediaForUI=a}),98);
__d("MAWChangeSecurityAlertSettingApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE},"changeSecurityAlertSetting",function(a){return function(b){return d("MAWDbMsgTypeVersionTxns").updateSecurityAlertValueForContact(a,b)}});g.changeSecurityAlertSetting=a}),98);
__d("MAWChangeSecurityAlertSettingForSelfApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE},"changeSecurityAlertSettingForSelf",function(a){return function(b){return d("MAWDbMsgTypeVersionTxns").updateSecurityAlertValueForSelf(a,b)}});g.changeSecurityAlertSettingForSelf=a}),98);
__d("MAWCompleteUndoThreadCutoverApi",["MAWAdminWriteCutoverThreadMsgTxn","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["UpdateAdminMessageAfterUndoCutover failed to get the thread"]);h=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"completeUndoThreadCutover",function(a){return function(b){b=b.threadJid;return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h());return}b=b.value;if(b.isMigratedLocally===!0)return d("MAWDbThreadTxns").markCutoverThreadAsNotMigratedLocally(a,b).then(function(b){return d("MAWAdminWriteCutoverThreadMsgTxn").revertCutoverThreadAdminMsg(a,b).then(function(){return d("MAWAdminWriteCutoverThreadMsgTxn").writeRollbackCutoverAdminMsg(a,b)})})})}});g.completeUndoThreadCutover=b}),98);
__d("MAWConvertEchoMessagesToMsgStanzas",["MAWHandleEBRestoreWithHIM"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWHandleEBRestoreWithHIM").convertEchoMessages(a,b)}g.convertEchoMessagesToMsgStanzas=a}),98);
__d("MAWCreateOrUpdateThreadApi",["MAWBridgeThread","MAWIndexedDb","MAWJids","MAWThreadManagementTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,reactions:a.READONLY,threads:a.READWRITE},"createOrUpdateThread",function(a){return function(b){var c=b.contactFbid,e=b.description,f=b.s2sInstanceKey;b=b.threadKey;return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{description:e,offlineThreadingId:b,skipVerifyThread:!0,userJid:d("MAWJids").toUserJid(c)},f).then(function(a){var b=a.created;a=a.thread;return{clientThreadKey:a.optimisticThreadKey,created:b,folder:a.folder,jid:a.jid,lastActivityTs:d("MAWBridgeThread").getLastActivityTs(a.snippetMsgTs,a.newestMsgTs)}})}});g.createOrUpdateThread=b}),98);
__d("MAWCreateThreadApi__DO_NOT_USE__HOLDOUT_ONLY",["MAWIndexedDb","MAWJids","MAWThreadManagementTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,reactions:a.READONLY,threads:a.READWRITE},"createThread",function(a){return function(b,c,e,f,g){return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{description:e,offlineThreadingId:c,skipVerifyThread:!1,userJid:d("MAWJids").toUserJid(b)},f,g).then(function(a){var b=a.created;a=a.thread;return{created:b,jid:a.jid}})}});g.createThread__DO_NOT_USE__HOLDOUT_ONLY=b}),98);
__d("MAWDeleteMediaChunks_FOR_TESTING_ONLY",["MAWIndexedDb","MAWMediaUtils","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READWRITE},"deleteMediaChunks_FOR_TESTING_ONLY",function(a){return function(b){b=b.map(d("MAWMediaUtils").genHMACPlaintextHash);return a.chunk.where("hashedPlaintextHash").anyOf(b)["delete"]().then(function(){})}});g.deleteMediaChunks_FOR_TESTING_ONLY=a}),98);
__d("MAWDeleteThreadApi",["FBLogger","MAWIndexedDb","MAWThreadManagementTxns","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted thread ",""]);h=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READWRITE,deletedMessages:a.READWRITE,groupInfo:a.READWRITE,groupInvites:a.READWRITE,media:a.READWRITE,messages:a.READWRITE,participants:a.READWRITE,pendingStanzas:a.READWRITE,reactions:a.READWRITE,threads:a.READWRITE,unrenderedMessages:a.READWRITE},"deleteThread",function(a){return function(b){return a.threads.get({jid:b}).then(function(e){if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("There was no thread to delete in local delete thread");return d("MAWThreadManagementTxns").deleteAllThreadData(a,e).then(function(){d("WALogger").LOG(h(),b)})})}});g.deleteThread=b}),98);
__d("MAWGetProtocolMsgIdByMediaMsgId",["MAWIndexedDb","MAWTransactionMode","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getProtocolMsgIdByMediaMsgId",function(a){return function(b){return a.messages.get({msgId:b}).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(b.author)?null:{author:b.author,chat:a.jid,externalId:b.externalId}})})}});g.getProtocolMsgIdByMediaMsgId=a}),98);
__d("MAWDownloadMediaForUI",["MAWDownloadAndHandleMedia","MAWGetMediaApi","MAWGetProtocolMsgIdByMediaMsgId","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaManager","MAWMpsGating","MWFBLogger","Promise","WAErrorMessage","WAFindMostRecentMediaEntry","WAHashUtils","WAMediaManager","WAPromiseManagement","WAResultOrError","WAStartMediaDownloadQplFlow","asyncToGeneratorRuntime","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadMediaForUILayout success"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["download media with "," errors: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["download media with "," runtime error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot find media with ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadMediaForUILayout: args.type is not plaintextHash"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["start downloadMediaForUILayout. ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Runtime error"]);o=function(){return a};return a}var p=d("MWFBLogger").MWMediaLogger.tags(["downloadMediaForUI"]);function a(a){return(h||(h=b("Promise"))).all(a.media.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield q(a));return{arg:a,result:b}});return function(b){return a.apply(this,arguments)}}()))}function q(a){return r(a)["catch"](function(a){p.catching(a).MUSTFIX(o());return d("WAResultOrError").makeError("runtime-error")})}var r=d("WAPromiseManagement").cacheWhilePending(function(a){var b;switch(a.type){case"mediaId":return"mediaId-"+a.mediaId.toString()+"-"+((b=a.downloadType)!=null?b:"fullsizeAndPreview");case"xmaId":return"xmaId-"+a.xmaId.toString();default:a.type;return"plaintextHash-"+a.plaintextHash+"-"+((b=a.downloadType)!=null?b:"fullsizeAndPreview")}},e);function e(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=v(a);p.DEBUG(n(),e);if(d("MAWMpsGating").isFullMpsEnabled()){var f=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"UILayout",msgType:null,protocolMsgId:null,triggerUIView:a.triggerUIView});if(a.type!=="plaintextHash"){p.MUSTFIX(m());return d("WAResultOrError").makeError("missing-media")}var g=a.plaintextHash;d("MAWDownloadAndHandleMedia").sendUIStatusDownloading(g,"download_and_handle_media");d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"download_and_handle_media",hash:g,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main"});var o=d("MAWMediaManager").getMawMediaManager().enqueueDownloadFullSizeAndPreview({fullSizePlaintextHash:g,mediaDownloadFlow:f,priority:d("WAMediaManager").MediaTaskPriority.HIGH}),q=o.fullsizePromise;o=o.previewPromise;void o.then(function(){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"handle_media_download_success",hash:g,status:c("MAWMediaDownloadStatus").SUCCESS,type:"preview"})});o=(yield q);if(o.success===!1){f.endFail("handle_media_download_fail",{string:{failReason:o.payload==null?o.error:d("WAErrorMessage").maybeGetMessageFromError(o.payload)}});d("MAWDownloadAndHandleMedia").sendUIStatusFailure(g,o.error);return d("WAResultOrError").makeError("runtime-error")}f.addPoint("handle_media_download_end");f.endSuccess();d("MAWDownloadAndHandleMedia").sendUIStatusSuccess(g,o.value.validatedResult);return d("WAResultOrError").makeResult()}var r;switch(a.type){case"xmaId":r=(yield d("MAWGetMediaApi").getMediaByXMAId(a.xmaId).then(function(a){return a.filter(Boolean)}));break;case"mediaId":r=(yield d("MAWGetMediaApi").getMediaByMediaId(a.mediaId).then(function(a){return a==null?[]:[{media:a}]}));break;default:a.type;r=(yield d("MAWGetMediaApi").getMediaByPlaintextHash(a.plaintextHash).then(function(a){return a==null?[]:[{media:a}]}));break}if(r.length===0){p.MUSTFIX(l(),e);return d("WAResultOrError").makeError("missing-media")}q=(yield (h||(h=b("Promise"))).all(r.map(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f,g=b.media;f=(f=a.xmaMediaType)!=null?f:b.xmaMediaType;try{b=(yield t(g));if(!b.success)return b;b=b.value;var h="UILayout";f=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:h,msgType:a.msgType,protocolMsgId:b,triggerUIView:a.triggerUIView,xmaMediaType:f});yield d("MAWDownloadAndHandleMedia").downloadAndHandleMediaImpl({downloadEntry:h,downloadType:a.downloadType,hash:g.plaintextHash,mediaDownloadFlow:f,msgType:a.msgType,protocolMsgId:b});return d("WAResultOrError").makeResult()}catch(a){p.catching(c("getErrorSafe")(a)).MUSTFIX(k(),e);return d("WAResultOrError").makeError("runtime-error")}});return function(a){return f.apply(this,arguments)}}())));f=q.filter(function(a){return!a.success});if(f.length>0){p.MUSTFIX(j(),e,f.map(function(a){return a.error}).toString());return f[0]}else{p.DEBUG(i());return d("WAResultOrError").makeResult()}});return s.apply(this,arguments)}function t(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAFindMostRecentMediaEntry").findMostRecentMediaEntry(a.mediaEntries);if(!a.success)return a;a=a.value;var b=a[0];a[1];a=(yield d("MAWGetProtocolMsgIdByMediaMsgId").getProtocolMsgIdByMediaMsgId(b));return a==null?d("WAResultOrError").makeError("no-protocol-msg-id"):d("WAResultOrError").makeResult(a)});return u.apply(this,arguments)}function v(a){switch(a.type){case"mediaId":return"mediaId: "+a.mediaId.toString();case"xmaId":return"xmaId: "+a.xmaId.toString();default:a.type;return"plaintextHash: "+d("WAHashUtils").sanitisePlaintextHash(a.plaintextHash)}}g.bulkDownloadMediaForUI=a;g.downloadMediaForUI=q;g.getMostRecentProtocolMsgId=t}),98);
__d("MAWDyiDownloadMedia",["MAWHandleMediaPreviewBeforeDownloadApi","MAWHandleMediaPreviewDownloadApi","MAWHandleMediaPreviewDownloadAsFailedApi","MAWUpdateMediaEntryForMsgApi","WAAPI","WAStartMediaDownloadQplFlow","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"MAWDyiDownloadMedia",msgType:null,protocolMsgId:a,triggerUIView:null});b=(yield c("WAAPI").downloadMedia({downloadMediaMetric:f,handleMediaPreviewBeforeDownload:d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload,handleMediaPreviewDownload:d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload,handleMediaPreviewDownloadFailed:d("MAWHandleMediaPreviewDownloadAsFailedApi").handleMediaPreviewDownloadFailed,hash:b,mediaEntry:e,protocolMsgId:a,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg}));b.success===!1?f.endFail(b.error):f.endSuccess();return b});return h.apply(this,arguments)}g.dyiDownloadMedia=a}),98);
__d("MAWFTSEBMessagesDataSync",["FBLogger","I64","MAWBridge","MAWDbFTSManifest","MAWFTSIndexedDb","MAWFTSWorker","MAWTransactionMode","MAWVault","Promise","asyncToGeneratorRuntime","err","isMAWUniversalSearchWithEBEnabled","justknobx","promiseDone","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(a=c("justknobx"))._("2645"),m=a._("2606")+a._("2646"),n=a._("2647"),o=[],p=new Map(),q=[];function r(a){var b;o=o.filter(function(b){return b.tabId!==a});q=q.filter(function(b){return b!==a});if(!p.has(a))return;window.clearTimeout((b=p.get(a))==null?void 0:b.aliveTimeout);(b=p.get(a))==null?void 0:(b=b.ongoingTask)==null?void 0:b.reject(c("err")("Tab is closed"));p["delete"](a)}function s(a,b){var c=window.setTimeout(function(){r(a)},n),d=p.get(a);b&&t(a);if(d!=null){window.clearTimeout(d.aliveTimeout);d.aliveTimeout=c;return}p.set(a,{aliveTimeout:c,ongoingTask:null})}e=function(a){var c=a.hasFocus;a=a.tabId;s(a,c);return(k||(k=b("Promise"))).resolve()};f=function(a){a=a.tabId;r(a);return(k||(k=b("Promise"))).resolve()};function t(a){if(q.length>0&&q[0]===a)return;q=[a].concat(q.filter(function(b){return b!==a}))}a=function(a){a=a.tabId;s(a,!0);return(k||(k=b("Promise"))).resolve()};function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var d=p.get(a);if(d==null)return;var e=new(k||(k=b("Promise")))(function(a,b){d.ongoingTask={reject:b,resolve:a}});try{yield (k||(k=b("Promise"))).race([e,new k(function(a,b){window.setTimeout(function(){b(c("err")("Task timeout"))},m)})])}catch(a){c("FBLogger")("fts_worker").mustfix("Failed to restore FTS index for tab %s",a.message)}finally{e=p.get(a);e!=null&&(e.ongoingTask=null);o=o.filter(function(b){return b.tabId!==a})}});return v.apply(this,arguments)}var w=function(a){var e=a.tabId,f=a.threadJid;if(!d("MAWFTSWorker").isFTSInitiated())return(k||(k=b("Promise"))).resolve(!1);if(o.length>=l)return(k||(k=b("Promise"))).resolve(!1);if(!q.slice(0,l).includes(e))return(k||(k=b("Promise"))).resolve(!1);if(o.some(function(a){return a.threadJid===f}))return(k||(k=b("Promise"))).resolve(!1);o.push({tabId:e,threadJid:f});c("promiseDone")(u(e));return(k||(k=b("Promise"))).resolve(!0)},x=function(a){var c=a.error;a=a.tabId;if(c==null){var d;(d=p.get(a))==null?void 0:(d=d.ongoingTask)==null?void 0:d.resolve()}else{(d=p.get(a))==null?void 0:(a=d.ongoingTask)==null?void 0:a.reject(c)}return(k||(k=b("Promise"))).resolve()},y=(i=d("MAWFTSIndexedDb")).makeMsgrFTSTransactor({ftsRestoreStatus:(j=d("MAWTransactionMode")).READWRITE},function(a){return function(b,c){return a.ftsRestoreStatus.get(b).then(function(e){var f;if(e!=null&&(h||(h=d("I64"))).lt((h||(h=d("I64"))).of_string(e.restoredUntilSortOrderMs),(h||(h=d("I64"))).of_string(c)))return;e=(f=(f=e==null?void 0:e.maxRestoredUntilSortOrderMs)!=null?f:e==null?void 0:e.restoredUntilSortOrderMs)!=null?f:c;return a.ftsRestoreStatus.put({maxRestoredUntilSortOrderMs:e,restoredUntilSortOrderMs:c,threadId:b})})}}),z=i.makeMsgrFTSTransactor({ftsRestoreStatus:j.READWRITE},function(a){return function(b){return a.ftsRestoreStatus.get(b)}}),A=i.makeMsgrFTSTransactor({ftsRestoreStatus:j.READWRITE},function(a){return function(b){return a.ftsRestoreStatus["delete"](b)}}),B=i.makeMsgrFTSTransactor({ftsManifest:j.READWRITE},function(a){return function(){return a.ftsManifest.get(d("MAWDbFTSManifest").ManifestKeys.CURR_VERSION).then(function(b){if(b!=null){if(b.restoreSessionId!=null)return b.restoreSessionId;var e=c("uuidv4")();return a.ftsManifest.update(d("MAWDbFTSManifest").ManifestKeys.CURR_VERSION,{restoreSessionId:e}).then(function(){return e})}return""})}}),C=i.makeMsgrFTSTransactor({ftsRestoreStatus:j.READWRITE},function(a){return function(){return a.ftsRestoreStatus.toCollection().toArray()}}),D=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.newSortOrderMs,e=a.threadId;a=a.unvaultedBridgeSearchMessages;var f=d("MAWFTSWorker").getFTSWorker(),g=a.map(function(a){var b;b=(b=a.msg)==null?void 0:b.content;return b==null?null:{chatId:e,id:a.externalId,textFragments:[d("MAWVault").isVaulted(b)?d("MAWVault").unvault(b):b],timestamp:a.sortOrderMs}}).filter(Boolean),h;c("isMAWUniversalSearchWithEBEnabled")()&&(h=(yield f.getExistingMessageIdsInIndex(a.map(function(a){return a.externalId}))));f.setEphemeralBacklog(g);yield f.index({estimatedNumMessages:g.length,type:"EB"});yield y(e,b);d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"AddMessageSearchResult",value:h!=null?a.filter(function(a){return!h.has(a.externalId)}):a}]})});return function(b){return a.apply(this,arguments)}}(),E=i.makeMsgrFTSTransactor({mediaRestoreStatus:j.READWRITE},function(a){return function(b){return a.mediaRestoreStatus.get(b)}}),F=i.makeMsgrFTSTransactor({mediaRestoreStatus:j.READWRITE},function(a){return function(b,c){return a.mediaRestoreStatus.get(b).then(function(e){var f;if(e!=null&&(h||(h=d("I64"))).lt((h||(h=d("I64"))).of_string(e.restoredUntilSortOrderMs),(h||(h=d("I64"))).of_string(c)))return;e=(f=(f=e==null?void 0:e.maxRestoredUntilSortOrderMs)!=null?f:e==null?void 0:e.restoredUntilSortOrderMs)!=null?f:c;return a.mediaRestoreStatus.put({maxRestoredUntilSortOrderMs:e,restoredUntilSortOrderMs:c,threadId:b})})}});i=function(){return B()};j=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.threadId;a=(yield z(a));return(a=a==null?void 0:a.restoredUntilSortOrderMs)!=null?a:null});return function(b){return a.apply(this,arguments)}}();var G=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.newSortOrderMs;a=a.threadId;yield y(a,b)});return function(b){return a.apply(this,arguments)}}(),H=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.threadId;a=(yield z(a));return a});return function(b){return a.apply(this,arguments)}}(),I=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.threadId;yield A(a)});return function(b){return a.apply(this,arguments)}}(),J=function(){return C()},K=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.threadId;a=(yield E(a));return a});return function(b){return a.apply(this,arguments)}}(),L=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.newSortOrderMs;a=a.threadId;yield F(a,b)});return function(b){return a.apply(this,arguments)}}(),M=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.threadId;a=(yield E(a));return(a=a==null?void 0:a.restoredUntilSortOrderMs)!=null?a:null});return function(b){return a.apply(this,arguments)}}();g.searchFTSReportTabAlive=e;g.searchFTSReportTabDestroy=f;g.searchFTSReportTabForeground=a;g.searchFTSRequestRestoreTask=w;g.searchFTSReportTabTaskComplete=x;g.searchIndexUpdate=D;g.searchGetFTSRestoreSessionId=i;g.searchGetFTSNextTimestamp=j;g.searchSetFTSNextTimestamp=G;g.searchFTSGetThreadRestoreStatus=H;g.searchFTSClearThreadRestoreStatus=I;g.searchFTSGetThreadsRestoreStatus=J;g.getThreadMediaRestoreStatus=K;g.setThreadMediaRestoreStatus=L;g.getMediaRestoreNextTimestamp=M}),98);
__d("MAWFTSIssueGraphQLRangeRestoreRequest",["CurrentUser","EBAPI","MAWEBUnstoredDbMsgUtils","MAWJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,e,f){if(a.protobufMessages!=null){f=d("MAWEBUnstoredDbMsgUtils").getUnstoredDbMsgFromProtobuf(a.protobufMessages,void 0,e,f);return{hasMoreAfter:a.hasMoreAfter,hasMoreBefore:a.hasMoreBefore,isPointQuery:!1,messages:f,nextMessageTimestampMsBefore:a.nextMessageTimestampMsBefore!=null?a.nextMessageTimestampMsBefore:void 0,protobufMessages:a.protobufMessages,referenceTimestamp:a.referenceTimestamp!=null?a.referenceTimestamp:void 0,requestId:c,restoreType:"protobuf",threadId:b}}else if(a.echoMessages!=null){f=d("MAWEBUnstoredDbMsgUtils").getUnstoredDbMsgFromEcho(a.echoMessages,e);return{echoMessages:a.echoMessages,hasMoreAfter:a.hasMoreAfter,hasMoreBefore:a.hasMoreBefore,isPointQuery:!1,messages:f,nextMessageTimestampMsBefore:a.nextMessageTimestampMsBefore!=null?a.nextMessageTimestampMsBefore:void 0,referenceTimestamp:a.referenceTimestamp!=null?a.referenceTimestamp:void 0,requestId:c,restoreType:"echo",threadId:b}}else return void 0}function a(a,b,c,d,e,f,g){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,i,j){b=(yield c("EBAPI").messageRangeQueryForIndexing({chatJid:a,direction:b,numMessages:j,sortOrderMs:e,source:f,traceId:g}));if(b.success){j=b.value;e=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());f=h(j,i,g,a,e);if(f==null)return{error:"No echo message or protobuf payload returned from EB API for range restore"};else return{loadMessagesResponse:f}}else{j=b.error;return{error:j}}});return i.apply(this,arguments)}g.issueGraphQLRangeRestoreRequest=a}),98);
__d("MAWGetDownloadableThumbnailForMediaApi",["MAWOptimisticUploadManager","WALogger","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetDownloadableThumbnail - previewEntry optimistedPromise rejected with ",""]);h=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(a==null)return null;a=a.previewPlaintextHash;if(a==null)return null;a=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(a==null)return null;a=(yield (a=a.optimisticUploadPromise)==null?void 0:a["catch"](function(a){d("WALogger").ERROR(h(),a);return d("WAResultOrError").makeError("runtime-error")}));if(a==null||a.success!==!0)return null;a=a.value;var b=a.directPath,c=a.fileEncSha256,e=a.fileSha256,f=a.mediaKey,g=a.mediaKeyTimestamp;a=a.objectId;return{directPath:b,fileEncSha256:c,fileSha256:e,mediaKey:f,mediaKeyTimestamp:g,objectId:a}});return function(b){return a.apply(this,arguments)}}();g.getDownloadableThumbnailForMedia=a}),98);
__d("MAWGetMediaPlaintextApi",["MAWIndexedDb","MAWMediaUtils","MAWOptimisticUploadManager","MAWTransactionMode","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media blob does not exist for the given hashedPlaintextHash"]);i=function(){return a};return a}a=function(a){var c=d("MAWOptimisticUploadManager").getOptimisticUploadManager();c=c.get(a);if(c==null)return j(a);else return(h||(h=b("Promise"))).resolve(c.file)};function j(a){return d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY},"getMediaPlaintextFromDb",function(a){return function(b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.where("hashedPlaintextHash").equals(b).first().then(function(a){if(!a){d("WALogger").WARN(i());return null}return new Blob([a.blobData],{type:a.mimetype})})}})(a)}g.getMediaPlaintext=a}),98);
__d("MAWGetMediaKnownEntriesApi",["MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","MWFBLogger","WAHashUtils","WAJids","WAMsgMap","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message missing in messages table for given msgId for plaintextHash ",". Skipping..."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."]);i=function(){return a};return a}var j=d("MWFBLogger").MWMediaLogger.tags(["GetMediaKnownEntries"]);a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return k(a,b)}});function k(a,b){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b).then(function(c){if(!c){j.DEBUG(i(),d("WAHashUtils").sanitisePlaintextHash(b));return d("WAResultOrError").makeError("no-media-entry-by-plaintext-hash")}var e=Array.from(c.mediaEntries.keys());return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWDbMsgTxns").maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING(a,b)})).then(function(a){a=a.map(function(a){return a.find(function(a){return(a==null?void 0:a.mediaId)===c.mediaId})});var f=[];a=a.reduce(function(a,g,i){if(!g){j.WARN(h(),d("WAHashUtils").sanitisePlaintextHash(b));f.push(e[i]);return a}i=c.mediaEntries.get(g.msgId);var k=g.author,l=g.threadJid;i&&!d("WAJids").isAuthorSystem(k)&&l!=null&&a.set({author:k,chat:l,externalId:g.externalId},i);return a},new(d("WAMsgMap").MsgMap)());return{missingMessages:f,msgMap:a,numEntries:e.length}}).then(d("WAResultOrError").makeResult)})}g.getMediaKnownEntries=a;g.getMediaKnownEntriesTxn=k}),98);
__d("MAWGetOrCreateMediaKnownEntriesApi",["MAWGetMediaKnownEntriesApi","MAWIndexedDb","MAWTransactionMode","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getOrCreateMediaKnownEntries",function(a){return function(b){return d("MAWGetMediaKnownEntriesApi").getMediaKnownEntriesTxn(a,b).then(function(a){if(a.success===!1)return new(d("WAMsgMap").MsgMap)();else return a.value.msgMap})}});g.getOrCreateMediaKnownEntries=a}),98);
__d("MAWMsgUtil",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"updateSystemAckWithTxn",function(a){return function(b,e){return d("MAWDbMsgTxns").updateSystemAck(a,b,e).then(c("emptyFunction"))}});g.updateSystemAckWithTxn=b}),98);
__d("MAWStartMediaUploadQplFlow",["WAGetStorageQplAnnotations","WAJids","WAMediaQplHelper","WAPREList","WAPREMetrics","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chatJid,e=a.fileSize,f=a.serverMediaType;a=a.uploadEntry;var g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_UPLOAD,{string:{chat_type:d("WAJids").switchOnMsgrChatJidType(b,{group:function(){return"group"},user:function(){return"user"}}),jid:b,media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(e),media_type:f,upload_entry:a}},void 0);c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){g.addAnnotations(a)}));return g}g.startMediaUploadQplFlow=a}),98);
__d("getProtocolMsgIdByMsgIdCommon",["MAWDexieTable","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDexieTable").dexieAll([a.messages.get({msgId:b}),a.unrenderedMessages.get({msgId:b}),a.reactions.get({reactionId:b})]).then(function(b){var c=b[0],e=b[1];b=b[2];if(b!=null)if(d("WAJids").isAuthorSystem(b.author))return null;else return{author:b.author,chat:b.threadJid,externalId:b.externalId};var f=c||e;return f==null?null:a.threads.get({jid:f.threadJid}).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(f.author)?null:{author:f.author,chat:a.jid,externalId:f.externalId}})})}g.getProtocolMsgIdByMsgIdCommon=a}),98);
__d("MAWGetProtocolMsgIdByMsgId",["MAWIndexedDb","MAWTransactionMode","getProtocolMsgIdByMsgIdCommon"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getProtocolMsgByMsgId",function(a){return function(b){return d("getProtocolMsgIdByMsgIdCommon").getProtocolMsgIdByMsgIdCommon(a,b)}});g.getProtocolMsgIdByMsgId=b}),98);
__d("MAWUpdateMediaEntryForOptimisticUploadApi",["FBLogger","MAWGetProtocolMsgIdByMsgId","MAWOptimisticUploadManager","MAWUpdateMediaEntryForMsgApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),h=g.get(a),i=h==null?void 0:h.msgId,j=b();if(i!=null){i=(yield d("MAWGetProtocolMsgIdByMsgId").getProtocolMsgIdByMsgId(i));i&&(yield d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg(a,i,b,e,f))}else{if(!h)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot update mediaEntry without both uploadEntry and msgId");g.set(a,babelHelpers["extends"]({},h,{mediaEntry:j}))}return});return function(b,c,d,e){return a.apply(this,arguments)}}();g.updateMediaEntryForOptimisticUpload=a}),98);
__d("MAWWriteForwardedMsgApi",["FBLogger","MAWAckLevel","MAWBridgeTypesCreators","MAWDbMsg","MAWDbMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWJidUtils","MAWMediaAfterTxns","MAWMediaManagementTxns","MAWMediaUtils","MAWMsgType","MAWQplProxy","MAWTransactionMode","MAWWriteMsgTxns","MAWXMAManagementTxns","MAWXMAUtils","WAJids","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,threads:a.READWRITE,xma:a.READWRITE},"writeForwardedMsg",function(a){return function(b){var c=b.chatJid,e=b.ephemeralSetting,f=b.externalId,g=b.isFirstMsg,k=b.mediaGroupMetadata,l=b.openMessageParticipantCount,m=b.participantCount,n=b.protocolMsgId,o=b.qplEventType,p=b.qplInstanceKey,q=b.textWithSubstitutions,r=b.ts;return d("MAWDexieTable").dexieAll([a.threads.get({jid:c}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,n),a.messages.where("externalId").equals(f).toArray()]).then(function(b){var c=b[0],s=b[1];b=b[2];if(c==null)return{type:"missing_thread"};if(s==null)return{type:"missing_msg"};if(s.ephemeralSetting!=null&&s.ephemeralSetting.ephemeralExpirationInSec!==0)return{type:"forwarding_ephemeral_msg"};b=b.find(function(a){return a.threadJid===c.jid&&a.author===d("WAJids").AUTHOR_ME});if(b!=null)return b.ack>=d("MAWAckLevel").ACK.sent?{msgId:b.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:c.jid,externalId:b.externalId},type:"already_sent"}:{msgId:b.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:c.jid,externalId:b.externalId},type:"not_sent"};else{b={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:e!=null?e:void 0,externalId:f,forwardingScore:((b=s.forwardingScore)!=null?b:0)+1,groupId:k==null?void 0:k.groupId,groupIndex:k==null?void 0:k.groupIndex,groupSize:k==null?void 0:k.groupSize,hdType:s.hdType,isForwarded:s.author!==d("WAJids").AUTHOR_ME,mediaId:s.mediaId,msgContent:s.type==="Text"||s.type==="XMA"?s.msgContent:void 0,specialTextSize:s.specialTextSize,threadJid:c.jid,ts:r};var t=h(s.type,b,s.type==="Text"?s.msgContent:{content:""},s.xmaMessageType,q);return d("MAWWriteMsgTxns").writeMsg(a,t,c,{isFirstMsg:g,openMessageParticipantCount:l,participantCount:m}).then(function(b){return d("MAWDexieTable").dexieAll([j(a,n,b,s,c.jid,o,p),i(a,s.mediaId,b,s,c.jid)]).then(function(a){return{msgId:b.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:c.jid,externalId:t.externalId},type:"not_sent"}})})}})}});function h(a,b,e,f,g){switch(a){case"Text":return babelHelpers["extends"]({},b,{msgContent:g!=null?{content:g}:e,type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.IMAGE});case"Video":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("XMA type is null in forward msg");return babelHelpers["extends"]({},b,{msgContent:g!=null?{content:g}:b.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:f});default:throw c("FBLogger")("messenger_web").mustfixThrow("Should not be forwarding a message of type: "+a)}}function i(a,b,e,f,g){f=b!=null?a.media.get({mediaId:b}):d("MAWDexieTable").dexieResolve(null);return f.then(function(b){if(b==null&&d("MAWDbMsg").isMediaMsg(e))throw c("FBLogger")("messenger_web").mustfixThrow("Could not find media of forwarded message");return b!=null?d("MAWMediaManagementTxns").linkMedia(a,e,b.plaintextHash,b.mediaType,b.size,null,{validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:b.validatedDocumentFileInfo,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},null,null,!1).then(function(b){if(b!=null)return a.messages.where("msgId").anyOf(b.msgIds).toArray().then(function(c){var e=d("MAWMediaUtils").createHdTypesForBridgeMedia(c);c=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:g,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(c,g),hasMediaForUI:!0,hdTypes:e,media:b});d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(a,c)})}):d("MAWDexieTable").dexieResolve()})}function j(a,b,e,f,g,h,i){var j=c("gkx")("9841")?f.type===d("MAWMsgType").MSG_TYPE.XMA:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(f.xmaMessageType);if(!j)return d("MAWDexieTable").dexieResolve();d("MAWQplProxy").sendQPLAnnotationsThroughBridge(h,{"int":{xma_message_type:f.xmaMessageType}},i);return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null)return;var h=b.defaultPreviewMediaId,i=b.faviconMediaId,j=b.headerMediaId,k=Array.from(new Set([h,i,j].filter(Boolean)));k=k.map(function(b){return a.media.get(b).then(function(a){if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Could not find media of forwarded xma message");return a})});return d("MAWDexieTable").dexieAll(k).then(function(k){k=k.map(function(b){return d("MAWMediaManagementTxns").linkMedia(a,e,b.plaintextHash,b.mediaType,b.size,b.mediaEntries.get(f.msgId),{validatedAudioInfo:b.validatedAudioInfo,validatedDocumentFileInfo:null,validatedImageInfo:b.validatedImageInfo,validatedVideoInfo:b.validatedVideoInfo},void 0,void 0,!0)});return d("MAWDexieTable").dexieAll(k).then(function(k){k=k.reduce(function(a,b){return a.set(b.mediaId,b)},new Map());var l=h==null?void 0:k.get(h);k=d("MAWXMAUtils").isXMAExternalLinkShare(f.xmaMessageType)||d("MAWXMAUtils").isReceiverFetchXMA(f.xmaMessageType);if(h==null&&!k)throw c("FBLogger")("messenger_web").mustfixThrow("Preview Media is missing");k=d("MAWJidUtils").maybeToProtocolMsgId(e.author,g,e.externalId);if(k==null)throw c("FBLogger")("messenger_web").mustfixThrow("ProtocolMsgId is null for forward XMA Share");d("MAWDexieTable").dexieResolve();return d("MAWXMAManagementTxns").saveXMA(a,h,j,i,b.targetType,e.msgId,void 0,k,{contentRef:b.contentRef,ctas:c("justknobx")._("3349")?b.ctas:void 0,defaultCTA:b.defaultCTA,headerTitle:b.headerTitle,maxSubtitleNumOfLines:b.maxSubtitleNumOfLines,maxTitleNumOfLines:b.maxTitleNumOfLines,overlayDescription:b.overlayDescription,overlayIconGlyph:b.overlayIconGlyph,overlayTitle:b.overlayTitle,subtitleText:b.subtitleText,targetExpiringAtSec:b.targetExpiringAtSec,targetId:b.targetId,targetUsername:b.targetUsername,titleText:b.titleText,xmaLayoutType:b.xmaLayoutType},void 0,b.defaultPreviewMediaPlaintextHash,b.headerMediaPlaintextHash,b.faviconPlaintextHash).then(function(b){k=d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(a,b,l);return k.then(function(){return})})})})})}g.writeForwardedMsg=b}),98);
__d("MAWForwardMsg",["FBLogger","MAWAckLevel","MAWDbMedia","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbXMATxns","MAWDownloadAndHandleMedia","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetOrCreateMediaKnownEntriesApi","MAWIndexedDb","MAWMediaManager","MAWMediaManagerUiIntegrationCheck","MAWMessageSendsCommon","MAWMpsGating","MAWMsgType","MAWMsgUtil","MAWProtobufDeserializers","MAWQplProxy","MAWSendWrittenMsg","MAWStartMediaUploadQplFlow","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWWriteForwardedMsgApi","MpsTypes","Promise","WAAPI","WAErrorMessage","WAFranking","WAGlobals","WAJids","WALogger","WAQPLProxy","WAResultOrError","WAStartMediaDownloadQplFlow","WebMps","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadMediaForForwardMsg: can't get serverMediaType. ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg: failed to upload media. ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg: media found for message, start media encrypt and upload"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot forward an ephemeral message"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot forward a non-existent message"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg cannot send to a non-existent thread"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg already sent message"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["forwardMsg: ",""]);p=function(){return a};return a}var q=function(a,b){return function(c){if(b==null)return;d("MAWQplProxy").sendQplPointThroughBridge(a,c,{instanceKey:b})}};function r(a,b){var c=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(a.toplevelProtobuf.payload);c=(c=c.encryptedTransportMessage())==null?void 0:c.proto;if(c==null)return null;a=d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid())===a.toplevelProtobuf.senderId;var e;b!=null&&(e={ephemeralExpiration:b.ephemeralExpirationInSec,ephemeralSettingTimestamp:b.ephemeralLastUpdatedOrSetTimestamp*1e3});return{metadata:babelHelpers["extends"]({},c.metadata,{chatEphemeralSetting:e,forwardingScore:((b=(b=c.metadata)==null?void 0:b.forwardingScore)!=null?b:0)+1,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),isForwarded:!a,quotedMessage:null}),payload:c.payload}}function s(a,b,c,d){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=a.args,h=a.chatJid,i=a.ephemeralSetting,s=a.externalId,t=a.protocolMsgId;a=a.textWithSubstitutions;d("WALogger").DEV(p(),h);var v=q(e,f);yield c("WAAPI").getDevicesBeforeSend({chatJid:h,reason:"ForwadMsg"});if(d("MAWMpsGating").isFullMpsEnabled()){var w=(yield d("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:"local-only"},debug:{purpose:"fetch-forwarded-message"},messageId:d("MpsTypes").toMessageId(t.externalId),threadId:d("MpsTypes").toThreadId(t.chat)})),x=w.value&&r(w.value,i);if(w.value==null||w.value.expiryTimestampMs!=null||x==null){c("FBLogger")("mps").mustfix("Original message not found for forwarding");return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-referenced-msg"})}w={author:d("WAJids").AUTHOR_ME,chat:h,externalId:s};w=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:w,referencedOriginalExternalId:s,type:"edit"},d("WAQPLProxy").waQPLProxyStartResume(e,f),"MAWSendEditMsg",{messageApplication:x}));if(w.success===!0)return d("WAResultOrError").makeResult({chatJid:h,content:g==null?void 0:g.content,ephemeralSetting:g==null?void 0:g.ephemeralSetting,externalId:s,initiatingSource:g==null?void 0:g.initiatingSource,messageType:"sendMsg",quote:g==null?void 0:g.quote,source:g==null?void 0:g.source,specialTextSize:g==null?void 0:g.specialTextSize,xmaMessageType:g==null?void 0:g.xmaMessageType});else return d("WAResultOrError").makeError(w.error)}x=(yield d("MAWWriteForwardedMsgApi").writeForwardedMsg({chatJid:h,ephemeralSetting:i,externalId:s,mediaGroupMetadata:g==null?void 0:g.mediaGroupMetadata,protocolMsgId:t,qplEventType:e,qplInstanceKey:f,textWithSubstitutions:a,ts:b}));if(x.type==="already_sent"){d("WALogger").LOG(o());return d("WAResultOrError").makeError({isRetriable:!1,type:"already-sent"})}else if(x.type==="missing_thread"){d("WALogger").LOG(n());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}else if(x.type==="missing_msg"){d("WALogger").LOG(m());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-referenced-msg"})}else if(x.type==="forwarding_ephemeral_msg"){d("WALogger").LOG(l());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-referenced-msg"})}v("forwarded_message_written");w=(yield d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY},"getMediaForForwardMsg",function(a){return function(){return d("MAWDbMsgTxns").maybeGetMsgResultByProtocolMsgId(a,t).then(function(b){if(!b.success)return b;var c=b.value;return b.value.type==="XMA"?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,t).then(function(a){if(a.success===!1)return d("WAResultOrError").makeError("missing-xma");return a.value==null||a.value.previews==null||a.value.previews.length===0?d("WAResultOrError").makeError("missing-xma-payload"):d("WAResultOrError").makeResult({media:a.value.previews[0],msg:c})}):d("MAWDbMediaTxns").getMediaFromMsgs(a,[c]).then(function(a){a=a[0];return a==null?d("WAResultOrError").makeError("missing-media"):d("WAResultOrError").makeResult({media:a,msg:c})})})}})());if(w.success){d("WALogger").LOG(k());i=w.value;a=i.media;b=i.msg;w=(yield u({forwardedMsg:{chatJid:h,protocolMsgId:x.protocolMsgId},originalMedia:a,originalMsg:b}));if(!w.success){d("WALogger").ERROR(j(),w.error);v("failed_upload_media_to_backend");yield d("MAWMsgUtil").updateSystemAckWithTxn(x.msgId,d("MAWAckLevel").ACK.failed);return d("WAResultOrError").makeError({isRetriable:!1,type:"media-error"})}}i=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:x.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(e,f),"MAWForwardMsg"));if(i.success===!0)return d("WAResultOrError").makeResult({chatJid:h,content:g==null?void 0:g.content,ephemeralSetting:g==null?void 0:g.ephemeralSetting,externalId:s,initiatingSource:g==null?void 0:g.initiatingSource,messageType:"sendMsg",quote:g==null?void 0:g.quote,source:g==null?void 0:g.source,specialTextSize:g==null?void 0:g.specialTextSize,xmaMessageType:g==null?void 0:g.xmaMessageType});else return d("WAResultOrError").makeError(i.error)});return t.apply(this,arguments)}function a(a){var b=a.args,c=a.qplEventType,e=a.qplInstanceKey;return d("MAWMessageSendsCommon").messageSendObserver(c,e,function(a){return s(b,a,c,e)},"msg",{author:d("WAJids").AUTHOR_ME,chat:b.chatJid,externalId:b.externalId})}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.forwardedMsg,f=a.originalMedia;a=a.originalMsg;var g=d("MAWDbMedia").getServerMediaType(f,a.msgId);if(g.success===!1){d("WALogger").ERROR(i(),g.error);return g}g=g.value;a=a.type==="XMA"&&g==="image"?"xma-image":g;g=d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:e.chatJid,fileSize:f.size,serverMediaType:a,uploadEntry:"forwardMediaMsg"});if(!d("MAWMediaManagerUiIntegrationCheck").getIsMediaManagerUiIntegrationEnabled()){var j;j=(yield c("WAAPI").uploadMedia({chatJid:e.chatJid,filename:(j=f.validatedDocumentFileInfo)==null?void 0:j.filename,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,hash:f.plaintextHash,mediaTypeDetails:{mediaType:a,type:"regular"},protocolMsgId:e.protocolMsgId,size:f.size,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:g}));return j}var k=(yield d("MAWGetMediaPlaintextApi").getMediaPlaintext(f.plaintextHash));if(k==null){j=(yield w(e.protocolMsgId,f));if(j.success===!1)return j;k=j.value}return c("WAAPI").uploadMedia({chatJid:e.chatJid,filename:(j=f.validatedDocumentFileInfo)==null?void 0:j.filename,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:function(){return(h||(h=b("Promise"))).resolve(k)},hash:f.plaintextHash,mediaTypeDetails:{mediaType:a,type:"regular"},protocolMsgId:e.protocolMsgId,size:f.size,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:g})});return v.apply(this,arguments)}function w(a,b){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c="ForwardMedia";a=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:c,msgType:d("MAWMsgType").MSG_TYPE.IMAGE,protocolMsgId:a,triggerUIView:null});b=(yield d("MAWMediaManager").getMawMediaManager().enqueueDownloadFullSize({fullSizePlaintextHash:b.plaintextHash,mediaDownloadFlow:a,priority:d("MAWDownloadAndHandleMedia").getPriorityFromDownloadEntry(c)}));if(b.success===!1){c=b.payload==null?b.error:d("WAErrorMessage").maybeGetMessageFromError(b.payload);a.endFail(b.error,{string:{failReason:c}});return d("WAResultOrError").makeError(c)}a.endSuccess();return d("WAResultOrError").makeResult(new Blob([b.value.validatedResult.validatedPlaintext],{type:(c=b.value.validatedResult.mimeType)!=null?c:b.value.unvalidatedMimeType}))});return x.apply(this,arguments)}g.forwardMsgFn=a}),98);
__d("MAWCreateMaybeAddPointForMediaRender",["MAWQplProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return function(b,e){if(a==null)return;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25302828,"2195"),b,{annotations:e,instanceKey:a},!0)}}g.createMaybeAddPointForMediaRender=a}),98);
__d("MAWGetBlobDataUrlByMediaIdApi",["FBLogger","MAWCreateMaybeAddPointForMediaRender","MAWDbChunkTxns","MAWDbMediaTxns","MAWIndexedDb","MAWLegacyMediaDownloadManager","MAWMaybeWithTimeout","MAWMediaManager","MAWMpsGating","MAWTransactionMode","Promise","WAAssertUnreachable","WAHashUtils","WALogger","WAMediaManager","WAResultOrError","WAStartMediaDownloadQplFlow","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getBlobDataUrlByPlaintextHashCall cannot find media or chunk with hash: ",", from ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["getBlobDataUrlByPlaintextHash cannot find chunk with hash: ",", from ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["getBlobDataUrlByMediaIdDbCall cannot find media with mediaId: ",", from ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["getBlobDataUrlByMediaIdDbCall cannot find chunk with mediaId: ",", from ",""]);l=function(){return a};return a}var m=c("gkx")("4307")?18e4:6e4;a=function(a,e,f){var g=d("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(f);g("fetch_blob_api_start",{string:{call_site:e,fetch_by:"mediaId"}});return n(a,e).then(function(f){if(f.success===!1)switch(f.error){case"missing_media":g("fetch_blob_api_fail_no_media_found");throw c("FBLogger")("messenger_web_media").mustfixThrow("Failed to getBlobDataUrlByMediaId because media is not in the media db. mediaId is %s, from %s",a,e);default:f;throw c("WAAssertUnreachable")(f.error)}f=f.value;var i=f.blob,j=f.media;if(i!=null){g("fetch_blob_api_success",{bool:{has_blob:i.size>0}});return i}g("fetch_blob_api_no_media_blob_found");return d("MAWMaybeWithTimeout").maybeWithTimeout(new(h||(h=b("Promise")))(function(a){g("fetch_blob_api_fetch_chunk_start"),d("MAWLegacyMediaDownloadManager").setToMediaDownloadManager(j.mediaId,a)}).then(function(a){g("fetch_blob_api_fetch_chunk_success");g("fetch_blob_api_success",{bool:{has_blob:a.size>0}});return a}),m,function(){g("fetch_blob_api_fetch_chunk_fail_timeout");d("WALogger").ERROR(l(),a,e);throw c("FBLogger")("messenger_web_media").mustfixThrow("Failed to getBlobDataUrlByMediaId in time. mediaId is %s, from %s",a,e)})})};var n=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY},"getBlobDataUrlByMediaId",function(a){return function(b,c){return a.media.get(b).then(function(e){if(e==null){d("WALogger").ERROR(k(),b,c);return d("WAResultOrError").makeError("missing_media")}return a.chunk.where("hashedPlaintextHash").equals(e.hashedPlaintextHash).first().then(function(a){return a==null?d("WAResultOrError").makeResult({blob:null,media:e}):d("WAResultOrError").makeResult({blob:new Blob([a.blobData],{type:a.mimetype}),media:e})})})}});e=function(a,b,c){return o(a,b,c)};var o=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=d("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(f);g("fetch_blob_api_start",{string:{call_site:e,fetch_by:"plaintextHash"}});if(d("MAWMpsGating").isFullMpsEnabled()){var i;f=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"UILayout",msgType:null,protocolMsgId:null,triggerUIView:null});f=(yield d("MAWMediaManager").getMawMediaManager().enqueueDownloadFullSize({fullSizePlaintextHash:a,mediaDownloadFlow:f,priority:d("WAMediaManager").MediaTaskPriority.HIGH}));if(!f.success){g("fetch_blob_api_fail_no_media_found");throw c("FBLogger")("messenger_web_media").mustfixThrow("Failed to getBlobDataUrlByPlaintextHash because hash is not in the media db. hash is %s, from %s",a,e)}f=f.value;var k=f.unvalidatedMimeType;f=f.validatedResult;i=(i=f.mimeType)!=null?i:k;k=new Blob([f.validatedPlaintext],{type:i});g("fetch_blob_api_success",{bool:{has_blob:k.size>0}});return k}return p(a,e).then(function(f){if(!f.success){g("fetch_blob_api_fail_no_media_found");throw c("FBLogger")("messenger_web_media").mustfixThrow("Failed to getBlobDataUrlByPlaintextHash because hash is not in the media db. hash is %s, from %s",a,e)}f=f.value;if(f.status==="found_media_and_blob"){g("fetch_blob_api_success",{bool:{has_blob:f.blob.size>0}});return f.blob}f.status;g("fetch_blob_api_no_media_blob_found");return d("MAWMaybeWithTimeout").maybeWithTimeout(new(h||(h=b("Promise")))(function(b){g("fetch_blob_api_fetch_chunk_start"),d("MAWLegacyMediaDownloadManager").setToMediaPlaintextDownloadManager(a,b)}).then(function(a){g("fetch_blob_api_fetch_chunk_success");g("fetch_blob_api_success",{bool:{has_blob:a.size>0}});return a}),m,function(){g("fetch_blob_api_fetch_chunk_fail_timeout");d("WALogger").ERROR(j(),d("WAHashUtils").sanitisePlaintextHash(a),e);throw c("FBLogger")("messenger_web_media").mustfixThrow("Failed to getBlobDataUrlByPlaintextHash in time. hash is %s, from "+e,a,e)})})});return function(b,c,d){return a.apply(this,arguments)}}(),p=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY},"getBlobDataUrlByPlaintextHash",function(a){return function(b,c){return d("MAWDbChunkTxns").maybeGetChunkByPlaintextHash(a,b).then(function(e){if(e!=null)return d("WAResultOrError").makeResult({blob:new Blob([e.blobData],{type:e.mimetype}),status:"found_media_and_blob"});else return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b).then(function(a){if(a!=null)return d("WAResultOrError").makeResult({media:a,status:"found_media_need_blob"});d("WALogger").ERROR(i(),d("WAHashUtils").sanitisePlaintextHash(b),c);return d("WAResultOrError").makeError("missing_media")})})}});g.getBlobDataUrlByMediaId=a;g.getBlobDataUrlByHashedPlaintextHash=e;g.getBlobDataUrlByPlaintextHash=o}),98);
__d("MAWGetDeviceChangeAlertsByOptionsApi",["MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE},"getDeviceChangeAlertsByOptions",function(a){return function(b){return d("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn(a,b)}});g.getDeviceChangeAlertsByOptions=a}),98);
__d("MAWGetGroupSuperAdminApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"getGroupSuperAdmin",function(a){return function(b){b=d("MAWDbParticipantTxns").getParticipantsInThread(a,b);return b.then(function(a){a=a.filter(function(a){return a.type==="superadmin"});if(a.length!==0&&a[0]){a=a[0];return d("WAJids").extractUserId(a.userJid)}else return null})}});g.getGroupSuperAdmin=a}),98);
__d("MAWGetLatestThreadIdsApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] getLatestThreadIds complete, threads count: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] getLatestThreadIds started"]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY},"getLatestThreadIds",function(a){return function(b){d("WALogger").LOG(i());b=a.threads.orderBy("threadOrder").reverse().limit(b).toArray();return b.then(function(a){var b=[];a.forEach(function(a){b.push(a.jid.split("@")[0])});d("WALogger").LOG(h(),b.length);return d("MAWDexieTable").dexieResolve(b)})}});g.getLatestThreadIds=a}),98);
__d("MAWGetMaybeNextNonAdminMsgSortOrderMsApi",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWRestoreMsgsTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getMaybeNextNonAdminMsgSortOrderMs",function(a){return function(b,c){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsg(a,c),d("MAWDbThreadTxns").getThread(a,b)]).then(function(b){var c=b[0];b=b[1];var e=0;if(d("MAWRestoreMsgsTxns").isE2eeOrCutoverAdminMsg(c)&&b.success&&c!=null)return d("MAWRestoreMsgsTxns").getNextMsgBasedOnSortOrderMs(a,b.value,c==null?void 0:c.msgId).then(function(a){a!=null&&a.sortOrderMs!=null&&(e=a.sortOrderMs);return{minMsgTimestampMs:e}});else c!=null&&c.sortOrderMs!=null&&(e=c.sortOrderMs);return{minMsgTimestampMs:e}})}});g.getMaybeNextNonAdminMsgSortOrderMs=a}),98);
__d("MAWGetMediaDownloadStatusApi",["MAWCreateMaybeAddPointForMediaRender","MAWDbChunkTxns","MAWDbMedia","MAWGetMediaApi","MAWIndexedDb","MAWLoggerUtils","MAWMediaDownloadStatus","MAWTransactionMode","MWFBLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaDownloadStatusByPlaintextHash - media not found for plaintextHash: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMediaDownloadStatusByMediaId - media not found for mediaId: ",""]);i=function(){return a};return a}var j=d("MWFBLogger").MWMediaLogger.tags([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]);a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=d("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(b);b("get_media_download_status_api_start",{string:{fetch_by:"mediaId"}});b("get_media_download_status_api_get_media_start");var e=(yield d("MAWGetMediaApi").getMediaByMediaId(a));b("get_media_download_status_api_get_media_end",{bool:{has_media:e!=null}});if(e==null){b("get_media_download_status_api_fail",{string:{fail_reason:"media_not_found"}});j.DEBUG(i(),a);return{mainMediaStatus:c("MAWMediaDownloadStatus").MISSING_FILE,mainMediaStatusDetails:"get_by_mediaId_missing_media",previewMediaStatus:c("MAWMediaDownloadStatus").MISSING_FILE,previewMediaStatusDetails:"get_by_mediaId_missing_media"}}b("get_media_download_status_api_get_status_from_media_start");a=(yield k(e));b("get_media_download_status_api_get_status_from_media_end");b("get_media_download_status_api_end");return a});return function(b,c){return a.apply(this,arguments)}}();e=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=d("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(b);b("get_media_download_status_api_start",{string:{fetch_by:"plaintextHash"}});b("get_media_download_status_api_get_media_start");var e=(yield d("MAWGetMediaApi").getMediaByPlaintextHash(a));b("get_media_download_status_api_get_media_end",{bool:{has_media:e!=null}});if(e==null){b("get_media_download_status_api_fail",{string:{fail_reason:"media_not_found"}});j.DEBUG(h(),a);return{mainMediaStatus:c("MAWMediaDownloadStatus").MISSING_FILE,mainMediaStatusDetails:"get_by_mediaPlaintextHash_missing_media",previewMediaStatus:c("MAWMediaDownloadStatus").MISSING_FILE,previewMediaStatusDetails:"get_by_mediaPlaintextHash_missing_media"}}a=(yield k(e));b("get_media_download_status_api_get_status_from_media_end");b("get_media_download_status_api_end");return a});return function(b,c){return a.apply(this,arguments)}}();function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield m(a));var b=a.hasDownloadedMainMedia,d=a.hasDownloadedThumbnail;a=a.hasThumbnail;return{mainMediaStatus:b?c("MAWMediaDownloadStatus").SUCCESS:c("MAWMediaDownloadStatus").MISSING_FILE,mainMediaStatusDetails:"status_from_media",previewMediaStatus:a?d?c("MAWMediaDownloadStatus").SUCCESS:c("MAWMediaDownloadStatus").MISSING_FILE:void 0,previewMediaStatusDetails:"status_from_media"}});return l.apply(this,arguments)}var m=d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY},"checkMediaDownloadStatus",function(a){return function(b){var c=n(b);return d("MAWDbChunkTxns").hasMediaChunk(a,b.hashedPlaintextHash).then(function(a){return{hasDownloadedMainMedia:a,hasDownloadedThumbnail:(c==null?void 0:c.jpegThumbnail)!=null,hasThumbnail:c!=null}})}});function n(a){var b;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return{jpegThumbnail:(b=a.validatedImageInfo)==null?void 0:b.jpegThumbnail};case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return{jpegThumbnail:(b=a.validatedVideoInfo)==null?void 0:b.jpegThumbnail}}}g.getMediaDownloadStatusByMediaId=a;g.getMediaDownloadStatusByPlaintextHash=e}),98);
__d("MAWGetMediaValidationResultApi",["MAWGetMediaApi","MAWVideoAudioValidationUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a){a=a.validatedResult;return a==null?null:d("MAWVideoAudioValidationUtils").normalizeValidationResult({audioAvgBitsPerSecond:a.audioAvgBitsPerSecond,audioNumberOfChannels:a.audioNumberOfChannels,audioSamplingRate:a.audioSamplingRate,audioStreamType:a.audioStreamType,validatedMimeType:a.validatedMimeType,videoAvgBitsPerSecond:a.videoAvgBitsPerSecond,videoCalculatedFps:a.videoCalculatedFps,videoDuration:a.videoDuration,videoHeight:a.videoHeight,videoNominalFps:a.videoNominalFps,videoStreamType:a.videoStreamType,videoWidth:a.videoWidth})}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("MAWGetMediaApi").getMediaByMediaId(a));return b==null?null:h(b)});return function(b,c){return a.apply(this,arguments)}}();c=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("MAWGetMediaApi").getMediaByPlaintextHash(a));return b==null?null:h(b)});return function(b,c){return a.apply(this,arguments)}}();g.getMediaValidationResultByMediaId=a;g.getMediaValidationResultByPlainTextHash=c}),98);
__d("MAWGetReceiverFetchInfoApi",["MAWDbReceiverFetchTxns","MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({receiverFetchInfo:d("MAWTransactionMode").READONLY},"MAWGetReceiverFetchInfo",function(a){return function(b){b=b.receiverFetchId;return d("MAWDbReceiverFetchTxns").maybeGetReceiverFetchInfoFromReceiverFetchId(a,b).then(function(a){var b;if(a==null||a.previewUrl==null||a.previewUrlExpirationTimestampMs==null)return;return{accessibilitySummaryText:(b=a.accessibilitySummaryText)!=null?b:void 0,previewUrl:a.previewUrl,previewUrlExpirationTimestampMs:d("WATimeUtils").castLongIntToMillisTime(a.previewUrlExpirationTimestampMs)}})}});g.getReceiverFetchInfo=a}),98);
__d("WADbIdentityTxnsV2",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.identity.bulkGet(b).then(function(a){return a.map(function(a){if(a==null)return;return{id:a.deviceJid,identity:a.identity}}).filter(Boolean)})}f.bulkGetIdentities=a}),66);
__d("WACompareIdentityV2",["WACryptoUtils","WADbIdentityTxnsV2","WADbSignal","WAJids","WASignalKeys","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield a.meta.bulkGet([d("WADbSignal").MetaKeysEnum.fbid,d("WADbSignal").MetaKeysEnum.deviceId,d("WADbSignal").MetaKeysEnum.identityKeyPair])),c=b[0],e=b[1];b=b[2];c=c==null?void 0:c.value.fbid;e=e==null?void 0:e.value.deviceId;b=b==null?void 0:b.value.identityKeyPair;if(c!=null&&e!=null){c=d("WAJids").toDeviceJid(d("WAJids").toMsgrUserJid(c),e);e=(yield d("WADbIdentityTxnsV2").bulkGetIdentities(a,[c]));if(!(e.length===0)){a=e[0];if((b==null?void 0:b.publicKey)==null)return!0;if(!d("WACryptoUtils").serializedPubKeysEqual(a.identity,d("WASignalKeys").serializePubKey(b)))return!1}return!0}return!0});return h.apply(this,arguments)}g.compareIdentity=a}),98);
__d("WAGetRegistrationInfoApi",["Promise","WACompareIdentityV2","WADbSignal","WALogger","WASignalDB","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Registration history log unexpectedly empty"]);i=function(){return a};return a}function a(){return d("WASignalDB").getDb().runInTransaction(["meta","identity"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all([a.stores.meta.bulkGet([d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,d("WADbSignal").MetaKeysEnum.deviceUUID,d("WADbSignal").MetaKeysEnum.lastSessionDeviceWasLinkedTo,d("WADbSignal").MetaKeysEnum.regId,d("WADbSignal").MetaKeysEnum.identityKeyPair,d("WADbSignal").MetaKeysEnum.fbid,d("WADbSignal").MetaKeysEnum.deviceId,d("WADbSignal").MetaKeysEnum.registrationVersion,d("WADbSignal").MetaKeysEnum.deviceRegUnixTime,d("WADbSignal").MetaKeysEnum.cat]),d("WACompareIdentityV2").compareIdentity(a.stores)]));var c=a[0],e=c[0],f=c[1],g=c[2],i=c[3],j=c[4],k=c[5],l=c[6],m=c[7],n=c[8];c=c[9];a=a[1];e=e==null?void 0:(e=e.value)==null?void 0:e.lastSignedPrekeyId;f=f==null?void 0:(f=f.value)==null?void 0:f.deviceUUID;g=g==null?void 0:(g=g.value)==null?void 0:g.lastSessionDeviceWasLinkedTo;i=i==null?void 0:(i=i.value)==null?void 0:i.regId;j=j==null?void 0:(j=j.value)==null?void 0:j.identityKeyPair;k=k==null?void 0:(k=k.value)==null?void 0:k.fbid;l=l==null?void 0:(l=l.value)==null?void 0:l.deviceId;m=m==null?void 0:m.value.registrationVersion;n=n==null?void 0:(n=n.value)==null?void 0:n.deviceRegUnixTime;c=c==null?void 0:(c=c.value)==null?void 0:(c=c.cat)==null?void 0:c.expiration_time_in_seconds;return{lastSignedPrekeyId:e,deviceUUID:f,lastSessionDeviceWasLinkedTo:g,regId:i,identityKeyPair:j,registrationUnixTime:n,fbid:k,deviceId:l,registrationVersion:m,identityCompareResult:a,catExpiryUnixTime:c!=null?d("WATimeUtils").castToUnixTime(c):void 0}});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("getRegistrationInfo"))}function c(){return d("WASignalDB").getDb().runInTransaction(["plaintextMeta"],"readonly",function(a){return a.stores.plaintextMeta.get(d("WADbSignal").PlainTextMetaKeysEnum.registrationHistory).then(function(a){return a==null?void 0:a.value.registrationHistory})},"getRegistrationHistory")}var j=10;function e(a){return d("WASignalDB").getDb().runInTransaction(["plaintextMeta"],"readwrite",function(b){return b.stores.plaintextMeta.get(d("WADbSignal").PlainTextMetaKeysEnum.registrationHistory).then(function(c){var e=d("WATimeUtils").unixTime();c=c==null?void 0:c.value.registrationHistory;if(c==null&&a==null)return;var f;if(a!=null)f=[].concat(c!=null?c:[],[{deviceRegTime:a,lastActivityTime:e}]);else{c=c;if(c.length===0){d("WALogger").ERROR(i());return}var g=c[c.length-1];f=[].concat(c.slice(0,-1),[babelHelpers["extends"]({},g,{lastActivityTime:e})])}return b.stores.plaintextMeta.bulkPut([{key:d("WADbSignal").PlainTextMetaKeysEnum.registrationHistory,value:{registrationHistory:f.slice(-j)}}])})},"updateRegistrationHistory")}g.getRegistrationInfo=a;g.getRegistrationHistory=c;g.updateRegistrationHistory=e}),98);
__d("MAWGetRedactedRegistrationInfoForBugnub",["WAGetRegistrationInfoApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAGetRegistrationInfoApi").getRegistrationInfo()),b=a.catExpiryUnixTime;a=a.registrationUnixTime;return{catExpiryUnixTime:b,registrationUnixTime:a}});return h.apply(this,arguments)}g.getRedactedRegistrationInfoForBugnub=a}),98);
__d("MessengerInfraReport",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h={};a=function(){for(var a of Object.keys(h))delete h[Number(a)]};b=function(){return c("gkx")("23390")};var i=20;d=function(a,b,c){var d=h[a];if(!d){h[a]=new Map([[c,babelHelpers["extends"]({},b,{latestTimestampMs:Date.now(),startTimestampMs:Date.now()})]]);return}var e=d.get(c);if(e!=null){d.set(c,babelHelpers["extends"]({},e,{},b,{latestTimestampMs:Date.now()}));return}if(d.size>=i){h[a]=new Map([[c,babelHelpers["extends"]({},b,{latestTimestampMs:Date.now(),startTimestampMs:Date.now()})]]);return}d.set(c,babelHelpers["extends"]({},b,{latestTimestampMs:Date.now(),startTimestampMs:Date.now()}))};e=function(a,b){return(a=h[a])==null?void 0:a.get(b)};f=function(a,b){(a=h[a])==null?void 0:a["delete"](b)};g.reportedEvents=h;g.clearReportedEvents=a;g.isEPD=b;g.MAX_SIZE=i;g.storeEventData=d;g.getEventData=e;g.deleteEventData=f}),98);
__d("MAWGetReportedQplEvents",["MessengerInfraReport","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){return(h||(h=b("Promise"))).resolve(d("MessengerInfraReport").reportedEvents)};g.getReportedQplEvents=a}),98);
__d("MAWGetSecureThreadTotalCount",["MAWTransactionMode","MAWTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY},"getSecureThreadTotalCount",function(a){return function(){return a.threads.count()}});g.getSecureThreadTotalCount=a}),98);
__d("MAWGetSecurityAlertSettingApi",["MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY},"getSecurityAlertSetting",function(a){return function(){return d("MAWDbMsgTypeVersionTxns").getSecuritySettingForContact(a)}});g.getSecurityAlertSetting=a}),98);
__d("MAWGetSecurityAlertSettingForSelfAndContactApi",["MAWDbMsgTypeVersionTxns","MAWTransactionMode","MAWTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWTransactor").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READONLY},"getSecurityAlertSettingForSelfAndContact",function(a){return function(){return d("MAWDbMsgTypeVersionTxns").maybeBulkGetSecuritySetting(a)}});g.getSecurityAlertSettingForSelfAndContact=a}),98);
__d("MAWGetThreadConsistencyInfo",["MAWDexieTable","MAWGetThreadUpdateType","MAWIndexedDb","MAWThreadSnippetUtils","MAWThreadUpdateType","MAWTransactionMode","err"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY},"getThreadConsistencyInfo",function(a){return function(b){if(b.action==="GET_SNIPPETS_INFO")return d("MAWDexieTable").dexieAll(b.chatJids.map(function(b){return d("MAWThreadSnippetUtils").getThreadSnippetFromScratch(a,b)})).then(function(a){return{snippetsInfo:a}});if(b.action==="MSG_ELIGIBLE_FOR_SNIPPET_RECALCULATION")return a.messages.get({msgId:b.msgId,threadJid:b.chatJid}).then(function(a){var b=null;a!=null&&(b=d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a));return{isSnippetEligible:b!==d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}});throw c("err")("Invalid params type")}});g.getThreadConsistencyInfo=a}),98);
__d("MAWGetThreadLastMessageTsApi",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getThreadLastMessageTs",function(a){return function(b){return a.threads.get({authoritativeThreadKey:b}).then(function(b){if(b==null)return;return d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,b.jid).then(function(a){return a==null?null:d("WATimeUtils").castUnixTimeToMillisTime((a=a.serverTs)!=null?a:d("WATimeUtils").castToUnixTime(0))})})}});g.getThreadLastMessageTs=a}),98);
__d("MAWGetThreadLastNumMessagesBySortOrderApi",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getThreadLastNumMessagesBySortOrder",function(a){return function(b,c){return a.threads.get({authoritativeThreadKey:b}).then(function(b){return b==null?[]:d("MAWDbMsgTxns").getThreadNewestNumMessagesBySortOrder(a,b.jid,c)})}});g.getThreadLastNumMessagesBySortOrder=a}),98);
__d("MAWGetThreadsInfoApi",["MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getThreadIdByDeduplicationKey ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY},"getThreadIdByDeduplicationKey",function(a){return function(b){d("WALogger").DEV(h(),b);return d("MAWDbThreadTxns").getThreadByDeduplicationKey(a,b).then(function(a){return a.success?{jid:a.value.jid}:null})}});g.getThreadIdByDeduplicationKey=a}),98);
__d("blobToDataUri",["Promise","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var d=new FileReader(),e=new(h||(h=b("Promise")))(function(a,b){d.onloadend=a,d.onerror=b});d.readAsDataURL(a);yield e;a=d.result;if(typeof a!=="string")throw c("err")('Unexpected result type "%s" when reading Blob as DataURL.',a instanceof ArrayBuffer?"ArrayBuffer":typeof a);return a});return i.apply(this,arguments)}g["default"]=a}),98);
__d("MAWGetThumbnailBlobDataUrlByMediaIdApi",["MAWCreateMaybeAddPointForMediaRender","MAWDbChunkTxns","MAWDbMedia","MAWDbMediaTxns","MAWIndexedDb","MAWMaybeWithTimeout","MAWMediaManager","MAWMediaPreviewDownloadManager","MAWMpsGating","MAWTransactionMode","MWFBLogger","Promise","WAErrorMessage","WAHashUtils","WAMediaManager","WAResultOrError","WAStartMediaDownloadQplFlow","asyncToGeneratorRuntime","blobToDataUri"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: using media chunk as the thumbnail"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["getImageThumbnail: unable to get a thumbnail as the media chunk is missing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Exception when waiting for thumbnail to download: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found jpegThumbnail entry for ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["No media found for ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Get thumbnail blob for "," from ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["Returning data uri for ",""]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create thumbnail data uri from blob for ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found jpegThumbnail entry for ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["No media found for ",""]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["Get thumbnail blob for "," from , from ",""]);C=function(){return a};return a}var D=d("MWFBLogger").MWMediaLogger.tags(["getThumbnailBlobDataUrlByMediaId"]);a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){D.DEBUG(C(),a,b);var f=d("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(e),g={string:{description:b,fetch_by:"mediaId"}};f("fetch_thumbnail_blob_api_start",g);f("get_media_from_db_start",g);var h=(yield G(a));f("get_media_from_db_finish",{bool:{db_media_found:h!=null}});if(h==null){D.WARN(B(),a);f("fetch_thumbnail_blob_api_fail_no_media_found_in_db",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because media is not in the media db. mediaId is %s, from %s",a,b)}var i=I(h);if(i.success===!0){D.DEBUG(A(),a);f("fetch_thumbnail_blob_api_success",g);var j=(yield c("blobToDataUri")(i.value));if(!Boolean(j)){D.MUSTFIX(z(),a);f("fetch_thumbnail_blob_api_fail_no_data_uri",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",a,b)}D.DEBUG(y(),a);return j}j=i.error;switch(j){case"missing_jpeg_thumbnail":if(h.mediaType===d("MAWDbMedia").MEDIA_TYPE.IMAGE||h.mediaType===d("MAWDbMedia").MEDIA_TYPE.VIDEO){i=(yield E(h,e));if(i!=null){f("fetch_thumbnail_blob_api_success",g);j=(yield c("blobToDataUri")(i));if(!Boolean(j)){D.MUSTFIX(x(),a);f("fetch_thumbnail_blob_api_fail_no_data_uri",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",a,b)}D.DEBUG(w(),a);return j}if((h==null?void 0:h.mediaType)===d("MAWDbMedia").MEDIA_TYPE.VIDEO){f("fetch_thumbnail_blob_api_fail_not_able_to_generate_video_thumbnail_on_the_fly",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId in time (for video). mediaId is %s, from %s",a,b)}i=(yield F(h,e));if(i==null){f("fetch_thumbnail_blob_api_fail_not_able_to_generate_image_thumbnail_on_the_fly",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId in time or to generate thumnbail on the fly. mediaId is %s, from %s",a,b)}f("fetch_thumbnail_blob_api_success",g);j=(yield c("blobToDataUri")(i));if(!Boolean(j)){D.MUSTFIX(v(),a);f("fetch_thumbnail_blob_api_fail_no_data_uri",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. mediaId is %s, from %s",a,b)}D.DEBUG(u(),a);return j}f("fetch_thumbnail_blob_api_fail_missing_thumbnail",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media (missing_jpeg_thumbnail). mediaId is %s, from %s",a,b);case"invalid_media":f("fetch_thumbnail_blob_api_fail_invalid_media",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media. mediaId is %s, from %s",a,b)}});return function(b,c,d){return a.apply(this,arguments)}}();e=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=d("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(e),g={string:{description:b,fetch_by:"hashedPlaintextHash"}};f("fetch_thumbnail_blob_api_start",g);D.DEBUG(t(),d("WAHashUtils").sanitisePlaintextHash(a),b);if(d("MAWMpsGating").isFullMpsEnabled()){var h=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:"UILayout",msgType:null,protocolMsgId:null,triggerUIView:null}),i=(yield d("MAWMediaManager").getMawMediaManager().enqueueDownloadPreview({fullSizePlaintextHash:a,mediaDownloadFlow:h,priority:d("WAMediaManager").MediaTaskPriority.HIGH}));if(i.success){var j=i.value.validatedResult.validatedPlaintext;j=new Blob([j],{type:(j=i.value.validatedResult.mimeType)!=null?j:void 0});j=(yield c("blobToDataUri")(j));return j}if(i.error!=="preview-not-supported")throw d("MWFBLogger").MPSLogger.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash. plaintextHash is %s, from %s, error: %s",d("WAHashUtils").sanitisePlaintextHash(a),b,i.error);j=(yield d("MAWMediaManager").getMawMediaManager().enqueueDownloadFullSize({fullSizePlaintextHash:a,mediaDownloadFlow:h,priority:d("WAMediaManager").MediaTaskPriority.HIGH}));if(j.success){h=j.value.validatedResult.validatedPlaintext;j=new Blob([h],{type:(h=j.value.validatedResult.mimeType)!=null?h:void 0});h=(yield c("blobToDataUri")(j));return h}throw d("MWFBLogger").MPSLogger.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash. plaintextHash is %s, from %s, error: %s",d("WAHashUtils").sanitisePlaintextHash(a),b,i.error)}j=(yield H(a));if(j==null){D.WARN(s(),d("WAHashUtils").sanitisePlaintextHash(a));f("fetch_thumbnail_blob_api_fail_no_media_found_in_db",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash because media is not in the media db. plaintextHash is %s, from %s",d("WAHashUtils").sanitisePlaintextHash(a),b)}h=I(j);if(h.success===!0){D.DEBUG(r(),d("WAHashUtils").sanitisePlaintextHash(a));f("fetch_thumbnail_blob_api_success",g);i=(yield c("blobToDataUri")(h.value));if(!Boolean(i)){D.MUSTFIX(q(),d("WAHashUtils").sanitisePlaintextHash(a));f("fetch_thumbnail_blob_api_fail_no_data_uri",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",d("WAHashUtils").sanitisePlaintextHash(a),b)}D.DEBUG(p(),d("WAHashUtils").sanitisePlaintextHash(a));return i}i=h.error;switch(i){case"missing_jpeg_thumbnail":if(j.mediaType===d("MAWDbMedia").MEDIA_TYPE.IMAGE||j.mediaType===d("MAWDbMedia").MEDIA_TYPE.VIDEO){h=(yield E(j,e));if(h!=null){f("fetch_thumbnail_blob_api_success",g);i=(yield c("blobToDataUri")(h));if(!Boolean(i)){D.MUSTFIX(o(),d("WAHashUtils").sanitisePlaintextHash(a));f("fetch_thumbnail_blob_api_fail_no_data_uri",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",d("WAHashUtils").sanitisePlaintextHash(a),b)}D.DEBUG(n(),d("WAHashUtils").sanitisePlaintextHash(a));return i}if((j==null?void 0:j.mediaType)===d("MAWDbMedia").MEDIA_TYPE.VIDEO){f("fetch_thumbnail_blob_api_fail_not_able_to_generate_video_thumbnail_on_the_fly",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash in time (for video). plaintextHash is %s, from %s",d("WAHashUtils").sanitisePlaintextHash(a),b)}h=(yield F(j,e));if(h==null){f("fetch_thumbnail_blob_api_fail_not_able_to_generate_image_thumbnail_on_the_fly",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByHashedPlaintextHash in time or to generate thumnbail on the fly. plaintextHash is %s, from %s",d("WAHashUtils").sanitisePlaintextHash(a),b)}i=(yield c("blobToDataUri")(h));if(!Boolean(i)){D.MUSTFIX(m(),d("WAHashUtils").sanitisePlaintextHash(a));f("fetch_thumbnail_blob_api_fail_no_data_uri",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId because data uri is null. plaintextHash is %s, from %s",d("WAHashUtils").sanitisePlaintextHash(a),b)}D.DEBUG(l(),d("WAHashUtils").sanitisePlaintextHash(a));return i}f("fetch_thumbnail_blob_api_fail_missing_thumbnail",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media (missing_jpeg_thumbnail). plaintextHash is %s, from %s",d("WAHashUtils").sanitisePlaintextHash(a),b);case"invalid_media":f("fetch_thumbnail_blob_api_fail_invalid_media",g);throw D.mustfixThrow("Failed to getThumbnailBlobDataUrlByMediaId, invalid media. plaintextHash is %s, from %s",d("WAHashUtils").sanitisePlaintextHash(a),b)}});return function(b,c,d){return a.apply(this,arguments)}}();var E=function(a,c){var e=d("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(c);e("fetch_thumbnail_blob_api_thumbnail_download_start");c=d("MAWMediaPreviewDownloadManager").getMediaPreviewDownloadingResolvable(a.plaintextHash);if(c==null){e("fetch_thumbnail_blob_api_thumbnail_download_fail_no_resolvable");return(h||(h=b("Promise"))).resolve(null)}return d("MAWMaybeWithTimeout").maybeWithTimeout(c.promise,1e4,function(){throw D.mustfixThrow("timeout waiting for thumbnail to download")}).then(function(a){e("fetch_thumbnail_blob_api_thumbnail_download_success");return a})["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);D.MUSTFIX(k(),a);e("fetch_thumbnail_blob_api_thumbnail_download_fail_exception",{string:{wait_for_thumbnail_download_exception:a}});return null})},F=d("MAWIndexedDb").makeMsgrTransactor({chunk:(f=d("MAWTransactionMode")).READONLY,media:f.READONLY},"generateThumbnailFromMediaChunk",function(a){return function(b,c){var e=d("MAWCreateMaybeAddPointForMediaRender").createMaybeAddPointForMediaRender(c);e("fetch_thumbnail_blob_api_thumbnail_generate_from_media_start");return d("MAWDbChunkTxns").maybeGetChunkFromHash(a,b.hashedPlaintextHash).then(function(a){if(a==null){D.MUSTFIX(j());e("fetch_thumbnail_blob_api_thumbnail_generate_from_media_fail_chunk_missing");return}D.WARN(i());e("fetch_thumbnail_blob_api_thumbnail_generate_from_media_success");return new Blob([a.blobData],{type:a.mimetype})})}}),G=d("MAWIndexedDb").makeMsgrTransactor({media:f.READONLY},"getFullMedia",function(a){return function(b){return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b)}}),H=d("MAWIndexedDb").makeMsgrTransactor({media:f.READONLY},"getFullMedia",function(a){return function(b){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b)}}),I=function(a){a=J(a);if(a.success===!1)return a;a=a.value.jpegThumbnail;return a!=null?d("WAResultOrError").makeResult(new Blob([a],{type:"image/jpeg"})):d("WAResultOrError").makeError("missing_jpeg_thumbnail")},J=function(a){var b;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return d("WAResultOrError").makeResult({jpegThumbnail:(b=a.validatedImageInfo)==null?void 0:b.jpegThumbnail});case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return d("WAResultOrError").makeResult({jpegThumbnail:(b=a.validatedVideoInfo)==null?void 0:b.jpegThumbnail});case d("MAWDbMedia").MEDIA_TYPE.PTT:case d("MAWDbMedia").MEDIA_TYPE.STICKER:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return d("WAResultOrError").makeError("invalid_media");default:a.mediaType;return d("WAResultOrError").makeError("invalid_media")}};g.getThumbnailBlobDataUrlByMediaId=a;g.getThumbnailBlobDataUrlByHashedPlaintextHash=e}),98);
__d("MAWGetWAIDevices",["WADevicesState","WAGlobals","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.users;yield d("WAGlobals").getWaOneQueue().waitForWAInfraOfflineSyncEnd();yield d("WADevicesState").getDevicesState().waitForUserDevices(b,"getWAIDevices");a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(b)},{afterInit:!0,flush:!1,operationType:"maw_load_identities"}));var c=[];if(a.size===0)c=[].concat(b);else for(var e of a){var f=e[0],g=e[1];g.size===0&&c.push(f)}c.length>0&&(yield d("WADevicesState").getDevicesState().waitForUserDevices(c,"getWAIDevices",!0),a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(b)},{afterInit:!0,flush:!1,operationType:"maw_load_identities"})));g=new Map();for(f of a){e=f[0];c=f[1];g.set(e,Array.from(c.keys()))}return g});return h.apply(this,arguments)}g.getWAIDevices=a}),98);
__d("MAWGetWATimeApi",["Promise","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){return(h||(h=b("Promise"))).resolve({clockSkew:d("WATimeUtils").getClockSkew(),millisTime:d("WATimeUtils").millisTime(),unixTime:d("WATimeUtils").unixTime()})};g.getWATime=a}),98);
__d("MAWGetWorkerHeartbeatApi",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){return(g||(g=b("Promise"))).resolve(!0)};f.getWorkerHeartbeat=a}),66);
__d("MAWLowLevelMediaDownloadQplBridgeHandler",["MAWDownloadAndRestoreMedia"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){b=d("MAWDownloadAndRestoreMedia").getMediaDownloadFlow(b,e);switch(a){case"success":b.endSuccess();break;case"fail":b.endFail(c,e);break;case"point":b.addPoint(c,e);break}}g.handleBridgeMediaDownloadQPL=a}),98);
__d("MAWHandleMediaRestoreCdnUrlResult",["EncryptedBackupsResignCdnUrl","MAWLowLevelMediaDownloadQplBridgeHandler","MWFBLogger","Promise","WADirectPath","WAPromiseDelays","WAResultOrError","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult success. directPath: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult direct path error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult request error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult: restoredCdnUrlResolvable is null}"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult: traceId is not a number. success: ",", error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMediaRestoreCdnUrlResult: traceId is null. success: ",", error: ",""]);n=function(){return a};return a}var o=d("MWFBLogger").MWMediaLogger.tags(["RestoreCdnUrlThroughSproc"]);function a(a){var e;e=(e=(e=a.value)==null?void 0:e.rawTraceId)!=null?e:(e=a.error)==null?void 0:e.rawTraceId;if(e==null){var f;o.MUSTFIX(n(),a.success,a.success?"":(f=a.error.errorMessage)!=null?f:"");return}f=isNaN(parseInt(e,10))?null:parseInt(e,10);if(f==null){var g;o.MUSTFIX(m(),a.success,a.success?"":(g=a.error.errorMessage)!=null?g:"");return}g=o.tags([e]);e=d("EncryptedBackupsResignCdnUrl").getRestoredCdnUrlResolvable(f);if(e==null){o.MUSTFIX(l());return}if(!a.success){var q;g.MUSTFIX(k(),(q=a.error.errorMessage)!=null?q:"");e==null?void 0:e.resolve(d("WAResultOrError").makeError("resign-cdn-url-request-error"));e==null&&p(f,a.error.errorMessage);return}q=d("WADirectPath").validateDirectPath(a.value.rawDirectPath);if(!q.success){g.WARN(j(),q.error);e==null?void 0:e.resolve(q);return}f=q.value;o.DEBUG(i(),f);void (h||(h=b("Promise"))).race([(a=e==null?void 0:e.resolve(d("WAResultOrError").makeResult(f)))!=null?a:(h||(h=b("Promise"))).resolve(),d("WAPromiseDelays").delayMs(c("justknobx")._("4255"))])}function p(a,b){d("MAWLowLevelMediaDownloadQplBridgeHandler").handleBridgeMediaDownloadQPL("fail",a,"attachment_restore_failure",{string:{error:b!=null?b:""}})}g.handleMediaRestoreCdnUrlResult=a}),98);
__d("MAWIdentifyCollapsedMessagesByExternalId",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.externalIds;a=(yield d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY},"identifyCollapsedMessagesByExternalId",function(a){return function(){return d("MAWDbMsgTxns").UNSAFE_getMultipleMsgsByExternalId(a,b)}})());return a.filter(function(a){return a.isCollapsed===!0}).map(function(a){return a.externalId})});return h.apply(this,arguments)}g.identifyCollapsedMessagesByExternalId=a}),98);
__d("MAWIdentifyXMAWithAssociatedTextByExternalId",["MAWDbXMATxns","MAWIndexedDb","MAWTransactionMode","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.externalIds;a=(yield d("MAWIndexedDb").makeMsgrTransactor({xma:d("MAWTransactionMode").READONLY},"identifyXMAWithAssociatedTextByExternalId",function(a){return function(){return d("MAWDbXMATxns").getMultipleXMAByExternalId(a,b)}})());return a.filter(function(a){return a.associatedMessageId!=null}).map(function(a){return a.externalId})});return h.apply(this,arguments)}g.identifyXMAWithAssociatedTextByExternalId=a}),98);
__d("MAWInsertAdminMessageInCutoverThreadsApi",["MAWAdminWriteCutoverThreadMsgTxn","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"insertAdminMessageInCutoverThreads",function(a){return function(b){var c=b.openThreadId,e=b.threadJid;b=b.traceId;return d("MAWAdminWriteCutoverThreadMsgTxn").writeCutoverThreadAdminMsg(a,e,c,b).then(function(b){b=b.needsMarkThreadAsMigrated;if(b)return d("MAWDbThreadTxns").markCutoverThreadAsMigratedLocally(a,e)}).then(function(){return!0})}});g.insertAdminMessageInCutoverThreads=b}),98);
__d("MAWLoadMediaApi",["FBLogger","LSThreadMediaGalleryGroup","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDexieTable","MAWIndexedDb","MAWMediaAfterTxns","MAWTransactionMode","WAHashUtils","WALogger","WATimeUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[loadMoreMedia] msgMediaPairs: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[loadMoreMedia] foundMessages: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to load media for thread. ThreadJid "," does not exist"]);j=function(){return a};return a}var k=c("justknobx")._("1132");b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,threads:a.READONLY},"loadMoreMedia",function(a){return function(b){var e=b.earliestLoadedMediaMessageId,f=b.earliestLoadedMediaTs,g=b.mediaGalleryGroup,m=b.pageSize,n=b.threadJid,o=0,p=!1,q=0,r=!1,s=m!=null?m:k;return a.threads.get({jid:n}).then(function(b){if(b==null)throw d("WALogger").ERROR(j(),n);b=a.messages.where(["threadJid","sortOrderMs"]).between([b.jid,d("MAWDbMsg").MIN_MSG_SORT_ORDER],[b.jid,f],!0,!0);return b.filter(function(a){return l(a,g)}).until(t).reverse().toArray()}).then(function(b){var f,j=b.findIndex(function(a){return a.msgId===e});j=p?j+1:0;b=b.slice(j,j+s+1);j=b.length===s;j=c("gkx")("4219")?r:j;var k=b[b.length-1],l=c("gkx")("4219")?Number.MAX_SAFE_INTEGER:d("MAWDbMsg").MIN_MSG_SORT_ORDER;f=(f=k==null?void 0:k.sortOrderMs)!=null?f:l;d("MAWIndexedDb").afterTransaction({tag:"NewMediaRange",value:{earliestLoadedMediaTs:f,hasMoreBefore:j,lastLoadedMessageId:(l=k==null?void 0:k.msgId)!=null?l:e,mediaGalleryGroup:g,threadJid:n}});d("WALogger").LOG(i(),b.map(function(a){return""+a.msgId}));return d("MAWDbMediaTxns").getMsgMediaPairFromMsgs(a,b).then(function(b){d("WALogger").LOG(h(),b.map(function(a){var b=a[0];a=a[1];return"["+b.msgId+", "+d("WAHashUtils").sanitisePlaintextHash(a.plaintextHash)+"]"})),d("MAWDexieTable").dexieAll(b.map(function(b){var e=b[0],f=b[1];return d("MAWDbChunkTxns").hasMediaChunk(a,f.hashedPlaintextHash).then(function(b){b||c("FBLogger")("messenger_web_media").warn("loadMoreMedia cannot find chunk for mediaId: %s",f.mediaId),d("MAWMediaAfterTxns").handleNewMediaAfterTxn(e,f,b,a,!0)})}))})});function t(a){o++;a.msgId===e?p=!0:(p||c("gkx")("4219")&&f===Number.MAX_SAFE_INTEGER)&&q++;if(q>s){r=!0;return!0}if(o>s&&!p&&a.sortOrderMs!==f){r=!0;return!0}return!1}}});function l(a,b){var e=d("WATimeUtils").unixTime(),f=!1;switch(b){case c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS:f=d("MAWDbMsg").isPhotoOrVideoMediaMsg(a);break;case c("LSThreadMediaGalleryGroup").FILES_ONLY:f=d("MAWDbMsg").isDocumentFileMediaMsg(a);break;case c("LSThreadMediaGalleryGroup").LINKS:f=d("MAWDbMsg").isXMAMsg(a);break}b=a.messageExpirationTs==null||a.messageExpirationTs>e;return f&&b}g.loadMoreMedia=b;g.filterForMediaMessages=l}),98);
__d("WAWaitPromiseUntil",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){var d=new(g||(g=b("Promise")))(function(a){return void setTimeout(a,c)});return g.race([a.then(function(a){return{result:a}}),d.then(function(){return"timeout"})])}f.waitPromiseUntil=a}),66);
__d("MAWLoadMoreScheduler",["FBLogger","MAWEBLSInWorkerSwitch","MAWLoadMsgsApi","MAWMessagesDirection","MAWMpsGating","MAWSharedCOP","MawMpsCop","MpsTypes","WALogger","WAResultOrError","WAWaitForUserUnblocked","WAWaitPromiseUntil","WorkerScheduler","asyncToGeneratorRuntime","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs from COP fails: ",""]);h=function(){return a};return a}var i=5,j=c("justknobx")._("4600"),k=c("justknobx")._("4703"),l;function m(){l==null&&(l=d("WorkerScheduler").makeScheduler("load-more",{concurrency:10,defaultSamplingRate:1e3,maxConcurrency:10,maxThrottleMs:0}));return l}function a(a){var b=a.actionType,c=a.chatJid,e=a.config,f=a.direction,g=a.externalId,h=a.includeOriginalMsg,i=a.msgId,j=a.numMsgs,k=a.sortOrderMs;return n({actionType:b,chatJid:c,direction:f,externalId:g,loadFn:function(){return d("MAWLoadMsgsApi").loadMsgsFromTs(c,j,f,k,h,i,e)},numMsgs:j,timestamp:k})}function e(a){return d("WAWaitPromiseUntil").waitPromiseUntil(c("MAWEBLSInWorkerSwitch").waitForEBEnabled(),k).then(function(c){if(c==="timeout")return;return m().runTask({customFlags:{runtimeReliability:!0},fn:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield q(a.actionType,a.config.map(function(a){var b=a.chatJid,c=a.direction,e=a.lowerBoundExternalId,f=a.lowerBoundSortOrderMs;a=a.numMsgs;return{chatJid:b,direction:c,messageId:e!=null?d("MpsTypes").toMessageId(e):null,numMsgs:a,timestamp:d("MpsTypes").toTimestamp(f!=null?f:Date.now())}}))});function e(){return c.apply(this,arguments)}return e}(),name:"loadMessagesByChatJids",priority:d("WorkerScheduler").BLOCKING_PRIORITY})})}function f(a){var b=a.chatJid,c=a.config,e=a.direction,f=a.range;return n({actionType:a.actionType,chatJid:b,direction:e,externalId:f.lowerBoundExternalId,loadFn:function(){return d("MAWLoadMsgsApi").loadMsgsRange(b,c,e,f)},numMsgs:f.numMsgs,timestamp:f.lowerBoundSortOrderMs})}function n(a){return m().runTask({customFlags:{runtimeReliability:!0},fn:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{if(d("MAWMpsGating").isMpsM3Only()){var b;c("gkx")("15935")&&(yield d("WAWaitForUserUnblocked").waitForUserUnblocked());return s(a.actionType,a.chatJid,a.direction,a.numMsgs,d("MpsTypes").toTimestamp((b=a.timestamp)!=null?b:Date.now()),a.externalId!=null?d("MpsTypes").toMessageId(a.externalId):null,a.loadFn)}else a.actionType==="user"&&(yield d("MAWSharedCOP").getCOP_old().loadMoreMsgs(a.chatJid,a.numMsgs))}catch(a){d("WALogger").ERROR(h(),a)}return a.loadFn()});function f(){return e.apply(this,arguments)}return f}(),name:"maw_load_msgs",priority:d("WorkerScheduler").BLOCKING_PRIORITY})}function o(a){return a.hasNext===!0&&a.endCursor!=null?{cursor:a.endCursor,hasMore:!0}:{hasMore:!1}}function p(a,b,c){switch(b){case"before":b=c.msgs[c.msgs.length-1];return b.sortOrderMs>=a[0];case"after":b=c.msgs[0];return b.sortOrderMs<=a[0]}}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield d("MawMpsCop").mpsCop().loadBatchMsgsIntoMaw({debug:{purpose:"cop-load-batch-"+(a!=null?a:"")},ranges:b.map(function(a){var b=a.chatJid,c=a.direction,e=a.messageId,f=a.numMsgs;a=a.timestamp;return{direction:d("MAWMessagesDirection").translateMawDirectionToMwpDirection(c),from:[a,e],numMessages:f+j,threadId:d("MpsTypes").toThreadId(b)}})})});return r.apply(this,arguments)}function s(a,b,c,d,e,f,g){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,k){var l=c("FBLogger")("mps").tags(["MAW","loadMore"]);if(f===0)return k();g=[g,h];for(h=0;h<i;h++){h>1&&c("FBLogger")("mps").warn("MAW MPS Iteration %s Direction %s",h,e);var m=(yield d("MawMpsCop").mpsCop().loadMoreMsgsIntoMaw({debug:{purpose:"cop-load-more-"+(a!=null?a:"")},direction:d("MAWMessagesDirection").translateMawDirectionToMwpDirection(e),from:g,numMessages:f+j,threadId:d("MpsTypes").toThreadId(b)})["catch"](function(a){l.catching(a).mustfix("Failed to load more messages from MPS");return d("WAResultOrError").makeError("runtime-error")}));if(m.success===!1){l.warn("MPS Failed with result: %s",m.error);break}m=o(m.value.cursorInfo);var n=(yield k());if(m.hasMore===!1)return n;g=m.cursor;if(n.msgs.length<f)continue;if(p(m.cursor,e,n)===!1)continue;return n}l.warn("Returning best-effort loadMessages from MAW");return k()});return t.apply(this,arguments)}g.loadMoreScheduler=m;g.loadMoreMessages=a;g.loadMessagesByChatJidsIntoMaw=e;g.loadMoreMsgsRange=f}),98);
__d("MAWMarkBackupAsCompleted",["EncryptedBackupsUploadQueue"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.queueId;var b=d("EncryptedBackupsUploadQueue").ebUploadQueue();return b.ack([a])}g.markBackupAsCompleted=a}),98);
__d("MAWMarkThreadAsUnreadApi",["MAWBridgeThread","MAWDbMsgTxns","MAWIndexedDb","MAWThreadUtils","MAWTimeUtils","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READWRITE},"markThreadAsUnread",function(a){return function(b){return a.threads.get({jid:b}).then(function(c){if(c==null)return;return d("MAWDbMsgTxns").getThreadNewestMessageMs(a,c.jid).then(function(e){var f=d("MAWTimeUtils").ensureValidMillisTime(e),g=d("WATimeUtils").castToMillisTime(0);if(f==null||e===g)return;e={lastReadMsg:null};return d("MAWThreadUtils").updateThreadWithJid(a,b,e).then(function(a){a===1&&d("MAWIndexedDb").afterTransaction({tag:"ThreadTimestampsUpdated",value:d("MAWBridgeThread").createBridgeThreadTimestampsUpdated(c.jid,g,f,!0)})})})})}});g.markThreadAsUnread=a}),98);
__d("MAWMediaSizeCheck",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a>100*1024}f.isMinSizeForImagePreviewGeneration=a}),66);
__d("MAWUploadAndHandleMedia",["FBLogger","MAWMediaManager","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getDownloadableThumbnailForMedia unexpected runtime-erorr: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to enqueue upload full size: ",""]);i=function(){return a};return a}var j=c("FBLogger")("messenger_web_media");function a(a){var b=a.chatJid,c=a.dbCallbacks,d=a.filename,e=a.hash,f=a.plaintext,g=a.protocolMsgId,h=a.serverMediaType,i=a.size;a=a.uploadMediaMetric;return k({chatJid:b,dbCallbacks:c,filename:d,hash:e,plaintext:f,protocolMsgId:g,serverMediaType:h,size:i,uploadMediaMetric:a})}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.chatJid,c=a.dbCallbacks,e=a.filename,f=a.hash,g=a.plaintext,k=a.serverMediaType,l=a.size;a=a.uploadMediaMetric;b=(yield d("MAWMediaManager").getMawMediaManager().enqueueUploadFullSize({chatJid:b,mediaUploadFlow:a,plaintext:g,plaintextHash:f,serverMediaType:k}));if(b.success!==!0){j.WARN(i(),b.error);a.endFail(b.error);return b}g=(yield c.getDownloadableThumbnailForMedia(f)["catch"](function(a){j.catching(a).MUSTFIX(h(),a);return null}));k=babelHelpers["extends"]({},b.value,{downloadableThumbnail:g,filename:e,size:l});a.endSuccess();return d("WAResultOrError").makeResult(k)});return l.apply(this,arguments)}g.uploadAndHandleMedia=a}),98);
__d("MAWOptimisticUploadMedia",["MAWConfig","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetOrCreateMediaKnownEntriesApi","MAWMediaSizeCheck","MAWMediaUtils","MAWOptimisticUploadManager","MAWStartMediaUploadQplFlow","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWUploadAndHandleMedia","MWFBLogger","WABlobToArrayBuffer","WAHashUtils","WAMediaCrypto","WAProgressiveJpegGetScanLengths","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["fileUploadResult success, setting with previewPlaintextHash"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["previewUploadResult success"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["unsupported preview media type ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["preview uploading"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["thumbnail_exists: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["File is already being uploaded"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["fileUploadResult success"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["file uploading"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["start uploading type: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping preview upload for media type ",""]);q=function(){return a};return a}var r=d("MWFBLogger").MWMediaLogger.tags(["OptimisticUploadMedia"]);function s(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){r.DEBUG(p(),String(c));var e=(yield d("MAWMediaUtils").hashBlob(a));e=d("WAHashUtils").toPlaintextHash(e);var f=d("MAWOptimisticUploadManager").getOptimisticUploadManager();f=f.get(e);if(f!=null)return d("WAResultOrError").makeError("already_uploading");f=c.type==="regular"?c.mediaType:"preview";var g=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:b,fileSize:a.size,serverMediaType:f,uploadEntry:"optimisticUploadMedia"}));b=d("MAWUploadAndHandleMedia").uploadAndHandleMedia({chatJid:b,dbCallbacks:{getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload},filename:f==="document"?a.name:void 0,hash:e,mediaTypeDetails:c,plaintext:yield d("WABlobToArrayBuffer").blobToArrayBuffer(a),protocolMsgId:null,serverMediaType:f,size:a.size,uploadMediaMetric:g});return d("WAResultOrError").makeResult({plaintextHash:e,uploadPromise:b})});return t.apply(this,arguments)}function a(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.file,c=a.jid;a=a.thumbnail;var e=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type);f=f.serverMediaType;r.DEBUG(o());var g=(yield s(b,c,{mediaType:f,type:"regular"}));g.success===!0?(r.DEBUG(n()),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:null})):(g.error,r.DEBUG(m()));var p=null;r.DEBUG(l(),a!=null);var q=new Uint8Array(yield d("WABlobToArrayBuffer").blobToArrayBuffer(b));if(a&&v(f,b.size,q)){r.DEBUG(k());q=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f);if(q==null){r.MUSTFIX(j(),f);return}f=(yield s(a,c,{messageType:q,type:"preview"}));f.success===!0&&(r.DEBUG(i()),p=f.value.plaintextHash,e.set(f.value.plaintextHash,{file:a,optimisticUploadPromise:f.value.uploadPromise}),g.success===!0&&(r.DEBUG(h()),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:p})))}});return u.apply(this,arguments)}function v(a,b,c){switch(a){case"gif":return!1;case"image":return w(b,c);case"video":return!0;default:r.DEBUG(q(),a);return!1}}function w(a,b){if(!d("MAWMediaSizeCheck").isMinSizeForImagePreviewGeneration(a))return!1;return!x(b)&&d("MAWConfig").getConfig().shouldFallbackToPreviewForFailedProgressiveJpeg()===!0?!0:!1}function x(a){a=d("WAProgressiveJpegGetScanLengths").getProgressiveJpegScanLengths(a);return a.length>0}g.optimisticUploadMedia=a;g.shouldUploadPreview=v}),98);
__d("MAWGetMsgIdByProtocolMsgId",["MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getMsgIdByProtocolMsgId",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgResultByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b.success)return d("WAResultOrError").makeResult(b.value.msgId);else if(c!=null)return d("WAResultOrError").makeResult(c.reactionId);else if(a.success&&a.value.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return d("WAResultOrError").makeResult(a.value.msgId);var e="missing_msg_in_db";b=b.error;a=a.error;b==="missing_msg"&&c==null&&a==="missing_unrendered_msg"?e="missing_all_db_msg":b==="missing_thread_msg"&&a==="missing_thread_unrendered_msg"?e="missing_all_thread":(b==="missing_thread_msg"||a==="missing_thread_unrendered_msg")&&(e=b+"__"+(a!=null?a:"unrenderedMsgResultNoError"));return d("WAResultOrError").makeError(e)})}});g.getMsgIdByProtocolMsgId=b}),98);
__d("MAWCheckThreadExistsTxn",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY},"checkThreadExists",function(b){return function(){return b.threads.get({jid:a}).then(function(a){return a!=null})}})()}g.checkThreadExistsTxn=a}),98);
__d("MAWSendMediaMsg",["EBAPI","EBLogger","MAWAckLevel","MAWAsConsumerApplication","MAWBridgeTypesCreators","MAWCastToMsgrServerMediaType","MAWCheckThreadExistsTxn","MAWDbChunkTxns","MAWDbMedia","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetMsgIdByProtocolMsgId","MAWGetOrCreateMediaKnownEntriesApi","MAWIndexedDb","MAWMediaAfterTxns","MAWMediaBackupTxns","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaManagementTxns","MAWMediaUtils","MAWMessageSendsCommon","MAWMpsGating","MAWMsgType","MAWMsgUtil","MAWOptimisticUploadManager","MAWQplProxy","MAWSendWrittenMsg","MAWStartMediaUploadQplFlow","MAWTSUtils","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWUploadAndHandleMedia","MAWWriteOutgoingMsgApi","MpsMediaManager","MpsToBridgeMessageId","MpsTypes","Promise","SendMsgArgsToProtobuf","WAAPI","WAAsMessageApplication","WABlobToArrayBuffer","WAJids","WAMediaUtils","WAMsgApplication.pb","WAMsgMap","WAQPLProxy","WAResultOrError","WASortedLists","asyncToGeneratorRuntime","encodeProtobuf","gkx","nullthrows","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWSendMediaMsg] - msgId mismatch between put msg and got msg"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMediaMsg - begin writing "," media msg"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Chat ",": is received in job"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media for msgId: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media for msgId: ",""]);m=function(){return a};return a}function n(a){switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return d("MAWMsgType").MSG_TYPE.IMAGE;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return d("MAWMsgType").MSG_TYPE.VIDEO;case d("MAWDbMedia").MEDIA_TYPE.PTT:return d("MAWMsgType").MSG_TYPE.PTT;case d("MAWDbMedia").MEDIA_TYPE.GIF:return d("MAWMsgType").MSG_TYPE.GIF;case d("MAWDbMedia").MEDIA_TYPE.STICKER:return d("MAWMsgType").MSG_TYPE.STICKER;case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE;default:d("EBLogger").EBLogger.tags(["unsupported_media"]).mustfix("unsupported media type");throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Expected media msg type")}}e=function(){function a(){this.mediaEntry=null}var e=a.prototype;e.writeToDb=function(a,b,c,e){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};e.attachHashAndSaveMedia=function(a,b,c,e,f,g,h,i,j,k){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};e.maybePersistMediaEntry=function(a,b,c,e){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};e.perisitMediaEntryForQuickMediaSend=function(a,b,c){return d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE},"perisitMediaEntryForQuickMediaSend",function(e){return function(){var f=d("WAMediaUtils").encodeMediaEntryForUpload(c);return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(e,a).then(function(a){var g;if(a==null)throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("media should already exist upon this point");g=babelHelpers["extends"]({},a,{mediaEntries:a.mediaEntries.set(b,f),msgIds:d("WASortedLists").addToSet(a.msgIds,b),objectId:(g=c.objectId)!=null?g:void 0});return e.media.update(a.mediaId,g).then(function(){})})}})()};e.getUnderlyingMessage=function(a,b,c){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};e.updateSystemAckWithTxn=function(a,b){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};e.getProtobufData=function(a,b,c,e,f,g,h){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};e.uploadToWaapi=function(a,b,c,e,f,g,h){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};e.checkThreadExists=function(a){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};e.persistMessageAndMedia=function(a){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};e.constructMediaInfo=function(a,b){a={validatedAudioInfo:a==="Ptt"&&b.duration!=null?{duration:b.duration,mimetype:c("gkx")("9277")?d("MAWAsConsumerApplication").AUDIO_OGG_MIME_TYPE:d("MAWAsConsumerApplication").AUDIO_WAV_MIME_TYPE,played:!1}:null,validatedDocumentFileInfo:a==="DocumentFile"&&b.filename!=null?{filename:b.filename,mimetype:d("MAWAsConsumerApplication").FILE_MIME_TYPE}:null,validatedImageInfo:a==="Image"?{hdType:b.hdType,height:b.height,jpegThumbnail:b.jpegThumbnail,jpegThumbnailHeight:b.jpegThumbnailHeight,jpegThumbnailWidth:b.jpegThumbnailWidth,width:b.width}:a==="Gif"||a==="Sticker"?{height:b.height,jpegThumbnailHeight:b.height,jpegThumbnailWidth:b.width,width:b.width}:null,validatedVideoInfo:a==="Video"?{duration:b.duration,height:b.height,jpegThumbnail:b.jpegThumbnail,jpegThumbnailHeight:b.jpegThumbnailHeight,jpegThumbnailWidth:b.jpegThumbnailWidth,mimetype:d("MAWAsConsumerApplication").VIDEO_MIME_TYPE,width:b.width}:null};return a};e.getMediaEntry=function(a){var b,c=d("MAWOptimisticUploadManager").getOptimisticUploadManager();return(b=this.mediaEntry)!=null?b:(b=c.get(a))==null?void 0:b.mediaEntry};e.updateMediaEntry=function(a,b){d("MAWUpdateMediaEntryForMsgApi").maybeUpdateOptimisticUploadMediaEntry(a,b),this.mediaEntry=b()};e.saveAndPassOff=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){e=b.mediaType;b=b.serverMediaType;var i=f.args;f.attachmentType;var j=f.chatJid;f.externalId;var k=f.file;f=f.filename;var l=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(b);if(!l){d("EBLogger").EBLogger.tags(["unsupported_media"]).mustfix("unsupported media type");d("MAWQplProxy").sendQplPointThroughBridge(g,"failed_media_unsupported_type",{instanceKey:h});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Media type unsupported: "+(b!=null?b:""))}yield this.getUnderlyingMessage(a,g,h);d("MAWQplProxy").sendQplPointThroughBridge(g,"get_validated_media_info_start",{instanceKey:h});l=a.msgId;var n=this.constructMediaInfo(e,i);d("MAWQplProxy").sendQplPointThroughBridge(g,"get_validated_media_info_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"attach_hash_and_save_media_start",{instanceKey:h});yield this.attachHashAndSaveMedia(j,a.protocolMsgId,k,c,void 0,void 0,e,n,i.offlineAttachmentId,i.accessibilityLabel);d("MAWQplProxy").sendQplPointThroughBridge(g,"attach_hash_and_save_media_end",{instanceKey:h});var o=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),p=o.get(c),q=p==null?void 0:p.optimisticUploadPromise,r=q!=null;d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(g,"isOptimisticUpload",r,h);d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_to_backend_start",{instanceKey:h});var s;q!=null&&(s=(yield q),s.success||d("MAWQplProxy").sendQplPointThroughBridge(g,"optimistic_upload_failure",{annotations:{string:{optimisticUploadError:s.error}},instanceKey:h}));if(s==null||!s.success){s==null&&d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_when_no_existing_optimistic_upload",{instanceKey:h});r=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:j,fileSize:k.size,serverMediaType:b,uploadEntry:"sendMediaMsg"}));s=(yield this.uploadToWaapi(j,a,c,b,f,k,r))}if(!s.success){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(m(),l);d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_to_backend_fail",{instanceKey:h});d("MAWQplProxy").sendQPLStringAnnotationThroughBridge(g,"errorDescription",s.error,h);yield this.updateSystemAckWithTxn(l,d("MAWAckLevel").ACK.failed);return d("WAResultOrError").makeError({isRetriable:!1,type:"media-error"})}d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_to_backend_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"persist_media_entry_start",{instanceKey:h});yield this.perisitMediaEntryForQuickMediaSend(c,l,s.value);d("MAWQplProxy").sendQplPointThroughBridge(g,"persist_media_entry_end",{instanceKey:h});q=this.getProtobufData(e,i,c,k,n,j);d("MAWQplProxy").sendQplPointThroughBridge(g,"send_written_msg_start",{instanceKey:h});b=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:a.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(g,h),"MAWSendMediaMsg",q));d("MAWQplProxy").sendQplPointThroughBridge(g,"send_written_msg_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"clean_up_memory_start",{instanceKey:h});o["delete"](c);(p==null?void 0:p.previewPlaintextHash)!=null&&o["delete"](p.previewPlaintextHash);d("MAWQplProxy").sendQplPointThroughBridge(g,"clean_up_memory_end",{instanceKey:h});if(b.success===!1)return d("WAResultOrError").makeError(b.error);else{f={chatJid:a.protocolMsgId.chat,content:i.content,ephemeralSetting:i.ephemeralSetting,externalId:a.protocolMsgId.externalId,fileType:k.type,initiatingSource:i.initiatingSource,messageType:"sendMsg",quote:i.quote,source:i.source,specialTextSize:i.specialTextSize,xmaMessageType:i.xmaMessageType};return d("WAResultOrError").makeResult(f)}});function c(b,c,d,e,f,g,h){return a.apply(this,arguments)}return c}();e.saveAndPassOffForQuickSend=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,i,j,k,m){var n=e.mediaType;e=e.serverMediaType;var o=g.args;g.attachmentType;var p=g.chatJid;g.externalId;var q=g.file;g=g.filename;var r=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(e);if(!r){d("EBLogger").EBLogger.tags(["unsupported_media"]).mustfix("unsupported media type");d("MAWQplProxy").sendQplPointThroughBridge(i,"failed_media_unsupported_type",{instanceKey:j});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Media type unsupported: "+(e!=null?e:""))}d("MAWQplProxy").sendQplPointThroughBridge(i,"get_validated_media_info_start",{instanceKey:j});r=a.msgId;var s=this.constructMediaInfo(n,o);d("MAWQplProxy").sendQplPointThroughBridge(i,"get_validated_media_info_end",{instanceKey:j});d("MAWQplProxy").sendQplPointThroughBridge(i,"attach_hash_and_save_media_start",{instanceKey:j});yield this.attachHashAndSaveMedia(p,a.protocolMsgId,q,f,void 0,void 0,n,s,o.offlineAttachmentId,o.accessibilityLabel);d("MAWQplProxy").sendQplPointThroughBridge(i,"attach_hash_and_save_media_end",{instanceKey:j});var t=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),u=t.get(f),v=u==null?void 0:u.optimisticUploadPromise,w=v!=null;d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(i,"isOptimisticUpload",w,j);d("MAWQplProxy").sendQplPointThroughBridge(i,"upload_media_to_backend_start",{instanceKey:j});var x;if(v!=null){w=(yield (h||(h=b("Promise"))).all([v,m]));x=w[0];d("MAWQplProxy").sendQplPointThroughBridge(i,"fetch_devices_end",{instanceKey:j});x.success||d("MAWQplProxy").sendQplPointThroughBridge(i,"optimistic_upload_failure",{annotations:{string:{optimisticUploadError:x.error}},instanceKey:j})}if(x==null||!x.success){x==null&&d("MAWQplProxy").sendQplPointThroughBridge(i,"upload_media_when_no_existing_optimistic_upload",{instanceKey:j});v=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:p,fileSize:q.size,serverMediaType:e,uploadEntry:"sendMediaMsg"}));w=(yield (h||(h=b("Promise"))).all([this.uploadToWaapi(p,a,f,e,g,q,v),m]));x=w[0];d("MAWQplProxy").sendQplPointThroughBridge(i,"fetch_devices_end",{instanceKey:j})}if(!x.success){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(l(),r);d("MAWQplProxy").sendQplPointThroughBridge(i,"upload_media_to_backend_fail",{instanceKey:j});d("MAWQplProxy").sendQPLStringAnnotationThroughBridge(i,"errorDescription",x.error,j);return d("WAResultOrError").makeError({isRetriable:!1,type:"media-error"})}d("MAWQplProxy").sendQplPointThroughBridge(i,"upload_media_to_backend_end",{instanceKey:j});d("MAWQplProxy").sendQplPointThroughBridge(i,"persist_media_entry_start",{instanceKey:j});e=d("WAMediaUtils").encodeMediaEntryForUpload(x.value);d("MAWQplProxy").sendQplPointThroughBridge(i,"persist_media_entry_end",{instanceKey:j});g=this.getProtobufData(n,o,f,q,s,p,e);d("MAWQplProxy").sendQplPointThroughBridge(i,"send_written_msg_start",{instanceKey:j});v=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:a.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(i,j),"MAWSendMediaMsg",g));d("MAWQplProxy").sendQplPointThroughBridge(i,"send_written_msg_end",{instanceKey:j});d("MAWQplProxy").sendQplPointThroughBridge(i,"clean_up_memory_start",{instanceKey:j});t["delete"](f);(u==null?void 0:u.previewPlaintextHash)!=null&&t["delete"](u.previewPlaintextHash);d("MAWQplProxy").sendQplPointThroughBridge(i,"clean_up_memory_end",{instanceKey:j});if(v.success===!1)return d("WAResultOrError").makeError(v.error);else{d("MAWQplProxy").sendQplPointThroughBridge(i,"persist_message_and_media_start",{instanceKey:j});m=(yield this.persistMessageAndMedia({blob:q,blobArrayBuffer:yield d("WABlobToArrayBuffer").blobToArrayBuffer(q),chatJid:p,externalId:a.protocolMsgId.externalId,jobStartTime:k,mediaEntryData:e,mediaInfo:s,mediaSendArgs:o,mediaType:n,plaintextHash:f,protocolMsgId:a.protocolMsgId,qplEventType:i,qplInstanceKey:j,serverTs:v.value.serverTs}));d("MAWQplProxy").sendQplPointThroughBridge(i,"persist_message_and_media_end",{instanceKey:j});d("MAWQplProxy").sendQplPointThroughBridge(i,"persist_message_and_media_end",{instanceKey:j});w=m!=null?m:[];r=w[0];t=w[1];if(r!=null&&t!=null&&(g==null?void 0:g.messageApplication)!=null&&!d("MAWMpsGating").isEbUploadViaMpsEnabled()){d("MAWQplProxy").sendQplPointThroughBridge(i,"eb_upload_scheduling_start",{instanceKey:j});u=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,g==null?void 0:g.messageApplication).readBuffer();yield c("EBAPI").uploadSentMessage({dbMsg:r,instanceKey:a.protocolMsgId.externalId,isXMAMsg:!1,media:t,messageApplication:g==null?void 0:g.messageApplication,messageApplicationBytes:d("WAAsMessageApplication").castToMessageApplicationBytes(new Uint8Array(u)),protocolMsgId:a.protocolMsgId,serverTs:v.value.serverTs,xmaPayload:void 0});d("MAWQplProxy").sendQplPointThroughBridge(i,"eb_upload_scheduling_end",{instanceKey:j})}p={chatJid:a.protocolMsgId.chat,content:o.content,ephemeralSetting:o.ephemeralSetting,externalId:a.protocolMsgId.externalId,fileType:q.type,initiatingSource:o.initiatingSource,messageType:"sendMsg",quote:o.quote,source:o.source,specialTextSize:o.specialTextSize,xmaMessageType:o.xmaMessageType};return d("WAResultOrError").makeResult(p)}});function e(b,c,d,e,f,g,h,i){return a.apply(this,arguments)}return e}();e.sendMediaMsg=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=c("gkx")("1165");d("MAWQplProxy").sendQplPointThroughBridge(e,"fetch_devices_start",{instanceKey:f});var h=c("WAAPI").getDevicesBeforeSend({chatJid:a.chatJid,reason:"SendMediaMsg"});g||(yield h,d("MAWQplProxy").sendQplPointThroughBridge(e,"fetch_devices_end",{instanceKey:f}));d("MAWQplProxy").sendQplPointThroughBridge(e,"write_msg_to_db_start",{instanceKey:f});var i=(yield this.writeToDb({args:a.args,attachmentType:a.attachmentType,chatJid:a.chatJid,externalId:a.externalId,file:a.file},b,e,f)),j=i[0];i=i[1];d("MAWQplProxy").sendQplPointThroughBridge(e,"write_msg_to_db_end",{instanceKey:f});d("MAWQplProxy").sendQplPointThroughBridge(e,"gen_blob_hashes_start",{instanceKey:f});var k=(yield d("MAWMediaUtils").genBlobHashes(a.file)),l=k[0];k=k[1];d("MAWQplProxy").sendQplPointThroughBridge(e,"gen_blob_hashes_end",{instanceKey:f});d("MAWQplProxy").sendQplPointThroughBridge(e,"save_and_pass_off_start",{instanceKey:f});g?g=(yield this.saveAndPassOffForQuickSend(j,i,l,a,e,f,b,h)):g=(yield this.saveAndPassOff(j,i,l,k,a,e,f));d("MAWQplProxy").sendQplPointThroughBridge(e,"save_and_pass_off_end",{instanceKey:f});return g});function e(b,c,d,e){return a.apply(this,arguments)}return e}();return a}();var o=function(e){babelHelpers.inheritsLoose(a,e);function a(){return e.apply(this,arguments)||this}var f=a.prototype;f.writeToDb=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){var i=a.args,l=a.attachmentType,m=a.chatJid,o=a.externalId;a=a.file;d("MAWMessageSendsCommon").messageSendLogger.DEBUG(k(),m);a=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.type,void 0,l);l=a.mediaType;a=a.serverMediaType;var p=n(l),q=c("gkx")("1165");d("MAWMessageSendsCommon").messageSendLogger.DEBUG(j(),p);if(q){q=(yield this.checkThreadExists(m));if(!q){d("MAWQplProxy").sendQplPointThroughBridge(f,"missing_db_thread",{instanceKey:g});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Failed to write msg to DB - thread missing")}return(h||(h=b("Promise"))).resolve([{msgId:c("nullthrows")(d("MAWDbMsg").toMsgId(m+"_"+o+"_m")),protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:m,externalId:o},type:"not_sent"},{mediaType:l,serverMediaType:a}])}q=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(o,m,e,i,p,f,g));if(q.type==="missing_thread"){d("MAWQplProxy").sendQplPointThroughBridge(f,"writing_media_to_db_failed",{instanceKey:g});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Failed to write msg to DB - thread missing")}return[q,{mediaType:l,serverMediaType:a}]});function e(b,c,d,e){return a.apply(this,arguments)}return e}();f.attachHashAndSaveMedia=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,i,j,k,l,m,n){var o=c("gkx")("1165");if(o)return(h||(h=b("Promise"))).resolve();var p=(yield d("WABlobToArrayBuffer").blobToArrayBuffer(f));return d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE},"attachHashAndSaveMedia",function(b){return function(){return d("MAWDexieTable").dexieAll([d("MAWMediaManagementTxns").attachHashToMediaMsg(b,e,g,i,j,k,f.size,l,!1,n!=null?n:void 0),d("MAWDbChunkTxns").getOrCreateMediaChunkWithPlaintextHash(b,g,p,f.type)]).then(function(e){var f=e[0];return b.messages.where("msgId").anyOf(f.msgIds).toArray().then(function(e){var h=d("MAWMediaUtils").createHdTypesForBridgeMedia(e);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"sent_media",hash:g,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"});e=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:a,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(e,a),hasMediaForUI:!0,hdTypes:h,media:f,offlineAttachmentId:m});d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(b,e)})})}})()});function e(b,c,d,e,f,g,h,i,j,k){return a.apply(this,arguments)}return e}();f.maybePersistMediaEntry=function(a,c,e,f){var g=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),i=g.get(a),j=i==null?void 0:i.mediaEntry;if(i==null){if(f!=null){var k=f.qplEventType,l=f.qplInstanceKey;d("MAWQplProxy").sendQplPointThroughBridge(k,"persist_media_skipped_because_upload_entry_null",{instanceKey:l})}return(h||(h=b("Promise"))).resolve()}g.set(a,babelHelpers["extends"]({},i,{msgId:c}));if(j==null){if(f!=null){k=f.qplEventType;l=f.qplInstanceKey;d("MAWQplProxy").sendQplPointThroughBridge(k,"persist_media_skipped_because_optimistic_media_entry_null",{instanceKey:l})}return(h||(h=b("Promise"))).resolve()}return d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY},"maybePersistMediaEntry",function(b){return function(){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(b,a).then(function(a){if(a){var f=babelHelpers["extends"]({},a,{mediaEntries:a.mediaEntries.set(c,j),msgIds:d("WASortedLists").addToSet(a.msgIds,c)});e!=null&&(f=babelHelpers["extends"]({},f,{objectId:d("WAMediaUtils").stringToDeliveryObjectId(e)}));return b.media.update(a.mediaId,f).then(function(f){e!=null&&d("MAWMediaBackupTxns").linkMediaBackup(b,a.mediaId,c,d("WAMediaUtils").stringToDeliveryObjectId(e))})}else throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("media should already exist upon this point")})}})()};f.getUnderlyingMessage=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){d("MAWQplProxy").sendQplPointThroughBridge(b,"get_underlying_message_start",{instanceKey:c});var e=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(a.protocolMsgId));if(!e.success){d("MAWQplProxy").sendQplPointThroughBridge(b,"failed_media_msgid_missing_in_db",{instanceKey:c});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Message missing in db")}e.value!==a.msgId&&d("MAWMessageSendsCommon").messageSendLogger.MUSTFIX(i());d("MAWQplProxy").sendQplPointThroughBridge(b,"get_underlying_message_end",{instanceKey:c})});function c(b,c,d){return a.apply(this,arguments)}return c}();f.updateSystemAckWithTxn=function(a,b){return d("MAWMsgUtil").updateSystemAckWithTxn(a,b)};f.getProtobufData=function(a,b,e,f,g,h,i){var j=c("gkx")("1165");if(!j)return null;j=n(a);a=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMediaEntry(e,c("nullthrows")(i!=null?i:this.getMediaEntry(e)));return{messageApplication:d("SendMsgArgsToProtobuf").createMessageApplication(j,babelHelpers["extends"]({},b,{fileSize:f.size,mediaEntry:a,mediaInfo:g}),h)}};f.uploadToWaapi=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,i){var j=c("gkx")("1165"),k=function(){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};return d("MAWUploadAndHandleMedia").uploadAndHandleMedia({chatJid:a,dbCallbacks:{getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:j?k:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:j?k:d("MAWGetMediaPlaintextApi").getMediaPlaintext,updateMediaEntryForMsg:j?k:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:j?k:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload},filename:f==="document"?g:void 0,hash:e,mediaTypeDetails:{mediaType:f,type:"regular"},plaintext:yield d("WABlobToArrayBuffer").blobToArrayBuffer(h),protocolMsgId:b.protocolMsgId,serverMediaType:f,size:h.size,uploadMediaMetric:i})});function e(b,c,d,e,f,g,h){return a.apply(this,arguments)}return e}();f.checkThreadExists=function(a){return d("MAWCheckThreadExistsTxn").checkThreadExistsTxn(a)};f.persistMessageAndMedia=function(a){var b=a.blob,e=a.blobArrayBuffer,f=a.chatJid,g=a.externalId,h=a.jobStartTime,i=a.mediaEntryData,j=a.mediaInfo,k=a.mediaSendArgs,l=a.mediaType,m=a.plaintextHash,o=a.protocolMsgId,p=a.qplEventType,q=a.qplInstanceKey,r=a.serverTs;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READWRITE,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"persistMessageAndMedia",function(a){return function(){var s=n(l);d("MAWQplProxy").sendQplPointThroughBridge(p,"persist_message_start",{instanceKey:q});return d("MAWWriteOutgoingMsgApi").writeOutgoingMsgImpl(a,g,f,h,k,s,p,q).then(function(a){if(a.type==="missing_thread"){d("MAWQplProxy").sendQplPointThroughBridge(p,"writing_media_to_db_failed",{instanceKey:q});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Failed to write msg to DB - thread missing")}d("MAWQplProxy").sendQplPointThroughBridge(p,"persist_message_end",{instanceKey:q});return a}).then(function(g){var h;d("MAWQplProxy").sendQplPointThroughBridge(p,"persist_media_and_chunk_start",{instanceKey:q});return d("MAWDexieTable").dexieAll([d("MAWMediaManagementTxns").attachHashToMediaMsg(a,o,m,void 0,void 0,l,b.size,j,!1,(h=k.accessibilityLabel)!=null?h:void 0,i),d("MAWDbChunkTxns").getOrCreateMediaChunkWithPlaintextHash(a,m,e,b.type)]).then(function(b){var e=b[0];d("MAWQplProxy").sendQplPointThroughBridge(p,"persist_media_and_chunk_end",{instanceKey:q});d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"sent_media",hash:m,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"});return a.messages.where("msgId").anyOf(e.msgIds).toArray().then(function(b){var c=d("MAWMediaUtils").createHdTypesForBridgeMedia(b);b=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:f,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,f),hasMediaForUI:!0,hdTypes:c,media:e,offlineAttachmentId:k.offlineAttachmentId});d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(a,b)}).then(function(){d("MAWQplProxy").sendQplPointThroughBridge(p,"mark_message_as_sent_start",{instanceKey:q});return d("MAWDbMsgTxns").updateSystemAck(a,g.msgId,d("MAWAckLevel").ACK.sent,r)}).then(function(b){d("MAWQplProxy").sendQplPointThroughBridge(p,"mark_message_as_sent_end",{instanceKey:q});if(b!=null&&b.ephemeralSetting!=null){d("MAWQplProxy").sendQplPointThroughBridge(p,"mark_ephemeral_message_as_sent_start",{instanceKey:q});return d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,b,!0).then(function(a){d("MAWQplProxy").sendQplPointThroughBridge(p,"mark_ephemeral_message_as_sent_end",{instanceKey:q});return[a!=null?a:b,e]})}return[b,e]})})})}})()};return a}(e),p=function(e){babelHelpers.inheritsLoose(a,e);function a(){return e.apply(this,arguments)||this}var f=a.prototype;f.writeToDb=function(a){var c=a.attachmentType,e=a.chatJid,f=a.externalId;a=a.file;a=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.type,void 0,c);c=a.mediaType;a=a.serverMediaType;return(h||(h=b("Promise"))).resolve([{msgId:d("MpsToBridgeMessageId").mpsToBridgeMsgId(d("MpsTypes").toThreadId(e),d("MpsTypes").toMessageId(f)),protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:e,externalId:f},type:"not_sent"},{mediaType:c,serverMediaType:a}])};f.attachHashAndSaveMedia=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){a=(yield d("WABlobToArrayBuffer").blobToArrayBuffer(c));yield d("MpsMediaManager").storeChunk(e,a,c.type)});function c(b,c,d,e){return a.apply(this,arguments)}return c}();f.maybePersistMediaEntry=function(a,c){var e=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),f=e.get(a);if(f==null)return(h||(h=b("Promise"))).resolve();e.set(a,babelHelpers["extends"]({},f,{msgId:c}));return(h||(h=b("Promise"))).resolve()};f.getUnderlyingMessage=function(){return(h||(h=b("Promise"))).resolve()};f.updateSystemAckWithTxn=function(){return(h||(h=b("Promise"))).resolve()};f.getProtobufData=function(a,b,e,f,g,h,i){a=n(a);i=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMediaEntry(e,c("nullthrows")(i!=null?i:this.getMediaEntry(e)));return{messageApplication:d("SendMsgArgsToProtobuf").createMessageApplication(a,babelHelpers["extends"]({},b,{fileSize:f.size,mediaEntry:i,mediaInfo:g}),h)}};f.uploadToWaapi=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g,i,j){var k=this;return d("MAWUploadAndHandleMedia").uploadAndHandleMedia({chatJid:a,dbCallbacks:{getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:function(){return(h||(h=b("Promise"))).resolve(new(d("WAMsgMap").MsgMap)())},getMediaPlaintext:function(){return(h||(h=b("Promise"))).resolve(i)},updateMediaEntryForMsg:function(a,c,d){k.updateMediaEntry(a,d);return(h||(h=b("Promise"))).resolve()},updateMediaEntryForOptimisticUpload:function(a,c){k.updateMediaEntry(a,c);return(h||(h=b("Promise"))).resolve()}},filename:f==="document"?g:void 0,hash:e,mediaTypeDetails:{mediaType:f,type:"regular"},plaintext:yield d("WABlobToArrayBuffer").blobToArrayBuffer(i),protocolMsgId:c.protocolMsgId,serverMediaType:f,size:i.size,uploadMediaMetric:j})});function c(b,c,d,e,f,g,h){return a.apply(this,arguments)}return c}();f.checkThreadExists=function(a){return(h||(h=b("Promise"))).resolve(!0)};f.persistMessageAndMedia=function(a){return null};return a}(e);function q(){return d("MAWMpsGating").isFullMpsEnabled()?new p():new o()}function a(a){var b=a.qplEventType,c=a.qplInstanceKey,e=babelHelpers.objectWithoutPropertiesLoose(a,["qplEventType","qplInstanceKey"]),f=q();return d("MAWMessageSendsCommon").messageSendObserver(b,c,function(g){var h;return f.sendMediaMsg(e,(h=d("MAWTSUtils").gatedLSOptimisticTsToMaybeUnixTime((h=a.args)==null?void 0:(h=h.optimisticMsg)==null?void 0:h.ts))!=null?h:g,b,c)},"media",{author:d("WAJids").AUTHOR_ME,chat:a.chatJid,externalId:a.externalId})}g.mediaSender=q;g.sendMediaMsgFn=a}),98);
__d("MAWWriteLocalXMAMsgApi",["FBLogger","MAWAckLevel","MAWAuthor","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAJids","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msgToQuotedMsg-XMA: Unsupported message type ",""]);h=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"writeLocalXMAMsg",function(a){return function(b,c,e,f,g){f.content!=null&&(f.content=d("MAWVault").vault(f.content));return d("MAWDexieTable").dexieAll([a.threads.get({jid:c}),a.messages.where("externalId").equals(b).toArray(),i(a,f.quote,c)]).then(function(c){var h=c[0],i=c[1];c=c[2];if(h==null)return{type:"missing_thread"};i=i.find(function(a){return a.threadJid===h.jid&&a.author===g});if(i!=null)return{protocolMsgId:{author:g,chat:h.jid,externalId:i.externalId},type:"already_sent"};else{i={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:g,ephemeralSetting:f.ephemeralSetting,externalId:b,isForwarded:f.isForwarded,specialTextSize:f.specialTextSize,threadJid:h.jid,ts:e};i=j(i,f,c);c=f.isFirstMsg;var k=f.openMessageOtid,l=f.openMessageParticipantCount,m=f.optimisticMsg,n=f.participantCount;return d("MAWWriteMsgTxns").writeMsg(a,i,h,{isCurrentDeviceSendingMsg:!0,isFirstMsg:c,isOutgoing:!0,openMessageOtid:k,openMessageParticipantCount:l,optimisticMsg:m,participantCount:n}).then(function(){return{protocolMsgId:{author:g,chat:h.jid,externalId:b},type:"sent"}})}})}});function i(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){var e=b?k(b):null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&e!=null&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function j(a,b,e){var f,g;if(b.quote!=null&&(e==null?void 0:e.content)!=null){var h;g=e==null?void 0:(h=e.content)==null?void 0:h.externalId;f={content:e==null?void 0:e.content,remoteJid:(h=e==null?void 0:e.remoteJid)!=null?h:void 0}}if(b.xmaMessageType==null)throw c("FBLogger")("messenger_web").mustfixThrow("XMA Message Missing xmaMessageType");return babelHelpers["extends"]({},a,{quote:f,quoteExternalId:g,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:b.xmaMessageType})}function k(a){var b={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},b,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("MAWMsgType").MSG_TYPE.RAVEN:return babelHelpers["extends"]({},b,{ravenEphemeralMediaState:a.ravenEphemeralMediaState,ravenEphemeralType:a.ravenEphemeralType,ravenMediaType:a.ravenMediaType,type:d("MAWMsgType").MSG_TYPE.RAVEN});default:d("WALogger").ERROR(h(),a.type);throw c("FBLogger")("messenger_web").mustfixThrow("Trying to reply to a message type that does not support replies")}}g.writeLocalXMAMsg=b}),98);
__d("MAWSaveRTCCallXMAMsg",["MAWAckLevel","MAWBridgeXMA","MAWDexieTable","MAWExternalId","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetMsgIdByProtocolMsgId","MAWGetOrCreateMediaKnownEntriesApi","MAWIndexedDb","MAWMediaManagementTxns","MAWMediaUtils","MAWMsgUtil","MAWOptimisticUploadManager","MAWSendMediaMsg","MAWStartMediaUploadQplFlow","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWWriteLocalXMAMsgApi","MAWXMAManagementTxns","Promise","WAAPI","WAArmadilloXMA.pb","WABlobToArrayBuffer","WALogger","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media xma"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSaveRTCCallXMAMsg - Message missing in db"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma - missing thread"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSaveRTCCallXMAMsg - XMAMessageType is null"]);l=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.args,c=a.author,e=a.chatJid,f=a.faviconFile,g=a.ts;a=a.xmaArgs;var h=b.xmaMessageType;if(h==null){d("WALogger").ERROR(l());return}g=(yield d("MAWWriteLocalXMAMsgApi").writeLocalXMAMsg(d("MAWExternalId").generateExternalId(),e,g,b,c));if(g.type==="missing_thread"){d("WALogger").ERROR(k());return}b=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(g.protocolMsgId));if(!b.success){d("WALogger").ERROR(j());return}c=b.value;a=babelHelpers["extends"]({},a,{overlayIconGlyph:(b=a.overlayIconGlyph)!=null?b:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE});b=(yield p(f,c,h,g.protocolMsgId,a));f=d("MAWOptimisticUploadManager").getOptimisticUploadManager();h=(yield o(b,e,g.protocolMsgId,f));if(!(h==null?void 0:h.uploadResult.success)){d("WALogger").ERROR(i());return d("MAWMsgUtil").updateSystemAckWithTxn(c,d("MAWAckLevel").ACK.failed)}a=h.uploadResult;b=h.media;yield d("MAWSendMediaMsg").mediaSender().maybePersistMediaEntry(b.plaintextHash,c,a==null?void 0:(e=a.value)==null?void 0:e.objectId);f["delete"](h.media.plaintextHash)});return function(b){return a.apply(this,arguments)}}();function m(a,b,c,d,e,f){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){h=h.get(a);h=h==null?void 0:h.optimisticUploadPromise;if(h!=null)return h;h=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:b,fileSize:g,serverMediaType:f,uploadEntry:"saveRTCCallXMAMsg"}));return c("WAAPI").uploadMedia({chatJid:b,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:function(a){return d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries(a)},getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,hash:a,mediaTypeDetails:{mediaType:f,type:"regular"},protocolMsgId:e,size:g,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:h})});return n.apply(this,arguments)}function o(a,c,e,f){if(a==null)return(h||(h=b("Promise"))).resolve();var g=d("MAWMediaUtils").getServerMediaTypeFromMediaType(a.mediaType,"xma-media");return m(a.plaintextHash,c,e,g,a.size,f).then(function(b){return{media:a,uploadResult:b}})}function p(a,b,c,d,e){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e){a=(yield r(a));return t(b,a,c,d,e)});return q.apply(this,arguments)}function r(a){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a==null)return a;var b=a.file,e=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type),f=e.mediaType;e=e.serverMediaType;var g=(yield d("MAWMediaUtils").genBlobHashes(b)),h=g[0];g=g[1];if(f!=="Image")throw c("err")("Expected Image when sending XMA share");var i=(yield d("WABlobToArrayBuffer").blobToArrayBuffer(b));return{blobArrayBuffer:i,file:b,hashedPlaintextHash:g,mediaInfo:{validatedAudioInfo:null,validatedDocumentFileInfo:null,validatedImageInfo:{height:a.height,width:a.width},validatedVideoInfo:null},mediaType:f,plaintextHash:h,serverMediaType:e}});return s.apply(this,arguments)}function t(a,b,c,e,f){var g;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(g=d("MAWTransactionMode")).READWRITE,media:g.READWRITE,mediaBackup:g.READWRITE,messages:g.READWRITE,unrenderedMessages:g.READWRITE,xma:g.READWRITE},"saveRTCXMAMediaAndMetadata",function(g){return function(){var h=new Map();if(b!=null){var i=h.get(b.plaintextHash);i==null&&h.set(b.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(g,e,b.blobArrayBuffer,b.plaintextHash,void 0,void 0,b.mediaType,b.mediaInfo,b.file,!1))}i=Array.from(h.values());return d("MAWDexieTable").dexieAll(i).then(function(h){h=h.reduce(function(a,b){return a.set(b.plaintextHash,b)},new Map());var i=b!=null?h.get(b.plaintextHash):void 0;return d("MAWXMAManagementTxns").saveXMA(g,void 0,void 0,i==null?void 0:i.mediaId,c,a,void 0,e,f,void 0,void 0,void 0,i==null?void 0:i.plaintextHash).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:d("MAWBridgeXMA").createBridgeXMA(i,a,{hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1})});return i})})}})()}g.saveRTCCallXMAMsg=a}),98);
__d("MAWMessageComposingHooks",["MWFBLogger","Promise","WAAPI","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Querying group info ahead of group message send: ",""]);j=function(){return a};return a}var k=d("MWFBLogger").MWLogger.tags(["MAWMessageComposingHooks"]);function a(a,b){m(a)["catch"](function(a){k.catching(a).mustfix("Caught while calling maybeGetGroupInfoAheadOfGroupMessageSend hook for chat state composer.")})}var l=new Set();function m(a){return d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){if(l.has(a))return(h||(h=b("Promise"))).resolve();k.DEBUG(j(),a);l.add(a);return c("WAAPI").queryGroups({groups:[a],type:"array"})["catch"](function(a){k.catching(a).MUSTFIX(i())})},user:function(){return(h||(h=b("Promise"))).resolve()}})}g.callMessageComposingHooks=a}),98);
__d("WASmaxOutChatstateInternalTestMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.testConfig;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxJsx").smax("test",{config:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeInternalTestMixin=a}),98);
__d("WASmaxOutChatstateComposingMixin",["WASmaxAttrs","WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.hasComposingMediaAudio;a=d("WASmaxJsx").smax("chatstate",null,d("WASmaxJsx").smax("composing",{media:d("WASmaxAttrs").OPTIONAL_LITERAL("audio",a)}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeComposingMixin=a}),98);
__d("WASmaxOutChatstatePausedMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("chatstate",null,d("WASmaxJsx").smax("paused",null));return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergePausedMixin=a}),98);
__d("WASmaxOutChatstateStateTypes",["WASmaxMixinGroupExhaustiveError","WASmaxOutChatstateComposingMixin","WASmaxOutChatstatePausedMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.composing)return d("WASmaxOutChatstateComposingMixin").mergeComposingMixin(a,b.composing);if(b.isPaused)return d("WASmaxOutChatstatePausedMixin").mergePausedMixin(a);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeStateTypes=a}),98);
__d("WASmaxOutChatstateClientNotificationRequest",["WASmaxJsx","WASmaxMixins","WASmaxOutChatstateInternalTestMixin","WASmaxOutChatstateStateTypes","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.chatstateTo,c=a.internalTestMixinArgs;a=a.stateTypesArgs;b=d("WASmaxOutChatstateStateTypes").mergeStateTypes(d("WASmaxMixins").optionalMerge(d("WASmaxOutChatstateInternalTestMixin").mergeInternalTestMixin,d("WASmaxJsx").smax("chatstate",{to:d("WAWap").JID(b)}),c),a);return b}g.makeClientNotificationRequest=a}),98);
__d("WASmaxChatstateClientNotificationRPC",["WAComms","WASmaxOutChatstateClientNotificationRequest","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WASmaxOutChatstateClientNotificationRequest").makeClientNotificationRequest(a);yield d("WAComms").castSmaxStanza(a)});return h.apply(this,arguments)}g.sendClientNotificationRPC=a}),98);
__d("WASendChatStateProtocol",["WALogger","WASmaxChatstateClientNotificationRPC"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendChatStateProtocol Sending "," to ",""]);h=function(){return a};return a}function a(a,b){d("WALogger").LOG(h(),b,a);var c;b==="idle"?c={isPaused:!0}:(b,c={composing:{hasComposingMediaAudio:b==="recording_audio"}});return d("WASmaxChatstateClientNotificationRPC").sendClientNotificationRPC({chatstateTo:a,stateTypesArgs:c})}g.sendChatStateProtocol=a}),98);
__d("MAWSendChatStateFromComposerApi",["FBLogger","MAWIndexedDb","MAWMessageComposingHooks","MAWTransactionMode","Promise","WASendChatStateProtocol","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){var e=a.chatJid;a=a.state;d("WASendChatStateProtocol").sendChatStateProtocol(e,a)["catch"](function(a){return c("FBLogger")(a).mustfix("Caught while sending chat state from composer.")});d("MAWMessageComposingHooks").callMessageComposingHooks(e,a);return(h||(h=b("Promise"))).resolve()};e=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY},"sendChatStateFromComposer",function(a){return function(b){var e=b.chatJid,f=b.state;return a.threads.get({jid:e}).then(function(a){if(a==null)return;a=a.jid;d("WASendChatStateProtocol").sendChatStateProtocol(a,f)["catch"](function(a){return c("FBLogger")(a).mustfix("Caught while sending chat state from composer.")});d("MAWMessageComposingHooks").callMessageComposingHooks(e,f)})}});f=c("gkx")("10111")?a:e;g.sendChatStateFromComposer=f}),98);
__d("MAWWriteEditMsgApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteEditTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"writeEditMsg",function(a){return function(b,c,e){c={args:c,externalId:b,ts:e};return d("MAWWriteEditTxns").writeEdit(a,c).then(function(a){return a})}});g.writeEditMsg=b}),98);
__d("MAWSendEditMsg",["MAWMessageSendsCommon","MAWMpsGating","MAWMsgType","MAWSendWrittenMsg","MAWWriteEditMsgApi","SendMsgArgsToProtobuf","WAJids","WAQPLProxy","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendEditMsg already sent a message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendEditMsg cannot edit to a non-existent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendEditMsg cannot send to a non-existent thread"]);j=function(){return a};return a}function k(a,b,c,d,e,f){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){if(d("MAWMpsGating").isFullMpsEnabled()){var k={author:d("WAJids").AUTHOR_ME,chat:b,externalId:c};b={messageApplication:d("SendMsgArgsToProtobuf").createMessageApplication(d("MAWMsgType").MSG_TYPE.EDIT_ACTION,a,b)};b=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:k,referencedOriginalExternalId:c,type:"edit"},d("WAQPLProxy").waQPLProxyStartResume(f,g),"MAWSendEditMsg",b));if(b.success===!1)return d("WAResultOrError").makeError(b.error);else return d("WAResultOrError").makeResult({chatJid:k.chat,content:a.editMsgContent.content,externalId:k.externalId,messageType:"editMsg",specialTextSize:a.specialTextSize})}b=(yield d("MAWWriteEditMsgApi").writeEditMsg(c,a,e));if(!b.success)if(b.error==="missing_thread"){d("MAWMessageSendsCommon").messageSendLogger.WARN(j());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}else if(b.error==="missing_msg"){d("MAWMessageSendsCommon").messageSendLogger.WARN(i());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-referenced-msg"})}else{b.error;d("MAWMessageSendsCommon").messageSendLogger.WARN(h());return d("WAResultOrError").makeError({isRetriable:!1,type:"already-sent"})}k=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:b.value.protocolMsgId,referencedOriginalExternalId:b.value.originalMsgExternalId,type:"edit"},d("WAQPLProxy").waQPLProxyStartResume(f,g),"MAWSendEditMsg"));if(k.success===!1)return d("WAResultOrError").makeError(k.error);else return d("WAResultOrError").makeResult({chatJid:b.value.protocolMsgId.chat,content:a.editMsgContent.content,externalId:b.value.protocolMsgId.externalId,messageType:"editMsg",specialTextSize:a.specialTextSize})});return l.apply(this,arguments)}function a(a){var b=a.args,c=a.chatJid,e=a.externalId,f=a.qplEventType,g=a.qplInstanceKey;return d("MAWMessageSendsCommon").messageSendObserver(f,g,function(a){return k(b,c,e,a,f,g)},"edit",{author:d("WAJids").AUTHOR_ME,chat:c,externalId:e})}g.sendEditMsgFn=a}),98);
__d("MAWSendMsg",["MAWMessageSendsCommon","MAWMpsGating","MAWMsgType","MAWQplProxy","MAWSendWrittenMsg","MAWTSUtils","MAWWriteOutgoingMsgApi","SendMsgArgsToProtobuf","WAAPI","WAJids","WAQPLProxy","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg: ",""]);j=function(){return a};return a}function a(a){var b=a.args,c=a.chatJid,e=a.externalId,f=a.qplEventType,g=a.qplInstanceKey;return d("MAWMessageSendsCommon").messageSendObserver(f,g,function(a){var h;return k(b,c,e,(h=d("MAWTSUtils").gatedLSOptimisticTsToMaybeUnixTime((h=b.optimisticMsg)==null?void 0:h.ts))!=null?h:a,f,g)},"msg",{author:d("WAJids").AUTHOR_ME,chat:c,externalId:e})}function k(a,b,c,d,e,f){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,k){d("MAWQplProxy").sendQplPointThroughBridge(g,"received_message_in_wajob",{instanceKey:k});d("MAWQplProxy").sendQplPointThroughBridge(g,"fetch_devices_start",{instanceKey:k});yield c("WAAPI").getDevicesBeforeSend({chatJid:b,reason:"sendMsg"});d("MAWQplProxy").sendQplPointThroughBridge(g,"fetch_devices_end",{instanceKey:k});var l=null;!d("MAWMpsGating").isFullMpsEnabled()?f=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(e,b,f,a,d("MAWMsgType").MSG_TYPE.TEXT,g,k)):(f={protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:b,externalId:e}},l={messageApplication:d("SendMsgArgsToProtobuf").createMessageApplication(d("MAWMsgType").MSG_TYPE.TEXT,a,b)});d("MAWMessageSendsCommon").messageSendLogger.DEBUG(j(),b);if(f.type==="already_sent"){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(i());d("MAWQplProxy").sendQplPointThroughBridge(g,"message_already_sent_to_backend",{instanceKey:k});return d("WAResultOrError").makeError({isRetriable:!1,type:"already-sent"})}if(f.type==="missing_thread"){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(h());d("MAWQplProxy").sendQplPointThroughBridge(g,"failed_message_missing_thread",{instanceKey:k});return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}d("MAWQplProxy").sendQplPointThroughBridge(g,"sending_message_start",{instanceKey:k});e=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:f.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(g,k),"MAWSendMsg",l));if(e.success===!0){d("MAWQplProxy").sendQplPointThroughBridge(g,"sending_message_end",{instanceKey:k});b={chatJid:f.protocolMsgId.chat,content:a.content,ephemeralSetting:a.ephemeralSetting,externalId:f.protocolMsgId.externalId,initiatingSource:a.initiatingSource,messageType:"sendMsg",quote:a.quote,source:a.source,specialTextSize:a.specialTextSize,xmaMessageType:a.xmaMessageType};return d("WAResultOrError").makeResult(b)}else{d("MAWQplProxy").sendQplPointThroughBridge(g,"sending_message_fail",{annotations:{string:{errorType:e.error.type}},instanceKey:k});return d("WAResultOrError").makeError(e.error)}});return l.apply(this,arguments)}g.sendMsgFn=a}),98);
__d("MAWWritePollApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteGroupPollCreateTxns","WAJids"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,poll:d("MAWTransactionMode").READWRITE},"writePoll",function(a){return function(b,c,e,f,g){return d("MAWWriteGroupPollCreateTxns").savePollToDb(a,e,f,d("WAJids").AUTHOR_ME,g).then(function(a){d("MAWWriteGroupPollCreateTxns").sendPollToUI(a,b,c)})}});g.writePoll=a}),98);
__d("MAWSendPoll",["MAWGroupPollsDualEncryptionUtils","MAWMessageSendsCommon","MAWMsgType","MAWWriteOutgoingMsgApi","MAWWritePollApi","Promise","WAJids","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=0;function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.args,f=a.chatJid,g=a.externalId,j=a.qplInstanceKey;a=a.ts;var k=e.options,l=e.title,m=(yield (h||(h=b("Promise"))).all(k.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWGroupPollsDualEncryptionUtils").getHashForOptionName(a));return{optionHash:b,optionText:a}});return function(b){return a.apply(this,arguments)}}())));m=new Map(m.map(function(a){var b=a.optionHash;a=a.optionText;return[b,{optionText:a,voteAuthors:new Set()}]}));var n=self.crypto.getRandomValues(new Uint8Array(32)).buffer;e=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(g,f,a,e,d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE,c("qpl")._(25313175,"1551"),j));if(e.type==="missing_thread")return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"});if(e.type==="already_sent")return d("WAResultOrError").makeError({isRetriable:!1,type:"already-sent"});j=e.msgId;e={encKey:n,latestSenderTimestampsMs:new Map(),name:l,options:k,optionsHashed:m,selectableOptionsCount:i};yield d("MAWWritePollApi").writePoll(j,d("WATimeUtils").castUnixTimeToMillisTime(a),f,e,g);return d("WAResultOrError").makeResult({chatJid:f,externalId:g,messageType:"sendPoll"})});return k.apply(this,arguments)}function a(a){var b=a.args,e=a.chatJid,f=a.externalId,g=a.qplInstanceKey;return d("MAWMessageSendsCommon").messageSendObserver(c("qpl")._(25313175,"1551"),g,function(a){return j({args:b,chatJid:e,externalId:f,qplInstanceKey:g,ts:a})},"poll",{author:d("WAJids").AUTHOR_ME,chat:e,externalId:f})}g.sendPoll=a}),98);
__d("MAWSendPollUpdate",["Promise","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult({description:"sendPollUpdate",messageType:"fixMe"}))}g.sendPollUpdate=a}),98);
__d("MAWSendReactionMsg",["MAWIndexedDb","MAWMessageSendsCommon","MAWMpsGating","MAWSendWrittenMsg","MAWTransactionMode","MAWWriteReactionMsgApi","SendMsgArgsToProtobuf","WAAPI","WAJids","WALongInt","WAMsgType","WAQPLProxy","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg cannot react to a non-existent message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg cannot send to a non-existent thread"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg already sent message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendReactionMsg: ",""]);k=function(){return a};return a}function l(a){return a==="\u2764\ufe0f"?"\u2764":a}function m(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=a.args,m=a.chatJid;a=a.externalId;d("MAWMessageSendsCommon").messageSendLogger.DEBUG(k(),m);if(d("MAWMpsGating").isFullMpsEnabled()){var n={author:d("WAJids").AUTHOR_ME,chat:m,externalId:a},q={messageApplication:d("SendMsgArgsToProtobuf").createMessageApplication(d("WAMsgType").MSG_TYPE.REACTION,g,m)};n=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:n,referencedOriginalExternalId:a,type:"edit"},d("WAQPLProxy").waQPLProxyStartResume(e,f),"MAWSendEditMsg",q));if(n.success===!1)return d("WAResultOrError").makeError(n.error);else return d("WAResultOrError").makeResult({chatJid:m,externalId:a,messageType:"reactionMsg",reaction:g.reaction,source:g.source})}q=g.reaction;n=g.reactToProtocolMsgId;q=l(q);var r=d("WAJids").toMsgrUserJid(g.reactToAuthor),s=(yield p(n.externalId));s=(yield o(s));yield c("WAAPI").getDevicesBeforeSend({chatJid:m,reason:"sendReactionMsg"});q=(yield d("MAWWriteReactionMsgApi").writeReactionMsg(a,m,{groupingKey:q,reaction:q,reactToAuthor:r,reactToExternalId:n.externalId,senderTimestampMs:s},b));if(q.type==="already_sent"){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(j());return d("WAResultOrError").makeError({isRetriable:!1,type:"already-sent"})}else if(q.type==="missing_thread"){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(i());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}else if(q.type==="missing_msg"){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(h());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-referenced-msg"})}r=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:q.protocolMsgId,type:"reaction"},d("WAQPLProxy").waQPLProxyStartResume(e,f),"MAWSendReactionMsg"));if(r.success===!1)return d("WAResultOrError").makeError(r.error);else return d("WAResultOrError").makeResult({chatJid:m,externalId:a,messageType:"reactionMsg",reaction:g.reaction,source:g.source})});return n.apply(this,arguments)}function a(a){var b=a.args,c=a.chatJid,e=a.externalId,f=a.qplEventType,g=a.qplInstanceKey;return d("MAWMessageSendsCommon").messageSendObserver(f,g,function(a){return m({args:b,chatJid:c,externalId:e},a,f,g)},"reaction",{author:d("WAJids").AUTHOR_ME,chat:c,externalId:e})}function o(a){a=a.map(function(a){return d("WALongInt").maybeNumberOrThrowIfTooLarge(a.senderTimestampMs)}).filter(Boolean).reduce(function(a,b){return Math.max(a,b)},0);return Math.max((a!=null?a:0)+1,d("WATimeUtils").unixTimeMs())}var p=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY},"findMatchingReactionBeforeSendReactionMsg",function(a){return function(b){return a.reactions.where("reactToExternalId").equals(b).toArray()}});g.sanitizeReaction=l;g.sendReactionMsgFn=a;g.calculateSenderTimestampMs=o}),98);
__d("MAWSendXMAShareMsg",["MAWMessageSendsCommon","WAJids","cr:2959"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var c=a.qplEventType,e=a.qplInstanceKey,f=babelHelpers.objectWithoutPropertiesLoose(a,["qplEventType","qplInstanceKey"]);return d("MAWMessageSendsCommon").messageSendObserver(c,e,function(a){return b("cr:2959")(f,a,c,e)},"xma",{author:d("WAJids").AUTHOR_ME,chat:a.chatJid,externalId:a.xmaMsgExternalId})}g.sendXMAShareMsgFn=a}),98);
__d("MAWSetEphemeralSettingsFromFrontendApi",["FBLogger","MAWEphemeralSettingsTxns","MAWExternalId","MAWIndexedDb","MAWSendEphemeralSettingMsg","MAWTransactionMode","Promise","WAResultOrError","WATimeUtils","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"handleAndWriteOutgoingUserEphemeralSettingChange",function(a){return function(b,c,e,f){return d("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange(a,b,c,e,f)}});e=function(a){var e=a.chatJid,f=a.ephemeralExpirationInSec,g=a.ephemeralLastUpdatedOrSetTimestamp,j=a.isEphemeralSettingReset,k=a.s2sInstanceKey;if(e==null){c("FBLogger")("messenger_web").mustfix("Both chatJid and threadId passed to setEphemeralSettingsFromFrontend are null");return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"}))}var l=g!=null?g:d("WATimeUtils").unixTime();return i(e,f,l,j).then(function(a){if(a.value.shouldUpdateSetting===!1)return d("WAResultOrError").makeResult({description:"send not needed",messageType:"fixMe"});a={ephemeralExpirationInSec:f,ephemeralLastUpdatedOrSetTimestamp:l};return d("MAWSendEphemeralSettingMsg").sendEphemeralSettingMsgFn({args:{ephemeralSetting:a,isEphemeralSettingReset:j,isForSyncResponse:!1},chatJid:e,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:k})})};g.setEphemeralSettingsFromFrontend=e}),98);
__d("MAWSetEphemeralSettingsOfPeerFromMIApi",["MAWDbGroupInfoTxns","MAWDexieTable","MAWEphemeralSettingsTxns","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWIndexedDb").makeMsgrTransactor({ephemeralSettings:(a=d("MAWTransactionMode")).READWRITE,groupInfo:a.READWRITE,messages:a.READWRITE,threads:a.READWRITE},"handleAndWriteIncomingEphemeralSetting",function(a){return function(b,c,e,f,g,h,i){var j=d("WAJids").interpretAsGroupJid(c);j=d("MAWDexieTable").dexieAll([d("MAWGetOrCreateThreadTxns").getExistingThread(a,c),j!=null?d("MAWDbGroupInfoTxns").getGroupInfo(a,j):d("MAWDexieTable").dexieResolve()]);return j.then(function(b){var e=b[0];b=b[1];if(e!=null)return{created:!1,thread:e};b=b==null?void 0:(e=b.value)==null?void 0:e.creationTs;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:b==null?null:d("WATimeUtils").castUnixTimeToMillisTime(b),description:"handleAndWriteIncomingEphemeralSetting",jid:c})}).then(function(c){c=c.thread;return d("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(a,b,e,f,g,c,i,null,h)})}});b=function(a){var b=a.author,c=a.chatJid,d=a.ephemeralExpirationInSec,e=a.ephemeralLastUpdatedOrSetTimestamp,f=a.fromWAI,g=a.isEphemeralSettingReset;a=a.serverTs;return h(b,c,d,e,g,f,a).then(function(){return{success:!0}})};g.setEphemeralSettingsFromMI=b}),98);
__d("MAWUpdateDeviceChangeAlertsApi",["MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE},"updateDeviceChangeAlerts",function(a){return function(b){return d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,b).then(function(b){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a).then(function(){return b})})}});g.updateDeviceChangeAlerts=a}),98);
__d("MAWUpdateLSThreadFromGroupInfoApi",["MAWBridgeTypesCreators","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({groupInfo:d("MAWTransactionMode").READONLY},"updateLSThreadFromGroupInfo",function(a){return function(b){return a.groupInfo.get(b).then(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})}});g.updateLSThreadFromGroupInfo=a}),98);
__d("MAWUpdateMediaDownloadStatusByObjectIdApi",["MAWGetMediaByObjectId","MAWMediaDownloadStatusForUI","MWFBLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMediaDownloadStatusByObjectId - media not found for objectId: ",""]);h=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(yield d("MAWGetMediaByObjectId").getMediaByObjectId(a)),f=e.value;if(f==null||e.success!==!0){d("MWFBLogger").MWMediaLogger.tags(["MediaDownload"]).WARN(h(),a);return}d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:c,hash:f.plaintextHash,status:b,type:"main"})});return function(b,c,d){return a.apply(this,arguments)}}();g.updateMediaDownloadStatusByObjectId=a}),98);
__d("MAWUpdateReceiverFetchInfoApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteReceiverFetchTxns"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({receiverFetchInfo:d("MAWTransactionMode").READWRITE},"MAWUpdateReceiverFetchInfo",function(a){return function(b){var c=b.accessibilitySummaryText,e=b.mimetype,f=b.previewHeight,g=b.previewUrl,h=b.previewUrlExpirationTimestampMs,i=b.previewWidth,j=b.receiverFetchId;b=b.type;return d("MAWWriteReceiverFetchTxns").updateReceiverFetchInfoWithPreviewUrl(a,g,h,j,c,e,f,i,b)}});g.updateReceiverFetchInfo=a}),98);
__d("MpsToMawDbEditMsgHistory",["WAJids","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,c,e=a.deserialize().encryptedTransportMessage();b=e==null?void 0:(b=e.consumerMessage())==null?void 0:(b=b.payload)==null?void 0:(b=b.content)==null?void 0:b.editMessage;e=e==null?void 0:(e=e.consumerMessage())==null?void 0:(e=e.metadata)==null?void 0:e.specialTextSize;return b==null?null:{author:a.getAuthor(),editExternalId:d("WAStanzaUtils").toStanzaId(a.getExternalId()),editTs:a.getUnixTs(),msgContent:{commands:(c=b.message)==null?void 0:c.commands,content:((c=(c=b.message)==null?void 0:c.text)!=null?c:"")+" *",mentionedJids:(c=b.message)==null?void 0:c.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)},sendStatus:1,specialTextSize:e,threadJid:a.getChatJid()}}g.mpsToMawDbEditMsgHistory=a}),98);
__d("MpsToMawDbMsg",["FBLogger","MAWAckLevel","MAWMsgType","MpsAdminMsgToBridge","MpsMediaToBridge","MpsMessageToBridgeWrapper","MpsToMawDbEditMsgHistory","WAJids","WAStanzaUtils","getErrorSafe","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e,f,g,h,i,j,k,l=a.deserialize().encryptedTransportMessage();e=l==null?void 0:(e=l.consumerMessage())==null?void 0:(e=e.payload)==null?void 0:(e=e.content)==null?void 0:e.messageText;f=l==null?void 0:(f=l.consumerMessage())==null?void 0:(f=f.metadata)==null?void 0:f.specialTextSize;g=l==null?void 0:(g=l.proto.metadata)==null?void 0:g.isForwarded;h=l==null?void 0:(h=l.armadillo())==null?void 0:(h=h.proto.payload)==null?void 0:(h=h.content)==null?void 0:(h=h.bumpExistingMessage)==null?void 0:h.key;i=l==null?void 0:(i=l.armadillo())==null?void 0:(i=i.payload)==null?void 0:(i=i.content)==null?void 0:i.extendedContentMessage;j=l==null?void 0:(j=l.consumerMessage())==null?void 0:(j=j.payload)==null?void 0:(j=j.applicationData)==null?void 0:j.revoke;k=(k=a.deserialize().adminMessage())==null?void 0:k.proto;b=((b=b==null?void 0:b.supplementalProtobufs.values().toArray())!=null?b:[]).map(function(b){return d("MpsToMawDbEditMsgHistory").mpsToMawDbEditMsgHistory(d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromSupplemental(b,a.message))}).filter(Boolean).sort(function(a,b){return b.editTs-a.editTs});var m=b.length<=0?null:b[0];m={ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:a.getAuthor(),editCount:b.length,externalId:d("WAStanzaUtils").toStanzaId(a.getExternalId()),isForwarded:g,msgContent:{commands:(g=(b=m==null?void 0:m.msgContent.commands)!=null?b:e==null?void 0:e.commands)!=null?g:[],content:(g=(b=m==null?void 0:m.msgContent.content)!=null?b:e==null?void 0:e.text)!=null?g:"",mentionedJids:(g=(b=m==null?void 0:m.msgContent.mentionedJids)!=null?b:e==null?void 0:e.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean))!=null?g:[]},msgId:a.getMsgId(),quote:void 0,quoteExpirationTs:void 0,quoteExternalId:void 0,serverTs:a.getUnixTs(),sortOrderMs:a.message.timestampMs,specialTextSize:f,threadJid:a.getChatJid(),ts:a.getUnixTs()};if(j!=null)return babelHelpers["extends"]({},m,{revokedExternalId:d("WAStanzaUtils").toStanzaId(a.getExternalId()),type:d("MAWMsgType").MSG_TYPE.REVOKED,unsendMsgContentDeleteTs:a.getUnixTs()});if(h!=null){b=h.id;e=d("WAStanzaUtils").toStanzaId(c("nullthrows")(b));g=d("WAJids").unsafeCoerceToUserJid(c("nullthrows")(h.remoteJid));return babelHelpers["extends"]({},m,{quote:{content:{author:g,externalId:e,ts:void 0,type:d("MAWMsgType").MSG_TYPE.IMAGE},remoteJid:null},quoteExternalId:e,type:d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE})}if(i!=null){f=i.targetType;return babelHelpers["extends"]({},m,{type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:c("nullthrows")(f,"[MPS2MAW] XMA message must have targetType")})}if(k!=null)try{j=c("nullthrows")(d("MpsAdminMsgToBridge").getMessageContent(a.message.senderId,k));return babelHelpers["extends"]({},m,{author:"@system",msgContent:{adminMsgContent:j.adminMsgContent,adminType:j.adminType,version:j.version},type:d("MAWMsgType").MSG_TYPE.ADMIN})}catch(a){c("FBLogger")("mps").catching(c("getErrorSafe")(a)).warn("Failed to get admin message content")}b=d("MpsMediaToBridge").getMediaTypeForMedia(a.deserialize());if(b!=null)switch(b){case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},m,{type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},m,{type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},m,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},m,{type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.STICKER:i=(e=l==null?void 0:(h=l.consumerMessage())==null?void 0:(g=h.stickerMessage())==null?void 0:g.payload)!=null?e:{};f=i.ancillary;k=i.integral;b=(j=k==null?void 0:k.receiverFetchId)!=null?j:f==null?void 0:f.receiverFetchId;return b!=null?babelHelpers["extends"]({},m,{receiverFetchId:b,type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH}):babelHelpers["extends"]({},m,{type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},m,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE})}return babelHelpers["extends"]({},m,{type:d("MAWMsgType").MSG_TYPE.TEXT})}g.mpsToMawDbMsg=a}),98);
__d("MpsToMawDbReaction",["MAWAckLevel","MpsTypes","WAJids","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WAJids").createJidUtils({platform:"msgr"});function a(a){var b;b=(b=a.deserialize().encryptedTransportMessage())==null?void 0:(b=b.consumerMessage())==null?void 0:(b=b.payload)==null?void 0:(b=b.content)==null?void 0:b.reactionMessage;return b==null?null:{ack:d("MAWAckLevel").ACK.received,author:a.getAuthor(),externalId:d("WAStanzaUtils").toStanzaId(a.getExternalId()),groupingKey:void 0,reaction:b.text,reactToAuthor:h.toUserJid(a.topLevel.senderId),reactToExternalId:d("MpsTypes").messageIdToStanzaId(a.topLevel.messageId),senderTimestampMs:b.senderTimestampMs,threadJid:a.getChatJid(),ts:a.getUnixTs()}}g.mpsToMawDbReaction=a}),98);
__d("MAWSnippetsCacheServiceForMPS",["MAWCacheServiceBase","MAWDbMsg","MAWDbReaction","MAWGetThreadUpdateType","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippet","MAWThreadSnippetBuildTxns","MpsMessageToBridgeWrapper","MpsToMawDbMsg","MpsToMawDbReaction","MpsTypes","Promise","WAJids","WALongInt","WebMps","asyncToGeneratorRuntime","cr:21515","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){babelHelpers.inheritsLoose(e,a);function e(){return a.call(this,"snippets")||this}var f=e.prototype;f.$MAWSnippetsCacheService$p_1=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=d("MpsToMawDbMsg").mpsToMawDbMsg(d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a),null),e=d("MAWThreadNewestMsgOrReactionUtils").filterForSnippet(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(c),!1);if(!e)return;var f=d("WAJids").unsafeCoerceToChatJid(a.threadId);e=(yield this.getValueFromCache(f));if(e==null)return this.$MAWSnippetsCacheService$p_2(f).then(function(a){if(a==null)return;return[f,a]});if(e.timestamp>a.timestampMs)return;e=d("MAWThreadSnippet").buildThreadSnippetV2({chatJid:f,dbMsg:c});return(h||(h=b("Promise"))).resolve([f,{key:f,timestamp:d("MAWDbMsg").getSortOrderWithFallback(c),value:{snippet:e,snippetMsgId:c.msgId}}])});function c(b){return a.apply(this,arguments)}return c}();f.$MAWSnippetsCacheService$p_3=function(a){var e=c("nullthrows")(a.directive);switch(e.actionType){case d("MpsTypes").ActionType.Unknown:case d("MpsTypes").ActionType.Noop:case d("MpsTypes").ActionType.Preprocess:case d("MpsTypes").ActionType.DeleteThread:case d("MpsTypes").ActionType.DeleteSupplemental:return(h||(h=b("Promise"))).resolve();case d("MpsTypes").ActionType.UpsertTopLevel:return this.$MAWSnippetsCacheService$p_1(a.message);case d("MpsTypes").ActionType.DeleteTopLevel:case d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:case d("MpsTypes").ActionType.UpsertSupplemental:return this.$MAWSnippetsCacheService$p_2(d("WAJids").unsafeCoerceToChatJid(a.message.threadId)).then(function(b){return b==null?void 0:[a.message.threadId,b]})}};f.calculateDelta=function(a){var c=this;return(h||(h=b("Promise"))).all(a.map(function(a){return c.$MAWSnippetsCacheService$p_3(a)})).then(function(a){return a.filter(Boolean)})};f.$MAWSnippetsCacheService$p_2=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("WebMps").mps().loadMessages({config:{shouldFetchSupplementals:!0,strategy:"local-only"},debug:{purpose:"update_snippet_from_scratch"},direction:"desc",from:[d("MpsTypes").toTimestamp(Number.MAX_SAFE_INTEGER),null],numMessages:20,threadId:d("MpsTypes").toThreadId(a)}));if(e.success===!1)return;b("cr:21515")&&c("promiseDone")(b("cr:21515").submitEBMessagesToPLL(e.value));var f=e.value.messages.map(function(a){return d("MpsToMawDbMsg").mpsToMawDbMsg(d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.toplevelProtobuf),a)});f=f.find(function(a){return d("MAWThreadNewestMsgOrReactionUtils").filterForSnippet(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),!1)});e=e.value.messages.flatMap(function(a){return Array.from(a.supplementalProtobufs.values()).map(function(b){return{supplemental:b,topLevel:a.toplevelProtobuf}})}).map(function(a){var b=a.supplemental;a=a.topLevel;return d("MpsToMawDbReaction").mpsToMawDbReaction(d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromSupplemental(b,a))}).filter(Boolean).map(function(a){return d("MAWDbReaction").maybeCastToIncomingDbReaction(a)}).filter(Boolean);e=e.length===0?null:e.sort(function(a,b){return b.ts-a.ts})[0];if(f==null&&e==null)return;var g=null;if(e!=null&&e.ts>(f!=null?d("MAWDbMsg").getCanonicalTsFromMsg(f):0)){var h;g=d("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(e.author,e.reaction,a);return{key:a,timestamp:(h=d("WALongInt").maybeNumber(e.senderTimestampMs))!=null?h:0,value:{snippet:g,snippetReactionId:e.reactionId}}}else if(f!=null){g=d("MAWThreadSnippet").buildThreadSnippetV2({chatJid:a,dbMsg:f});return{key:a,timestamp:d("MAWDbMsg").getSortOrderWithFallback(f),value:{snippet:g,snippetMsgId:f.msgId}}}});function e(b){return a.apply(this,arguments)}return e}();f.computeCachePayloadFromScratch=function(a){var c=this;return(h||(h=b("Promise"))).all(a.map(function(a){return c.$MAWSnippetsCacheService$p_2(d("WAJids").unsafeCoerceToChatJid(a)).then(function(b){return b==null?null:[a,b]})})).then(function(a){return a.filter(Boolean)})};f.shouldDropDelta=function(a){return(h||(h=b("Promise"))).resolve(!1)};return e}(c("MAWCacheServiceBase"));var i=new a();e=function(){return i};g.MAWSnippetsCacheService=a;g.getMAWSnippetsCacheService=e}),98);
__d("MAWWorkerCacheServicesForMPS",["FBLogger","MAWBridge","MAWCacheServiceDB","MAWCacheServiceQPL","MAWCacheServiceUtils","MAWLoggerUtils","MAWMpsGating","MAWSnippetsCacheServiceForMPS","Promise","WorkerScheduler","asyncToGeneratorRuntime","err","gkx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=d("MAWSnippetsCacheServiceForMPS").getMAWSnippetsCacheService();var i=[a],j=function(){function a(){this.$1=d("MAWCacheServiceUtils").getMAWCacheServiceBroadcastChannel(),this.registry=i,this.schedulerRegistry=i.map(function(a){return a.namespace}).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b]=d("WorkerScheduler").makeScheduler(d("MAWCacheServiceUtils").getSchedulerName(b),d("MAWCacheServiceUtils").SCHEDULER_CONFIG),a))},{})}var e=a.prototype;e.$2=function(a,b,c,e){if(!d("MAWMpsGating").isFullMpsEnabled())return;b={cache:b,instanceKey:e,namespace:a,source:c};this.$1==null?d("MAWBridge").getBridge().fireAndForget("event","broadcastChannelFallback",{event:{data:b},namespace:d("MAWCacheServiceUtils").MAW_CACHE_SERVICE_BROADCAST_CHANNEL}):this.$1.postMessage(b)};e.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=a.namespace,h=d("MAWCacheServiceUtils").findDuplicates(b,function(a){var b=a[0];a[1];return b});h.length>0&&(c("FBLogger")("MAWCacheService").mustfix("Found duplicate keys in cache: %s. Original keys: %s, Namespace: %s, Source: %s",h.map(function(a){var b=a[0];a[1];return b}).join(", "),b.map(function(a){var b=a[0];a[1];return b}).join(", "),g,e),f!=null&&c("MAWCacheServiceQPL").addAnnotationsQPL(f,{bool:{hasDuplicateKeys:!0},string_array:{duplicateKeys:c("MAWCacheServiceQPL").redactKeysForNonEmployee(h.map(function(a){var b=a[0];a[1];return b}))}}));if(b.length===0){f!=null&&(c("MAWCacheServiceQPL").addPointQPL(f,"nothing_to_update_in_cache",e),c("MAWCacheServiceQPL").endSuccessQPL(f));return}f!=null&&c("MAWCacheServiceQPL").addPointQPL(f,"updating_cache_in_persisted_start",e);a.updateInMemoryCacheBulk(b);try{var i=d("MAWCacheServiceDB").convertCacheValueToDBRawValue(b).map(function(a){return babelHelpers["extends"]({},a,{key:a.key+"_mps_reactive"})});h=(yield d("MAWCacheServiceDB").getOrSetupMAWCacheDB());yield h.runInTransaction([g],"readwrite",function(a){var b=i.map(function(a){return{item:a,selector:[a.key]}});return a.stores[g].bulkUpsert("key",b)},"update_cache_"+g);f!=null&&c("MAWCacheServiceQPL").addPointQPL(f,"updating_cache_in_persisted_end",e)}catch(a){f!=null&&(c("MAWCacheServiceQPL").addAnnotationsQPL(f,{string:{error:a.message}}),c("MAWCacheServiceQPL").addPointQPL(f,"updating_cache_in_persisted_failed",e)),c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to update persisted cache")}f!=null&&c("MAWCacheServiceQPL").addPointQPL(f,"broadcasting_to_ui_start",e);this.$2(g,b,e,f)});function e(b,c,d,e){return a.apply(this,arguments)}return e}();e.$4=function(a,e){var f=this,g=c("gkx")("14458")?a.shouldDropDelta(e):(h||(h=b("Promise"))).resolve(!1);return g.then(function(b){if(b)return;b=f.schedulerRegistry[a.namespace];return b.runTask({fn:function(){return a.calculateDelta(e).then(function(b){var e=b.map(function(a){var b=a[0];a[1];return b}),g=d("MAWLoggerUtils").getInstanceKey();b.length!==0&&(c("MAWCacheServiceQPL").startQPL(g,a.namespace),c("MAWCacheServiceQPL").addAnnotationsQPL(g,{bool:{isRealtimeUpdate:!0},"int":{instanceKey:g},string_array:{realtimeUpdatedKeys:e}}));return f.$3(a,b,"realtime-update",g)})["catch"](function(b){c("FBLogger")("MAWCacheService").catching(b).warn("Failed to calculate delta for: %s",a.namespace)})},name:"maw_calculate_delta",priority:d("WorkerScheduler").REGULAR_PRIORITY})})};e.calculateDelta=function(a){var d=this,e=this.registry.map(function(b){return d.$4(b,a)});(h||(h=b("Promise"))).all([].concat(e))["catch"](function(a){c("FBLogger")("MAWCacheService").catching(a).mustfix("Failed to calculate delta for all services")})};e.computeCachePayloadFromScratch=function(a,b,e,f){var g=this;f!=null&&c("MAWCacheServiceQPL").registerInstanceKeyInWorker(f);c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_start",e);c("MAWCacheServiceQPL").addAnnotationsQPL(f,{string_array:{keysReceivedInWorker:c("MAWCacheServiceQPL").redactKeysForNonEmployee(b)}});var h=c("nullthrows")(this.registry.find(function(b){return b.namespace===a})),i=this.schedulerRegistry[h.namespace];if(h==null)throw c("err")("No service found for namespace: "+a);return i.runTask({fn:function(){return h.computeCachePayloadFromScratch(b).then(function(a){c("MAWCacheServiceQPL").addPointQPL(f,"compute_from_scratch_end",e);return g.$3(h,a,e,f)})["catch"](function(a){c("MAWCacheServiceQPL").endFailureQPL(f,"compute_from_scratch_failed",e),c("FBLogger")("MAWCacheService").catching(a).warn("Failed to compute cache payload from scratch")})},name:"maw_compute_cache_payload_from_scratch",priority:d("WorkerScheduler").REGULAR_PRIORITY})};return a}(),k=null;e=function(){k==null&&(k=new j());return k};g.getMAWWorkerCacheServices=e}),98);
__d("mawAdminWriteDualThreadCutoverMsgTxns",["MAWDbThreadTxns","MAWExternalId","MAWLocalizationType","MAWLocalizationUtils","MAWWriteMsgTxns","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["dualThreadCutover failed to get the thread"]);h=function(){return a};return a}function a(a,b,c){return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success){d("WALogger").WARN(h());return{needsMarkThreadAsMigrated:!1}}b=b.value;if(b.didInsertDualThreadCutoverAdminMsg===!0)return{needsMarkThreadAsMigrated:!1};var e=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE,version:1},b.jid,d("MAWExternalId").generateExternalId(),d("WATimeUtils").castMillisTimeToUnixTime(c)),f=babelHelpers["extends"]({},b,{didInsertDualThreadCutoverAdminMsg:!0});return a.threads.put(f).then(function(){return d("MAWWriteMsgTxns").writeMsg(a,e,f).then(function(){return{needsMarkThreadAsMigrated:!0}})})})}g["default"]=a}),98);
__d("MAWWriteAdminMessageForDualThreadCutoverApi",["MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","mawAdminWriteDualThreadCutoverMsgTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"writeAdminMessageForDualThreadCutover",function(a){return function(b){var e=b.chatJid;b=b.cutoverTimestampMs;return c("mawAdminWriteDualThreadCutoverMsgTxns")(a,e,b).then(function(b){b=b.needsMarkThreadAsMigrated;if(b)return d("MAWDbThreadTxns").markCutoverThreadAsMigratedLocally(a,e)})}});g.writeAdminMessageForDualThreadCutover=b}),98);
__d("MAWWriteAdminMessageForEphemeralSettingsChange",["MAWDbGroupInfoTxns","MAWDexieTable","MAWEphemeralAdminMsgBuildTxns","MAWGetOrCreateThreadTxns","MAWHIMLogger","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot create a thread for message after missing thread creation attempt"]);h=function(){return a};return a}a=6*d("WATimeUtils").HOUR_SECONDS;e=d("MAWIndexedDb").makeMsgrTransactor({chunk:(b=d("MAWTransactionMode")).READONLY,ephemeralSettings:b.READWRITE,ftsBackloggedMessages:b.READWRITE,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,reactions:b.READONLY,threads:b.READWRITE,xma:b.READONLY},"writeAdminMessageForEphemeralSettingsChange",function(a){return function(b){var e=b.author,f=b.chatJid,g=b.expirationInSec,i=b.externalId,j=b.isEphemeralSettingReset,k=b.isTurningOnEphemeralSetting,l=b.serverTs;b=d("WAJids").interpretAsGroupJid(f);b=d("MAWDexieTable").dexieAll([d("MAWGetOrCreateThreadTxns").getExistingThread(a,f),b!=null?d("MAWDbGroupInfoTxns").getGroupInfo(a,b):d("MAWDexieTable").dexieResolve()]);return b.then(function(b){var c=b[0];b=b[1];if(c!=null)return{created:!1,thread:c};b=b==null?void 0:(c=b.value)==null?void 0:c.creationTs;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:b==null?null:d("WATimeUtils").castUnixTimeToMillisTime(b),description:"writeAdminMessageForEphemeralSettingsChange",jid:f})}).then(function(b){b=b==null?void 0:b.thread;if(b==null){c("MAWHIMLogger").MUSTFIX(h());return d("WAResultOrError").makeError({type:"no_thread"})}return d("MAWEphemeralAdminMsgBuildTxns").writeEphemeralSettingAdminMsg(a,e,g,l,b,k,j,i)}).then(c("emptyFunction"))}});g.REVOKE_CONTENT_EXPIRATION_IN_SEC=a;g.writeAdminMessageForEphemeralSettingsChange=e}),98);
__d("MAWWriteLimitSharingAdminMsgTxns",["MAWLocalizationUtils","MAWWriteLimitSharingAdminMsgContent","MAWWriteMsgTxns","WATimeUtils","emptyFunction","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,h){return a.threads.get({jid:e}).then(function(e){if(e==null)throw c("err")("Invalid chat Id when try to write admin message for limit sharing");var i=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(d("MAWWriteLimitSharingAdminMsgContent").getAdminMsgContent(b,g),e.jid,f,d("WATimeUtils").castMillisTimeToUnixTime(h),void 0,h);return d("MAWWriteMsgTxns").writeDedupedAdminMessage(a,i,e,h).then(c("emptyFunction"))})}g.writeLimitSharingAdminMsg=a}),98);
__d("MAWWriteAdminMessageForLimitSharingApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteLimitSharingAdminMsgTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"MAWWriteAdminMessageForLimitSharing",function(a){return function(b){var c=b.actorFbid,e=b.chatJid,f=b.externalId,g=b.isLimitSharingEnabled;b=b.serverAuthoritativeTimestampMs;return d("MAWWriteLimitSharingAdminMsgTxns").writeLimitSharingAdminMsg(a,c,e,f,g,b)}});g.writeAdminMessageForLimitSharing=b}),98);
__d("MAWWritePinMessageAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWritePinMessageAdminMsgContent","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g){return a.threads.get({jid:e}).then(function(e){if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for pin message");var h=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(d("MAWWritePinMessageAdminMsgContent").getAdminMsgContent(b),e.jid,f,d("WATimeUtils").castMillisTimeToUnixTime(g),void 0,g);return d("MAWWriteMsgTxns").writeDedupedAdminMessage(a,h,e,g).then(c("emptyFunction"))})}g.writePinMessageAdminMsg=a}),98);
__d("MAWWriteAdminMessageForPinMessageApi",["MAWIndexedDb","MAWTransactionMode","MAWWritePinMessageAdminMsgTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"MAWWriteAdminMessageForPinMessage",function(a){return function(b){var c=b.actorFbid,e=b.chatJid,f=b.externalId;b=b.serverAuthoritativeTimestampMs;return d("MAWWritePinMessageAdminMsgTxns").writePinMessageAdminMsg(a,c,e,f,b)}});g.writeAdminMessageForPinMessage=b}),98);
__d("MAWWriteThreadHotlikeCustomizationAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteThreadHotlikeCustomizationAdminMsgContent","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,h){return a.threads.get({jid:f}).then(function(f){if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for thread hotlike customization");var i=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(d("MAWWriteThreadHotlikeCustomizationAdminMsgContent").getAdminMsgContent(b,e),f.jid,g,d("WATimeUtils").castMillisTimeToUnixTime(h),void 0,h);return d("MAWWriteMsgTxns").writeDedupedAdminMessage(a,i,f,h).then(c("emptyFunction"))})}g.writeThreadHotlikeCustomizationAdminMsg=a}),98);
__d("MAWWriteAdminMessageForThreadHotlikeCustomizationApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteThreadHotlikeCustomizationAdminMsgTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"writeAdminMessageForThreadHotlikeCustomization",function(a){return function(b){var c=b.actorFbid,e=b.chatJid,f=b.externalId,g=b.serverAuthoritativeTimestampMs;b=b.threadIcon;return d("MAWWriteThreadHotlikeCustomizationAdminMsgTxns").writeThreadHotlikeCustomizationAdminMsg(a,c,b,e,f,g)}});g.writeAdminMessageForThreadHotlikeCustomization=b}),98);
__d("MAWWriteThreadNicknameCustomizationAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteThreadNicknameCustomizationAdminMsgContent","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,h,i){return a.threads.get({jid:e}).then(function(e){if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for thread nickname customization");var j=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(d("MAWWriteThreadNicknameCustomizationAdminMsgContent").getAdminMsgContent(b,g,f),e.jid,h,d("WATimeUtils").castMillisTimeToUnixTime(i),void 0,i);return d("MAWWriteMsgTxns").writeDedupedAdminMessage(a,j,e,i).then(c("emptyFunction"))})}g.writeThreadNicknameCustomizationAdminMsg=a}),98);
__d("MAWWriteAdminMessageForThreadNicknameCustomizationApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteThreadNicknameCustomizationAdminMsgTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"writeAdminMessageForThreadNicknameCustomization",function(a){return function(b){var c=b.actorFbid,e=b.chatJid,f=b.externalId,g=b.nickName,h=b.participantId;b=b.serverAuthoritativeTimestampMs;return d("MAWWriteThreadNicknameCustomizationAdminMsgTxns").writeThreadNicknameCustomizationAdminMsg(a,c,e,g,h,f,b)}});g.writeAdminMessageForThreadNicknameCustomization=b}),98);
__d("MAWWriteThreadPhotoCustomizationAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteThreadPhotoCustomizationAdminMsgContent","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g){return a.threads.get({jid:e}).then(function(e){if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for thread photo customization");var h=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(d("MAWWriteThreadPhotoCustomizationAdminMsgContent").getAdminMsgContent(b),e.jid,f,d("WATimeUtils").castMillisTimeToUnixTime(g),void 0,g);return d("MAWWriteMsgTxns").writeDedupedAdminMessage(a,h,e,g).then(c("emptyFunction"))})}g.writeThreadPhotoCustomizationAdminMsg=a}),98);
__d("MAWWriteAdminMessageForThreadPhotoCustomizationApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteThreadPhotoCustomizationAdminMsgTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"writeAdminMessageForThreadPhotoCustomization",function(a){return function(b){var c=b.actorFbid,e=b.chatJid,f=b.externalId;b=b.serverAuthoritativeTimestampMs;return d("MAWWriteThreadPhotoCustomizationAdminMsgTxns").writeThreadPhotoCustomizationAdminMsg(a,c,e,f,b)}});g.writeAdminMessageForThreadPhotoCustomization=b}),98);
__d("MAWWriteThreadThemeCustomizationAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteThreadThemeCustomizationAdminMsgContent","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,h,i,j){return a.threads.get({jid:g}).then(function(g){if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for thread theme customization");var k=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(d("MAWWriteThreadThemeCustomizationAdminMsgContent").getAdminMsgContent(b,e,f,j),g.jid,h,d("WATimeUtils").castMillisTimeToUnixTime(i),void 0,i);return d("MAWWriteMsgTxns").writeDedupedAdminMessage(a,k,g,i).then(c("emptyFunction"))})}g.writeThreadThemeCustomizationAdminMsg=a}),98);
__d("MAWWriteAdminMessageForThreadThemeCustomizationApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteThreadThemeCustomizationAdminMsgTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"writeAdminMessageForThreadThemeCustomization",function(a){return function(b){var c=b.actorFbid,e=b.chatJid,f=b.externalId,g=b.serverAuthoritativeTimestampMs,h=b.themeEmoji,i=b.themeNameWithSubtitle;b=b.themeType;return d("MAWWriteThreadThemeCustomizationAdminMsgTxns").writeThreadThemeCustomizationAdminMsg(a,c,h,i,e,f,g,b)}});g.writeAdminMessageForThreadThemeCustomization=b}),98);
__d("MAWWriteUKOSAAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteUKOSAAdminMsgContent","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g){return a.threads.get({jid:e}).then(function(e){if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for UK OSA");var h=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(d("MAWWriteUKOSAAdminMsgContent").getAdminMsgContent(b),e.jid,f,d("WATimeUtils").castMillisTimeToUnixTime(g),void 0,g);return d("MAWWriteMsgTxns").writeDedupedAdminMessage(a,h,e,g).then(c("emptyFunction"))})}g.writeUKOSAAdminMsg=a}),98);
__d("MAWWriteAdminMessageForUKOSAApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteUKOSAAdminMsgTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"MAWwriteAdminMessageForUKOSA",function(a){return function(b){var c=b.actorFbid,e=b.chatJid,f=b.externalId;b=b.serverAuthoritativeTimestampMs;return d("MAWWriteUKOSAAdminMsgTxns").writeUKOSAAdminMsg(a,c,e,f,b)}});g.writeAdminMessageForUKOSA=b}),98);
__d("MAWWriteUnpinMessageAdminMsgTxns",["FBLogger","MAWLocalizationUtils","MAWWriteMsgTxns","MAWWriteUnpinMessageAdminMsgContent","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g){return a.threads.get({jid:e}).then(function(e){if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow("Invalid chat Id when try to write admin message for unpin message");var h=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(d("MAWWriteUnpinMessageAdminMsgContent").getAdminMsgContent(b),e.jid,f,d("WATimeUtils").castMillisTimeToUnixTime(g),void 0,g);return d("MAWWriteMsgTxns").writeDedupedAdminMessage(a,h,e,g).then(c("emptyFunction"))})}g.writeUnpinMessageAdminMsg=a}),98);
__d("MAWWriteAdminMessageForUnpinMessageApi",["MAWIndexedDb","MAWTransactionMode","MAWWriteUnpinMessageAdminMsgTxns"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"MAWWriteAdminMessageForUnpinMessage",function(a){return function(b){var c=b.actorFbid,e=b.chatJid,f=b.externalId;b=b.serverAuthoritativeTimestampMs;return d("MAWWriteUnpinMessageAdminMsgTxns").writeUnpinMessageAdminMsg(a,c,e,f,b)}});g.writeAdminMessageForUnpinMessage=b}),98);
__d("WAGetRemotePublicIdentityV2",["WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c){return d("WASignalDB").getDb().runInTransaction(["identity"],"readonly",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=d("WAJids").toMsgrUserJid(c);e=d("WAJids").toDeviceJid(e,a);b=(yield b.stores.identity.get(e));return b==null?void 0:b.identity});return function(a){return e.apply(this,arguments)}}(),d("WASignalDB").signalOp("getRemotePublicIdentityKey"))};g.getRemotePublicIdentity=a}),98);
__d("WAGetThreadDevicesInfoApiV2",["WAHex","WAJids","WASignalDB","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var c=a.fbid;return d("WASignalDB").getDb().runInTransaction(["identity"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAJids").toMsgrUserJid(c);a=(yield a.stores.identity.readIndex("userJid",[b]));return a.map(function(a){return{deviceId:d("WAJids").extractDeviceId(a.deviceJid),firstSeenTs:a.firstSeenTs!=null?d("WATimeUtils").toDate(a.firstSeenTs):null,identityKey:d("WAHex").toHex(a.identity).replace(/(.{2})/g,"$1 ").trim()}})});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("getThreadDevicesInfo"))};g.getThreadDevicesInfo=a}),98);
__d("MAWBridgeHandlers",["EBGating","EBLS","EBMessageMetadataCache","EBSMDBAPI","EBWorkerAddDeviceUtils","EBWorkerAddDeviceWithKeys","EBWorkerAddDeviceWithPin","EBWorkerEBSMStateUtils","EBWorkerGetEBState","EBWorkerOptOut","EncryptedBackupsDYIMediaDownload","EncryptedBackupsUploadQueueAckUtils","IGDHandleContinueMediaDownload","MAWAddGroupParticipants","MAWBulkCancelDownloadMediaForUI","MAWBulkLoadMessagesForThread","MAWBulkMaybeCreateOrUpdateThreadScheduler","MAWBulkMaybeUpsertThreadAndParticipants","MAWCancelDownloadMediaForUI","MAWChangeSecurityAlertSettingApi","MAWChangeSecurityAlertSettingForSelfApi","MAWClearSignalAndTempStores","MAWCommonScheduler","MAWCompleteUndoThreadCutoverApi","MAWConvertEchoMessagesToEBProtobufs","MAWConvertEchoMessagesToMsgStanzas","MAWCreateGroup","MAWCreateOrUpdateThreadApi","MAWCreateThreadApi__DO_NOT_USE__HOLDOUT_ONLY","MAWDeleteMediaChunks_FOR_TESTING_ONLY","MAWDeleteMsgsForMe","MAWDeleteThreadApi","MAWDownloadMediaForUI","MAWDyiDownloadMedia","MAWEBLSInWorkerSwitch","MAWEBUploadTrackingUtils","MAWEncryptedBackupsStateManager","MAWEphemeralSettingsCache","MAWFTSDataSync","MAWFTSEBMessagesDataSync","MAWFTSIssueGraphQLRangeRestoreRequest","MAWForwardEBLSEbEnabledStateChangesToMainThread","MAWForwardMsg","MAWGetBlobDataUrlByMediaIdApi","MAWGetDeviceChangeAlertsByOptionsApi","MAWGetEphemeralSettingsApi","MAWGetGroupSuperAdminApi","MAWGetLatestChatJids","MAWGetLatestThreadIdsApi","MAWGetMaybeNextNonAdminMsgSortOrderMsApi","MAWGetMediaDownloadStatusApi","MAWGetMediaValidationResultApi","MAWGetProtocolMsgIdByMediaMsgId","MAWGetProtocolMsgIdByMsgId","MAWGetReceiverFetchInfoApi","MAWGetRedactedRegistrationInfoForBugnub","MAWGetReportedQplEvents","MAWGetSecureThreadTotalCount","MAWGetSecurityAlertSettingApi","MAWGetSecurityAlertSettingForSelfAndContactApi","MAWGetThreadConsistencyInfo","MAWGetThreadLastMessageTsApi","MAWGetThreadLastNumMessagesBySortOrderApi","MAWGetThreadsInfoApi","MAWGetThumbnailBlobDataUrlByMediaIdApi","MAWGetWAIDevices","MAWGetWATimeApi","MAWGetWorkerHeartbeatApi","MAWGroupSetMemberAddMode","MAWHandleMediaRestoreCdnUrlResult","MAWIdentifyCollapsedMessagesByExternalId","MAWIdentifyXMAWithAssociatedTextByExternalId","MAWInsertAdminMessageInCutoverThreadsApi","MAWLoadMediaApi","MAWLoadMoreScheduler","MAWLoadMsgsApi","MAWLoadThreadsTxns","MAWLowLevelMediaDownloadQplBridgeHandler","MAWMarkBackupAsCompleted","MAWMarkThreadAsUnreadApi","MAWMpsGating","MAWOptimisticUploadMedia","MAWRemoveGroupParticipants","MAWRestoreMsgsTxns","MAWRevokeMsg","MAWSaveRTCCallXMAMsg","MAWSendBumpMsg","MAWSendChatStateFromComposerApi","MAWSendEditMsg","MAWSendGroupInviteMsg","MAWSendMediaMsg","MAWSendMsg","MAWSendNoteReplyMsg","MAWSendPoll","MAWSendPollUpdate","MAWSendReactionMsg","MAWSendXMAShareMsg","MAWSetEphemeralSettingsFromFrontendApi","MAWSetEphemeralSettingsOfPeerFromMIApi","MAWSetGroupSubject","MAWStateManagerSyncToMainThread","MAWUpdateDeviceChangeAlertsApi","MAWUpdateLSThreadFromGroupInfoApi","MAWUpdateMediaDownloadStatusByObjectIdApi","MAWUpdateReceiverFetchInfoApi","MAWWorkerCacheServices","MAWWorkerCacheServicesForMPS","MAWWriteAdminMessageForDualThreadCutoverApi","MAWWriteAdminMessageForEphemeralSettingsChange","MAWWriteAdminMessageForLimitSharingApi","MAWWriteAdminMessageForPinMessageApi","MAWWriteAdminMessageForThreadHotlikeCustomizationApi","MAWWriteAdminMessageForThreadNicknameCustomizationApi","MAWWriteAdminMessageForThreadPhotoCustomizationApi","MAWWriteAdminMessageForThreadThemeCustomizationApi","MAWWriteAdminMessageForUKOSAApi","MAWWriteAdminMessageForUnpinMessageApi","Promise","WAGetCurrentUserDeviceInfoApi","WAGetRemotePublicIdentityV2","WAGetThreadDevicesInfoApiV2","WALogger","WorkerScheduler","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[maw_core_lla] Handler not implemented and should not be used outside Instamadillo"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][labyrinth_dyi] Attempted to call the old DYI V1 flow"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][labyrinth_dyi] Attempted to call the old DYI V1 flow"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[messenger_e2ee_web] Handler not implemented and should not be used outside of Instamadillo"]);l=function(){return a};return a}a={ackWithInstanceKey:function(a){return d("EncryptedBackupsUploadQueueAckUtils").ackWithInstanceKey(a.instanceKey,a.success)},ackWithInstanceKeyBatched:function(a){return d("EncryptedBackupsUploadQueueAckUtils").ackWithInstanceKeyBatched(a)},addDeviceWithKeysInWorker:function(a){return d("EBWorkerAddDeviceWithKeys").addDeviceWithKeysInWorker(a.source)},addDeviceWithPinInWorker:function(a){return d("EBWorkerAddDeviceWithPin").addDeviceWithPinInWorker(a.recoveryCode,a.userId)},addEbUploadTrackingWorkerQPL:function(a){return d("MAWEBUploadTrackingUtils").handleBridgeEbUploadTrackingQPL(a.qplType,a.qplInstanceKey,a.pointName,a.annotations)},addGroupParticipants:function(a){return d("MAWAddGroupParticipants").addGroupParticipantsFn(a)},addMediaDownloadQpl:function(a){return d("MAWLowLevelMediaDownloadQplBridgeHandler").handleBridgeMediaDownloadQPL(a.qplType,a.qplInstanceKey,a.pointName,a.annotations)},backupWriteCompletionHook:function(){d("WALogger").WARN(l());return(h||(h=b("Promise"))).resolve()},bulkCancelDownloadMediaForUI:function(a){return d("MAWBulkCancelDownloadMediaForUI").bulkCancelDownloadMediaForUI(a.hashes)},bulkDownloadMediaForUI:function(a){return d("MAWDownloadMediaForUI").bulkDownloadMediaForUI(a)},bulkLoadMessagesForThread:function(a){return d("MAWBulkLoadMessagesForThread").bulkLoadMessagesForThread(a)},bulkMaybeCreateOrUpdateThread:function(a,b){return d("MAWBulkMaybeCreateOrUpdateThreadScheduler").bulkMaybeCreateOrUpdateThreadScheduler().runTask({fn:function(){return d("MAWBulkMaybeUpsertThreadAndParticipants").bulkMaybeCreateOrUpdateThread(a,b)},name:"maw_maybe_create_or_update_thread",priority:d("WorkerScheduler").BLOCKING_PRIORITY})},cancelDownloadMediaForUI:function(a){return d("MAWCancelDownloadMediaForUI").cancelDownloadMediaForUI(a.hash)},changeSecurityAlertSetting:function(a){return d("MAWChangeSecurityAlertSettingApi").changeSecurityAlertSetting(a.isEnableAlert)},changeSecurityAlertSettingForSelf:function(a){return d("MAWChangeSecurityAlertSettingForSelfApi").changeSecurityAlertSettingForSelf(a.isEnableSelfAlert)},checkForDecryptionFailuresToPointRestore:function(){return d("MAWRestoreMsgsTxns").checkForDecryptionFailuresToPointRestore()},checkIfGroupParticipant:function(a){return d("MAWLoadThreadsTxns").checkIfGroupParticipant(a)},clearSignalAndTempStores:function(a){return d("MAWClearSignalAndTempStores").clearSignalAndTempStores()},clearWorkerEBSMReStore:function(a){return d("EBLS").clearEBSMStorage()},clearWorkerEBStateDBOnLogout:function(a){return d("EBSMDBAPI").clearEBIDBNonPersistedRows({hasUserGivenAutoRestoreConsent:a.hasUserGivenAutoRestoreConsent})},completeUndoThreadCutover:function(a){return d("MAWCompleteUndoThreadCutoverApi").completeUndoThreadCutover(a)},computeCachePayloadFromScratch:function(a){var b=d("MAWMpsGating").isFullMpsEnabled()?d("MAWWorkerCacheServicesForMPS").getMAWWorkerCacheServices:d("MAWWorkerCacheServices").getMAWWorkerCacheServices;if(a.isLowPriority)return d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){return b().computeCachePayloadFromScratch(a.namespace,a.keys,"cache-invalidation",a.instanceKey)},name:"maw_compute_cache_payload_from_scratch",priority:d("WorkerScheduler").BACKGROUND_PRIORITY});else return b().computeCachePayloadFromScratch(a.namespace,a.keys,"from-scratch",a.instanceKey)},continueMediaDownload:function(a){return d("IGDHandleContinueMediaDownload").handleContinueMediaDownload(a)},convertEchoMessagesToEBProtobufs:function(a){return d("MAWConvertEchoMessagesToEBProtobufs").convertEchoMessagesToEBProtobufs(a.encodedEchoMessages,a.chatJid)},convertEchoMessagesToMsgStanzas:function(a){return d("MAWConvertEchoMessagesToMsgStanzas").convertEchoMessagesToMsgStanzas(a.encodedEchoMessages,a.chatJid)},createGroup:function(a){return d("MAWCreateGroup").createGroupFn(a)},createOrUpdateThread:function(a){return d("MAWCreateOrUpdateThreadApi").createOrUpdateThread(a)},createThread:function(a){return d("MAWCreateThreadApi__DO_NOT_USE__HOLDOUT_ONLY").createThread__DO_NOT_USE__HOLDOUT_ONLY(a.contactFbid,a.threadKey,a.description,a.s2sInstanceKey,a.instanceKey)},deleteMediaChunks_FOR_TESTING_ONLY:function(a){return d("MAWDeleteMediaChunks_FOR_TESTING_ONLY").deleteMediaChunks_FOR_TESTING_ONLY(a.plaintextHashes)},deleteMsgsForMe:function(a){return d("MAWDeleteMsgsForMe").deleteMsgsForMeFn(a)},deleteThread:function(a){return d("MAWDeleteThreadApi").deleteThread(a.chatJid)},downloadMediaForUI:function(a){return d("MAWDownloadMediaForUI").downloadMediaForUI(a)},dyiDownloadMedia:function(a){return d("MAWDyiDownloadMedia").dyiDownloadMedia(a.protocolMsgId,a.hash,a.mediaEntry)},dyiDownloadMediaV2:function(a){return d("EncryptedBackupsDYIMediaDownload").downloadDYIMedia({mediaEntry:a.mediaEntry,plaintextHash:a.plaintextHash,protocolMsgId:a.protocolMsgId,sortOrderMs:a.sortOrderMs})},dyiGetThreadList:function(){d("WALogger").WARN(k());return(h||(h=b("Promise"))).resolve()},ebOptOutInWorker:function(a){return d("EBWorkerOptOut").ebOptOutInWorker()},forwardMsg:function(a){return d("MAWForwardMsg").forwardMsgFn(a)},getAllThreadsAsJson:function(){d("WALogger").WARN(j());return(h||(h=b("Promise"))).resolve({})},getBlobDataUrlByHashedPlaintextHash:function(a){return d("MAWGetBlobDataUrlByMediaIdApi").getBlobDataUrlByHashedPlaintextHash(a.plaintextHash,a.description,a.qplInstanceKey)},getBlobDataUrlByMediaId:function(a){return d("MAWGetBlobDataUrlByMediaIdApi").getBlobDataUrlByMediaId(a.mediaId,a.description,a.qplInstanceKey)},getBlobDataUrlByPlaintextHash:function(a){return d("MAWGetBlobDataUrlByMediaIdApi").getBlobDataUrlByPlaintextHash(a.plaintextHash,a.description,a.qplInstanceKey)},getCurrentUserDeviceId:function(){return d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceId()},getCurrentUserDeviceInfo:function(){return d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo()},getDeviceChangeAlertsByOptions:function(a){return d("MAWGetDeviceChangeAlertsByOptionsApi").getDeviceChangeAlertsByOptions(a.options)},getEBMetadataCacheDetailsForThread:function(a){return d("EBMessageMetadataCache").getCacheDetailsForThreadForLogging(a)},getEBSMWorkerState:function(){return d("EBWorkerEBSMStateUtils").getEBSMWorkerState()},getEphemeralSettings:function(a){return d("MAWGetEphemeralSettingsApi").getEphemeralSettings(a.threadId)},getGroupSuperAdmin:function(a){return d("MAWGetGroupSuperAdminApi").getGroupSuperAdmin(a.chatJid)},getIdentityKeys:function(a){return d("EBWorkerAddDeviceUtils").getIdentityKeysInWorker()},getLatestChatJids:function(a){return d("MAWGetLatestChatJids").getLatestChatJids(a.count)},getLatestThreadIds:function(a){return d("MAWGetLatestThreadIdsApi").getLatestThreadIds(a.numThreads)},getMaybeNextNonAdminMsgSortOrderMs:function(a){return d("MAWGetMaybeNextNonAdminMsgSortOrderMsApi").getMaybeNextNonAdminMsgSortOrderMs(a.chatJid,a.mayBeAdminMsgId)},getMediaDownloadStatusByMediaId:function(a){return d("MAWGetMediaDownloadStatusApi").getMediaDownloadStatusByMediaId(a.mediaId,a.qplInstanceKey)},getMediaDownloadStatusByPlaintextHash:function(a){return d("MAWGetMediaDownloadStatusApi").getMediaDownloadStatusByPlaintextHash(a.plaintextHash,a.qplInstanceKey)},getMediaRestoreNextTimestamp:function(a){return d("MAWFTSEBMessagesDataSync").getMediaRestoreNextTimestamp(a)},getMediaValidationResultByMediaId:function(a){return d("MAWGetMediaValidationResultApi").getMediaValidationResultByMediaId(a.mediaId,a.qplInstanceKey)},getMediaValidationResultByPlainTextHash:function(a){return d("MAWGetMediaValidationResultApi").getMediaValidationResultByPlainTextHash(a.plaintextHash,a.qplInstanceKey)},getProtocolMsgIdByMediaMsgId:function(a){return d("MAWGetProtocolMsgIdByMediaMsgId").getProtocolMsgIdByMediaMsgId(a.msgId)},getProtocolMsgIdByMsgId:function(a){return d("MAWGetProtocolMsgIdByMsgId").getProtocolMsgIdByMsgId(a.msgId)},getReceiverFetchInfo:function(a){return d("MAWGetReceiverFetchInfoApi").getReceiverFetchInfo(a)},getRedactedRegistrationInfoForBugnub:function(a){return d("MAWGetRedactedRegistrationInfoForBugnub").getRedactedRegistrationInfoForBugnub()},getRemotePublicIdentityKey:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WAGetRemotePublicIdentityV2").getRemotePublicIdentity(a.deviceId,a.userId));return a==null?null:{remotePublicIdentityKey:a}});function c(b){return a.apply(this,arguments)}return c}(),getReportedQplEvents:function(a){return d("MAWGetReportedQplEvents").getReportedQplEvents()},getSecureThreadTotalCount:function(a){return d("MAWGetSecureThreadTotalCount").getSecureThreadTotalCount()},getSecurityAlertSetting:function(a){return d("MAWGetSecurityAlertSettingApi").getSecurityAlertSetting()},getSecurityAlertSettingForSelfAndContact:function(a){return d("MAWGetSecurityAlertSettingForSelfAndContactApi").getSecurityAlertSettingForSelfAndContact()},getThreadConsistencyInfo:function(a){return d("MAWGetThreadConsistencyInfo").getThreadConsistencyInfo(a)},getThreadDevicesInfo:function(a){return d("WAGetThreadDevicesInfoApiV2").getThreadDevicesInfo(a)},getThreadIdByDeduplicationKey:function(a){return d("MAWGetThreadsInfoApi").getThreadIdByDeduplicationKey(a.deduplicationKey)},getThreadLastMessageTs:function(a){return d("MAWGetThreadLastMessageTsApi").getThreadLastMessageTs(a.threadKey)},getThreadLastNumMessagesBySortOrder:function(a){return d("MAWGetThreadLastNumMessagesBySortOrderApi").getThreadLastNumMessagesBySortOrder(a.threadKey,a.numMsgs)},getThreadMediaRestoreStatus:function(a){return d("MAWFTSEBMessagesDataSync").getThreadMediaRestoreStatus(a)},getThumbnailBlobDataUrlByHashedPlaintextHash:function(a){return d("MAWGetThumbnailBlobDataUrlByMediaIdApi").getThumbnailBlobDataUrlByHashedPlaintextHash(a.plaintextHash,a.description,a.qplInstanceKey)},getThumbnailBlobDataUrlByMediaId:function(a){return d("MAWGetThumbnailBlobDataUrlByMediaIdApi").getThumbnailBlobDataUrlByMediaId(a.mediaId,a.description,a.qplInstanceKey)},getWAIDevices:function(a){return d("MAWGetWAIDevices").getWAIDevices(a)},getWATime:function(){return d("MAWGetWATimeApi").getWATime()},getWorkerEBState:function(){return d("EBWorkerGetEBState").getEBWorkerState()},getWorkerHeartbeat:function(){return d("MAWGetWorkerHeartbeatApi").getWorkerHeartbeat()},handleInstamadilloDYIRangeQueryRestore:function(){d("WALogger").WARN(i());return(h||(h=b("Promise"))).resolve()},identifyCollapsedMessagesByExternalId:function(a){return d("MAWIdentifyCollapsedMessagesByExternalId").identifyCollapsedMessagesByExternalId(a)},identifyXMAWithAssociatedTextByExternalId:function(a){return d("MAWIdentifyXMAWithAssociatedTextByExternalId").identifyXMAWithAssociatedTextByExternalId(a)},insertAdminMessageInCutoverThreads:function(a){return d("MAWInsertAdminMessageInCutoverThreadsApi").insertAdminMessageInCutoverThreads(a)},issueGraphQLRangeRestoreRequest:function(a){return d("MAWFTSIssueGraphQLRangeRestoreRequest").issueGraphQLRangeRestoreRequest(a.chatJid,a.direction,a.sortOrderMs,a.source,a.traceId,a.threadId,a.numMessages)},loadMoreMedia:function(a){return d("MAWLoadMediaApi").loadMoreMedia(a)},loadMsgsByExternalId:function(a){return d("MAWLoadMsgsApi").loadMsgsByExternalId(a.externalId,a.config)},markBackupAsCompleted:function(a){return d("MAWMarkBackupAsCompleted").markBackupAsCompleted(a)},markThreadAsUnread:function(a){return d("MAWMarkThreadAsUnreadApi").markThreadAsUnread(a.chatJid)},maw_load_msgs:function(a){return d("MAWLoadMoreScheduler").loadMoreMessages(a)},maw_load_msgs_by_chat_jids_into_maw:function(a){return d("MAWLoadMoreScheduler").loadMessagesByChatJidsIntoMaw(a)},maw_load_msgs_range:function(a){return d("MAWLoadMoreScheduler").loadMoreMsgsRange(a)},mediaRestoreCdnUrlResult:function(a){return d("MAWHandleMediaRestoreCdnUrlResult").handleMediaRestoreCdnUrlResult(a)},optimisticUploadMedia:function(a){return d("MAWOptimisticUploadMedia").optimisticUploadMedia(a)},removeGroupParticipants:function(a){return d("MAWRemoveGroupParticipants").removeGroupParticipantsFn(a)},resendEBLSInWorkerEbEnabledState:function(a){return d("MAWForwardEBLSEbEnabledStateChangesToMainThread").sendEBLSEbEnabledStateToMainThread()},resendWorkerStateManagerValuesToMainThread:function(a){return d("MAWStateManagerSyncToMainThread").resendCurrentValuesToMainThread()},saveRTCCallXMAMsg:function(a){return d("MAWSaveRTCCallXMAMsg").saveRTCCallXMAMsg(a)},search:function(a){return d("MAWFTSDataSync").search(a)},searchFTSClearThreadRestoreStatus:function(a){return d("MAWFTSEBMessagesDataSync").searchFTSClearThreadRestoreStatus(a)},searchFTSGetThreadRestoreStatus:function(a){return d("MAWFTSEBMessagesDataSync").searchFTSGetThreadRestoreStatus(a)},searchFTSGetThreadsRestoreStatus:function(a){return d("MAWFTSEBMessagesDataSync").searchFTSGetThreadsRestoreStatus(a)},searchFTSReportTabAlive:function(a){return d("MAWFTSEBMessagesDataSync").searchFTSReportTabAlive(a)},searchFTSReportTabDestroy:function(a){return d("MAWFTSEBMessagesDataSync").searchFTSReportTabDestroy(a)},searchFTSReportTabForeground:function(a){return d("MAWFTSEBMessagesDataSync").searchFTSReportTabForeground(a)},searchFTSReportTabTaskComplete:function(a){return d("MAWFTSEBMessagesDataSync").searchFTSReportTabTaskComplete(a)},searchFTSRequestRestoreTask:function(a){return d("MAWFTSEBMessagesDataSync").searchFTSRequestRestoreTask(a)},searchGetFTSNextTimestamp:function(a){return d("MAWFTSEBMessagesDataSync").searchGetFTSNextTimestamp(a)},searchGetFTSRestoreSessionId:function(a){return d("MAWFTSEBMessagesDataSync").searchGetFTSRestoreSessionId(a)},searchIndexUpdate:function(a){return d("MAWFTSEBMessagesDataSync").searchIndexUpdate(a)},searchSetFTSNextTimestamp:function(a){return d("MAWFTSEBMessagesDataSync").searchSetFTSNextTimestamp(a)},sendBumpMsg:function(a){return d("MAWSendBumpMsg").sendBumpMsgFn(a)},sendChatStateFromComposer:function(a){return d("MAWSendChatStateFromComposerApi").sendChatStateFromComposer(a)},sendEditMsg:function(a){return d("MAWSendEditMsg").sendEditMsgFn(a)},sendGroupInviteMsg:function(a){return d("MAWSendGroupInviteMsg").sendGroupInviteMsgFn(a)},sendMediaMsgV2:function(a){var b=a.mimeType,c=a.plaintext;a=babelHelpers.objectWithoutPropertiesLoose(a,["mimeType","plaintext"]);c=new Blob([c],{type:b});return d("MAWSendMediaMsg").sendMediaMsgFn(babelHelpers["extends"]({},a,{file:c,filename:(b=a.args.filename)!=null?b:"document"}))},sendMsg:function(a){return d("MAWSendMsg").sendMsgFn(a)},sendNoteReplyMsg:function(a){return d("MAWSendNoteReplyMsg").sendNoteReplyMsgFn(a)},sendPoll:function(a){return d("MAWSendPoll").sendPoll(a)},sendPollUpdate:function(a){return d("MAWSendPollUpdate").sendPollUpdate()},sendReactionMsg:function(a){return d("MAWSendReactionMsg").sendReactionMsgFn(a)},sendRevokeMsg:function(a){return d("MAWRevokeMsg").sendRevokeMsgFn(a)},sendXMAShareMsg:function(a){return d("MAWSendXMAShareMsg").sendXMAShareMsgFn(a)},setEncryptedBackupsState:function(a){(!c("gkx")("12414")||!d("EBGating").isEBSMv2Phase1Enabled())&&d("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(a.newState)},setEphemeralSettingCache:function(a){return d("MAWEphemeralSettingsCache").setEphemeralSettingCache(a.jid,a.settings)},setEphemeralSettingsFromFrontend:function(a){return d("MAWSetEphemeralSettingsFromFrontendApi").setEphemeralSettingsFromFrontend(a)},setEphemeralSettingsFromMI:function(a){return d("MAWSetEphemeralSettingsOfPeerFromMIApi").setEphemeralSettingsFromMI(a)},setGroupMemberAddMode:function(a){return d("MAWGroupSetMemberAddMode").setMemberAddModeFn(a)},setGroupSubject:function(a){return d("MAWSetGroupSubject").setGroupSubjectFn(a)},setThreadMediaRestoreStatus:function(a){return d("MAWFTSEBMessagesDataSync").setThreadMediaRestoreStatus(a)},updateDeviceChangeAlerts:function(a){return d("MAWUpdateDeviceChangeAlertsApi").updateDeviceChangeAlerts(a.alert)},updateLSThreadFromGroupInfo:function(a){return d("MAWUpdateLSThreadFromGroupInfoApi").updateLSThreadFromGroupInfo(a.groupJid)},updateMediaDownloadStatusByObjectId:function(a){return d("MAWUpdateMediaDownloadStatusByObjectIdApi").updateMediaDownloadStatusByObjectId(a.objectId,a.downloadStatus,a.details)},updateReceiverFetchInfo:function(a){return d("MAWUpdateReceiverFetchInfoApi").updateReceiverFetchInfo(a)},waitForEBLSEbEnabled:function(a){return c("MAWEBLSInWorkerSwitch").waitForEBEnabled()},writeAdminMessageForDualThreadCutover:function(a){return d("MAWWriteAdminMessageForDualThreadCutoverApi").writeAdminMessageForDualThreadCutover(a)},writeAdminMessageForEphemeralSettingsChange:function(a){return d("MAWWriteAdminMessageForEphemeralSettingsChange").writeAdminMessageForEphemeralSettingsChange(a)},writeAdminMessageForLimitSharing:function(a){return d("MAWWriteAdminMessageForLimitSharingApi").writeAdminMessageForLimitSharing(a)},writeAdminMessageForPinMessage:function(a){return d("MAWWriteAdminMessageForPinMessageApi").writeAdminMessageForPinMessage(a)},writeAdminMessageForThreadHotlikeCustomization:function(a){return d("MAWWriteAdminMessageForThreadHotlikeCustomizationApi").writeAdminMessageForThreadHotlikeCustomization(a)},writeAdminMessageForThreadNicknameCustomization:function(a){return d("MAWWriteAdminMessageForThreadNicknameCustomizationApi").writeAdminMessageForThreadNicknameCustomization(a)},writeAdminMessageForThreadPhotoCustomization:function(a){return d("MAWWriteAdminMessageForThreadPhotoCustomizationApi").writeAdminMessageForThreadPhotoCustomization(a)},writeAdminMessageForThreadThemeCustomization:function(a){return d("MAWWriteAdminMessageForThreadThemeCustomizationApi").writeAdminMessageForThreadThemeCustomization(a)},writeAdminMessageForUKOSA:function(a){return d("MAWWriteAdminMessageForUKOSAApi").writeAdminMessageForUKOSA(a)},writeAdminMessageForUnpinMessage:function(a){return d("MAWWriteAdminMessageForUnpinMessageApi").writeAdminMessageForUnpinMessage(a)}};g.bridgeHandlers=a}),98);
__d("IGDLowLevelApiBridgeHandlers",["EncryptedBackupsUploadQueue","EncryptedBackupsUploadQueueProcessor","MAWBridgeHandlers","Promise","WALogger","asyncToGeneratorRuntime","cr:8399"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DYI] Instamadillo DYI is not enabled"]);i=function(){return a};return a}a=babelHelpers["extends"]({},d("MAWBridgeHandlers").bridgeHandlers,{backupWriteCompletionHook:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("EncryptedBackupsUploadQueue").ebUploadQueue();yield a.queueIds.map(function(a){return b.ack([a])});d("EncryptedBackupsUploadQueueProcessor").scheduleNextRun()});function c(b){return a.apply(this,arguments)}return c}(),handleInstamadilloDYIRangeQueryRestore:function(a){if(b("cr:8399")==null){d("WALogger").LOG(i());return(h||(h=b("Promise"))).resolve()}return b("cr:8399")(a.threadId,a.messages,a.hasMoreBefore,a.nextMessageTimestampMsBefore)}});g.igdBridgeHandlers=a}),98);
__d("IGDBackendBridgeHandlers",["EBBridgedAPIHandler","IGDBridgedAPIHandler","IGDLowLevelApiBridgeHandlers","MAWJobManager","Promise","WABridgedAPIHandler","WAMockServerShell","WAWaitForComms","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"]);j=function(){return a};return a}function a(a){return babelHelpers["extends"]({},d("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers,{ebapi:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("WAWaitForComms").waitForComms();var c=d("EBBridgedAPIHandler").ebapi[b.type];c==null&&a.TAGS(["EBBridgedAPI"]).ERROR(j(),b.type);return c.apply(void 0,b.args)});function e(a){return c.apply(this,arguments)}return e}(),igdapi:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("IGDBridgedAPIHandler").igdapi(a)});function c(b){return a.apply(this,arguments)}return c}(),initMockServer:function(a){return d("WAMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("WAMockServerShell").getMockServer().init(a)},minosEBAPI:function(){throw c("err")("not implemented")},runJobFireAndForget:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().fireAndForget(a)});function c(b){return a.apply(this,arguments)}return c}(),runJobWaitUntilCompleted:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().waitUntilCompleted(a)});function c(b){return a.apply(this,arguments)}return c}(),runJobWaitUntilPersisted:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().waitUntilPersisted(a)});function c(b){return a.apply(this,arguments)}return c}(),runMock:function(a){return d("WAMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("WAMockServerShell").getMockServer().runMock(a)},setMockVariables:function(a){if(d("WAMockServerShell").getMockServer==null)throw c("err")("Mock server is not available. Make sure you use worker v2");d("WAMockServerShell").getMockServer().setVariables(a.variables)},waapi:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("WAWaitForComms").waitForComms();var c=d("WABridgedAPIHandler").waapi[b.type];c==null&&a.TAGS(["WABridgedAPI"]).ERROR(i(),b.type);return c.apply(void 0,b.args)});function e(a){return c.apply(this,arguments)}return e}()})}g.getIGDBridgeHandlers=a}),98);
__d("IGDCOP",["MAWSharedCOP","cr:10748","cr:5112"],(function(a,b,c,d,e,f,g){"use strict";c=(a=b("cr:5112"))!=null?a:b("cr:10748");e=d("MAWSharedCOP").makeCOP(c.processProtocolQueueEntries);g.cop=e}),98);
__d("IGDGetMediaKnownEntriesApi",["I64","MAWDbMsg","MAWJids","MAWMediaUtils","MAWReStoreDb","Promise","WAJids","WALogger","WAMsgMap","WAStanzaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for hashedPlaintextHash ",". Returning new MsgMap."]);j=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield d("MAWReStoreDb").getDB(f.id+":35")),e=d("MAWMediaUtils").genHMACPlaintextHash(a);a=(yield c.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield a.e2ee_media.index("hashedPlaintextHash").get(e));if(c==null){d("WALogger").ERROR(j(),e);return new(d("WAMsgMap").MsgMap)()}var f=Array.from(c.mediaEntries.keys());f=(yield (i||(i=b("Promise"))).all(f.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield a.messages.index("messageId").get(b));return b});return function(a){return c.apply(this,arguments)}}())));f=f.reduce(function(a,b){if(b!=null){var e=c.mediaEntries.get(d("MAWDbMsg").instamadilloMsgIdToMsgId(b.messageId)),f=d("WAJids").validateUserJid(d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(b.threadKey))),g=d("WAStanzaUtils").toStanzaId(b.offlineThreadingId);if(e&&!b.isAdminMessage&&f!=null){b={author:d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(b.senderId)),chat:f,externalId:g};a.set(b,e)}}return a},new(d("WAMsgMap").MsgMap)());return f});return function(b){return a.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":38"));return a});return function(b){return a.apply(this,arguments)}}();g.getMediaKnownEntries=a}),98);
__d("IGDGetMediaPlaintextApi",["MAWMediaUtils","MAWReStoreDb","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media blob does not exist for the given hashedPlaintextHash"]);h=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWReStoreDb").getDB(f.id+":25"));a=d("MAWMediaUtils").genHMACPlaintextHash(a);b=(yield b.tables.e2ee_chunk.index("hashedPlaintextHash").get(a));if(!b){d("WALogger").ERROR(h());return null}return new Blob([b.blobData],{type:b.mimetype})});return function(b){return a.apply(this,arguments)}}();g.getMediaPlaintext=a}),98);
__d("InstamadilloMediaUpload",["FBLogger","IGDGetMediaKnownEntriesApi","IGDGetMediaPlaintextApi","IGDUpdateMediaEntryForMsgApi","LSIntEnum","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWMediaUtils","MAWOptimisticUploadMedia","MAWStartMediaUploadQplFlow","MAWUpdateMediaEntryForOptimisticUploadApi","MessagingAttachmentType","WAAPI","WABlobToArrayBuffer","WAHashUtils","WAMediaCrypto","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield d("MAWMediaUtils").hashBlob(b));f=d("WAHashUtils").toPlaintextHash(f);var g=e.type==="regular"?e.mediaType:"preview",h=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:a.chat,fileSize:b.size,serverMediaType:g,uploadEntry:"InstamadilloMediaUpload"}));return c("WAAPI").uploadMedia({chatJid:a.chat,filename:g==="document"?b.name:void 0,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("IGDGetMediaKnownEntriesApi").getMediaKnownEntries,getMediaPlaintext:d("IGDGetMediaPlaintextApi").getMediaPlaintext,hash:f,mediaTypeDetails:e,protocolMsgId:a,size:b.size,updateMediaEntryForMsg:d("IGDUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:h})});return j.apply(this,arguments)}function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(e.playableUrlMimeType==null)throw c("FBLogger")("igd_web").mustfixThrow("instamadilloUpload: mimeType is null");var f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.playableUrlMimeType);f=f.serverMediaType;var g=(yield i(a,b,{mediaType:f,type:"regular"}));if(g.success!==!0)throw c("FBLogger")("igd_web").mustfixThrow("instamadilloUpload: Failed to upload media");var j=null,k=(h||(h=d("LSIntEnum"))).unwrapIntEnum(e.attachmentType);e=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloMediaUpload",url:e.previewUrl}));if(e!=null){e=(yield e.arrayBuffer());k=k===c("MessagingAttachmentType").IMAGE||k===c("MessagingAttachmentType").VIDEO?d("MAWMediaUtils").convertJpegThumbnailArrayBufferToFile(e):null;e=new Uint8Array(yield d("WABlobToArrayBuffer").blobToArrayBuffer(b));if(k&&d("MAWOptimisticUploadMedia").shouldUploadPreview(f,b.size,e)){b=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f);if(b==null)throw c("FBLogger")("igd_web").mustfixThrow("unsupported preview media type %s",f);e=(yield i(a,k,{messageType:b,type:"preview"}));if(e.success!==!0)throw c("FBLogger")("igd_web").mustfixThrow("instamadilloUpload: Failed to upload preview media");j=e.value}}return{mediaEntry:g.value,thumbnailMediaEntry:j}});return k.apply(this,arguments)}g.instamadilloUpload=a}),98);
__d("createInstamadilloMediaPayload",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.directPath,d=a.duration,e=a.fileEncSha256,f=a.fileLength,g=a.fileSha256,m=a.height,n=a.isAnimated,o=a.isSticker,p=a.mediaId,q=a.mediaKey,r=a.mediaKeyTimestamp,s=a.mediaType,t=a.mimetype,u=a.objectId,v=a.sidecar,w=a.thumbnail,x=a.waveforms,y=a.waveformSamplingFrequencyHz;a=a.width;b={directPath:b,fileEncSha256:e,fileLength:f,fileSha256:g,mediaId:p,mediaKey:q,mediaKeyTimestamp:r,mimetype:t,objectId:u,sidecar:v};switch(s){case"Image":return h(m,a,b,w);case"Video":return i(m,a,b,w);case"Ptt":if(x==null)throw c("FBLogger")("igd_web").mustfixThrow("createInstamadilloMedia: waveforms is null");return j(d,b,x,y);case"Gif":return k(m,a,b,o);case"Sticker":return l(b,n);default:throw c("FBLogger")("igd_web").mustfixThrow("createInstamadilloMedia: mediaType is unsupported")}}function h(a,b,c,d){return{staticPhoto:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function i(a,b,c,d){return{video:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function j(a,b,c,d){return{voice:{duration:a,mediaTransport:b,waveforms:c,waveformSamplingFrequencyHz:d}}}function k(a,b,c,d){return{gif:{height:a,isSticker:d,mediaTransport:c,width:b}}}function l(a,b){return{avatarSticker:{isAnimated:b,mediaTransport:a}}}g.createInstamadilloMediaEncode=a}),98);
__d("InstamadilloSendMediaMessageUtils",["FBLogger","I64","InstamadilloMediaUpload","LSIntEnum","MAWDbMsg","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWMediaUtils","MAWReStoreDb","MessagingAttachmentType","ReQL","WABase64","WABlobToArrayBuffer","WAMediaUtils","WASortedLists","WATimeUtils","asyncToGeneratorRuntime","createInstamadilloMediaPayload"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(b,c)));return a});return j.apply(this,arguments)}function k(a){return{validatedAudioInfo:l(a),validatedDocumentFileInfo:null,validatedImageInfo:m(a),validatedVideoInfo:n(a)}}function l(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO))?{duration:a.playableDurationMs!=null?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,mimetype:a.playableUrlMimeType}:null}function m(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))?{height:a.previewHeight!=null?(h||(h=d("I64"))).to_float(a.previewHeight):0,width:a.previewWidth!=null?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function n(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))?{duration:a.playableDurationMs!=null?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,height:a.previewHeight!=null?(h||(h=d("I64"))).to_float(a.previewHeight):0,mimetype:a.playableUrlMimeType,width:a.previewWidth!=null?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function o(a){var b=a.directPath,c=a.fbid,e=a.fileEncSha256,f=a.fileSha256,g=a.mediaKey,h=a.mediaKeyTimestamp;a=a.objectId;return{directPath:b!=null?b:void 0,fileEncSha256:d("WABase64").encodeB64(e),fileSha256:d("WABase64").encodeB64(f),mediaId:c!=null?c:void 0,mediaKey:d("WABase64").encodeB64(g),mediaKeyTimestamp:String(h),objectId:a!=null?a:void 0}}function e(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g,i=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloSendMediaMessageUtils",url:e.playableUrl}));if(i==null)throw c("FBLogger")("igd_web").mustfixThrow("Blob is null");var j=e.playableUrlMimeType;if(j==null)throw c("FBLogger")("igd_web").mustfixThrow("IGDSendMessageTaskHandler: mimeType is null");var l=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(j),m=l.mediaType;l=l.serverMediaType;if(m==null)throw c("FBLogger")("igd_web").mustfixThrow("handleInstamadilloMediaSends: mediaType is null");var n=(yield d("MAWMediaUtils").genBlobHashes(i)),p=n[0],q=n[1];n=(yield d("MAWReStoreDb").getDB(f.id+":192"));var r=(yield n.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.e2ee_media.index("hashedPlaintextHash").get(q)),f=new Map(c==null?void 0:c.mediaEntries),g=k(e),h=d("MAWDbMsg").stanzaIdToMsgId(a.externalId);if(c!=null){var l=d("WASortedLists").addToSet(c.msgIds,h);c=babelHelpers["extends"]({},c,{},g,{mediaEntries:f,msgIds:l})}else c=babelHelpers["extends"]({hashedPlaintextHash:q,mediaEntries:f,mediaType:m,msgIds:d("WASortedLists").singleElement(h),plaintextHash:p,size:i.size,ts:d("WATimeUtils").unixTime()},g);yield b.e2ee_media.put(c);l=(yield d("WABlobToArrayBuffer").blobToArrayBuffer(i));f=(yield b.e2ee_chunk.index("hashedPlaintextHash").get(q));f==null&&(yield b.e2ee_chunk.put({blobData:l,hashedPlaintextHash:q,mimetype:j,plaintextHash:p}));return c});return function(a){return c.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":193"));g=new File([i],(g=e.filename)!=null?g:"",{type:j});var s=(yield d("InstamadilloMediaUpload").instamadilloUpload(a,g,e)),t=s.mediaEntry;s=s.thumbnailMediaEntry;var u=babelHelpers["extends"]({},r,{objectId:t.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(t.objectId):void 0});yield n.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a.e2ee_media.put(u)});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":260");r=o(t);r.$$unknownFieldCount;n=babelHelpers.objectWithoutPropertiesLoose(r,["$$unknownFieldCount"]);t=babelHelpers["extends"]({},n,{duration:e.playableDurationMs!=null?(h||(h=d("I64"))).to_int32(e.playableDurationMs):void 0,fileLength:g.size,height:e.previewHeight!=null?(h||(h=d("I64"))).to_int32(e.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:m,mimetype:j,sidecar:void 0,waveforms:e.waveformData!=null?e.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:e.samplingFrequencyHz!=null?(h||(h=d("I64"))).to_int32(e.samplingFrequencyHz):void 0,width:e.previewWidth!=null?(h||(h=d("I64"))).to_int32(e.previewWidth):void 0});if(s!=null){r=o(s);r.$$unknownFieldCount;n=babelHelpers.objectWithoutPropertiesLoose(r,["$$unknownFieldCount"]);g={mediaTransport:n};t=babelHelpers["extends"]({},t,{thumbnail:g})}s=d("createInstamadilloMediaPayload").createInstamadilloMediaEncode(t);return{media:u,mediaEncode:s,serverMediaType:l}});return p.apply(this,arguments)}g.getMediaAttachment=a;g.generateValidatedMediaInfoFromAttachment=k;g.prepareMediaProtobuf=e}),98);
__d("MAWDbChunk",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}f.convertNumberToChunkId=a;f.convertToChunkId64=b}),66);
__d("IGDReportUserSpamJob",["FBLogger","I64","InstamadilloSendMediaMessageUtils","LSIntEnum","MAWDbChunk","MAWDbMedia","MAWDbMsg","MAWGetGroupInfoApi","MAWJids","MAWJobManager","MAWReStoreDb","MAWSpamReportUtils","Promise","WABase64","WADeprecatedSendIq","WAGlobals","WAJids","WAMediaUtils","WAResultOrError","WAWap","asyncToGeneratorRuntime","createInstamadilloMediaPayload","err","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("reportUserSpam",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.chatJid,f=a.context,g=a.frxParams,h=a.frxTags,i=a.msgs,j=a.reportedMessageId,l=a.spamFlow,m=a.userJid;a=null;if(h!=null){if(h.length===0)throw c("err")("spam reasons should not be an empty array");a=d("WAWap").wap("tagset",null,h.map(function(a){return d("WAWap").wap("tag",{value:d("WAWap").CUSTOM_STRING(a)})}))}h=null;c("isStringNullOrEmpty")(g)||(h=d("WAWap").wap("parameters",null,g));g=null;f!=null&&(g=d("WAWap").wap("context",null,f));var n=null;(a!=null||g!=null||h!=null)&&(n=d("WAWap").wap("frx",null,a,g,h));var q=(yield k(i,e,m,j));f=(yield d("WAJids").switchOnMsgrChatJidType(e,{group:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWap").DROP_ATTR,c=d("WAWap").DROP_ATTR,e=(yield d("MAWGetGroupInfoApi").getGroupInfo(a));e!=null&&e.subject!=null&&e.subject.content!=null&&(b=d("WAWap").CUSTOM_STRING(e.subject.content));e!=null&&e.inviter!=null&&(c=d("WAWap").USER_JID(e.inviter));return o(q,a,m,c,b,l,n)});function c(b){return a.apply(this,arguments)}return c}(),user:function(){return p(q,m,l,n)}}));d("WADeprecatedSendIq").deprecatedCastStanza(f);return d("WAResultOrError").makeResult()});return function(b){return a.apply(this,arguments)}}()).end();function k(a,c,e,f){a=(a!=null?a:[]).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("MAWJids").toUserJid((i||(i=d("I64"))).to_string(a.senderId)),g;a.transportKey==="Instamadillo"&&(i||(i=d("I64"))).equal(a.displayedContentTypes,(j||(j=d("LSIntEnum"))).ofNumber(2))&&(g=(yield l(a)));if(d("WAJids").interpretAsGroupJid(c)!=null)return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,null,d("WAJids").toGroupJid(c),b);else{var h=(i||(i=d("I64"))).equal(a.senderId,(i||(i=d("I64"))).of_string(d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid())))?e:d("WAGlobals").getMyUserJid();return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,h,null,b,g,f===a.messageId)}});return function(b){return a.apply(this,arguments)}}());return(h||(h=b("Promise"))).all(a)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("MAWReStoreDb").getDB(f.id+":244"));e=(yield e.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=(yield d("InstamadilloSendMediaMessageUtils").getMediaAttachment(b,a.threadKey,a.messageId));if(e==null)throw c("FBLogger")("igd_web").warn("IGDReportUserSpam: Tried to send a message with associated attachment");var f=d("MAWDbMedia").convertToMediaId64((i||(i=d("I64"))).of_string(e.attachmentFbid));f=(yield b.e2ee_media.get(f));if(f==null)throw c("FBLogger")("igd_web").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_media");var g=d("MAWDbChunk").convertToChunkId64(i.of_string(e.attachmentFbid));b=(yield b.e2ee_chunk.get(g));if(b==null)throw c("FBLogger")("igd_web").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_chunk");return{attachment:e,chunk:b,media:f}});return function(a){return e.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":245"));var g=e.attachment;e=e.media;var h=d("MAWDbMsg").instamadilloMsgIdToMsgId(a.messageId);if(!e.msgIds.includes(h))throw c("FBLogger")("igd_web").warn("IGDReportUserSpam: media is not linked to this message");h=e.mediaEntries.get(h);if(h==null)throw c("FBLogger")("igd_web").warn("IGDreportUserSpam: media entry not found");h=d("WAMediaUtils").mediaEntryDataToRawData(e.plaintextHash,h);h=n(h);h.$$unknownFieldCount;h=babelHelpers.objectWithoutPropertiesLoose(h,["$$unknownFieldCount"]);h=babelHelpers["extends"]({},h,{duration:g.playableDurationMs!=null?(i||(i=d("I64"))).to_int32(g.playableDurationMs):void 0,fileLength:e.size!=null?e.size:void 0,height:g.previewHeight!=null?(i||(i=d("I64"))).to_int32(g.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:e.mediaType,mimetype:g.playableUrlMimeType,sidecar:void 0,waveforms:g.waveformData!=null?g.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:g.samplingFrequencyHz!=null?(i||(i=d("I64"))).to_int32(g.samplingFrequencyHz):void 0,width:g.previewWidth!=null?(i||(i=d("I64"))).to_int32(g.previewWidth):void 0});e=d("createInstamadilloMediaPayload").createInstamadilloMediaEncode(h);return e});return m.apply(this,arguments)}function n(a){var b=a.directPath,c=a.fbid,e=a.fileEncSha256,f=a.fileSha256,g=a.mediaKey,h=a.mediaKeyTimestamp;a=a.objectId;return{directPath:b!=null?b:void 0,fileEncSha256:e!=null?d("WABase64").encodeB64(e):void 0,fileSha256:f!=null?d("WABase64").encodeB64(f):void 0,mediaId:c!=null?c:void 0,mediaKey:g!=null?d("WABase64").encodeB64(g):void 0,mediaKeyTimestamp:String(h),objectId:a!=null?a:void 0}}function o(a,b,c,e,f,g,h){var i;return(i=d("WAWap")).wap("iq",{id:i.generateId(),to:i.S_WHATSAPP_NET,type:"set",xmlns:"spam"},i.wap("spam_list",{jid:i.GROUP_JID(b),reportee:i.USER_JID(c),source:e,spam_flow:i.CUSTOM_STRING(g),subject:f},a),h)}function p(a,b,c,e){var f;return(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.S_WHATSAPP_NET,type:"set",xmlns:"spam"},f.wap("spam_list",{jid:f.USER_JID(b),reportee:f.USER_JID(b),spam_flow:f.CUSTOM_STRING(c)},a),e)}g.igdReportUserSpam=a}),98);
__d("IGDStartInstamadilloDYIJob",["EncryptedBackupsDYISingleton","EncryptedBackupsDYITypes","MAWJobManager","MAWReStoreDb","asyncToGeneratorRuntime","cr:1288"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Instamadillo DYI not enabled"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Started job startInstamadilloDYI"]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("startInstamadilloDYI",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.qplInstanceKey;d("EncryptedBackupsDYISingleton").initSingleton(d("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Instamadillo,d("MAWReStoreDb").getDB,a);a=d("EncryptedBackupsDYISingleton").getSingleton();var c=a.getLogger();c.LOG(i());a.logDYIQPLPoint("instamadillo_dyi_job_start");b("cr:1288")!=null?(yield b("cr:1288").getInstance().startDYI(),a.logDYIQPLPoint("instamadillo_dyi_started")):c.ERROR(h())});return function(b){return a.apply(this,arguments)}}()).end();g.startInstamadilloDYI=a}),98);
__d("IGDJobHandlers",["IGDReportUserSpamJob","IGDStartInstamadilloDYIJob","MAWCreateJobNotImplemented"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return{acceptGroupInvite:(a=d("MAWCreateJobNotImplemented")).createNotImplementedJob("acceptGroupInvite"),addGroupParticipants:a.createNotImplementedJob("addGroupParticipants"),createGroup:a.createNotImplementedJob("createGroup"),deleteMsgsForMe:a.createNotImplementedJob("deleteMsgsForMe"),deleteThread:a.createNotImplementedJob("deleteThread"),demoteGroupParticipants:a.createNotImplementedJob("demoteGroupParticipants"),downloadAndHandleMedia:a.createNotImplementedJob("downloadAndHandleMedia"),downloadAndRestoreMedia:a.createNotImplementedJob("downloadAndRestoreMedia"),getSpams:a.createNotImplementedJob("getSpams"),handleFutureproofMsg:a.createNotImplementedJob("handleFutureproofMsg"),handleSpamMsg:a.createNotImplementedJob("handleSpamMsg"),igdReportUserSpam:d("IGDReportUserSpamJob").igdReportUserSpam,leaveGroups:a.createNotImplementedJob("leaveGroups"),markThreadAsRead:a.createNotImplementedJob("markThreadAsRead"),promoteGroupParticipants:a.createNotImplementedJob("promoteGroupParticipants"),removeGroupParticipants:a.createNotImplementedJob("removeGroupParticipants"),reportUserSpam:a.createNotImplementedJob("reportUserSpam"),requestReuploadMedia:a.createNotImplementedJob("requestReuploadMedia"),resendWrittenAppData:a.createNotImplementedJob("resendWrittenAppData"),restoreMessagesFromEncryptedBackups:a.createNotImplementedJob("restoreMessagesFromEncryptedBackups"),restoreProtobufsFromEncryptedBackups:a.createNotImplementedJob("restoreProtobufsFromEncryptedBackups"),restoreThreadsFromEncryptedBackups:a.createNotImplementedJob("restoreThreadsFromEncryptedBackups"),reuploadMedia:a.createNotImplementedJob("reuploadMedia"),revokeMsgs:a.createNotImplementedJob("revokeMsgs"),sendAppData:a.createNotImplementedJob("sendAppData"),sendBumpMsg:a.createNotImplementedJob("sendBumpMsg"),sendGroupInviteMsg:a.createNotImplementedJob("sendGroupInviteMsg"),sendWrittenAppData:a.createNotImplementedJob("sendWrittenAppData"),setGroupSubject:a.createNotImplementedJob("setGroupSubject"),startInstamadilloDYI:d("IGDStartInstamadilloDYIJob").startInstamadilloDYI,updateBackupEntFbidForMedia:a.createNotImplementedJob("updateBackupEntFbidForMedia")}}g.getJobHandlers=a}),98);
__d("IGDLoadRecentParticipantsApi",["I64","LSIntEnum","MAWReStoreDb","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("MAWReStoreDb").getDB(f.id+":30"));c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(c.tables.threads.index("lastActivityTimestampMs")).filter(function(a){return(h||(h=d("I64"))).equal(a.threadType,(i||(i=d("LSIntEnum"))).ofNumber(1))}).take(a)));var e=[];c.forEach(function(a){a=d("WAJids").interpretAsUserJid(d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(a.threadKey)));a!=null&&a!==b&&e.push(a)});return new Set(e)});return function(b,c){return a.apply(this,arguments)}}();g.loadRecentParticipants=a}),98);
__d("InstamadilloBackend",["cr:10745","cr:10746","cr:10747","cr:4772","cr:4849","cr:7098","cr:7691","cr:8224","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h=(d=b("cr:7098"))!=null?d:b("cr:10746"),i=(e=b("cr:4849"))!=null?e:b("cr:10747");function a(a){i!=null&&c("promiseDone")(i.setDeviceJid(a.deviceJid)),b("cr:8224")==null?void 0:b("cr:8224").initEbUploadQueue(),b("cr:7691")==null?void 0:b("cr:7691").initIGDEbRestoreProcessor(),b("cr:4772")==null?void 0:b("cr:4772").listenForEbUploadQueueFlush(),h!=null&&(h.initPendingMessageStanzaQueue(),c("promiseDone")(h.processFutureproofPendingMessageStanzas())),b("cr:10745")==null?void 0:b("cr:10745").startIGDDisappearingMsgCleaner()}g.init=a}),98);
__d("MAWDebugDefineFunctions",["MAWDebug","MAWDebugSendMultipleMsgs"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return{desc:a,execute:b,name:a,serializedArgs:[]}}function a(){var a=Object.keys(d("MAWDebug").MAWDebugFuncs).reduce(function(a,b){return Object.assign(a,(a={},a[b]=h(b,d("MAWDebug").MAWDebugFuncs[b]),a))},{});return babelHelpers["extends"]({},a,{sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs})}g.getAllDebugFunctions=a}),98);
__d("MAWServerRPC",["MAWHandleAbPropsRefreshNotification","MAWHandleAppdataMessage","MAWHandleChatState","MAWHandleFailure","MAWHandleFbDeviceChangeNotification","MAWHandleFbMultiwayNotification","MAWHandleFbThreadNotification","MAWHandleGroupNotification","MAWHandleGroupReceipt","MAWHandleGroupRetryReceipt","MAWHandleIndividualRetryReceipt","MAWHandleLoginSuccess","MAWHandlePeerAppdataReceipt","MAWHandlePeerAppdataRetryReceipt","MAWHandleRtcE2eeCallEventNotification","MAWHandleSpam","MAWHandleThreadMetadata","Promise","WAHandleErrorStanza","WAHandleIncomingMsg","WAHandleInfoBulletin","WAHandlePrekeyContactIDChangedNotification","WAHandlePrekeyDigestNotification","WAHandlePrekeyLowCountNotification","WAHandleReceipt","WAHandleServerPing","WAHandleStreamError","WALogger","WAServerRPC"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Peer messages are not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Broadcast messages are not supported"]);j=function(){return a};return a}function a(){var a;return d("WAServerRPC").makeServerRPC({abprops:{handleAbPropsRefreshNotification:d("MAWHandleAbPropsRefreshNotification").handleAbPropsRefreshNotification},accountSync:null,appdataMessage:{handleAppdataMessage:d("MAWHandleAppdataMessage").handleAppdataMessage,handlePeerAppdataReceipt:d("MAWHandlePeerAppdataReceipt").handlePeerAppdataReceipt,handlePeerAppdataRetryReceipt:d("MAWHandlePeerAppdataRetryReceipt").handlePeerAppdataRetryReceipt},broadcast:{handleBroadcastMessage:function(a){a=a.makeAck;d("WALogger").ERROR(j());return(h||(h=b("Promise"))).resolve(a())}},call:{handleRtcE2eeCallEvent:d("MAWHandleRtcE2eeCallEventNotification").handleRtcE2eeCallEventNotification},clientLog:null,comms:{handleEdgeRoutingInfo:d("WAHandleInfoBulletin").handleEdgeRoutingInfo,handleServerPing:d("WAHandleServerPing").handleServerPing},error:{handleErrorStanza:d("WAHandleErrorStanza").handleErrorStanza,handleSmaxErrorStanza:d("WAHandleErrorStanza").handleSmaxErrorStanza},fb:{handleFbDeviceChangeNotification:d("MAWHandleFbDeviceChangeNotification").handleFbDeviceChangeNotification,handleFbMultiwayNotification:d("MAWHandleFbMultiwayNotification").handleFbMultiwayNotification,handleFbThreadNotification:d("MAWHandleFbThreadNotification").handleFbThreadNotification},groupMessage:{handleGroupChatState:d("MAWHandleChatState").handleGroupChatState,handleGroupDirtyBit:null,handleGroupMessage:d("WAHandleIncomingMsg").handleGroupMessage,handleGroupNotification:d("MAWHandleGroupNotification").handleGroupNotification,handleGroupReceipt:d("MAWHandleGroupReceipt").handleGroupReceipt,handleGroupRetryReceipt:d("MAWHandleGroupRetryReceipt").handleGroupRetryReceipt},individualMessage:{handleIndividualChatState:d("MAWHandleChatState").handleIndividualChatState,handleIndividualMessage:d("WAHandleIncomingMsg").handleIncomingIndividualMsg,handleIndividualReceipt:d("WAHandleReceipt").handleIndividualReceipt,handleIndividualRetryReceipt:d("MAWHandleIndividualRetryReceipt").handleIndividualRetryReceipt},login:{handleLoginFailure:d("MAWHandleFailure").handleLoginFailure,handleLoginSuccess:d("MAWHandleLoginSuccess").handleLoginSuccess},md:null,newsletter:null,offline:{handleOfflineEnd:d("WAHandleInfoBulletin").handleOfflineEnd,handleOfflineStart:d("WAHandleInfoBulletin").handleOfflineStart,handleThreadMetadata:d("MAWHandleThreadMetadata").handleThreadMetadata},peerMessage:{handlePeerMessage:function(a){a=a.makeAck;d("WALogger").ERROR(i());return(h||(h=b("Promise"))).resolve(a())}},prekey:{handlePrekeyContactIDChangedNotification:d("WAHandlePrekeyContactIDChangedNotification").handlePrekeyContactIDChangedNotification,handlePrekeyDigestNotification:d("WAHandlePrekeyDigestNotification").handlePrekeyDigestNotification,handlePrekeyLowCountNotification:d("WAHandlePrekeyLowCountNotification").handlePrekeyLowCountNotification},presence:null,serverProps:null,spam:{handleSpam:d("MAWHandleSpam").handleSpam},status:null,streamError:{handleAckKick:(a=d("WAHandleStreamError")).handleAckKick,handleBadMac:a.handleBadMac,handleConflict:a.handleConflict,handlePingKick:a.handlePingKick,handleStreamErrorCode:a.handleStreamErrorCode,handleXmlNotWellFormed:a.handleXmlNotWellFormed},syncd:null,usync:null})}g.makeServerRPC=a}),98);
__d("WADebugTools",["WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";function a(a){self.Debug==null&&(self.Debug={});var b=function(b){var c=a[b];self.Debug[c.name]=function(){return c.execute.apply(c,arguments)}};for(var c in a)b(c);d("WADevToolsDebugFns").registerDebugFnsToDevTool(a)}g.initDebugFunctions=a}),98);
__d("IGDBackend",["IGDAWDebug","IGDAWMainWebWorkerConfig","IGDBackendBridgeHandlers","IGDCOP","IGDJobHandlers","IGDLoadRecentParticipantsApi","InstamadilloBackend","MAWClearSignalAndTempStores","MAWCommsConfig","MAWConfig","MAWCreateGroupApi","MAWCurrentUser","MAWDebugDefineFunctions","MAWDefinePersistedJob","MAWEphemeralConsts","MAWExternalId","MAWExtractMsFromExternalId","MAWFbCat","MAWHandleReachabilityErrorAdminMsgApi","MAWMpsBridgeHandlers","MAWPREListeners","MAWQplProxy","MAWReStoreDb","MAWServerRPC","MAWSharedOfflineQueueMetric","MAWSharedOfflineResumeUINotifier","MAWTaskDefinitions","Promise","WAArrayBufferUtils","WADebugTools","WAMessageLoggingPublisher","WAMockServerShell","WAPassiveMode","WAService","WATagsLogger","WAWaitForComms","WAWaitForUserUnblocked","asyncToGeneratorRuntime","isUseridAnnotationEnabled","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Worker inited"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to init worker (post-startup): ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["deviceJid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["initWAInfra"]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["backend"]);function a(a,b,c,d,e){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,n){m.LOG(l());m.LOG(k(),a.deviceJid);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"igd_backend_setup_start");d("MAWFbCat").setFbCat(d("WAArrayBufferUtils").stringToArrayBuffer(a.fbCat));g=d("MAWServerRPC").makeServerRPC();n=(yield d("WAService").makeWAService({config:n,dependencies:{clearSignalAndTempStores:d("MAWClearSignalAndTempStores").clearSignalAndTempStores,createGroups:d("MAWCreateGroupApi").createGroups,ephemeralMaxDeletionWindowForUnseenMessage:function(){return d("MAWEphemeralConsts").ephemeralMaxDelectionWindowForUnseenMessage},extractMsFromStanzaId:d("MAWExtractMsFromExternalId").extractMsFromStanzaId,generateExternalId:d("MAWExternalId").generateExternalId,handleReachabilityErrorAdminMsg:d("MAWHandleReachabilityErrorAdminMsgApi").handleReachabilityErrorAdminMsg,isEmployee:d("MAWCurrentUser").isEmployee,isUseridAnnotationEnabled:c("isUseridAnnotationEnabled"),loadRecentParticipants:d("MAWReStoreDb").shouldUseReStoreDb()?d("IGDLoadRecentParticipantsApi").loadRecentParticipants:function(){return(h||(h=b("Promise"))).resolve(new Set())},mediaUploadRoot:function(){return"/wa-igd/mms"},waMessageReceiveReliabilityQplEvent:function(){return c("qpl")._(25306682,"11176")}},getCommsConfig:d("MAWCommsConfig").getCommsConfig,hmacKey:e,regData:a,serverRPC:g})["catch"](function(a){m.ERROR(j(),a);throw a}));d("MAWSharedOfflineQueueMetric").makeOfflineQueueMetric(n.oneQueue,d("WAPassiveMode").passiveModeNotifier,d("IGDCOP").cop,d("WAMessageLoggingPublisher").messageLoggingPublisher);d("MAWConfig").setConfig(d("IGDAWMainWebWorkerConfig").mawConfig);d("IGDCOP").cop.subscribeToOfflineQueue(n.oneQueue,n.protocolQueue);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToWAEvents(n.oneQueue);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToMawEvents(d("IGDCOP").cop);d("WAMockServerShell").isMockServerMode||c("promiseDone")(d("WAWaitForComms").waitForComms().then(function(){return d("MAWTaskDefinitions").registerTasks(d("WAWaitForUserUnblocked").waitForUserUnblocked())}));f.setHandlers("backend",d("IGDBackendBridgeHandlers").getIGDBridgeHandlers(m));d("MAWPREListeners").initializeWAPREMetrics();f.setHandlers("mps",d("MAWMpsBridgeHandlers").mpsBridgeHandlers);d("InstamadilloBackend").init(a);d("MAWDefinePersistedJob").setMsgrJobImplementations(d("IGDJobHandlers").getJobHandlers());yield n.startComms();m.LOG(i());d("WAWaitForComms").unblockComms();d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"igd_backend_setup_end")});return n.apply(this,arguments)}g.startIGDBackend=a}),98);
__d("IGDLowLevelApiImpl",["IGDLowLevelApiBridgeHandlers"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{bridgeHandlers:d("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers}}g.makeLowLevelApi=a}),98);
__d("MAWBackendBridgeSetup",["MAWBridge","WACrossWorkerPortal","WAResultOrError","pageID"],(function(a,b,c,d,e,f,g){"use strict";function a(a){try{var b=h();b.setPort(a.getBridgePort());return d("WAResultOrError").makeResult(null)}catch(a){return d("WAResultOrError").makeError(a)}}function h(){var a=d("MAWBridge").getBridge();a=d("WACrossWorkerPortal").attachPortal(a,["event","threadEvent"],function(a,b){var c=a.length>0?a[a.length-1]:null;c!=null&&c.type==="request"&&c.content.name==="uiUpdate"&&c.content.arg.events&&b.type==="request"&&b.content.name==="uiUpdate"?Array.prototype.push.apply(c.content.arg.events,b.content.arg.events):a.push(b);return a},c("pageID"),{bridgeBatcherMaxTokens:Number.MAX_SAFE_INTEGER});return a}g.initWorkerBridge=a}),98);
__d("MAWCompareWorkerSetupArgs",["BackendInitLoggingUtils","FBLogger","MAWCurrentUser","MessengerWebInitData","WACryptoUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){if(a.prefixAndSuffix!==b.prefixAndSuffix)return!1;a=a.encryptionKey;b=b.encryptionKey;if(a==null&&b==null)return!0;if(a==null&&b!=null||a!=null&&b==null)return!1;if(a==null||b==null)throw c("FBLogger")("messenger_web").mustfixThrow("encryptionKeyA and encryptionKeyB cannot be null at this point");return d("WACryptoUtils").arrayBuffersEqual(a,b)}function a(a,b){c("MessengerWebInitData").sessionId===b.sessionId?d("BackendInitLoggingUtils").MAWInitPoint("setup_args_session_ids_match"):d("BackendInitLoggingUtils").MAWInitPoint("setup_args_session_ids_mismatch");var e=c("justknobx")._("2218");if(b.sessionId!==c("MessengerWebInitData").sessionId){var f=!0;c("gkx")("8512")&&(c("MessengerWebInitData").createdAt!=null&&b.createdAt!=null&&(f=b.createdAt>c("MessengerWebInitData").createdAt),b.createdAt==null&&c("MessengerWebInitData").createdAt!=null&&(f=!1));if(f){d("BackendInitLoggingUtils").MAWInitPoint("setup_args_current_session_ids_mismatch");return{hasArgsChanged:!0,reason:"session_id_change"}}}f=e?d("MAWCurrentUser").getID():a.fbId;if(b.fbId!==f){c("FBLogger")("messenger_web").mustfix("FBID mismatch during worker setup. %s:%s:%s:%s",f==="0",f.length,b.fbId==="0",b.fbId.length);return{hasArgsChanged:!0,reason:"fbid_change"}}else d("BackendInitLoggingUtils").MAWInitPoint("setup_args_fb_ids_match");return!h(b.vaultMaterials,a.vaultMaterials)?{hasArgsChanged:!0,reason:"vault_materials_change"}:{hasArgsChanged:!1,reason:"args_ok"}}g.didWorkerSetupArgsChange=a}),98);
__d("MAWDeviceRegistrationODSBump",["MAWCurrentUser","MAWODSProxy","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.DEVICE_REGISTRATION,key:a}),d("MAWCurrentUser").isEmployee()||d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.DEVICE_REGISTRATION_NON_EMPLOYEE,key:a})}g["default"]=a}),98);
__d("MAWCryptoAuthTokenWrapper",["MessengerWebInitData"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("MessengerWebInitData").cryptoAuthToken}g.getCryptoAuthToken=a}),98);
__d("WASignedKeyApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WASignalDB").getDb().runInTransaction(["signedPrekey"],"readonly",function(b){return b.stores.signedPrekey.get(a)},d("WASignalDB").signalOp("getSignedKey"))}g.getSignedKey=a}),98);
__d("MAWDeviceRegistrationActions",["MAWLoggerUtils","MAWODSProxy","MWFBLogger","MessengerWebInitData","WADbSignal","WAGetRegistrationInfoApi","WAOdsEnums","WASignedKeyApi","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": signedPrekey}"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Device Registration Meta Check] Device Id should be a number"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWDeviceRegistrationActions: sessionId is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);o=function(){return a};return a}var p="Device registration meta is incomplete: ",q=d("MWFBLogger").MWLogger.tags([d("MAWLoggerUtils").Tag.DeviceRegistration]);function r(a,b,c,e,f){(a!=null||b!=null||c!=null||e!=null||f!=null)&&(a==null&&q.MUSTFIX(o(),p,d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId),b==null&&q.MUSTFIX(n(),p,d("WADbSignal").MetaKeysEnum.deviceUUID),c==null&&q.MUSTFIX(m(),p,d("WADbSignal").MetaKeysEnum.regId),e==null&&q.MUSTFIX(l(),p,d("WADbSignal").MetaKeysEnum.identityKeyPair),f==null&&q.MUSTFIX(k(),p,d("WADbSignal").MetaKeysEnum.fbid))}function a(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAGetRegistrationInfoApi").getRegistrationInfo()),b=a.deviceId,e=a.deviceUUID,f=a.fbid,g=a.identityCompareResult,k=a.identityKeyPair,l=a.lastSessionDeviceWasLinkedTo,m=a.lastSignedPrekeyId,n=a.regId,o=a.registrationUnixTime;a=a.registrationVersion;g||d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.COMPARE_IDENTITY,key:"meta_identity_mismatch"});if(m==null||e==null||n==null||k==null||f==null){r(m,e,n,k,f);return null}c("MessengerWebInitData").sessionId==null&&q.MUSTFIX(j());if(b!=null&&typeof b!=="number"){q.MUSTFIX(i());return null}f=(yield d("WASignedKeyApi").getSignedKey(m));if(f==null){q.MUSTFIX(h(),p);return null}return{deviceId:b,deviceUUID:e,identityCompareResult:g,lastSessionDeviceWasLinkedTo:l,lastSignedPrekeyId:m,registrationUnixTime:o,registrationVersion:a!=null?a:void 0,signalRegInfo:{identityKeyPair:k,regId:n,signedPreKey:f}}});return s.apply(this,arguments)}g.getRegistrationMetaWorm=a}),98);
__d("XArmadilloWebLinkDeviceToSessionControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/messenger/armadillo/link_device/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("MAWDeviceRegistrationSessionUtil",["CSRFGuard","CurrentMessengerUser","DTSG","DTSGUtils","MAWLoggerUtils","MWFBLogger","PHPQuerySerializer","SprinkleConfig","WAAPI","WAWorkerGlobalScope","XArmadilloWebLinkDeviceToSessionControllerRouteBuilder","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetch result is not succesful"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["LinkDeviceToTheSession success"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parse response error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetch is not 200: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Fetch error, fetch defined: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeviceUUID is null"]);n=function(){return a};return a}var o=d("MWFBLogger").MWLogger.tags([d("MAWLoggerUtils").Tag.DeviceRegistration,"LinkDeviceToTheSession"]);function a(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;e=(e=d("WAWorkerGlobalScope").workerGlobalScope.location)==null?void 0:e.origin;if(e==null||e==="")return;if(d("CurrentMessengerUser").isTestUser()&&e.includes("twshared"))return;if(a==null){o.MUSTFIX(n());return}e=new URL(e).hostname;e=(e=c("XArmadilloWebLinkDeviceToSessionControllerRouteBuilder").buildUri({}).setDomain(e))==null?void 0:(e=e.setProtocol("https"))==null?void 0:e.toString();if(e==null)return;var f=d("DTSG").getToken();if(f==null)return;a={device_id:a,fb_dtsg:f};c("SprinkleConfig").param_name&&(a[c("SprinkleConfig").param_name]=c("DTSGUtils").getNumericValue(f));f=d("WAWorkerGlobalScope").workerGlobalScope.fetch;var g;try{g=(yield f(e,{body:(h||(h=c("PHPQuerySerializer"))).serialize(a),headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",redirect:"error"}))}catch(a){o.catching(a).MUSTFIX(m(),f!=null);return}if(!g.ok){o.MUSTFIX(l(),g.status);return}e=(yield g.text());d("CSRFGuard").exists(e)&&(e=d("CSRFGuard").clean(e));var p;try{p=JSON.parse(e)}catch(a){o.catching(a).MUSTFIX(k());return}((a=p)==null?void 0:a.success)===!0?(o.DEBUG(j()),yield c("WAAPI").saveLastSessionDeviceWasLinkedTo({sessionId:b})):o.WARN(i())});return p.apply(this,arguments)}g.linkDeviceToTheSession=a}),98);
__d("WAPreRegistrationCrypto",["WACryptoManager","WASignalSignatures","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WACryptoManager").generateRegistrationInfo()),b=a.regId,c=a.staticKeyPair;a=a.authKeyPair;var e=Date.now();e=(yield d("WASignalSignatures").generateSignedPreKey(1,e,c));var f=e.plainObject;e=e.record;return{regId:b,identityKeyPair:c,authKeyPair:a,signedPreKey:{keyId:f.id,encoded:e}}});return h.apply(this,arguments)}function e(a){var b=d("WASignalSignatures").deserializeSignedPreKey(a.signedPreKey.encoded);if(b==null||b.id!==a.signedPreKey.keyId)throw c("err")("Badly formatted signed prekey");return{regId:a.regId,identityPubKeyType:5,identityPubKey:a.identityKeyPair.publicKey,signedPreKey:b}}g.makeRegistrationData=a;g.serializeRegistrationData=e}),98);
__d("MAWDeviceRegistrationUtilWorker",["FBLogger","MAWConstants","MAWCurrentUser","URI","WABase64","WADbDeviceRegistration","WAPreRegistrationCrypto","WATimeUtils","WAWorkerGlobalScope","asyncToGeneratorRuntime","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){var c=new Uint8Array(b);a=a;for(b=b-1|0;b>=0;--b)c[b]=a&255,a=a>>>8;return c}function j(a,b,c,e,f,g,h,j,k){var l;f=(l=d("WABase64")).encodeB64(i(f,4));g=l.encodeB64(i(g,1));h=l.encodeB64(h);var m=l.encodeB64(i(j.id,3)),n=l.encodeB64(j.keyPair.publicKey);l=l.encodeB64(j.signature);j=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",e).set("e_regid",f).set("e_keytype",g).set("e_ident",h).set("e_skey_id",m).set("e_skey_val",n).set("e_skey_sig",l);if(k){a=d("WABase64").encodeB64(k.signedICDCIdentityList);b=d("WABase64").encodeB64(k.ihash);j.set("icdc_list",a).set("icdc_ts",k.ts).set("icdc_seq",k.seq).set("ihash",b)}return j}function k(a){var b=[];a.forEach(function(a,c,d){b.push(encodeURIComponent(c)+("="+encodeURIComponent(a.toString())))});return b.join("&")}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",priority:c("gkx")("15590")?"high":"auto"}));return yield b.json()});return m.apply(this,arguments)}function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){b=(yield d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",priority:c("gkx")("15590")?"high":"auto",signal:e}));return b.json()});return o.apply(this,arguments)}function p(){var a=new(h||(h=c("URI")))(s()+d("WADbDeviceRegistration").ICDC_ENDPOINT);return a.toString()}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=p();a=(yield l(a,b));if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(a.status!==200)throw c("FBLogger")("messenger_web").mustfixThrow("WA Server returned status code "+a.status+" while attempting device registration");return a});return r.apply(this,arguments)}function s(){var a=Number(d("MAWCurrentUser").getAppID()),b=d("WADbDeviceRegistration").REG_FB_DOMAIN;switch(a){case 1217981644879628:case 936619743392459:case 487152425211411:case 1035956773910536:b=d("WADbDeviceRegistration").REG_IGD_DOMAIN;break;case 772021112871879:b=d("WADbDeviceRegistration").REG_MSGR_DOMAIN;break;default:b=d("WADbDeviceRegistration").REG_FB_DOMAIN}return b}function t(){var a=new(h||(h=c("URI")))(s()+d("WADbDeviceRegistration").REGISTRATION_ENDPOINT);return a.toString()}var u=new Set(["www.facebook.com","intern.facebook.com","web.facebook.com","www.instagram.com","www.messenger.com"]);function v(){if(c("gkx")("2456")){var a=d("WAWorkerGlobalScope").workerGlobalScope.location.hostname;u.has(a)||c("FBLogger")("bt","device_registration").warn("Invalid subdomain for device registration: %s",a)}}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=t();v();var e;try{e=(yield n(a,b))}catch(a){throw c("FBLogger")("messenger_web").mustfixThrow("Post request failed: "+(a==null?void 0:a.message)+" url:"+b)}if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(e.status!==200){c("FBLogger")("messenger_web").warn("WA Server returned status code %s %s while attempting device registration",e.status,(a=e.message)!=null?a:"");return{message:(b=e.message)!=null?b:"Empty message",status:e.status,success:!1}}if(typeof e.wa_device_id!=="number")throw c("FBLogger")("messenger_web").mustfixThrow("Device ID from WA Server was not a number");if(typeof e.product!=="string")throw c("FBLogger")("messenger_web").mustfixThrow("Product info from WA Server was not a string");return{edge_routing_info:e.edge_routing_info,icdc_success:e.icdc_success,product:e.product,status:200,success:!0,type:e.type,wa_device_id:e.wa_device_id}});return x.apply(this,arguments)}function a(a,b,c,d){a=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",d);b=k(a);return q(b)}function e(a,b,c,d,e,f,g,h,i){a=j(a,b,c,d,e,f,g,h,i);b=k(a);return w(b)}function f(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAPreRegistrationCrypto").makeRegistrationData());return{deviceUUID:c("uuidv4")(),lastSignedPrekeyId:a.signedPreKey.keyId,registrationUnixTime:d("WATimeUtils").unixTime(),registrationVersion:d("MAWConstants").CURRENT_REGISTRATION_VERSION,signalRegInfo:a}});return y.apply(this,arguments)}g.getRegistrationEndpoint=t;g.fetchICDC=a;g.register=e;g.createNewRegistrationMeta=f}),98);
__d("WAIdentityApiV2",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["identity"],"readwrite",function(b){return b.stores.identity.bulkPut([a])},d("WASignalDB").signalOp("saveIdentity"))};g.saveIdentity=a}),98);
__d("MAWDeviceRegistrationWorker",["IGDWebUtils","MAWClearSignalAndTempStores","MAWCryptoAuthTokenWrapper","MAWCurrentUser","MAWDeviceRegistrationActions","MAWDeviceRegistrationODSBump","MAWDeviceRegistrationSessionUtil","MAWDeviceRegistrationUtilWorker","MAWJids","MAWLoggerUtils","MAWODSProxy","MAWQplProxy","MWFBLogger","MessengerWebInitData","Promise","UserAgentData","WADbDeviceRegistration","WADbMetaTxnsV2","WADbRegistrationApiV2","WAGetSafeQPLError","WAICDCUtils","WAIdentityApiV2","WAIdentityUtils","WAJids","WAMockServerShell","WAOdsEnums","WAPreRegistrationCrypto","WASignalKeys","WATimeUtils","asyncToGeneratorRuntime","cr:7755","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping device registration"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Crypto Auth Token was null or incomplete"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot process ICDC payload during registration"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Beginning device registration"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Device registration failure - ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);n=function(){return a};return a}var o=d("MWFBLogger").MWLogger.tags([d("MAWLoggerUtils").Tag.DeviceRegistration]),p=function(){return d("IGDWebUtils").isInstagramWebSupportedApp(Number(d("MAWCurrentUser").getAppID()))};function q(a){switch(a){case 1217981644879628:case 936619743392459:case 487152425211411:case 1035956773910536:return"instagram.com";case 772021112871879:return"messenger.com";case 2220391788200892:return"facebook.com";default:return"unknown"}}function r(a,b){b===void 0&&(b=400);return{message:a,registrationState:{type:d("WADbDeviceRegistration").RegistrationStatesEnum.failed},status:b}}function s(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){function f(a){b.addPoint(a),e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e,"device_registration_"+a)}o.DEBUG(l());var g=(yield d("MAWDeviceRegistrationUtilWorker").createNewRegistrationMeta());f("registration_created");b.addAnnotations({string:{unique_device_id:g.deviceUUID}});yield d("WADbRegistrationApiV2").saveRegistrationMeta(d("MAWCurrentUser").getID(),g);f("registration_saved");var h=d("MAWCurrentUser").getID(),i=g.deviceUUID,j=d("WAPreRegistrationCrypto").serializeRegistrationData(g.signalRegInfo),m=null,n=!1;n=(n=n?1019394685547802:d("MAWCurrentUser").getAppID())==null?void 0:n.toString();if(n==null)return r("appId is null, cannot register to WhatsApp");if(h==="0")return r(d("WADbDeviceRegistration").DEVICE_REGISTER_ERROR_ZERO_AS_USER_ID);var q=null,s=null;try{var t=(yield d("MAWDeviceRegistrationUtilWorker").fetchICDC(h,a.encrypted_serialized_cat,n,i));f("icdc_fetched");var u=[].concat(d("WAICDCUtils").base64DeviceIdentitiesToSerializedPubKeys(t.device_identities));if(t.curr_identity_idx!=null){var v=t.curr_identity_idx;u[v]=d("WASignalKeys").serializeIdentity(j.identityPubKey)}else u.push(d("WASignalKeys").serializeIdentity(j.identityPubKey));q=d("WAICDCUtils").computeICDCInfoForUpload(g.signalRegInfo.identityKeyPair,t.icdc_seq,u,"registration","registration");s=(yield d("WAIdentityUtils").computeIdentitiesHash(u));f("identities_computed")}catch(a){o.catching(a).MUSTFIX(k())}v=!1;try{t=(yield d("MAWDeviceRegistrationUtilWorker").register(h,a.encrypted_serialized_cat,n,i,j.regId,j.identityPubKeyType,j.identityPubKey,j.signedPreKey,q&&s?{ihash:s,seq:q.icdcInfo.seq,signedICDCIdentityList:q.encodedSignedICDC,ts:q.icdcInfo.timestamp}:null));f("device_registered");u=t==null?void 0:t.type;u!=null&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.REGISTRATION_TYPE,key:u});if(!t||!(t==null?void 0:t.success)){return{message:(a=t==null?void 0:t.message)!=null?a:d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER,registrationState:{type:d("WADbDeviceRegistration").RegistrationStatesEnum.failed},status:(n=t==null?void 0:t.status)!=null?n:"400"}}m=t.wa_device_id;v=(j=t.icdc_success)!=null?j:!1}catch(a){return r(d("WAGetSafeQPLError").getSafeQPLErrorMessage(a))}if(m==null)return r(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);s=d("MAWJids").toUserJid(h);if(!p()){f=c("MessengerWebInitData").sessionId;f!=null&&c("promiseDone")(d("MAWDeviceRegistrationSessionUtil").linkDeviceToTheSession(i,f))}if(q!=null&&v){u=q.icdcInfo;yield d("WADbRegistrationApiV2").saveICDC(s,{devices:u.devices,dirty:!0,sequence:u.seq,signingDeviceIndex:u.signingDeviceIndex,timestamp:u.timestamp});b.addPoint("icdc_saved")}yield d("WADbRegistrationApiV2").saveDeviceId(m);b.addPoint("device_saved");a={deviceJid:d("WAJids").toDeviceJid(s,m),identity:d("WASignalKeys").serializeIdentity(g.signalRegInfo.identityKeyPair.publicKey),userJid:s};yield d("WAIdentityApiV2").saveIdentity(a);b.addPoint("identity_saved");return{message:d("WADbDeviceRegistration").DEVICE_SUCCESSFULLY_REGISTERED,registrationState:{registrationTime:g.registrationUnixTime,type:d("WADbDeviceRegistration").RegistrationStatesEnum.finished},status:200}});return t.apply(this,arguments)}function a(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25307273,"1410"),{string:{browser_name:c("UserAgentData").browserName,device_os:c("UserAgentData").platformName,device_os_version:c("UserAgentData").platformVersion,"interface":q(Number(d("MAWCurrentUser").getAppID()))}},{providedTimeoutInMs:2e4}),g=function(a,b){return d("MAWQplProxy").measurePerfInQPL(f,a,b)};try{e=e!=null?e:d("MAWCryptoAuthTokenWrapper").getCryptoAuthToken();if(e==null||e.encrypted_serialized_cat===""){o.WARN(j());f.endFail("empty_cat_token");return r(d("WADbDeviceRegistration").DEVICE_REGISTER_ERROR_EMPTY_CAT_TOKEN,414)}a!=null&&d("MAWQplProxy").sendQPLAnnotationsThroughBridge(a,{"int":{secondsUntilCATExpiration:Math.floor(e.expiration_time_in_seconds-Date.now()/1e3)}});if(!d("WATimeUtils").isInFuture(d("WATimeUtils").castToUnixTime(e.expiration_time_in_seconds))){f.endFail("expired_cat_token");return r(d("WADbDeviceRegistration").DEVICE_REGISTER_ERROR_EXPIRED_CAT_TOKEN,413)}if(d("WAMockServerShell").isMockServerMode){var k=(yield d("MAWDeviceRegistrationUtilWorker").createNewRegistrationMeta());yield (h||(h=b("Promise"))).all([d("WADbRegistrationApiV2").saveRegistrationMeta(d("MAWCurrentUser").getID(),k),d("WADbRegistrationApiV2").saveDeviceId(d("WAJids").interpretAsDeviceId(1)),d("WADbMetaTxnsV2").saveCAT(e)]);f.addPoint("wa_device_registration_mock_server");f.endSuccess();return{message:"Skipping registration because of Mock Server",registrationState:{registrationTime:k.registrationUnixTime,type:d("WADbDeviceRegistration").RegistrationStatesEnum.finished},status:200}}b("cr:7755")!=null&&(yield b("cr:7755").updateRegDataFromLocalStorage());k=d("MAWDeviceRegistrationActions").getRegistrationMetaWorm();k=(yield g("get_registration_data",k));f.addAnnotations({string:{unique_device_id:k==null?void 0:k.deviceUUID}});a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_check",{annotations:{bool:{identityCompareResult:k==null?void 0:k.identityCompareResult},"int":{registrationVersion:k==null?void 0:k.registrationVersion}}});var l=(k==null?void 0:k.identityCompareResult)===!1;if(k==null||k.deviceId==null||l){f.addAnnotations({bool:{isNewRegistartion:!0}});a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_new_reg_start");try{yield g("clear_signal_stores",d("MAWClearSignalAndTempStores").clearSignalAndTempStores()),a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_signal_temp_stores_cleared"),yield g("save_cat",d("WADbMetaTxnsV2").saveCAT(e)),a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_cat_saved")}catch(a){return r(d("WAGetSafeQPLError").getSafeQPLErrorMessage(a))}l=(yield g("try_register",s(e,f,a)));l.registrationState.type===d("WADbDeviceRegistration").RegistrationStatesEnum.failed?f.endFail("wa_device_registration_failed",{string:{errorMsg:l.message}}):(f.addPoint("wa_device_registration_successful"),f.endSuccess());a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_new_reg_end");return l}else{f.addAnnotations({bool:{isNewRegistartion:!1}});a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_existing_reg_start");yield g("save_cat",d("WADbMetaTxnsV2").saveCAT(e));l=c("MessengerWebInitData").sessionId;g=k.lastSessionDeviceWasLinkedTo==null||k.lastSessionDeviceWasLinkedTo!==l;l!=null&&!(k.deviceUUID===l||k.deviceUUID.startsWith(l+"-"))&&g&&!p()&&c("promiseDone")(d("MAWDeviceRegistrationSessionUtil").linkDeviceToTheSession(k.deviceUUID,l));a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_existing_reg_end")}c("MAWDeviceRegistrationODSBump")("already_registered");f.addPoint("wa_device_registration_persisted");f.endSuccess();o.DEBUG(i());return{message:d("WADbDeviceRegistration").DEVICE_ALREADY_REGISTERED,registrationState:{type:d("WADbDeviceRegistration").RegistrationStatesEnum.finished},status:200}}catch(a){f.endFail("uncaught_exception",{string:{errorMsg:(e=a==null?void 0:a.message)!=null?e:"No error message"}});throw a}});return u.apply(this,arguments)}function e(a){c("MAWDeviceRegistrationODSBump")("fail");o.MUSTFIX(n(),d("WADbDeviceRegistration").FAILED_REGISTRATION_RETRIES);for(a of a)o.MUSTFIX(m(),a)}g.handleRegistrationError=r;g.setupDeviceRegistration=a;g.logDeviceRegistrationRetryFailure=e}),98);
__d("MAWDeviceRegistrationInitWorker",["BackendInitLoggingUtils","BrowserLockManager","MAWDeviceRegistrationODSBump","MAWDeviceRegistrationWorker","MAWHMACKey","MAWQplProxy","MAWRotateCAT","MWFBLogger","Promise","WADbDeviceRegistration","WADbRegistrationApiV2","WAGetRegistrationInfoApi","WAPromiseRetryLoop","WARetryUtils","asyncToGeneratorRuntime","gkx","justknobx","memoizeOneWithArgs","promiseDone","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Registration finished, ending device registration promise retry loop"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration 500: Retry is needed"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration 403: User is banned"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration 415: User should take action to  re-register to WAI"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration ",": User should re-login"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration ",". Rotate CAT"]);o=function(){return a};return a}var p=d("MWFBLogger").MWLogger.tags(["backend","init","deviceRegistration"]);function a(){var a;a=(a=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&c("gkx")("15590"))!=null?a:!1;return c("BrowserLockManager")!=null&&!a?d("BackendInitLoggingUtils").measureMawInit("request_maw_registration_lock",function(){return new(h||(h=b("Promise")))(function(a,d){c("promiseDone")(c("BrowserLockManager").request("maw_registration_lock",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var b=(yield q());a(b)}catch(a){d(a)}})))})}):q()}var q=c("memoizeOneWithArgs")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("BackendInitLoggingUtils").measureMawInit("init_device_reg_overall",function(){return r()})),c=a.message;a=a.registrationState;if(a===d("WADbDeviceRegistration").RegistrationStatesEnum.failed)throw p.mustfixThrow("registration_failed: "+c);a=(yield (h||(h=b("Promise"))).all([d("BackendInitLoggingUtils").measureMawInit("load_reg_in_txn",function(){return d("WADbRegistrationApiV2").loadAllRegistrationMetaInTransaction()}),d("BackendInitLoggingUtils").measureMawInit("gen_insert_hmac",function(){return d("MAWHMACKey").generateAndInsertHMACKey()})]));c=a[0];a=a[1];return{hmacKey:a,regData:c}}));function r(){var a=0,e=new Set(),f=0,g=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({code:function(){var g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){a++;if(a>d("WADbDeviceRegistration").MAX_DEVICE_REGISTRATION_RETRIES){d("MAWDeviceRegistrationWorker").logDeviceRegistrationRetryFailure(e);var g=d("MAWDeviceRegistrationWorker").handleRegistrationError(d("WADbDeviceRegistration").FAILED_REGISTRATION_RETRIES);b(g);return}try{g=null;switch(f){case 414:case 413:case 418:p.DEBUG(o(),f);g=(yield d("MAWRotateCAT").rotateCAT({initiator:"MAWDeviceRegistrationInitWorker::initDeviceRegistration",qplAnnotations:{"int":{prevStatusCode:f}}}));break;case 400:case 401:p.MUSTFIX(n(),f);c("justknobx")._("3526")&&(g=(yield d("MAWRotateCAT").rotateCAT({initiator:"MAWDeviceRegistrationInitWorker::initDeviceRegistration",qplAnnotations:{"int":{prevStatusCode:f}}})));break;case 415:p.MUSTFIX(m());break;case 403:p.MUSTFIX(l());break;case 500:p.MUSTFIX(k());break}var h=a===1?c("qpl")._(25310776,"6155"):null;h=(yield d("MAWDeviceRegistrationWorker").setupDeviceRegistration(h,g));f=h.status;c("MAWDeviceRegistrationODSBump")("attempt."+a+".result."+h.registrationState.type);h.registrationState.type===d("WADbDeviceRegistration").RegistrationStatesEnum.finished&&(h.registrationState.registrationTime!=null&&c("MAWDeviceRegistrationODSBump")("success"),p.DEBUG(j()),b(h));e.add(h.message);d("MAWQplProxy").sendQPLAnnotationsThroughBridge(c("qpl")._(25310776,"6155"),{"int":{deviceRegistrationLastAttemptCount:a},string:{deviceRegistrationLastAttemptMessages:Array.from(e).join(", ")}})}catch(b){g="Uncaught device registration error - "+b;p.WARN(i(),g);e.add(""+g);d("MAWQplProxy").sendQPLAnnotationsThroughBridge(c("qpl")._(25310776,"6155"),{"int":{deviceRegistrationLastAttemptCount:a},string:{deviceRegistrationLastAttemptMessages:Array.from(e).join(", ")}})}});function h(a){return g.apply(this,arguments)}return h}(),name:"deviceRegistration",timer:d("WARetryUtils").fibonacciBackoff(!0)});g.start();return g.promise().then(function(a){a.registrationState.type===d("WADbDeviceRegistration").RegistrationStatesEnum.finished&&c("promiseDone")(d("WAGetRegistrationInfoApi").updateRegistrationHistory(a.registrationState.registrationTime));return a})}g.registerDevice=a;g.performDeviceRegistration=q;g.initDeviceRegistration=r}),98);
__d("MAWDbInitIndexedDb",["MAWIndexedDb","MWEARKeychainV3","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.onDbPopulate;return d("MAWIndexedDb").makeDB(d("MWEARKeychainV3").getDbEncryptionKey,{enableDataSyncMiddleware:!0,enableMutationValidator:c("gkx")("1627"),onDbPopulate:a})}g.dbInit=a}),98);
__d("MAWMpsAppdataEncryptedBackupsSecretsPreprocessor",["FBLogger","MAWHandleEncryptedBackupsSecretsApi","MAWProtobufDeserializers","MpsTypes","Promise","asyncToGeneratorRuntime","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var e=a.backupId,f=a.epoch,g=a.mailboxRootKey,i=a.obliviousValidationToken,j=a.serverDataId;a=a.tempOcmfClientState;if(e==null||f==null||g==null||i==null||j==null||a==null){c("FBLogger")("mps").warn("Cannot process encrypted backups secrets - mandatory data missing");return(h||(h=b("Promise"))).resolve()}f=f.map(function(a){var b=a.anonId,d=a.id,e=a.rootKey;a=a.status;if(b==null||d==null||e==null||a==null){c("FBLogger")("mps").warn("Encountered invalid epoch when processing encrypted backups secrets");return null}return{anonId:b,id:d,rootKey:e,status:a}}).filter(Boolean);e={backupId:e,epoch:f,mailboxRootKey:g,obliviousValidationToken:i,serverDataId:j,tempOcmfClientState:a};return d("MAWHandleEncryptedBackupsSecretsApi").handleEncryptedBackupsSecret(e)}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield i(b);return{directive:{actionType:d("MpsTypes").ActionType.Noop,debugFlags:["WA"],isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:a.message.messageId},insertionSource:a.insertionSource,message:a.message}});return k.apply(this,arguments)}a={name:"MAWMpsAppdataEncryptedBackupsSecretsPreprocessorAsync",processAsync:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e.metric.addPoint("eb_appdata_secret_start");var f=new Array(a.length),g=new Map();a=a.map(function(a,b){var e=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(a.message.payload);if(e.payload().kind!=="messageApplication"){f[b]=a;return}e=(e=e.encryptedTransportMessage())==null?void 0:(e=e.armadillo())==null?void 0:(e=e.payload)==null?void 0:(e=e.signal)==null?void 0:e.encryptedBackupsSecrets;if(e==null){f[b]=a;return}return j(a,e).then(function(a){f[b]=a})["catch"](function(b){g.set(a.message.messageId,c("getErrorSafe")(b))})});a.length>0&&(yield (h||(h=b("Promise"))).all(a));e.metric.addPoint("eb_appdata_secret_end");return{errors:g,payload:f}});function e(b,c){return a.apply(this,arguments)}return e}()};g.MAWMpsAppdataEncryptedBackupsSecretsPreprocessor=a}),98);
__d("MAWMpsGenerateMessageFromBackupMessage",["FBLogger","MAWProtobufDeserializers","MpsTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){try{var e,f=a.decryptedProtobuf,g=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(f);if(g.payload().kind!=="messageApplication"){c("FBLogger")("mps").warn("Expected messageApplication, got %s",g.payload().kind);return null}e=(e=g.proto.metadata)==null?void 0:e.senderId;g=(g=g.proto.metadata)==null?void 0:g.messageId;return e!=null&&g!=null?{messageId:d("MpsTypes").toMessageId(g),payload:d("MpsTypes").toBytes(f),senderId:e,threadId:b,timestampMs:a.protobufTimestampMS}:null}catch(a){c("FBLogger")("mps").catching(a).mustfix("Runtime error performing generateMessage: %s",a);throw a}}g.generateMessage=a}),98);
__d("MAWMpsGenerateSupplementalFromBackupMessage",["FBLogger","MAWProtobufDeserializers","MpsTypes","WALongInt"],(function(a,b,c,d,e,f,g){"use strict";function a(a){try{var b,e=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(a);if(e.payload().kind!=="messageApplication"){c("FBLogger")("mps").warn("Expected messageApplication, got %s",e.payload().kind);return null}b=(b=e.proto.metadata)==null?void 0:b.messageId;e=(e=e.proto.metadata)==null?void 0:e.timestampMs;return b!=null&&e!=null?{messageId:d("MpsTypes").toMessageId(b),payload:d("MpsTypes").toBytes(a),timestampMs:d("WALongInt").numberOrThrowIfTooLarge(e)}:null}catch(a){c("FBLogger")("mps").catching(a).mustfix("Runtime error performing generateSupplemental: %s",a);throw a}}g.generateSupplemental=a}),98);
__d("MAWMpsDecodeAndParseEbProtobufs",["FBLogger","MAWMpsGenerateMessageFromBackupMessage","MAWMpsGenerateSupplementalFromBackupMessage","MpsTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=[];try{a.forEach(function(a){if(a==null)return;var c=d("MAWMpsGenerateMessageFromBackupMessage").generateMessage(a.toplevelProtobuf,b);if(c==null)return;var f=new Map();a.supplementalProtobufs.forEach(function(a,b){a=a.decryptedProtobuf;a=d("MAWMpsGenerateSupplementalFromBackupMessage").generateSupplemental(a);a!=null&&f.set(d("MpsTypes").toSupplementalKey(b),a)});a={expiryTimestampMs:null,supplementalProtobufs:f,tags:(a=a.tags)!=null?a:[],toplevelProtobuf:c};e.push(a)});return e}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Runtime error performing decodeAndParseEbProtobufs for MPS: %s",a);throw a}}g.decodeAndParseEbProtobufs=a}),98);
__d("MAWMpsTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({REACTION:"reaction",EDIT:"edit",RAVEN_ACTION_MESSAGE:"raven_action_message",RAVEN_ORIGINAL_MESSAGE:"raven_original_message"});f.SupplementalKeyPrefixMps=a}),66);
__d("MAWMpsDirectiveGenerator",["FBLogger","MAWMpsGating","MAWMpsTypes","MAWProtobufDeserializers","MSGDataclassTypes.flow","MWFBLogger","MpsFutureProofKey","MpsTypes","WAResultOrError","err","getErrorSafe","getMediaTypeFromConsumerMessage","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return d("MpsTypes").toSupplementalKey(d("MAWMpsTypes").SupplementalKeyPrefixMps.REACTION+":"+a.senderId)}var i={status:"next"};function j(a,b){var c;b=b.subProtocol();if((b==null?void 0:b.kind)!=="consumerApplication")return d("WAResultOrError").makeError("edit_protobuf_invalid");return((c=b.payload)==null?void 0:(c=c.content)==null?void 0:(c=c.editMessage)==null?void 0:c.timestampMs)==null?d("WAResultOrError").makeError("edit_protobuf_invalid"):d("WAResultOrError").makeResult(d("MpsTypes").toSupplementalKey(d("MAWMpsTypes").SupplementalKeyPrefixMps.EDIT+":"+a.senderId+":"+b.payload.content.editMessage.timestampMs))}function k(a){return d("MpsTypes").toSupplementalKey(d("MAWMpsTypes").SupplementalKeyPrefixMps.RAVEN_ACTION_MESSAGE+":"+a.senderId)}function l(a){return d("MpsTypes").toSupplementalKey(a.messageId)}function m(a){switch(a){case"image":return d("MSGDataclassTypes.flow").MpsMessageTag.Photo;case"video":return d("MSGDataclassTypes.flow").MpsMessageTag.Video;case"gif":return d("MSGDataclassTypes.flow").MpsMessageTag.Gif;case"ptt":return d("MSGDataclassTypes.flow").MpsMessageTag.Audio;case"document":return d("MSGDataclassTypes.flow").MpsMessageTag.File;case"sticker":case"md-app-state":case"xma-image":case void 0:case null:return;default:a}}function n(a,b){b=b.subProtocol();if((b==null?void 0:b.kind)!=="armadillo")return i;return((b=b.payload)==null?void 0:(b=b.content)==null?void 0:b.ravenMessageMsgr)==null?i:{directive:{actionType:d("MpsTypes").ActionType.Preprocess,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:a.messageId},status:"success"}}function o(a,b){b=b.subProtocol();if((b==null?void 0:b.kind)!=="consumerApplication")return i;return((b=b.payload)==null?void 0:(b=b.content)==null?void 0:b.pollCreationMessage)==null?i:{directive:{actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:a.messageId},status:"success"}}function p(a,b){var c;b=b.subProtocol();if((b==null?void 0:b.kind)!=="consumerApplication")return i;if(((c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.pollUpdateMessage)==null)return i;if(((c=b.payload.content.pollUpdateMessage.pollCreationMessageKey)==null?void 0:c.id)==null)return{errorMessage:"no target message id found for poll update message",status:"drop"};c=b.payload.content.pollUpdateMessage.pollCreationMessageKey.id;return{directive:{actionType:d("MpsTypes").ActionType.UpsertSupplemental,isLocalOnly:!1,isTransportErrorPlaceholder:!1,supplementalKey:l(a),tags:[],targetMessageId:d("MpsTypes").toMessageId(c)},status:"success"}}function q(a,b){var c;b=b.subProtocol();if((b==null?void 0:b.kind)!=="armadillo")return i;if(((c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.ravenActionNotifMessage)==null)return i;if(((c=b.payload.content.ravenActionNotifMessage.key)==null?void 0:c.id)==null)return{errorMessage:"no target message id found for raven action message",status:"drop"};b=(c=b.payload)==null?void 0:(b=c.content)==null?void 0:(c=b.ravenActionNotifMessage.key)==null?void 0:c.id;return{directive:{actionType:d("MpsTypes").ActionType.Preprocess,isLocalOnly:!1,isTransportErrorPlaceholder:!1,supplementalKey:k(a),tags:[],targetMessageId:d("MpsTypes").toMessageId(b)},status:"success"}}function r(a,b){var c;b=b.subProtocol();if((b==null?void 0:b.kind)!=="consumerApplication")return i;b=b.proto;c=(c=b.payload)==null?void 0:c.content;b=d("getMediaTypeFromConsumerMessage").getMediaTypeFromConsumerMessage(b);if(b==null&&(c==null?void 0:c.messageText)==null&&(c==null?void 0:c.pollCreationMessage)==null)return i;c=[];b=m(b);b!=null&&c.push(b);return{directive:{actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:c,targetMessageId:a.messageId},status:"success"}}function s(a,b){b=b.subProtocol();if((b==null?void 0:b.kind)!=="armadillo")return i;b=b;b=(b=b.payload)==null?void 0:b.content;return(b==null?void 0:b.extendedContentMessage)==null&&(b==null?void 0:b.bumpExistingMessage)==null&&(b==null?void 0:b.noteReplyMessage)==null&&(b==null?void 0:b.screenshotAction)==null?i:{directive:{actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:a.messageId},status:"success"}}function t(a,b){return b.proto.payload!=null||((b=b.proto.metadata)==null?void 0:b.chatEphemeralSetting)==null?i:{directive:{actionType:d("MpsTypes").ActionType.Noop,isLocalOnly:!0,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:a.messageId},status:"success"}}function u(a,b){var c,e=b.subProtocol();if((e==null?void 0:e.kind)!=="consumerApplication")return i;e=e.proto;if(((c=e.payload)==null?void 0:(c=c.content)==null?void 0:c.editMessage)==null)return i;c=(c=e.payload)==null?void 0:(e=c.content)==null?void 0:e.editMessage;c=(e=c.key)==null?void 0:e.id;e=j(a,b);if(c==null)return{errorMessage:"no target message id found for edit supplemental message",status:"drop"};return!e.success?{errorMessage:"no edit timestampMs found for edit supplemental message",status:"drop"}:{directive:{actionType:d("MpsTypes").ActionType.UpsertSupplemental,isLocalOnly:!1,isTransportErrorPlaceholder:!1,supplementalKey:e.value,tags:[],targetMessageId:d("MpsTypes").toMessageId(c)},status:"success"}}function v(a,b){var c;b=b.subProtocol();if((b==null?void 0:b.kind)!=="consumerApplication")return i;b=b.proto;if(((c=b.payload)==null?void 0:(c=c.content)==null?void 0:c.reactionMessage)==null)return i;c=(c=b.payload)==null?void 0:(b=c.content)==null?void 0:b.reactionMessage;if(((b=c.key)==null?void 0:b.id)==null)return{errorMessage:"no target message id found for reaction supplemental message",status:"drop"};c=(b=c.key)==null?void 0:b.id;return{directive:{actionType:d("MpsTypes").ActionType.UpsertSupplemental,isLocalOnly:!1,isTransportErrorPlaceholder:!1,supplementalKey:h(a),tags:[],targetMessageId:d("MpsTypes").toMessageId(c)},status:"success"}}function w(a,b){a=b.subProtocol();if((a==null?void 0:a.kind)!=="consumerApplication")return i;b=a.proto;a=(a=b.payload)==null?void 0:(b=a.applicationData)==null?void 0:b.revoke;if(a==null)return i;if(((b=a.key)==null?void 0:b.id)==null)return{errorMessage:"no target message id found for revoked message",status:"drop"};b=a.key.id;return{directive:{actionType:d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:d("MpsTypes").toMessageId(b)},status:"success"}}function x(a,b){a=a.locallyTransformedMessage();a=(a==null?void 0:a.proto.pollUpdateMessage)!=null;return{actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!a,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:b.messageId}}function y(a,b){var c;b=b.subProtocol();if((b==null?void 0:b.kind)!=="armadillo")return i;b=b;return((c=b.payload)==null?void 0:(c=c.applicationData)==null?void 0:(c=c.metadataSync)==null?void 0:c.actions)!=null||((c=b.payload)==null?void 0:(b=c.signal)==null?void 0:b.encryptedBackupsSecrets)!=null?{directive:{actionType:d("MpsTypes").ActionType.Preprocess,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:a.messageId},status:"success"}:i}function z(a,b){try{a=c("nullthrows")(a.encryptedTransportMessage());var e=[r,s,v,u,w,y,q,p,o,n,t];for(e of e){var f=e(b,a);if(f.status==="success")return d("WAResultOrError").makeResult(f.directive);if(f.status==="drop")return d("WAResultOrError").makeError(f.errorMessage)}d("MWFBLogger").MPSLogger.mustfix("Unknown message type %s",(f=a.subProtocol())==null?void 0:f.kind);return d("WAResultOrError").makeResult({actionType:d("MpsTypes").ActionType.Unknown,isLocalOnly:!0,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:b.messageId})}catch(a){e=c("getErrorSafe")(a);c("FBLogger")("mps").catching(e).mustfix("Directive generation failed for message");return d("WAResultOrError").DEPRECATED_makeError("runtime-error",e)}}function A(a,b){var e;a=c("nullthrows")(a.encryptedTransportEvent()).proto;if(((e=a.placeholder)==null?void 0:e.type)!=null)return{actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!0,isTransportErrorPlaceholder:!0,tags:[],targetMessageId:b.messageId};if(a.event!=null)return{actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!0,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:b.messageId}}function B(a,b){var e,f=c("nullthrows")(a.encryptedTransportEvent()).proto;f=f.placeholder!=null;switch((e=a.proto.metadata)==null?void 0:e.futureProofBehavior){case d("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofPlaceholder:return d("WAResultOrError").makeResult({actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!0,isTransportErrorPlaceholder:f,tags:[],targetMessageId:b.messageId});case d("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofNoPlaceholder:case d("MpsFutureProofKey").WCEPlaintextPayloadFutureProof.WCEPlaintextPayloadFutureProofIgnore:return d("WAResultOrError").makeResult({actionType:d("MpsTypes").ActionType.Noop,isLocalOnly:!0,isTransportErrorPlaceholder:f,tags:[],targetMessageId:b.messageId});default:e=A(a,b);return d("WAResultOrError").makeResult(e!=null?e:{actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!0,isTransportErrorPlaceholder:f,tags:[],targetMessageId:b.messageId})}}function C(a){return{actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!d("MAWMpsGating").isMpsUploadAdminMessageEnabled(),isTransportErrorPlaceholder:!1,tags:[],targetMessageId:a.messageId}}function D(a){var b=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(a.payload),c=b.payload();switch(c.kind){case"messageApplication":return z(b,a);case"transportEvent":return B(b,a);case"locallyTransformedMessage":return d("WAResultOrError").makeResult(x(b,a));case"adminMessage":return d("WAResultOrError").makeResult(C(a));default:c.kind}return d("WAResultOrError").makeError("Incoming message has no payload")}a={name:"MawMpsDirectiveGeneratorPreprocessor",process:function(a,b){b.metric.addPoint("directive_generation_start");var d=[],e=new Map();a.forEach(function(a){var b=a.directive,f=a.insertionSource;a=a.message;var g=D(a);if(g.success&&g.value!=null){d.push({directive:babelHelpers["extends"]({},g.value,{debugFlags:["WA"]}),insertionSource:f,message:a});return}if(b!=null){d.push({directive:b,insertionSource:f,message:a});return}e.set(a.messageId,(b=g.payload)!=null?b:c("err")("Directive generation failed for message - runtime error"))});b.metric.addPoint("directive_generation_end");return{errors:e,payload:d}}};g.createRavenActionSupplementalKeyMps=k;g.createPollUpdateSupplementalKeyMps=l;g.generateDirectiveForMessage=D;g.MawMpsDirectiveGeneratorPreprocessor=a}),98);
__d("MAWMpsMessageRangeQuery",["CoalescingLoader","EBLS","EBMessageRangeQueryForThreads","LSVec","MAWConvertEchoMessagesToEBProtobufs","MAWEncryptedBackupUtils","MAWJobDefinitions","Promise","asyncToGeneratorRuntime","first","justknobx","last"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){var b=a.args,e=a.echo,f=a.messageRangeInfo;a=a.protobuf;a=[].concat(d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(a),d("MAWConvertEchoMessagesToEBProtobufs").convertEchoMessagesToEBProtobufs(c("LSVec").toArray(e).map(d("MAWJobDefinitions").toEncodedEchoMessage),b.chatJid));a.sort(function(a,b){return a.toplevelProtobuf.protobufTimestampMS-b.toplevelProtobuf.protobufTimestampMS});e=b.direction==="after"?f.has_more_after:f.has_more_before;b=b.direction==="after"?f.has_more_before:f.has_more_after;f=c("first")(a);var g=c("last")(a);f={endCursor:f&&[f.otid,String(f.toplevelProtobuf.protobufTimestampMS)],hasNext:e,hasPrevious:b,startCursor:g&&[g.otid,String(g.toplevelProtobuf.protobufTimestampMS)]};return{success:!0,value:{cursorInfo:f,messages:a}}}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;for(var c of a)c.ctx.metric.addPoint("mps_message_range_query_start",{"int":{batchSize:a.length}});c=(yield d("EBLS").init()).db;var e=a[0].instanceKey;b=(b=a[0].source)!=null?b:-1;var f=(yield d("EBMessageRangeQueryForThreads").messageRangeQueryForThreads({instanceKey:e,restoreType:"range",source:b,storage:c,threads:a.map(function(a){return{chatJid:a.chatJid,direction:a.direction,from:a.after,numMessages:a.numMessages}})}));for(e of a)e.ctx.metric.addPoint("mps_message_range_query_end",{bool:{rangeQuerySuccess:f.success}});return f.success===!1?a.map(function(){return f}):f.value.map(function(a){return a.success===!1?a:i(a.value)})});return j.apply(this,arguments)}f=function(){return new(h||(h=b("Promise")))(function(a){return setTimeout(a,0)})};f=c("justknobx")._("4737")?f:function(){return(h||(h=b("Promise"))).resolve()};var k=new(d("CoalescingLoader").CoalescingLoader)(a,f);function e(a){return k.gen(a)}g.LOADER=k;g.MAWMpsMessageRangeQuery=e}),98);
__d("MAWMpsMutateMessagePreprocessor",["FBLogger","MAWMpsTypes","MAWProtobufDeserializers","MpsTypes","WAArmadilloApplication.pb","WAArmadilloBackupMessage.pb","WAJids","WAMsgApplication.pb","WAResultOrError","encodeProtobuf","err","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=[e,b,a];function i(a,b,c){c={ephemeralType:c};c={payload:{content:{ravenMessage:c}}};b={metadata:b.metadata,payload:{subProtocol:{armadillo:{payload:d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,c).readBuffer(),version:1}}}};c=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,b).readBuffer();b={encryptedTransportMessage:c,metadata:a.proto.metadata};return d("encodeProtobuf").encodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,b).readBuffer()}function a(a,b){var e=a.directive,f=a.insertionSource;a=a.message;b=(b=b.encryptedTransportMessage())==null?void 0:(b=b.armadillo())==null?void 0:(b=b.payload)==null?void 0:(b=b.content)==null?void 0:b.ravenActionNotifMessage;if(b==null)return;var g={actionType:d("MpsTypes").ActionType.UpsertSupplemental,debugFlags:e==null?void 0:e.debugFlags,isLocalOnly:!1,isTransportErrorPlaceholder:!1,supplementalKey:e==null?void 0:e.supplementalKey,tags:[],targetMessageId:a.messageId};b=c("nullthrows")((b=b.key)==null?void 0:b.id);e={actionType:d("MpsTypes").ActionType.DeleteSupplemental,debugFlags:e==null?void 0:e.debugFlags,isLocalOnly:!0,isTransportErrorPlaceholder:!1,supplementalKey:d("MpsTypes").toSupplementalKey(d("MAWMpsTypes").SupplementalKeyPrefixMps.RAVEN_ORIGINAL_MESSAGE),tags:[],targetMessageId:d("MpsTypes").toMessageId(b)};b={messageId:d("MpsTypes").toMessageId(b),payload:a.payload,senderId:a.senderId,threadId:a.threadId,timestampMs:a.timestampMs};return[{directive:g,insertionSource:f,message:a},{directive:e,insertionSource:f,message:b}]}function b(a,b){var c,e=a.directive,f=a.insertionSource;a=a.message;var g=b.encryptedTransportMessage();c=(c=b.encryptedTransportMessage())==null?void 0:(c=c.armadillo())==null?void 0:(c=c.payload)==null?void 0:(c=c.content)==null?void 0:(c=c.ravenMessageMsgr)==null?void 0:c.ephemeralType;if(g==null||c==null)return;var h=[];b={messageId:a.messageId,payload:i(b,g.proto,c),senderId:a.senderId,threadId:a.threadId,timestampMs:a.timestampMs};g={actionType:d("MpsTypes").ActionType.UpsertTopLevel,debugFlags:e==null?void 0:e.debugFlags,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:a.messageId};c={actionType:d("MpsTypes").ActionType.UpsertSupplemental,debugFlags:e==null?void 0:e.debugFlags,isLocalOnly:!0,isTransportErrorPlaceholder:!1,supplementalKey:d("MpsTypes").toSupplementalKey(d("MAWMpsTypes").SupplementalKeyPrefixMps.RAVEN_ORIGINAL_MESSAGE),tags:[],targetMessageId:a.messageId};h.push({directive:g,insertionSource:f,message:b},{directive:c,insertionSource:f,message:a});return h}function j(a){if(a==null)return null;a=d("WAJids").interpretAndValidateJid(a);if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="group")return a.groupJid;else{a.jidType;return null}}function e(a,b){var e=a.directive,f=a.insertionSource,g=a.message;b=(a=b.encryptedTransportMessage())==null?void 0:(b=a.armadillo())==null?void 0:(a=b.payload)==null?void 0:a.applicationData;if(b==null)return;var h=[];(a=b.metadataSync)==null?void 0:a.actions.forEach(function(a){if(a.chatAction!=null){var b=a.chatAction;if(b.chatId==null){c("FBLogger")("mps").warn("Chat id not defined for appdata chat action");return}b.chatDelete!=null&&h.push({directive:{actionType:d("MpsTypes").ActionType.DeleteThread,debugFlags:e==null?void 0:e.debugFlags,isLocalOnly:!0,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:g.messageId},insertionSource:f,message:babelHelpers["extends"]({},g,{threadId:d("MpsTypes").toThreadId(b.chatId)})});if(b.chatArchive!=null){c("FBLogger")("mps").warn("Chat archive not supported for appdata");return}if(b.chatRead!=null){c("FBLogger")("mps").warn("Chat read not supported for appdata");return}}if(a.messageAction!=null){b=a.messageAction;if(b.key==null){c("FBLogger")("mps").warn("Message key not defined for appdata message");return}a=b.key.id;var i=j(b.key.remoteJid);if(i==null){c("FBLogger")("mps").warn("Message key remoteJid incomplete for appdata message");return}if(a==null){c("FBLogger")("mps").warn("Message key id is incomplete for appdata message");return}b.messageDelete!=null&&h.push({directive:{actionType:d("MpsTypes").ActionType.DeleteTopLevel,debugFlags:e==null?void 0:e.debugFlags,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:d("MpsTypes").toMessageId(a)},insertionSource:f,message:babelHelpers["extends"]({},g,{threadId:d("MpsTypes").toThreadId(i)})})}});return h}function k(a){try{for(var b of h){var e=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(a.message.payload);e=b(a,e);if(e!=null)return d("WAResultOrError").makeResult(e)}c("FBLogger")("mps").warn("mutate preprocessor failed to mutate payload");return d("WAResultOrError").makeResult([a])}catch(a){c("FBLogger")("mps").catching(a).mustfix("Preprocess directive handling failed for message");return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)}}f={name:"MAWMpsMutateMessagePreprocessor",process:function(a,b){b.metric.addPoint("mutate_start");var e=[],f=new Map();a.forEach(function(a){var b;if(((b=a.directive)==null?void 0:b.actionType)!==d("MpsTypes").ActionType.Preprocess){e.push(a);return}b=k(a);if(b.success)e.push.apply(e,b.value);else{f.set(a.message.messageId,(a=b.payload)!=null?a:c("err")("Preprocess directive handler failed - runtime error"))}});b.metric.addPoint("mutate_end");return{errors:f,payload:e}}};g.MAWMpsMutateMessagePreprocessor=f}),98);
__d("MAWMpsSetExpiryPreprocessor",["FBLogger","MAWProtobufDeserializers","MpsTypes","WAResultOrError","getErrorSafe","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.payload;a=a.timestampMs;b=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(b);b=(b=(b=b.encryptedTransportMessage())==null?void 0:(b=b.proto.metadata)==null?void 0:(b=b.chatEphemeralSetting)==null?void 0:b.ephemeralExpiration)!=null?b:0;if(b<=0)return;return a+b*1e3}function i(a){var b=a.insertionSource,e=a.message,f=c("nullthrows")(a.directive),g=f.actionType===d("MpsTypes").ActionType.UpsertTopLevel||f.actionType===d("MpsTypes").ActionType.DeleteTopLevel||f.actionType===d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder;if(!g)return a;g=h(e);return g==null?a:{directive:babelHelpers["extends"]({},f,{expiryTimestampMs:g,isLocalOnly:!0}),insertionSource:b,message:e}}function j(a){try{return d("WAResultOrError").makeResult(i(a))}catch(b){a=c("getErrorSafe")(b);c("FBLogger")("mps").catching(a).mustfix("SetExpiry Preprocess failed");return d("WAResultOrError").makeError(a)}}a={name:"MAWMpsSetExpiryPreprocessor",process:function(a,b){b.metric.addPoint("set_expiry_start");var c=[],d=new Map();a.forEach(function(a){var b=j(a);b.success?c.push(b.value):d.set(a.message.messageId,b.error)});b.metric.addPoint("set_expiry_end");return{errors:d,payload:c}}};g.MAWMpsSetExpiryPreprocessor=a}),98);
__d("MAWMpsXMAValidationPreprocessor",["ACTSanitizerApiLazyLoader","ACTSanitizerApiTypes","FBLogger","MAWParseXMAFBConfig","MAWParseXMAProtocol","MAWProtobufDeserializers","Promise","WAResultOrError","asyncToGeneratorRuntime","err","getErrorSafe","getMediaTypeFromConsumerMessage"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){if(a.payload==null)return;a=new(d("MAWProtobufDeserializers").DeserializedMessageApplication)(a.payload);a=a.subProtocol();if((a==null?void 0:a.kind)==="consumerApplication")return a.proto}function j(){var a=null;return function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){try{if(a==null){var e=(yield d("ACTSanitizerApiLazyLoader").loadACTSanitizerApi());a=e.isXMAValid}e=a;e=e(b);if(e!==d("ACTSanitizerApiTypes").ACTSanitizerValidationResult.Valid)throw c("FBLogger")("mps").mustfixThrow("XMA validation failed - extendedContentMessage does not have valid XMA content");e=b.associatedMessage;var f=b.sentWithMessageId,g=b.targetType;b=b.xmaDataclass;if(g==null||!d("MAWParseXMAFBConfig").isFBSupportedTargetType({fbTargetType:g,xmaDataclass:b})){c("FBLogger")("mps").warn("XMA Validation - found futureproof message");return d("WAResultOrError").makeResult()}if(e!=null&&f==null)throw c("FBLogger")("mps").mustfixThrow("XMA validation failed - XMA associatedMessage cannot be received without sentWithMessageId field");if(e!=null){b=i(e);if(d("getMediaTypeFromConsumerMessage").getMediaTypeFromConsumerMessage(b)!=null&&!d("MAWParseXMAProtocol").SUPPORTED_XMA_ASSOC_MEDIA_TARGET_TYPES.has(g))throw c("FBLogger")("mps").mustfixThrow("XMA validation failed - XMA associated msg has unsupported media type")}return d("WAResultOrError").makeResult()}catch(a){f=c("getErrorSafe")(a);c("FBLogger")("mps").catching(c("getErrorSafe")(f)).mustfix("XMA Validation failed for message");return d("WAResultOrError").DEPRECATED_makeError("runtime-error",f)}});return function(a){return e.apply(this,arguments)}}()}a={name:"MAWMpsXMAValidationPreprocessorAsync",processAsync:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e.metric.addPoint("xma_validator_start");var f=new Array(a.length),g=new Map(),i=j();a=a.map(function(a,b){var e;e=(e=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(a.message.payload).encryptedTransportMessage())==null?void 0:(e=e.armadillo())==null?void 0:(e=e.payload)==null?void 0:(e=e.content)==null?void 0:e.extendedContentMessage;if(e==null){f[b]=a;return}return i(e).then(function(d){if(d.success)f[b]=a;else{g.set(a.message.messageId,(d=d.payload)!=null?d:c("err")("XMA validation failed for message - runtime error"))}})}).filter(Boolean);a.length>0&&(yield (h||(h=b("Promise"))).all(a));e.metric.addPoint("xma_validator_end");return{errors:g,payload:f.filter(Boolean)}});function e(b,c){return a.apply(this,arguments)}return e}()};g.MAWMpsXMAValidationPreprocessor=a}),98);
__d("MAWThreadUpdatePostProcessors",["FBLogger","MAWWorkerCacheServicesForMPS","Promise","asyncToGeneratorRuntime","cr:21515"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){d("MAWWorkerCacheServicesForMPS").getMAWWorkerCacheServices().calculateDelta(a);return(h||(h=b("Promise"))).resolve(new Map())}var i;function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(b("cr:21515")!=null){i==null&&(i=b("cr:21515").subscribeToPLLAndWriteToCache());try{yield b("cr:21515").submitMPSMessagesToPLL(a.map(function(a){a=a.message;return a}))}catch(a){c("FBLogger")("messenger_e2ee_web").catching(a).warn("Snippet PLL update failure")}}return(h||(h=b("Promise"))).resolve(new Map())});return j.apply(this,arguments)}f={isCritical:!1,name:"MAWReactiveThreadUpdatePostProcessor",process:a};a={isCritical:!1,name:"MAWPLLThreadUpdatePostProcessor",process:e};g.MAWReactiveThreadUpdatePostProcessor=f;g.MAWPLLThreadUpdatePostProcessor=a}),98);
__d("MawMpsCopPostprocessor",["MawMpsCop","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b.metric.addPoint("cop_start");yield d("MawMpsCop").mpsCop().postProcessMessages(a);b.metric.addPoint("cop_end");return new Map()});return i.apply(this,arguments)}a={isCritical:!0,name:"MpsCopPostProcessor",process:function(a,b){return h(a,b)}};g.MpsCopPostProcessor=a}),98);
__d("MawMpsDeleteTopLevelWithPlaceholderProcessor",["MpsTypes","Promise","WAWaitForUserUnblocked","WebMps","asyncToGeneratorRuntime","getErrorSafe","justknobx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=c("justknobx")._("4369")?c("justknobx")._("4370")?d("WAWaitForUserUnblocked").isStillWaitingForUserUnblocked()?"local-only":"local-first":"local-first":"local-only";e=(yield d("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!1,shouldFetchTags:!1,strategy:e},debug:{purpose:"preprocess_revoke_fetch_local"},messageId:b,threadId:a}));return e.value});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=c("nullthrows")(a.directive),f=a.insertionSource,g=a.message;a={directive:{actionType:d("MpsTypes").ActionType.DeleteTopLevel,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:e.targetMessageId},insertionSource:f,message:{messageId:e.targetMessageId,payload:g.payload,senderId:g.senderId,threadId:g.threadId,timestampMs:g.timestampMs}};var h=g.timestampMs;b=b.find(function(a){return a.message.messageId===e.targetMessageId&&g.threadId===a.message.threadId});if(b!=null)h=b.message.timestampMs;else{b=(yield i(g.threadId,e.targetMessageId));b!=null&&(h=b==null?void 0:b.toplevelProtobuf.timestampMs)}b={directive:e,insertionSource:f,message:babelHelpers["extends"]({},g,{timestampMs:h})};return[a,b]});return l.apply(this,arguments)}a={name:"MawMpsDeleteTopLevelWithPlaceholderProcessorAsync",processAsync:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e.metric.addPoint("delete_top_level_start");var f=[],g=new Map(),i=function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,d){try{var e=(yield k(b,a));f[d]=e}catch(a){g.set(b.message.messageId,c("getErrorSafe")(a))}});return function(a,b){return d.apply(this,arguments)}}(),j=a.map(function(a,b){var c;c=(c=a.directive)==null?void 0:c.actionType;if(c===d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder)return i(a,b);else{f[b]=[a];return null}}).filter(Boolean);j.length!==0&&(yield (h||(h=b("Promise"))).all(j));e.metric.addPoint("delete_top_level_end");return{errors:g,payload:f.flat().filter(Boolean)}});function e(b,c){return a.apply(this,arguments)}return e}()};g.MawMpsDeleteTopLevelWithPlaceholderProcessor=a}),98);
__d("MawMpsMinosUploadPostProcessor",["EBEnqueueMinosMessage","MpsTypes","Promise","WAJids","asyncToGeneratorRuntime","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=new Map(),f=[];a=a.filter(function(a){var b=a.directive,c=a.insertionSource;a=a.message;a=d("WAJids").switchOnMsgrChatJidType(d("WAJids").unsafeCoerceToChatJid(a.threadId),{group:function(){return"group"},user:function(){return"one_to_one"}});return c===d("MpsTypes").InsertionSource.Send&&a==="one_to_one"&&k(b.actionType)&&!l(b)&&!m(b)});var g=new Map(),i=new Map();a.forEach(function(a){var b=a.directive;a=a.message;b.actionType===d("MpsTypes").ActionType.DeleteTopLevel?g.set(a.messageId,{message:a,updateDirective:b}):b.actionType===d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder?i.set(b.targetMessageId,{message:a,updateDirective:b}):f.push({message:a,updateDirective:b})});i.forEach(function(a,b){g.has(b)&&g["delete"](b),f.push(a)});g.forEach(function(a){f.push(a)});if(f.length===0)return e;yield (h||(h=b("Promise"))).all(f.map(function(a){var b=a.message;a=a.updateDirective;return d("EBEnqueueMinosMessage").enqueueSentMinosMessageForUpload({message:b,updateDirective:a}).then(function(a){a.success===!1&&e.set(b.messageId,c("getErrorSafe")(a.error))})["catch"](function(a){return e.set(b.messageId,c("getErrorSafe")(a))})}));return e});return j.apply(this,arguments)}function k(a){switch(a){case d("MpsTypes").ActionType.UpsertTopLevel:case d("MpsTypes").ActionType.UpsertSupplemental:case d("MpsTypes").ActionType.DeleteTopLevel:case d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:return!0;default:return!1}}function l(a){return a.expiryTimestampMs!=null}function m(a){return a.isLocalOnly}a={isCritical:!0,name:"MawMpsMinosUploadPostProcessor",process:function(a){return i(a)}};g.MawMpsMinosUploadPostProcessor=a}),98);
__d("MawMpsPayloadValidatorPreprocessor",["FBLogger","MAWProtobufDeserializers","MpsTypes","getErrorSafe","justknobx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=new Date(2e3,1,1).getTime(),i=new Date(2500,1,1).getTime();function j(a,b){if(!a)throw c("FBLogger")("mps").mustfixThrow(b)}function k(a,b){var e=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(b.payload);e=e.proto.metadata;j(a!=null,"directive is missing");a=c("nullthrows")(a);switch(c("nullthrows")(a.actionType)){case d("MpsTypes").ActionType.UpsertSupplemental:j(a.supplementalKey!=null,"supplemental key must be set");break;case d("MpsTypes").ActionType.UpsertTopLevel:j(a.targetMessageId===b.messageId,"messageId mismatch between directive and message");break;case d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:case d("MpsTypes").ActionType.DeleteTopLevel:case d("MpsTypes").ActionType.Unknown:case d("MpsTypes").ActionType.Noop:case d("MpsTypes").ActionType.Preprocess:case d("MpsTypes").ActionType.DeleteSupplemental:case d("MpsTypes").ActionType.DeleteThread:break}j(a.expiryTimestampMs==null||a.isLocalOnly,"If expiryTimestampMs is set, isLocalOnly must be true. we do not want to upload ephemeral messages to the server. Action type: "+String(a.actionType));j(e!=null,"metadata is missing in the protobuf");j((e==null?void 0:e.senderId)===b.senderId,"senderId mismatch between protobuf metadata and message");j((e==null?void 0:e.timestampMs)===b.timestampMs||(a==null?void 0:a.actionType)===d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder,"timestamp mismatch between protobuf metadata and message");j(!b.senderId.includes("@"),"senderId should just be an FBID, got "+b.senderId+" instead");e=b.threadId;j(e.includes("@"),"threadId should be a JID, got "+e+" instead");j(b.timestampMs>h,"timestampMs should be millisecond timestamps, got "+b.timestampMs+" instead");j(b.timestampMs<i,"timestampMs should be millisecond timestamps, got "+b.timestampMs+" instead")}function l(a,b){try{k(a,b)}catch(a){return c("getErrorSafe")(a)}}a={name:"MawMpsPayloadValidatorPreprocessor",process:function(a,b){if(c("justknobx")._("1008")===!1)return{errors:new Map(),payload:a};b.metric.addPoint("payload_validator_start");var d=[],e=new Map();a.forEach(function(a){var b=a.directive,c=a.message;a=babelHelpers.objectWithoutPropertiesLoose(a,["directive","message"]);var f=l(b,c);f==null?d.push(babelHelpers["extends"]({directive:b,message:c},a)):e.set(c.messageId,f)});b.metric.addPoint("payload_validator_end");return{errors:e,payload:d}}};g.MawMpsPayloadValidatorPreprocessor=a}),98);
__d("MawMpsUploadMessagesToEBPostprocessor",["EBEnqueueMessagesForUpload","EncryptedBackupsUploadEntity","FBLogger","MAWMPSCreateBackupDirective","MpsTypes","WAAsMessageApplication","WAJids","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to enqueue messages to upload queue: ",""]);h=function(){return a};return a}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Map();try{var e=a.map(function(a){var b=a.directive;a=a.message;var c=d("MAWMPSCreateBackupDirective").getTargetProtocolMsgIdForMessage(b,a);b=d("MAWMPSCreateBackupDirective").createBackupDirectiveFromMPSMessage(b,c);if(b==null)return;var e=b.actionType===3?k(c,d("WATimeUtils").castToMillisTime(a.timestampMs)):d("EncryptedBackupsUploadEntity").toEbBackupMessageBytes(a.payload);return{backupDirective:b,externalId:c.externalId,payload:e,threadId:d("WAJids").unsafeCoerceToChatJid(a.threadId)}}).filter(Boolean);e=(yield c("EBEnqueueMessagesForUpload")({messages:e,triggerSource:"upload-message-from-mps"}));for(e of e.entries()){var f=e[0],g=e[1];if(g.success)continue;b.set(d("MpsTypes").toMessageId(f),(f=g.payload)!=null?f:c("err")(g.error))}}catch(d){c("FBLogger")("mps").MUSTFIX(h(),String(d)),a.forEach(function(a){a=a.message;b.set(a.messageId,c("err")("runtime-error",d))})}return b});return j.apply(this,arguments)}function k(a,b){return d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("WAAsMessageApplication").castToMessageApplicationBytes(new Uint8Array(0)),msgId:a,reportingMeta:void 0,sortOrderMs:b})}a={isCritical:!0,name:"MawMpsUploadMessagesToEBPostprocessor",process:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield i(a.filter(function(a){return!a.directive.isLocalOnly})));return a});function c(b){return a.apply(this,arguments)}return c}()};g.MawMpsUploadMessagesToEBPostprocessor=a}),98);
__d("MpsExtensionConfiguration",[],(function(a,b,c,d,e,f){"use strict";a=function(a){var b=a.postProcessors;a=a.preprocessors;var c=[],d=[];b.forEach(function(a){a.isCritical?c.push(a):d.push(a)});this.postProcessors={critical:c,nonCritical:d};this.preprocessors=a};f.MpsExtensionConfiguration=a}),66);
__d("MpsFtsPostProcessor",["MAWDexieTable","MAWFTSTxns","MAWFTSWorker","MAWIndexedDb","MAWTransactionMode","MpsMessageToBridgeWrapper","MpsTypes","WAStanzaUtils","asyncToGeneratorRuntime","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b,c=d("WAStanzaUtils").toStanzaId(a.directive.targetMessageId),e=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.message);if(a.directive.actionType===d("MpsTypes").ActionType.UpsertTopLevel&&a.directive.expiryTimestampMs==null&&((b=e.deserialize().encryptedTransportMessage())==null?void 0:(b=b.consumerMessage())==null?void 0:(b=b.payload)==null?void 0:(b=b.content)==null?void 0:b.messageText)!=null)return function(a){return d("MAWFTSTxns").maybePutMessageToBacklog(a,c)};if(a.directive.actionType===d("MpsTypes").ActionType.DeleteTopLevel)return function(a){return d("MAWFTSTxns").maybePutMessageToPurgeBacklog(a,c)};if(a.directive.actionType===d("MpsTypes").ActionType.DeleteThread)return function(a){return d("MAWFTSTxns").maybePutThreadToPurgeBacklog(a,e.getChatJid())}}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.map(h).map(function(b,c){return b!=null?[b,a[c]]:null}).filter(Boolean);if(b.length===0)return new Map();var e=new Map();try{yield d("MAWIndexedDb").makeMsgrTransactor({ftsBackloggedMessages:d("MAWTransactionMode").READWRITE,ftsPurgeBacklog:d("MAWTransactionMode").READWRITE,ftsPurgeThreadBacklog:d("MAWTransactionMode").READWRITE},"mpsFts",function(a){return function(){return d("MAWDexieTable").dexieAll(b.map(function(b){var d=b[0],f=b[1];return d(a)["catch"](function(a){e.set(f.message.messageId,c("getErrorSafe")(a))})}))}})()}catch(a){b.forEach(function(b){b[0];b=b[1];e.set(b.message.messageId,c("getErrorSafe")(a))})}yield d("MAWFTSWorker").getFTSWorker().index({estimatedNumMessages:b.length,type:"LOCAL"});return e});return i.apply(this,arguments)}e={isCritical:!1,name:"MpsFtsPostProcessor",process:a};g.MpsFtsPostProcessor=e}),98);
__d("MpsMediaPostProcessor",["MpsMediaEntryCache","Promise","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){try{d("MpsMediaEntryCache").hydrateCache(a.message)}catch(a){return c("getErrorSafe")(a)}}function j(a){var c=new Map();a.forEach(function(a){var b=i(a);b!=null&&c.set(a.message.messageId,b)});return(h||(h=b("Promise"))).resolve(c)}a={isCritical:!0,name:"MpsMediaPostProcessor",process:function(a){return j(a)}};g.MpsMediaPostProcessor=a}),98);
__d("MAWMpsSetup",["BackendInitLoggingUtils","EBAPIMessagePointQuery","EBAPIMessageRangeQuery","EBMessageMetadataCache","MAWCurrentUser","MAWEBLSInWorkerSwitch","MAWIndexedDbMetadata","MAWMpsAppdataEncryptedBackupsSecretsPreprocessor","MAWMpsDecodeAndParseEbProtobufs","MAWMpsDirectiveGenerator","MAWMpsGating","MAWMpsMessageRangeQuery","MAWMpsMutateMessagePreprocessor","MAWMpsSetExpiryPreprocessor","MAWMpsXMAValidationPreprocessor","MAWODSProxy","MAWQplProxy","MAWThreadUpdatePostProcessors","MawMpsCopPostprocessor","MawMpsDeleteTopLevelWithPlaceholderProcessor","MawMpsMinosUploadPostProcessor","MawMpsPayloadValidatorPreprocessor","MawMpsUploadMessagesToEBPostprocessor","MessengerWebInitData","MpsExtensionConfiguration","MpsFtsPostProcessor","MpsMediaPostProcessor","WAOdsEnums","WebMps","asyncToGeneratorRuntime","gkx","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("justknobx")._("4699")?d("MAWMpsMessageRangeQuery").MAWMpsMessageRangeQuery:c("EBAPIMessageRangeQuery");function i(){var a=[];d("MAWMpsGating").isMpsM3OrLater()&&a.push(d("MawMpsCopPostprocessor").MpsCopPostProcessor);d("MAWMpsGating").isFullMpsEnabled()&&(a.push(d("MpsFtsPostProcessor").MpsFtsPostProcessor),a.push(d("MpsMediaPostProcessor").MpsMediaPostProcessor));(d("MAWMpsGating").isFullMpsEnabled()||c("gkx")("2792"))&&(a.push(d("MAWThreadUpdatePostProcessors").MAWReactiveThreadUpdatePostProcessor),a.push(d("MAWThreadUpdatePostProcessors").MAWPLLThreadUpdatePostProcessor));(c("gkx")("14827")||c("gkx")("14828"))&&a.push(d("MawMpsMinosUploadPostProcessor").MawMpsMinosUploadPostProcessor);d("MAWMpsGating").isEbUploadViaMpsEnabled()&&a.push(d("MawMpsUploadMessagesToEBPostprocessor").MawMpsUploadMessagesToEBPostprocessor);return new(d("MpsExtensionConfiguration").MpsExtensionConfiguration)({postProcessors:a,preprocessors:[d("MAWMpsDirectiveGenerator").MawMpsDirectiveGeneratorPreprocessor,d("MawMpsDeleteTopLevelWithPlaceholderProcessor").MawMpsDeleteTopLevelWithPlaceholderProcessor,d("MAWMpsAppdataEncryptedBackupsSecretsPreprocessor").MAWMpsAppdataEncryptedBackupsSecretsPreprocessor,d("MAWMpsMutateMessagePreprocessor").MAWMpsMutateMessagePreprocessor,d("MAWMpsSetExpiryPreprocessor").MAWMpsSetExpiryPreprocessor,d("MAWMpsXMAValidationPreprocessor").MAWMpsXMAValidationPreprocessor,d("MawMpsPayloadValidatorPreprocessor").MawMpsPayloadValidatorPreprocessor]})}function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("MAWMpsGating").isMpsEnabled())return;yield d("BackendInitLoggingUtils").measureMawInit("make_mps",function(){return d("WebMps").makeMps({db:{blockingErrorThreshold:c("justknobx")._("3218"),name:d("MAWIndexedDbMetadata").webReverDbbName(d("MAWCurrentUser").getID()),onBlockingError:function(a){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"database_mps_setup_failed"),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WORM,key:"reverb.unrecoverable."+a})},qplEvent:c("qpl")._(1056840657,"2716"),strEncKey:c("MessengerWebInitData").accountKeyV2},dependencies:{decodeAndParseEbProtobufs:d("MAWMpsDecodeAndParseEbProtobufs").decodeAndParseEbProtobufs,eb:{getMetadataFromCache:d("EBMessageMetadataCache").getEBMetadataFromCache,isEbEnabled:function(){return c("MAWEBLSInWorkerSwitch").isEnabled()},messagePointQuery:c("EBAPIMessagePointQuery"),messageRangeQuery:h}},extensionConfiguration:i()})})});return j.apply(this,arguments)}g.getMpsExtensionConfiguration=i;g.mawMpsSetup=a}),98);
__d("MAWPersistedQueuesSetup",["BackendInitLoggingUtils","MAWCurrentUser","MAWIndexedDbMetadata","MAWODSProxy","MessengerWebInitData","PersistedQueueDB","WAOdsEnums","asyncToGeneratorRuntime","gkx","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){c("gkx")("7318")&&(yield d("BackendInitLoggingUtils").measureMawInit("persisted_queues_init",function(){return d("PersistedQueueDB").makePersistedQueues({blockingErrorThreshold:c("justknobx")._("3218"),dbName:d("MAWIndexedDbMetadata").persistedQueueDbName(d("MAWCurrentUser").getID()),onBlockingError:function(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WORM,key:"reverb.unrecoverable."+a})},qplEvent:c("qpl")._(1056840657,"2716"),strEncKey:c("MessengerWebInitData").accountKeyV2})}))});return h.apply(this,arguments)}g.mawPersistedQueuesSetup=a}),98);
__d("MAWDeleteDanglingParticipantsStartupJob",["MAWDbVersion","MAWIndexedDb","MAWODSProxy","MAWQplProxy","MAWTransactionMode","WALogger","WAOdsEnums","asyncToGeneratorRuntime","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Delete Dangling Participants] ",""]);h=function(){return a};return a}function i(a){d("WALogger").LOG(h(),a)}var j=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY},"deleteDanglingParticipantsStartupJob",function(a){return function(){return a.threads.toArray().then(function(b){return a.participants.where("threadJid").noneOf(b.map(function(a){return a.jid}))["delete"]()})}});a={run:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("gkx")("24027")){i("Starting job...");d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DELETE_DANGLING_PARTICIPANTS,key:"start"});var a=(yield d("MAWDbVersion").getDBVersion());if(a!=null&&a>=85){i(""+(a!=null?a:"null"));var b=(yield d("MAWQplProxy").measurePerfInQPL_USE_WITH_CARE(c("qpl")._(25310776,"6155"),"startup_job:delete_dangling_participants",function(){return j()}));d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DELETE_DANGLING_PARTICIPANTS,key:b>0?"deleted":"good"});i("Found and deleted "+b+" dangling participants")}else i("Expected DBVersion >= 85, but got "+(a!=null?a:"null")+" instead"),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DELETE_DANGLING_PARTICIPANTS,key:"db_version_not_ready"})}});function e(){return a.apply(this,arguments)}return e}()};e=a;g["default"]=e}),98);
__d("MAWStartupJob",["MAWDeleteDanglingParticipantsStartupJob","MAWQplProxy","Promise","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[c("MAWDeleteDanglingParticipantsStartupJob")];function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"backend_startup_jobs"),yield (h||(h=b("Promise"))).all(i.map(function(a){return a.run()}))});return j.apply(this,arguments)}g.runMAWStartupJobs=a}),98);
__d("MAWSetupAllDatabases",["BackendInitLoggingUtils","EARInitType","EBDB","MAWCurrentUser","MAWDBKeychain","MAWDbInitIndexedDb","MAWEARGenNewKeychainCryptoKey","MAWFTSIndexedDb","MAWIndexedDb","MAWIndexedDbMetadata","MAWJobsIndexedDb","MAWMpsSetup","MAWODSProxy","MAWPersistedQueuesSetup","MAWQplProxy","MAWStartupJob","MAWWormOdsLogger","MWEARKeychainV3","MWSetupDBEncryption","MessengerWebInitData","Promise","WAHex","WAOdsEnums","WASignalDB","WormGlobalConfig","asyncToGeneratorRuntime","cr:21079","cr:21080","cr:9939","err","gkx","justknobx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("cr:21079")||b("cr:21080");function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a,e=c("qpl")._(25310776,"6155");d("WormGlobalConfig").setWormGlobalConfig({useNoWABinary:function(){return c("gkx")("14807")}});yield (a=d("BackendInitLoggingUtils")).measureMawInit("make_ear_db",function(){return c("gkx")("12397")?(h||(h=b("Promise"))).resolve({success:!0}):d("MWSetupDBEncryption").init(c("EARInitType").MAW_INIT).then(function(a){if(!a.success){var b;throw(b=a.payload)!=null?b:c("err")("Worker failed to setup encryption DB.")}return a})});yield a.measureMawInit("make_jobs_db",d("MAWJobsIndexedDb").makeJobsDb);yield a.measureMawInit("make_fts_db",d("MAWFTSIndexedDb").makeFTSDB);var f=(yield a.measureMawInit("make_maw_ear",d("MAWDBKeychain").initEAR)),g=f.isNewUser,j=f.reinitEAR,k=f.useMawEAR;yield a.measureMawInit("make_db",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!k)return d("MAWDbInitIndexedDb").dbInit({});var a;g===!0&&(a=babelHelpers["extends"]({},yield c("MAWEARGenNewKeychainCryptoKey")(),{randomisedVersion:d("MWEARKeychainV3").generateNewRandomisedVersionNumber([]),version:1}));return d("MAWDbInitIndexedDb").dbInit({onDbPopulate:function(b){d("MAWDBKeychain").onDbPopulateMAWKeychain(b,a)}}).then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){j===!0&&(yield d("MAWDBKeychain").initEAR()),d("MWEARKeychainV3").setNamespaceSourceDbAndMarkAsReady("maw_ear",(yield d("MAWIndexedDb").getDB()).stores.backendDB())}))}));yield a.measureMawInit("make_signal_db",function(){return d("WASignalDB").makeSignalDb(d("MAWIndexedDbMetadata").signalWorm(d("MAWCurrentUser").getID()),c("MessengerWebInitData").accountKeyV2,c("justknobx")._("3218"),function(a){d("MAWQplProxy").sendQplPointThroughBridge(e,"database_signal_db_setup_failed"),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WORM,key:"unrecoverable."+a})},d("MAWWormOdsLogger").wormOdsWorkerLogger,c("qpl")._(1056840657,"2716"))});yield d("MAWMpsSetup").mawMpsSetup();yield d("MAWPersistedQueuesSetup").mawPersistedQueuesSetup();yield a.measureMawInit("make_ebdb",function(){return d("EBDB").makeEBDB(d("MAWIndexedDbMetadata").ebdbName(d("MAWCurrentUser").getID()),c("qpl")._(1056840657,"2716"),d("WAHex").parseHex(c("MessengerWebInitData").accountKeyV2),d("EBDB").EBDBEnvironment.Worker,d("MAWWormOdsLogger").wormOdsWorkerLogger)});b("cr:9939")!=null&&(yield d("BackendInitLoggingUtils").measureMawInit("make_cache_service_db",function(){return b("cr:9939").getOrSetupMAWCacheDB()}));i!=null&&(yield i.makeEBMinosDevDB(d("MAWIndexedDbMetadata").ebMinosDbDevName(d("MAWCurrentUser").getID()),c("qpl")._(1056840657,"2716"),d("WAHex").parseHex(c("MessengerWebInitData").accountKeyV2)));c("promiseDone")(d("MAWStartupJob").runMAWStartupJobs())});return j.apply(this,arguments)}g.setupAllDatabases=a}),98);
__d("MAWSetupWorkerMsg",["FBLogger","ifRequired"],(function(a,b,c,d,e,f,g){"use strict";b=function(){function a(a,b){this.setupHash=a,this.currentWorker=b}var b=a.prototype;b.postAck=function(){this.currentWorker.postMessage({setupHash:this.setupHash,type:"worker-setup-ack"})};b.postSuccess=function(){this.currentWorker.postMessage({setupHash:this.setupHash,status:"success",type:"worker-setup"})};b.postFailure=function(a){this.currentWorker.postMessage({msg:a,setupHash:this.setupHash,status:"failure",type:"worker-setup"})};b.postNoActionRequired=function(){this.currentWorker.postMessage({action:"no-action",setupHash:this.setupHash,status:"already-setup",type:"worker-setup"})};b.postRebootRequired=function(a){this.currentWorker.postMessage({action:"reboot-required",reason:a,setupHash:this.setupHash,status:"already-setup",type:"worker-setup"})};b.postBackendState=function(a){this.currentWorker.postMessage({backendState:a,setupHash:this.setupHash,type:"worker-setup-ack"})};return a}();function a(a){var b;(b=c("ifRequired")("CurrentSharedWorkerExperimental",function(b){b.shutdownWorker(a)},function(){}))!=null?b:c("ifRequired")("CurrentSharedWorker",function(b){b.shutdownWorker(a)},function(){throw c("FBLogger")("messenger_web").mustfixThrow("Failed to update shared worker, reason: "+(a!=null?a:""))})}g.WorkerSetupComms=b;g.shutdownSharedWorker=a}),98);
__d("MAWWorkerEBDeps",["EBDeps","EBLS"],(function(a,b,c,d,e,f,g){"use strict";function a(){d("EBDeps").setDeps({getLSDB:function(){return d("EBLS").init().then(function(a){return a.db})}},"MAW worker")}g.initEBDeps=a}),98);
__d("MessengerInfraReportUtils",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a===2};b=function(a){switch(a){case 1:return"START";case 2:return"SUCCESS";case 3:return"FAIL";case 4:return"CANCEL";case 113:return"TIMEOUT";case 706:return"CANCEL_UNLOAD";case 4158:return"INVALID";case 87:return"ERROR";case 5947:return"SUCCESS_PAST_TIMEOUT";case 160:return"OFFLINE";default:return String(a)}};f.isQplActionSuccessful=a;f.qplStatusStr=b}),66);
__d("MessengerInfraQplReport",["FBLogger","MAWCurrentUser","MWBroadcastChannel","MessengerInfraReport","MessengerInfraReportUtils","QPLEvent","QuickPerformanceLogger","memoizeOneWithArgs"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(a={},a[1056839232]={annotations:{string:["errorDescription","failReason","backendAckState"]},name:"MAW_TTRC",single:!0},a[25310776]={annotations:{string:["errorDescription","failReason"]},name:"MAW_INIT",single:!0},a[25305590]={annotations:{string:["uncaught_error"]},name:"LS_INIT",single:!0},a[25313175]={annotations:{"int":["errorCode","applicationError"],string:["errorDescription","thread_type"],string_array:["worker_restart_msgs","worker_restart_reasons"]},name:"MESSAGE_SEND_TO_SENT",single:!1},a[30605380]={annotations:{string:["thread_type","cancelType"]},name:"CHAT_TAB_OPEN",single:!1},a[25303796]={annotations:{string:["eb_failure_reason","range_extension_error","cancel_reason"]},name:"LOAD_MORE_MESSAGES",single:!1},a[1056843758]={annotations:{string:["range_extension_error"],string_array:["message_ranges_source"]},name:"MAW_MLV2_RANGE_EXTENSION",single:!1},a[30605361]={annotations:{string:["cancelType"]},name:"POPOVER_SHOW",single:!1},a[398998698]={annotations:{bool:["isE2eeMandated"],string:["errorDescription"]},name:"E2EE_COMPONENTS_CREATION",single:!1},a[398997251]={annotations:{string:["endCallReason"]},name:"CALL_JOIN",single:!1},a[398989351]={name:"ZENON_SDK",single:!1},a[521476165]={annotations:{string:["type","taskSource","triggerType","querySource","error","exception","thread_state_by_jid"]},name:"RESTORE_END_TO_END",single:!1},a[521471755]={annotations:{string:["error_description","exception","source","restoreType"]},name:"EB_API_MESSAGE_RANGE_QUERY",single:!1},a[25302828]={annotations:{string:["fail_reason"]},name:"MEDIA_RENDER",single:!1},a[1056846543]={annotations:{bool:["is_otid","is_thread_requested"],string:["threadState","description"]},name:"MAW_ON_ACT_THREAD_READY_USAGE",single:!1},a[25302828]={annotations:{string:["fail_reason"]},name:"MEDIA_RENDER",single:!1},a[521474469]={name:"EB_API_MESSAGE_POINT_QUERY",single:!1},a[521473213]={name:"EB_API_MEDIA_RESTORE_PROBE",single:!1},a[521476367]={name:"EB_API_MESSAGE_RANGE_QUERY_SEARCH",single:!1},a[521477507]={name:"EBLSDB_INIT",single:!0},a[1056836502]={annotations:{bool:["isMawThreadCreated","hasMappingRowAlready","hasPlaceholderRowInserted","isResultVerified"],string:["flushReason","trigger"]},name:"THREAD_MAPPING",single:!1},a[521471024]={annotations:{string:["backup_id"]},name:"FETCH_BACKUP_IDS",single:!1},a[25307273]={annotations:{string:["errorMsg"]},name:"MAW_DEVICE_REGISTRATION_ALL",single:!0},a),k=c("memoizeOneWithArgs")(function(a){return d("MWBroadcastChannel").MWBroadcastChannel("msgr_qpl_logger_"+a)}),l="not_started";b=function(){return l};e=function(){try{if(d("MessengerInfraReport").isEPD()){l="epd_blocked";return function(){}}var a=k(d("MAWCurrentUser").getID()),b=function(a){if(e[a.data[0]]==null)return c("FBLogger")("msgr_web_flytrap").warn("Handler %s is not set for QPL listener",a.data[0]);switch(a.data[0]){case"onMarkerEnd":e.onMarkerEnd==null?void 0:e.onMarkerEnd.apply(e,a.data[1]);break;case"onAnnotation":e.onAnnotation==null?void 0:e.onAnnotation.apply(e,a.data[1]);break;case"onMarkerStart":e.onMarkerStart==null?void 0:e.onMarkerStart.apply(e,a.data[1]);break;case"onMarkerPoint":e.onMarkerPoint==null?void 0:e.onMarkerPoint.apply(e,a.data[1]);break;default:c("FBLogger")("maw_init").mustfix("Must implement QPL forwarding for event name: %s",a.data[0])}};a.addEventListener("message",b);var e={onAnnotation:function(a,b,c,d,e){n(a,b,c,d,e)},onMarkerEnd:function(a,b,c){o(a,b,c)},onMarkerPoint:function(a,b,c,d){p(a,b,c,d)},onMarkerStart:function(a,b){q(a,b)}},f=(i||(i=c("QuickPerformanceLogger"))).addListener(e);l="started";return function(){f.dispose(),a.removeEventListener("message",b)}}catch(a){l="error";c("FBLogger")("msgr_web_flytrap").catching(a).mustfix("Failed to initialize QPL logger");return function(){}}};f=function(a){return(a=(a=j[a])==null?void 0:a.name)!=null?a:"UNKNOWN_QPL_NAME"};a=function(a){a=(h||(h=d("QPLEvent"))).getMarkerId(a);return j[a]};var m=function(a,b){a=d("MessengerInfraReport").getEventData(a,b);return a};function n(a,b,c,d,e){a=a.i;var f=j[a];if(!f)return;if(!((f=f.annotations)==null?void 0:(f=f[e])==null?void 0:f.includes(c)))return;e=m(a,b);if(!e)return;if(e.status!==1)return;e.annotations[c]=d}function o(a,b,c){b=b.i;var e=j[b];if(!e)return;var f=m(b,c);if(!f)return;if(f.status!==1)return;e.single&&(f.status=a,f.latestTimestampMs=Date.now());e.single||(d("MessengerInfraReportUtils").isQplActionSuccessful(a)?d("MessengerInfraReport").deleteEventData(b,c):(f.status=a,f.latestTimestampMs=Date.now()))}function p(a,b,c,d){a=a.i;var e=j[a];if(!e)return;var f=m(a,b);if(!f)return;if(f.status!==1)return;f.lastPoints.push(c);if(d!=null&&e.annotations!=null){a=function(a){var b;if(d[a]==null)return"continue";(b=e.annotations)==null?void 0:b[a].forEach(function(b){var c;c=(c=d[a])==null?void 0:c[b];c!=null&&(f.annotations[b]=c)})};for(b of Object.keys(e.annotations)){c=a(b);if(c==="continue")continue}}}function q(a,b){a=a.i;var c=j[a];if(!c)return;var e=m(a,b);if(e!=null&&e.status!==1)return;d("MessengerInfraReport").storeEventData(a,{annotations:{},lastPoints:[],single:c.single,status:1},b)}g.ReportedQPLEvents=j;g.getLoggerTabCommunication=k;g.getQplLoggerInitStatus=b;g.initializeLogger=e;g.getQplName=f;g.getReportedEvent=a;g.getCurrentEventData=m;g.onAnnotationHandler=n;g.onMarkerEndHandler=o;g.onMarkerPointHandler=p;g.onMarkerStartHandler=q}),98);
__d("MessengerInfraQplReportInWorker",["MessengerInfraQplReport","MessengerInfraReport","QuickPerformanceLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){if(d("MessengerInfraReport").isEPD())return function(){};var a=(h||(h=c("QuickPerformanceLogger"))).addListener({onAnnotation:function(a,b,c,e,f){d("MessengerInfraQplReport").onAnnotationHandler(a,b,c,e,f)},onMarkerEnd:function(a,b,c){d("MessengerInfraQplReport").onMarkerEndHandler(a,b,c)},onMarkerPoint:function(a,b,c,e){d("MessengerInfraQplReport").onMarkerPointHandler(a,b,c,e)},onMarkerStart:function(a,b){d("MessengerInfraQplReport").onMarkerStartHandler(a,b)}});return function(){a.dispose()}};g.initializeWorkerLogger=a}),98);
__d("getBroadcastChannelForExecutionContext",["CometTaskFrameworkTypes","MWBroadcastChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MWBroadcastChannel").MWBroadcastChannel(d("CometTaskFrameworkTypes").TASK_FRAMEWORK_PREFIX+"_"+String(a))}g["default"]=a}),98);
__d("loadTaskHandlerResource",["asyncToGeneratorRuntime","cr:3760"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=b("cr:3760").TASK_HANDLERS_RESOURCES[a];return a==null?null:a.getModuleIfRequired()||a.load()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("registerExecutionContext",["BroadcastChannelClientServerHandshake","FBLogger","asyncToGeneratorRuntime","getBroadcastChannelForExecutionContext","loadTaskHandlerResource","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var d=a.context,e=a.name,f=a.payload;try{var g=(yield c("loadTaskHandlerResource")(e));if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("No task handler found in context %s",e);e=(yield g.handleTask(f,d));g={context:d,result:e,type:"task_success"};b.postMessage(g)}catch(g){c("FBLogger")("messenger_web").catching(g).mustfix("%s executionContext: Failed to execute task %s",String(a.context.executionContext),a.name);e={context:d,reason:(f=g.message)!=null?f:"",type:"task_failure"};b.postMessage(e)}return});return i.apply(this,arguments)}function a(a){var b=c("getBroadcastChannelForExecutionContext")(a);d("BroadcastChannelClientServerHandshake").listen(b);var e=new Set();b.addEventListener("message",function(a){switch(a.data.type){case"execute_task":a=a.data;var d=a.context.taskID;if(e.has(d))return;e.add(d);c("promiseDone")(h(a,b)["finally"](function(){e["delete"](d)}));break;default:}});return function(){return b.close()}}g["default"]=a}),98);
__d("registerMAWExecutionContext",["CometTaskFrameworkTypes","registerExecutionContext"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("registerExecutionContext")(d("CometTaskFrameworkTypes").ExecutionContext.MAW_WORKER)}g["default"]=a}),98);
__d("MAWCommonMainWebWorker",["BackendInitLoggingUtils","BrowserLockManager","EBIsEbEnabledSubscriber","EBLS","FBLogger","IGDWebUtils","MAWBackendBridgeSetup","MAWBridge","MAWCompareWorkerSetupArgs","MAWDataSyncQueue","MAWDeleteOldLogsFromDisk","MAWDeviceRegistrationInitWorker","MAWGetDbVersion","MAWLoggingSwitches","MAWQplProxy","MAWRotateDTSG","MAWSetupAllDatabases","MAWSetupWorkerMsg","MAWVaultMaterials","MAWWebWorkerLogger","MAWWorkerEBDeps","MAWWorkerSetupArgs","MessengerInfraQplReportInWorker","WACrossWorkerPortal","WADevToolsBridge","WAGetSafeQPLError","WALogger","asyncToGeneratorRuntime","gkx","justknobx","pageID","promiseDone","qpl","registerMAWExecutionContext"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing DevTool port. Not able to setup DevTool"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Worker should not run initWorker() more than once."]);i=function(){return a};return a}var j=c("justknobx")._("1495"),k,l,m=!1;d("BackendInitLoggingUtils").initializeBackendLogging();function a(a){if(m){d("WALogger").ERROR(i());return}var e=a.currentWorker,f=d("MAWBackendBridgeSetup").initWorkerBridge(e);d("MessengerInfraQplReportInWorker").initializeWorkerLogger();v(e);e.addMessageListener("worker-setup",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield n(b,a,f)});return function(a){return c.apply(this,arguments)}}());d("MAWWorkerEBDeps").initEBDeps();l=c("BrowserLockManager")!=null&&!j?w():null;e.addMessageListener("force-flush-data",function(){self.dispatchEvent(new CustomEvent("force-flush-logs")),c("promiseDone")(d("MAWDataSyncQueue").forceFlushDataSyncQueue())});e.addMessageListener("force-flush-logs-only",function(){self.dispatchEvent(new CustomEvent("force-flush-logs"))});m=!0}function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=b.config,g=b.currentWorker;g=new(d("MAWSetupWorkerMsg").WorkerSetupComms)(a.setupHash,g);g.postAck();d("MAWQplProxy").resolveWorkerBridge();var h=d("MAWWorkerSetupArgs").getWorkerSetupArgs();try{h==null?yield p(a,b,e,g):yield r(h,a,f,g)}catch(a){c("gkx")("23986")&&c("promiseDone")(d("MAWWebWorkerLogger").flushLogs());g.postFailure(d("WAGetSafeQPLError").getSafeQPLErrorMessage(a));throw a}});return o.apply(this,arguments)}function p(a,b,c,d){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){if(!e.success){f.postFailure((e=(e=e.payload)==null?void 0:e.message)!=null?e:"bridge_setup_fail");return}var g=b.config,h=b.initBackend,i=b.makeLowLevelApi;d("MAWWorkerSetupArgs").setWorkerSetupArgs(a.content);f.postBackendState("starting_new_setup");t(a.content.vaultMaterials,f);d("MAWGetDbVersion").setArmadilloDbVersionForTest(a.content.testDbVersion);l=(e=l)!=null?e:w();k=l.then(function(a){var b=a.hmacKey;a=a.regData;return h(a,b,d("MAWBridge").getBridge(),i(a.regInfo),g)});d("MAWLoggingSwitches").removeLoggingFromBridge&&void d("MAWDeleteOldLogsFromDisk").deleteOldLogsOnStartup();u(a.content.devToolMessageChannelPort2);d("EBLS").init().then(function(a){return d("EBIsEbEnabledSubscriber").initIsEbEnabledPubSub(a.db)})["catch"](function(){d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"ebls_init_failed")});yield k;c("registerMAWExecutionContext")();f.postSuccess()});return q.apply(this,arguments)}function r(a,b,c,d){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){if(!e.isSharedWorkerContext())throw c("FBLogger")("messenger_web").mustfixThrow("only shared workers can perform re-init!");a=d("MAWCompareWorkerSetupArgs").didWorkerSetupArgsChange(a,b.content);if(a.hasArgsChanged){f.postRebootRequired(a.reason);if(e.isSharedWorkerContext()){b="update-required-"+a.reason;d("MAWSetupWorkerMsg").shutdownSharedWorker(b)}else self.close();return}k==null&&f.postFailure("No setup happened");f.postBackendState("setup_ongoing");yield k;f.postNoActionRequired()});return s.apply(this,arguments)}function t(a,b){if(c("gkx")("23909")){if(a==null||a.encryptionKey==null||a.prefixAndSuffix==null){b.postFailure("null_vault_materials");throw c("FBLogger")("messenger_web").mustfixThrow("Vault materials was null in worker setup")}d("MAWVaultMaterials").initializeVaultMaterials(a)}else d("IGDWebUtils").isOnInstagramWeb()||c("FBLogger")("messenger_web").mustfix("[Vaulting] Vaulting GK disabled on worker init")}function u(a){if(c("gkx")("3282"))if(a==null)d("WALogger").ERROR(h());else{var b=d("WACrossWorkerPortal").attachPortal(d("WADevToolsBridge").getDevToolBridge(),["devtool","mawDbDevTool"],function(a,b){a.push(b);return a},c("pageID"));b.setPort(a)}}function e(a,b){k=a,m=b}function v(a){a.postMessage({status:"worker-ready",type:"worker-setup"})}function w(){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){c("promiseDone")(d("MAWRotateDTSG").tryRotateDTSG());yield d("MAWSetupAllDatabases").setupAllDatabases();d("BackendInitLoggingUtils").MAWMICPoint("backend_db_ready");return d("MAWDeviceRegistrationInitWorker").registerDevice().then(function(a){d("BackendInitLoggingUtils").MAWMICPoint("backend_device_ready");return a})});return x.apply(this,arguments)}g.initWorker=a;g.presetBackend_TEST_ONLY=e}),98);
__d("WorkerBanzaiLazyQueueChannelWorker",["BanzaiLazyQueue","WorkerFuncChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WorkerFuncChannel").importChannel({queuePost:null},a,"banzai_lazyqueue_channel");c("BanzaiLazyQueue").onQueue.add(function(){h(b)});h(b)}function h(a){c("BanzaiLazyQueue").flushQueue().forEach(function(b){a.queuePost.apply(a,b)})}g.init=a}),98);
__d("WorkerSelf",["WorkerBanzaiLazyQueueChannelWorker","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"worker","client"),d("WorkerBanzaiLazyQueueChannelWorker").init(a),d("WorkerQPLChannel").setMessagePort(a)}g.init=a}),98);
__d("WorkerBridgeAdaptor",["WorkerMessagePort","WorkerSelf"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var e;e=a.call(this,b,c)||this;e.onmessage=null;d("WorkerSelf").init(babelHelpers.assertThisInitialized(e));e.$WorkerBridgeAdaptor$p_1=b;e.onUnhandledMessage.add(function(a){e.onmessage&&e.onmessage({data:a})});return e}var c=b.prototype;c.getBridgePort=function(){return this};return b}(d("WorkerMessagePort").WorkerSyncedMessagePort);g["default"]=a}),98);
__d("IGDAWMainWebWorker",["CurrentWorkerMessagePort","FalcoLoggerTransports","IGDAWMainWebWorkerConfig","IGDBackend","IGDLowLevelApiImpl","MAWCommonMainWebWorker","WorkerBridgeAdaptor"],(function(a,b,c,d,e,f,g){"use strict";function a(){self.Env=self.Env||{};var a=new(c("WorkerBridgeAdaptor"))(d("CurrentWorkerMessagePort").getMessagePort(),"IGDAWMainWebWorker");d("MAWCommonMainWebWorker").initWorker({config:d("IGDAWMainWebWorkerConfig").waConfig,currentWorker:a,initBackend:d("IGDBackend").startIGDBackend,makeLowLevelApi:d("IGDLowLevelApiImpl").makeLowLevelApi});d("FalcoLoggerTransports").attach()}g["default"]=a}),98);
__d("MAWFetchAndEmitThreadApi",["MAWIndexedDb","MAWThreadFetchAndEmitTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READONLY,groupInfo:a.READWRITE,groupInvites:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,poll:a.READONLY,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"fetchAndEmitThread",function(a){return function(b,c){c===void 0&&(c="fetchAndEmitThreadInTxn");return d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(a,b,void 0,void 0,c)}});g.fetchAndEmitThreadInTxn=b}),98);
__d("MAWSendXMAShareMsgUtils",["MAWBridgeMsg","MAWDbMsgTxns","MAWDexieTable","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetOrCreateMediaKnownEntriesApi","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWMediaManagementTxns","MAWMediaUtils","MAWMessageSendsCommon","MAWMsgType","MAWStartMediaUploadQplFlow","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWUploadAndHandleMedia","MAWXMAManagementTxns","MAWXMAUtils","Promise","WABlobToArrayBuffer","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MAWMessageSendsCommon").messageSendLogger.tags(["XMAShare"]);function j(a,b,c,d,e,f,g){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){h=h.get(a);h=h==null?void 0:h.optimisticUploadPromise;if(h!=null)return h;var i=d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:b,fileSize:f,serverMediaType:e,uploadEntry:"sendXMAShareMsg"});return d("MAWUploadAndHandleMedia").uploadAndHandleMedia({chatJid:b,dbCallbacks:{getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload},filename:void 0,hash:a,mediaTypeDetails:{mediaType:e,type:"regular"},plaintext:yield d("WABlobToArrayBuffer").blobToArrayBuffer(g.file),protocolMsgId:c,serverMediaType:e,size:f,uploadMediaMetric:i})["catch"](function(a){i.endFail("xma_upload_unknown_failure",{string:{errorDescription:a.toString()}});throw a})});return k.apply(this,arguments)}function a(a){var c=a.chatJid,e=a.favicon,f=a.header,g=a.optimisticUploadManager,i=a.preview,k=a.protocolMsgId;a=[i,e,f].filter(Boolean);i=a.map(function(a){var b=a.dbMedia;a=a.file;var e=d("MAWMediaUtils").getServerMediaTypeFromMediaType(b.mediaType,"xma-media");return j(b.plaintextHash,c,k,e,b.size,a,g).then(function(a){return{media:b,uploadResult:a}})});return(h||(h=b("Promise"))).all(i)}function c(a,b,c,d,e,f,g,h,i,j,k){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d,e,f,g,i,j,k,l,n){a=(yield (h||(h=b("Promise"))).all([m(a,n,"preview"),m(c,n,"header"),m(d,n,"favicon")]));c=a[0];d=a[1];n=a[2];return o(e,c,d,n,f,g,i,j,k,l)});return l.apply(this,arguments)}function m(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(a==null)return a;var e=a.file,f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.type,!0),g=f.mediaType;f=f.serverMediaType;var h=(yield d("MAWMediaUtils").genBlobHashes(e)),j=h[0];h=h[1];if(g!=="Image"){b==null?void 0:b("xma_media_type_not_image",{string:{xma_get_media_metadata_source:c,xma_media_type:g}});throw i.mustfixThrow("Expected Image when sending XMA share")}b=(yield d("WABlobToArrayBuffer").blobToArrayBuffer(e));return{blobArrayBuffer:b,file:e,hashedPlaintextHash:h,mediaInfo:{validatedAudioInfo:null,validatedDocumentFileInfo:null,validatedImageInfo:{height:a.height,width:a.width},validatedVideoInfo:null},mediaType:g,plaintextHash:j,serverMediaType:f}});return n.apply(this,arguments)}function o(a,b,c,e,f,g,h,i,j,k){var l;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(l=d("MAWTransactionMode")).READWRITE,media:l.READWRITE,mediaBackup:l.READWRITE,messages:l.READWRITE,unrenderedMessages:l.READWRITE,xma:l.READWRITE},"saveXMAMediaAndMetadata",function(l){return function(){var m=new Map();b!=null&&m.set(b.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(l,h,b.blobArrayBuffer,b.plaintextHash,void 0,void 0,b.mediaType,b.mediaInfo,b.file,!0));if(c!=null){var n=m.get(c.plaintextHash);n==null&&m.set(c.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(l,h,c.blobArrayBuffer,c.plaintextHash,void 0,void 0,c.mediaType,c.mediaInfo,c.file,!0))}if(e!=null){n=m.get(e.plaintextHash);n==null&&m.set(e.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(l,h,e.blobArrayBuffer,e.plaintextHash,void 0,void 0,e.mediaType,e.mediaInfo,e.file,!0))}n=Array.from(m.values());return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsg(l,g),d("MAWDexieTable").dexieAll(n)]).then(function(m){var n=m[0];m=m[1];m=m.reduce(function(a,b){return a.set(b.plaintextHash,b)},new Map());var o=b!=null?m.get(b.plaintextHash):void 0,q=c!=null?m.get(c.plaintextHash):void 0,r=e!=null?m.get(e.plaintextHash):void 0;d("MAWDexieTable").dexieResolve();return d("MAWXMAManagementTxns").saveXMA(l,o==null?void 0:o.mediaId,q==null?void 0:q.mediaId,r==null?void 0:r.mediaId,f,a,g,h,i,k,o==null?void 0:o.plaintextHash,q==null?void 0:q.plaintextHash,r==null?void 0:r.plaintextHash).then(function(a){d("MAWXMAUtils").isXMAStoryReply(f)&&n!=null?m=p(l,j,a,o,n):m=d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(l,a,o);return m.then(function(){return{faviconDbMedia:r,headerDbMedia:q,previewDbMedia:o}})})})}})()}function p(a,b,c,e,f){var g=d("WAJids").interpretAsUserJid(b);if(g==null)throw i.mustfixThrow("this is a flow check, participant jid can not be null");var h=c.defaultCTA;h=h==null?void 0:h.nativeUrl;g={author:g,expirationTs:c.targetExpiringAtSec,externalId:c.externalId,mediaId:e==null?void 0:e.mediaId,plaintextHash:e==null?void 0:e.plaintextHash,sourceId:h,ts:f.ts,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:c.targetType};e={content:g,remoteJid:b};if(f.type!==d("MAWMsgType").MSG_TYPE.TEXT)throw i.mustfixThrow("flow check, this message type is only in text type");var j=babelHelpers["extends"]({},f,{quote:e});return a.messages.put(j).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(j)})})}g.uploadXMAMedias=a;g.saveXMAContent=c}),98);
__d("MAWSendXMAShareMsgImplLegacy",["MAWAckLevel","MAWBridge","MAWExpiredXMACleaner","MAWFetchAndEmitThreadApi","MAWGetMsgIdByProtocolMsgId","MAWMessageSendsCommon","MAWMsgType","MAWMsgUtil","MAWOptimisticUploadManager","MAWQplProxy","MAWSendMediaMsg","MAWSendWrittenMsg","MAWSendXMAShareMsgUtils","MAWVault","MAWWriteOutgoingMsgApi","MAWXMAUtils","Promise","WAArmadilloXMA.pb","WAMediaQplHelper","WAQPLProxy","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media xma"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message missing in db"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma - missing thread"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Associated Message missing in db"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma associated msg - missing thread"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMAMessageType is null"]);n=function(){return a};return a}var o=d("MAWMessageSendsCommon").messageSendLogger.tags(["XMAShare"]);function a(a,b,c,d){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g,p=function(a,b){b===void 0&&(b={}),f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e,a,{annotations:b,instanceKey:f})};p("received_message_in_wajob");var q=Boolean(a.associatedMsgContent)&&a.associatedMsgContent!=null?d("MAWVault").vault(a.associatedMsgContent):void 0,r=void 0,s=a.associatedMsgContentExternalId,t=a.args.xmaMessageType;if(t==null){o.MUSTFIX(n());return d("WAResultOrError").makeError({isRetriable:!1,type:"xma-content-error"})}p("fetch_thread_start");yield d("MAWFetchAndEmitThreadApi").fetchAndEmitThreadInTxn(a.chatJid,"sendXMAShareMsg");p("fetch_thread_end");p("write_msg_to_db_start");var u=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(a.xmaMsgExternalId,a.chatJid,c,a.args,d("MAWMsgType").MSG_TYPE.XMA,e,f));p("write_msg_to_db_end");if(q!=null&&s!=null){q=babelHelpers["extends"]({},a.args,{content:q});p("write_associated_msg_to_db_start");s=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(s,a.chatJid,c,q,d("MAWMsgType").MSG_TYPE.TEXT,e,f));if(s.type==="missing_thread"){o.MUSTFIX(m());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}c=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(s.protocolMsgId));if(!c.success){o.MUSTFIX(l());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-referenced-msg"})}r=c.value;p("write_associated_msg_to_db_end")}if(u.type==="missing_thread"){o.MUSTFIX(k());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}p("get_underlying_message_start");q=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(u.protocolMsgId));if(!q.success){o.MUSTFIX(j());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-referenced-msg"})}var v=q.value;p("get_underlying_message_end");p("write_xma_content_to_db_start");s=a.previewFile;c=a.headerFile;q=a.faviconFile;g=babelHelpers["extends"]({},a.xmaArgs,{overlayIconGlyph:(g=a.xmaArgs.overlayIconGlyph)!=null?g:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE,xmaLayoutType:(g=a.xmaArgs.xmaLayoutType)!=null?g:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE});t=(yield d("MAWSendXMAShareMsgUtils").saveXMAContent(s,c,q,v,t,r,u.protocolMsgId,g,a.chatJid,a.args.offlineAttachmentId,p));p("write_xma_content_to_db_end");r=g.targetExpiringAtSec;g=d("MAWXMAUtils").isXMAExpired(!1,r);if(!g&&r!=null)p("add_expired+xma_cleaner_timestamp"),d("MAWExpiredXMACleaner").addNewExpiredXMACleanerTimestamp(r);else if(g){p("send_expired_written_msg_start");r=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:u.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(e,f),"MAWSendXMAShareMsg-isExpired"));r.success===!0?(p("send_expired_written_msg_end"),d("MAWBridge").getBridge().fireAndForget("event","handleMessageSendResult",{report:{chatJid:u.protocolMsgId.chat,content:a.args.content,ephemeralSetting:a.args.ephemeralSetting,externalId:u.protocolMsgId.externalId,initiatingSource:a.args.initiatingSource,messageType:"sendMsg",quote:a.args.quote,source:a.args.source,specialTextSize:a.args.specialTextSize,xmaMessageType:a.args.xmaMessageType},success:!0},!0)):(p("send_expired_written_msg_fail",{string:{errorType:r.error.type}}),d("MAWBridge").getBridge().fireAndForget("event","handleMessageSendResult",{success:!1},!0))}p("upload_media_to_backend_start",{bool:{has_xma_favicon:t.faviconDbMedia!=null,has_xma_header:t.headerDbMedia!=null,has_xma_preview:t.previewDbMedia!=null},string:{xma_favicon_size_bucket:t.faviconDbMedia!=null?d("WAMediaQplHelper").convertIntegerSizeToStringBucket(t.faviconDbMedia.size):void 0,xma_header_size_bucket:t.headerDbMedia!=null?d("WAMediaQplHelper").convertIntegerSizeToStringBucket(t.headerDbMedia.size):void 0,xma_preview_size_bucket:t.previewDbMedia!=null?d("WAMediaQplHelper").convertIntegerSizeToStringBucket(t.previewDbMedia.size):void 0}});var w=d("MAWOptimisticUploadManager").getOptimisticUploadManager();g=(yield d("MAWSendXMAShareMsgUtils").uploadXMAMedias({chatJid:a.chatJid,favicon:t.faviconDbMedia!=null&&q!=null?{dbMedia:t.faviconDbMedia,file:q}:null,header:t.headerDbMedia!=null&&c!=null?{dbMedia:t.headerDbMedia,file:c}:null,optimisticUploadManager:w,preview:t.previewDbMedia!=null&&s!=null?{dbMedia:t.previewDbMedia,file:s}:null,protocolMsgId:u.protocolMsgId}));r=g.filter(function(a){return!a.uploadResult.success}).length;if(r>0){o.MUSTFIX(i());p("upload_media_to_backend_fail");yield d("MAWMsgUtil").updateSystemAckWithTxn(v,d("MAWAckLevel").ACK.failed);return d("WAResultOrError").makeError({isRetriable:!1,type:"xma-content-error"})}p("upload_media_to_backend_end");p("write_upload_result_to_db_start");q=g.map(function(a){var c=a.uploadResult;a=a.media;return c.success===!1?(h||(h=b("Promise"))).resolve():d("MAWSendMediaMsg").mediaSender().perisitMediaEntryForQuickMediaSend(a.plaintextHash,v,c.value)});yield (h||(h=b("Promise"))).all(q);p("write_upload_result_to_db_end");p("send_written_msg_start");c=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:u.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(e,f),"MAWSendXMAShareMsg"));if(c.success===!0){p("clean_up_memory_start");g.forEach(function(a){w["delete"](a.media.plaintextHash)});p("clean_up_memory_end");p("send_written_msg_end");t={chatJid:u.protocolMsgId.chat,content:a.args.content,ephemeralSetting:a.args.ephemeralSetting,externalId:u.protocolMsgId.externalId,initiatingSource:a.args.initiatingSource,messageType:"sendMsg",quote:a.args.quote,source:a.args.source,specialTextSize:a.args.specialTextSize,xmaMessageType:a.args.xmaMessageType};return d("WAResultOrError").makeResult(t)}else{p("clean_up_memory_start");g.forEach(function(a){w["delete"](a.media.plaintextHash)});p("clean_up_memory_end");p("send_written_msg_fail",{string:{errorType:c.error.type}});return d("WAResultOrError").makeError(c.error)}});return p.apply(this,arguments)}g["default"]=a}),98);
__d("SharedWorkerBootstrap",["CurrentSharedWorker","CurrentSharedWorkerAdapter"],(function(a,b,c,d,e,f,g){"use strict";function a(a){h(function(){return b.call(null,a)})}function c(a){h(function(){return a})}function h(a){d("CurrentSharedWorker").onInitComplete(function(){var b=a();if(typeof b==="function"||b!==null)try{b(new(d("CurrentSharedWorkerAdapter").CurrentSharedWorkerAdapter)())}catch(a){}})}g.start=a;g.startServerJS=c}),98);
__d("SharedOrWebWorkerBootstrapInit",["SharedWorkerBootstrap","WorkerBootstrap"],(function(a,b,c,d,e,f){"use strict";function a(a){"SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope?b("SharedWorkerBootstrap").startServerJS(a):b("WorkerBootstrap").startServerJS(a)}f.startServerJS=a}),66);